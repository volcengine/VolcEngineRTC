---
is_dir: False    # True for dir; False for doc
status: 1    # 1 for online; 0 for offline
keywords: 实时音视频    # use ',' as separator
---

检测扬声器设备（一般为 PC 端），以确定用户设备是否支持所需的音视频功能。对扬声器设备进行枚举与选择、音量调节与检测。

## 时序图

![alt](https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_5b4eb85b236feecf84a96038f54acf30.png)

## 相关 API

| **功能点** || Windows | MacOS |
| --- | --- | --- | --- | --- |
| 获取音频设备管理器 || [getAudioDeviceManager](70095#IRTCVideo-getaudiodevicemanager) | [getAudioDeviceManager](70092#ByteRTCVideo-getaudiodevicemanager) |
| 枚举扬声器 | 枚举设备 | [enumerateAudioPlaybackDevices](70095#IAudioDeviceManager-enumerateaudioplaybackdevices) | [enumerateAudioPlaybackDevices](70092#ByteRTCAudioDeviceManager-enumerateaudioplaybackdevices) |
| ^^ | 获取设备数量 | [getCount](70095#IAudioDeviceCollection-getcount) | [getCount](70092#ByteRTCDeviceCollection-getcount) |
| ^^ | 获取设备 | [getDevice](70095#IAudioDeviceCollection-getdevice) | [getDevice:](70092#ByteRTCDeviceCollection-getdevice-devicename-deviceid) |
| ^^ | 释放设备 | [release](70095#IAudioDeviceCollection-release) |  |
| 切换扬声器 | 获取音频播放设备 | [getAudioPlaybackDevice](70095#IAudioDeviceManager-getaudioplaybackdevice) | [getAudioPlaybackDevice:](70092#ByteRTCAudioDeviceManager-getaudioplaybackdevice) |
| ^^ | 设置音频播放路由不跟随系统 | [followSystemPlaybackDevice](70095#IAudioDeviceManager-followsystemplaybackdevice) | [followSystemPlaybackDevice:](70092#ByteRTCAudioDeviceManager-followsystemplaybackdevice) |
| ^^ | 设置音频播放设备 | [setAudioPlaybackDevice](70095#IAudioDeviceManager-setaudioplaybackdevice) | [setAudioPlaybackDevice:](70092#ByteRTCAudioDeviceManager-setaudioplaybackdevice) |
| 扬声器设备音量回调 || [onAudioDeviceVolumeChanged](70096#IRTCVideoEventHandler-onaudiodevicevolumechanged) | [onAudioDeviceVolumeChanged:](70093#ByteRTCVideoDelegate-rtcengine-onaudiodevicevolumechanged-volume-muted) |
| 扬声器音量调节（采集的音量） || [setPlaybackVolume](70095#IRTCVideo-setplaybackvolume) | [setPlaybackVolume:](70092#ByteRTCVideo-setplaybackvolume) |
| 扬声器测试 | 初始化音频播放设备 | [initAudioPlaybackDeviceForTest](70095#IAudioDeviceManager-initaudioplaybackdevicefortest) | [initAudioPlaybackDeviceForTest:](70092#ByteRTCAudioDeviceManager-initaudioplaybackdevicefortest) |
| ^^ | 开始音频播放设备测试，循环播放指定音频文件 | [startAudioPlaybackDeviceTest](70095#IAudioDeviceManager-startaudioplaybackdevicetest) | [startAudioPlaybackDeviceTest:interval:](70092#ByteRTCAudioDeviceManager-startaudioplaybackdevicetest-interval) |
| ^^ | 停止音频播放设备测试 | [stopAudioPlaybackDeviceTest](70095#IAudioDeviceManager-stopaudioplaybackdevicetest) | [stopAudioDevicePlayTest](70092#ByteRTCAudioDeviceManager-stopaudiodeviceplaytest) |
| 扬声器测试音量回调 || [onAudioPlaybackDeviceTestVolume](70096#IRTCVideoEventHandler-onaudioplaybackdevicetestvolume) | [onAudioPlaybackDeviceTestVolume:](70093#ByteRTCVideoDelegate-rtcengine-onaudioplaybackdevicetestvolume) |

## 常见问题

该部分介绍扬声器检测过程中的常见问题，关键词如下：

- 音频播放路由是否跟随系统
	
- 设备检测前的异常问题检测
	
- 音频播放测试
	
- 音量回调
	
- 设备权限配置
	

### 音频播放路由是否跟随系统

- 用户未指定音频采集/播放设备时，默认选择系统默认设备；设备变化时自动切换。
	
- 可以通过 [followSystemPlaybackDevice](70095#IAudioDeviceManager-followsystemplaybackdevice) 设置音频播放路由是否跟随系统。如果将该方法的参数设置为false，即设置音频播放路由不跟随系统，那么用户就可以手动切换扬声器设备；如果设置音频播放路由跟随系统，将无法调用 [setAudioPlaybackDevice](70095#IAudioDeviceManager-setaudioplaybackdevice) 设置音频播放设备。
	

### 设备检测前的异常问题检测

在扬声器检测前，调用 [initAudioPlaybackDeviceForTest](70095#IAudioDeviceManager-initaudioplaybackdevicefortest) 可以检测设备不存在、权限被拒绝/禁用等异常问题。

### 音频播放测试

调用 [startAudioPlaybackDeviceTest](70095#IAudioDeviceManager-startaudioplaybackdevicetest) 可以进行扬声器检测，测试启动后，会循环播放指定的音频文件；调用 [stopAudioPlaybackDeviceTest](70095#IAudioDeviceManager-stopaudioplaybackdevicetest) 可以停止音频播放测试。

### 音量回调

当扬声器系统音量发生变化，触发 [onAudioDeviceVolumeChanged](70096#IRTCVideoEventHandler-onaudiodevicevolumechanged) 回调。通过监听该回调，可以感知扬声器音量变化；如果设备音量过小或处于静音状态，可以根据需要给用户相应的提示。

### 设备权限配置

在 macOS 系统下，需在 Info.plist 文件中设置 NSMicrophoneUsageDescription；不更改 Windows 系统设置情况下，无需申请权限即可直接访问。
具体参考 [设备权限处理](1157762)。
