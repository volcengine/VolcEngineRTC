---
is_dir: False    # True for dir; False for doc
status: 1    # 0 for offline; 1 for online; 2 for whitelist; 4 for online but hidden in TOC
keywords: 实时音视频    # use ',' as separator
---

在互动娱乐场景中，为增添场景的趣味性并提升互动体验，通常需要设置美声和音效，如变声特效、混响和降噪等，例如，在 KTV 场景中，主播可以使用立体声音效增添自己声音的立体感，快速吸引大量听众。

## 前提条件

你已经集成 RTC SDK，实现了基本的音视频通话。
支持本功能的 SDK 详见[API 参考](#api)。
使用预设的变声特效时，需要集成音频技术插件，参见[按需集成插件以缩小应用体积](1108726)。

## 名词解释

降噪包含传统降噪和 AI 降噪两部分，其中 AI 降噪主要是抑制非平稳噪声，比如键盘敲击声、桌椅碰撞声等。而传统降噪主要是抑制平稳噪声，比如空调声、风扇声等。

## 功能实现

> 以下时序图以 Android SDK 中的 API 名称为例。不同端的 SDK 中 API 或回调名称可能略有不同，以 [API 参考](#api)为准。

![alt](https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_0412045aa139621e09cdd507efe4e502.png)

### 1. 创建引擎
	

创建和初始化一个音视频引擎类。

> 如果你需要获取远端的音频数据，还需要加入房间并发布音频流，参考 [构建 RTC 应用](70123) 获取详细步骤。

```mixin-react
const list = [
  {
    "lang": "java",
    "text": `rtcVideo = RTCVideo.createRTCVideo(this, Constants.APP_ID, rtcVideoEventHandler, null, null);`,
    "selected": true,
  },
  {
    "lang": "swift",
    "text": `self.rtcVideo = ByteRTCVideo.createRTCVideo(kAppID, delegate: self, parameters: [:])`, 
  },
  {
    "lang": "cpp",
    "text": `bytertc::IRTCVideo *video = bytertc::createRTCVideo("app_id", handler, nullptr);`, 
  }
]
return (<PreCodeTabs list={list} />);
```

### 2. 开启音频采集
	
```mixin-react
const list = [
  {
    "lang": "java",
    "text": `rtcVideo.startAudioCapture();`,
    "selected": true,
  },
  {
    "lang": "swift",
    "text": `self.rtcVideo?.startAudioCapture()`, 
  },
  {
    "lang": "cpp",
    "text": `video->startAudioCapture();`, 
  }
]
return (<PreCodeTabs list={list} />);
```


### 3. 设置变声特效

通过 `setVoiceChangerType` 和 `setVoiceReverbType` 选择 RTC SDK 提供的变声和混响效果。

```mixin-react
const list = [
  {
    "lang": "java",
    "text": `// 设置变声特效
rtcVideo.setVoiceChangerType(type);
// 设置混响特效
rtcVideo.setVoiceReverbType(type);`,
    "selected": true,
  },
  {
    "lang": "swift",
    "text": `// 设置变声特效
self.rtcVideo?.setVoiceChangerType(ByteRTCVoiceChangerType(type)
// 设置混响特效
self.rtcVideo?.setVoiceReverbType(ByteRTCVoiceReverbType(type)`, 
  }, 
  {
  	"lang": "cpp",
  	"text": `int ret = 0;
//设置变声特效：原声、巨人、黄粟鼠、小黄人、颤音、机器人
ret = video->setVoiceChangerType(type);
//设置混响特效：原声、回声、演唱会、空灵、KTV、录音棚、虚拟立体声、空旷、3D人声 
ret = video->setVoiceReverbType(type);`,
  }
]
return (<PreCodeTabs list={list} />);
```

其中，PC 端使用变声特效 `setVoiceChangerType` 需要传入[音频技术 SDK 的 Token](https://www.volcengine.com/docs/6489/75566)。

```cpp
#ifdef  Q_OS_WINDOWS
    QJsonObject obj;
    QString sami_path = QApplication::applicationDirPath() + "/Resources/sami_effect";
    obj.insert("rtc.sami_app_key", QString::fromStdString(g_sami_key));
    obj.insert("rtc.sami_resource_path", sami_path);
    obj.insert("rtc.sami_token", QString::fromStdString(g_sami_token));

    QJsonDocument doc(obj);
    QString str = QJsonDocument(obj).toJson(QJsonDocument::Compact);
    std::string str_sami = str.toStdString();
    int ret = m_video->setRuntimeParameters(str_sami.c_str());
#endif //  Q_OS_WINDOWS
```

### 4. 自定义升调和混响效果

如果预设效果无法满足你的业务需求，你还可以通过 `enableLocalVoiceReverb`和 `setLocalVoiceReverbParam` 自定义人声效果。

```mixin-react
const list = [
  {
    "lang": "java",
    "text": `// 设置变调，范围 [-12,12]
rtcVideo.setLocalVoicePitch(value);

// 开启本地音效混响效果
rtcVideo.enableLocalVoiceReverb(true);
// 设置本地采集音频的混响效果
rtcVideo.setLocalVoiceReverbParam(config);`,
    "selected": true,
  },
  {
    "lang": "swift",
    "text": `// 设置变调，范围 [-12,12]
self.rtcVideo?.setLocalVoicePitch(value)

// 开启本地音效混响效果
self.rtcVideo?.enableLocalVoiceReverb(true)
// 设置本地采集音频的混响效果
self.rtcVideo?.setLocalVoiceReverbParam(config)`, 
  }, 
  {
  	"lang": "cpp",
  	"text": `// 设置变调，范围 [-12,12]
ret = video->setLocalVoicePitch(value); 

// 开启本地音效混响效果
ret = video->enableLocalVoiceReverb(true); 
// 设置本地采集音频的混响效果
ret = video->setLocalVoiceReverbParam(config);`,
  }
]
return (<PreCodeTabs list={list} />);
```


### 5. 设置降噪类型
	

降噪包含传统降噪和 AI 降噪两部分，其中 AI 降噪主要是抑制非平稳噪声，比如键盘敲击声、桌椅碰撞声等；而传统降噪主要是抑制平稳噪声，比如空调声、风扇声等。

```mixin-react
const list = [
  {
    "lang": "java",
    "text": `rtcVideo.setAnsMode(mode);`,
    "selected": true,
  },
  {
    "lang": "swift",
    "text": `self.rtcVideo?.setAnsMode(mode)`, 
  }, 
  {
  	"lang": "cpp",
  	"text": `ret = video->setAnsMode(mode);`,
  }
]
return (<PreCodeTabs list={list} />);
```

## 示例项目

参考以下项目获取完整代码。

- [Android](https://github.com/volcengine/VolcEngineRTC/blob/ApiExample\_Demo/Android/APIExample/app/src/main/java/rtc/volcengine/apiexample/examples/VoiceEffectActivity.java)
	
- [iOS](https://github.com/volcengine/VolcEngineRTC/blob/ApiExample\_Demo/iOS/ApiExample/ApiExample/AudioManager/SoundEffects/SoundEffectsViewController.swift)
	
- [PC](https://github.com/volcengine/VolcEngineRTC/tree/ApiExample\_Demo/Windows/src/Advanced/SoundEffects)

<span id = "api"></span>
## API 参考

> 说明：表格中的 macOS API 接口为 Objective-C，而示例项目中的 macOS 项目使用的是 Windows SDK 中的 API 接口。

| 平台 | Android | iOS | macOS | Windows | Linux | Electron | Flutter | Unity |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 变声 | [setVoiceChangerType](Android-api#RTCVideo-setvoicechangertype) | [setVoiceChangerType:](iOS-api#ByteRTCVideo-setvoicechangertype) | [setVoiceChangerType:](macOS-api#ByteRTCVideo-setvoicechangertype) | [setVoiceChangerType](Windows-api#IRTCVideo-setvoicechangertype) | 无 | [setVoiceChangerType](Electron-api#rtcvideo-setvoicechangertype) | [setVoiceChangerType](https://pub.dev/documentation/volc_engine_rtc/latest/api_bytertc_video_api/RTCVideo/setVoiceChangerType.html) | 无 |
| 预设混响特效 | [setVoiceReverbType](Android-api#RTCVideo-setvoicereverbtype) | [setVoiceReverbType:](iOS-api#ByteRTCVideo-setvoicereverbtype) | [setVoiceReverbType:](macOS-api#ByteRTCVideo-setvoicereverbtype) | [setVoiceReverbType](Windows-api#IRTCVideo-setvoicereverbtype) | 无 | [setVoiceReverbType](Electron-api#rtcvideo-setvoicereverbtype) | [setVoiceReverbType](https://pub.dev/documentation/volc_engine_rtc/latest/api_bytertc_video_api/RTCVideo/setVoiceReverbType.html) | [SetVoiceReverbType](https://www.volcengine.com/docs/6348/191859#IRTCVideo-setvoicereverbtype) |
| 变调 | [setLocalVoicePitch](Android-api#RTCVideo-setlocalvoicepitch) | [setLocalVoicePitch:](iOS-api#ByteRTCVideo-setlocalvoicepitch) | [setLocalVoicePitch:](macOS-api#ByteRTCVideo-setlocalvoicepitch) | [setLocalVoicePitch](Windows-api#IRTCVideo-setlocalvoicepitch) | [setLocalVoicePitch](Linux-api#IRTCVideo-setlocalvoicepitch) | [setLocalVoicePitch](Electron-api#rtcvideo-setlocalvoicepitch) | [setLocalVoicePitch](https://pub.dev/documentation/volc_engine_rtc/latest/api_bytertc_video_api/RTCVideo/setLocalVoicePitch.html) | 无 |
| 开启自定义混响效果 | [enableLocalVoiceReverb](Android-api#RTCVideo-enablelocalvoicereverb) | [enableLocalVoiceReverb:](iOS-api#ByteRTCVideo-enablelocalvoicereverb) | [enableLocalVoiceReverb:](macOS-api#ByteRTCVideo-enablelocalvoicereverb) | [enableLocalVoiceReverb](Windows-api#IRTCVideo-enablelocalvoicereverb) | 无 | [enableLocalVoiceReverb](Electron-api#rtcvideo-enablelocalvoicereverb) | [enableLocalVoiceReverb](https://pub.dev/documentation/volc_engine_rtc/latest/api_bytertc_video_api/RTCVideo/enableLocalVoiceReverb.html) | 无 |
| 设置自定义混响效果 | [setLocalVoiceReverbParam](Android-api#RTCVideo-setlocalvoicereverbparam) | [setLocalVoiceReverbParam:](iOS-api#ByteRTCVideo-setlocalvoicereverbparam) | [setLocalVoiceReverbParam:](macOS-api#ByteRTCVideo-setlocalvoicereverbparam) | [setLocalVoiceReverbParam](Windows-api#IRTCVideo-setlocalvoicereverbparam) | 无 | [setLocalVoiceReverbParam](Electron-api#rtcvideo-setlocalvoicereverbparam) | [setLocalVoiceReverbParam](https://pub.dev/documentation/volc_engine_rtc/latest/api_bytertc_video_api/RTCVideo/setLocalVoiceReverbParam.html) | 无 |
| 降噪 | [setAnsMode](Android-api#RTCVideo-setansmode) | [setAnsMode:](iOS-api#ByteRTCVideo-setansmode) | [setAnsMode:](macOS-api#ByteRTCVideo-setansmode) | [setAnsMode](Windows-api#IRTCVideo-setansmode) | [setAnsMode](Linux-api#IRTCVideo-setansmode) | [setAnsMode](Electron-api#rtcvideo-setansmode) | [setAnsMode](https://pub.dev/documentation/volc_engine_rtc/latest/api_bytertc_video_api/RTCVideo/setAnsMode.html) | 无 |

## 常见问题

### Q：调用 setAnsMode 开启降噪后，降噪不生效，或降噪效果不明显

A：如果你使用的 SDK 版本是 V3.57.1 之前的版本，确保客户端选择的房间模式为[以下模式](#channelprofile)时，AI 降噪功能才能正常开启。建议升级到最新版本，可以在任意房间模式下开启 AI 降噪。

## 功能变更日志

在 V3.57.1 之前的版本，只有以下场景时，调用 `setAnsMode` 可以开启 AI 降噪。其余场景的 AI 降噪不会生效。
<span id = "channelprofile"></span>
- 游戏语音模式：`kRoomProfileTypeGame`
	
- 高音质游戏模式：`kRoomProfileTypeGameHD`
	
- 云游戏模式：`kRoomProfileTypeCloudGame`
	
- 1 vs 1 音视频通话：`kRoomProfileTypeChat`
	
- 多端同步播放音视频：`kRoomProfileTypeLwTogether`
	
- 云端会议中的个人设备：`kRoomProfileTypeMeeting`
	
- 课堂互动模式：`kRoomProfileTypeClassroom`
	
- 云端会议中的会议室终端：`kRoomProfileTypeMeetingRoom`
