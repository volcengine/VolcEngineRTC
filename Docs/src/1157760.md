---
is_dir: False    # True for dir; False for doc
status: 1    # 1 for online; 0 for offline
keywords: 实时音视频    # use ',' as separator
---

检测麦克风设备（一般为 PC 端），以确定用户设备是否支持所需的音视频功能。对麦克风设备进行枚举、选择、音量提示、音量调节。

## 时序图

![alt](https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_b6b488cf06dad43a2a65b45c057095c5.png)

## 相关 API

| **功能点** || Windows | MacOS |
| --- | --- | --- | --- | --- |
| 获取音频设备管理器 || [getAudioDeviceManager](Windows-api#IRTCVideo-getaudiodevicemanager) | [getAudioDeviceManager](macOS-api#ByteRTCVideo-getaudiodevicemanager) |
| 枚举麦克风 | 枚举设备 | [enumerateAudioCaptureDevices](Windows-api#IAudioDeviceManager-enumerateaudiocapturedevices) | [enumerateAudioCaptureDevices](macOS-api#ByteRTCAudioDeviceManager-enumerateaudiocapturedevices) |
| ^^ | 获取设备数量 | [getCount](Windows-api#IAudioDeviceCollection-getcount) | [getCount](macOS-api#ByteRTCDeviceCollection-getcount) |
| ^^ | 获取设备 | [getDevice](Windows-api#IAudioDeviceCollection-getdevice) | [getDevice:](macOS-api#ByteRTCDeviceCollection-getdevice-devicename-deviceid) |
| ^^ | 释放设备 | [release](Windows-api#IAudioDeviceCollection-release) |  |
| 切换麦克风 | 获取音频采集设备 | [getAudioCaptureDevice](Windows-api#IAudioDeviceManager-getaudiocapturedevice) | [getAudioCaptureDevice:](macOS-api#ByteRTCAudioDeviceManager-getaudiocapturedevice) |
| ^^ | 设置音频采集路由不跟随系统 | [followSystemCaptureDevice](Windows-api#IAudioDeviceManager-followsystemcapturedevice) | [followSystemCaptureDevice:](macOS-api#ByteRTCAudioDeviceManager-followsystemcapturedevice) |
| ^^ | 设置音频采集设备 | [setAudioCaptureDevice](Windows-api#IAudioDeviceManager-setaudiocapturedevice) | [setAudioCaptureDevice:](macOS-api#ByteRTCAudioDeviceManager-setaudiocapturedevice) |
| 麦克风设备音量回调 || [onAudioDeviceVolumeChanged](Windows-callback#IRTCVideoEventHandler-onaudiodevicevolumechanged) | [onAudioDeviceVolumeChanged:](macOS-callback#ByteRTCVideoDelegate-rtcengine-onaudiodevicevolumechanged-volume-muted) |
| 麦克风音量调节（采集的音量） || [setCaptureVolume](Windows-api#IRTCVideo-setcapturevolume) | [setCaptureVolume:](macOS-api#ByteRTCVideo-setcapturevolume-volume) |
| 麦克风测试 | 初始化音频采集设备 | [initAudioCaptureDeviceForTest](Windows-api#IAudioDeviceManager-initaudiocapturedevicefortest) | [initAudioCaptureDeviceForTest:](macOS-api#ByteRTCAudioDeviceManager-initaudiocapturedevicefortest) |
| ^^ | 开始音频设备测试，持续30s | [startAudioDeviceRecordTest](Windows-api#IAudioDeviceManager-startaudiodevicerecordtest) | [startAudioDeviceRecordTest:](macOS-api#ByteRTCAudioDeviceManager-startaudiodevicerecordtest) |
| ^^ | 可以在30s内停止音频采集，并播放采集的音频 | [stopAudioDeviceRecordAndPlayTest](Windows-api#IAudioDeviceManager-stopaudiodevicerecordandplaytest) | [stopAudioDeviceRecordAndPlayTest](macOS-api#ByteRTCAudioDeviceManager-stopaudiodevicerecordandplaytest) |
| ^^ | 停止音频采集设备测试 | [stopAudioDevicePlayTest](Windows-api#IAudioDeviceManager-stopaudiodeviceplaytest) | [stopAudioRecordingDeviceTest](macOS-api#ByteRTCAudioDeviceManager-stopaudiorecordingdevicetest) |
| 麦克风测试音量回调 || [onLocalAudioPropertiesReport](Windows-callback#IRTCVideoEventHandler-onlocalaudiopropertiesreport) | [onLocalAudioPropertiesReport:](macOS-callback#ByteRTCVideoDelegate-rtcengine-onlocalaudiopropertiesreport) |

## 常见问题

该部分介绍麦克风检测过程中的常见问题，关键词如下：

- 音频采集路由是否跟随系统
	
- 设备检测前的异常问题检测
	
- 音量回调
	
- 设备权限配置
	

### 音频采集路由是否跟随系统

- 用户未指定音频采集/播放设备时，默认选择系统默认设备；设备变化时自动切换。
	
- 可以通过 [followSystemCaptureDevice](Windows-api#IAudioDeviceManager-followsystemcapturedevice) 设置音频采集路由是否跟随系统。如果将该方法的参数设置为false，即设置音频采集路由不跟随系统，那么用户就可以手动切换麦克风设备；如果设置音频采集路由跟随系统，将无法调用 [setAudioCaptureDevice](Windows-api#IAudioDeviceManager-setaudiocapturedevice) 设置音频采集设备。
	

### 设备检测前的异常问题检测

在麦克风检测前，调用 [initAudioCaptureDeviceForTest](Windows-api#IAudioDeviceManager-initaudiocapturedevicefortest) 可以检测设备不存在、权限被拒绝/禁用等异常问题。

### 音量回调

当麦克风系统音量发生变化，触发 [onAudioDeviceVolumeChanged](Windows-callback#IRTCVideoEventHandler-onaudiodevicevolumechanged) 回调。通过监听该回调，可以感知麦克风音量变化；如果设备音量过小或处于静音状态，可以根据需要给用户相应的提示。

### 设备权限配置

在 macOS 系统下，需在 Info.plist 文件中设置 NSMicrophoneUsageDescription；不更改 Windows 系统设置情况下，无需申请权限即可直接访问。
具体参考 [设备权限处理](1157762)。
