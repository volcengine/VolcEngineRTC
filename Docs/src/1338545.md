---
is_dir: False    # True for dir; False for doc
status: 4   # 1 for online; 0 for offline
---
本文介绍如何集成火山引擎 RTC WebSDK，并调用对应服务端接口实现 AI 实时交互能力。

## SDK集成

如下是一个总体接入流程，详细细节请参见 [RTC服务开通指南](69865)。

![alt](https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_6b1001c58bd34ffa51894fff23d7d8af.png =50%x)#{style="margin:auto"}#

## 整体业务流程图
![alt](https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_e6b1d81f4446f7f2eaa3aefe4117c310.jpg)
## 核心功能实现
### 进入退出房间

#### 时序图
![](https://lf3-static.bytednsdoc.com/obj/eden-cn/UJjvKJ[Y/ljhwZthlaukjlkulzlp/1310560_plantuml_diagram0.png =40%x)#{style="margin:auto"}#
#### 示例代码
- 接口定义
```typescript
// Event Listeners
export interface IEventListener {
  [VERTC.events.onUserJoined]: (e: onUserJoinedEvent) => void;
  // ... other events
}
// @brief Basic options
export interface BasicOptions {
  appId: string;
  token?: string;
  userId: string;
  roomId: string;
}

// RTC Client
export class RtcClient {
  
  // RTC Engine
  engine!: IRTCEngine;
  // 相关基础配置
  config!: BasicOptions;
  // 引擎初始化
  createEngine = (props: BasicOptions) => {
    this.config = props;
    this.engine = VERTC.createEngine(this.config.appId);
  };

  // 监听事件
  addEventListeners = (events: IEventListener) => {
    for (const event of Object.keys(events)) {
      this.engine.on(event, events[event]);
    }
  };
  // 获取可用的音频设备列表
  async getDevices(): Promise<{
    audioInputs: MediaDeviceInfo[];
  }> {
    const audioInputs = await VERTC.enumerateAudioCaptureDevices();
    return {
      audioInputs: audioInputs.map((input) => input.deviceId),
    };
  }
  // 开启内部音频采集
  startAudioCapture = async (mic: string) => {
    await this.engine.startAudioCapture(mic);
  };
  // 停止内部音频采集
  stopAudioCapture = async () => {
    await this.engine.stopAudioCapture();
  };
  //推流
  publishStream = (mediaType: MediaType) => {
    this.engine.publishStream(mediaType);
  };
  //停止推流
  unpublishStream = (mediaType: MediaType) => {
    this.engine.unpublishStream(mediaType);
  };
  //进房
  joinRoom = ({ token, username }: {
    token: string;
    username?: string;
  }): Promise<void> => {
    return this.engine.joinRoom(
      token,
      `${this.config.roomId!}`,
      {
        userId: this.config.userId,
        extraInfo: JSON.stringify({
          user_name: username || this.config.userId,
          user_id: this.config.userId,
        }),
      },
      {
        isAutoPublish: true,
        isAutoSubscribeAudio: true,
        roomProfileType: RoomProfileType.chat,
      }
    );
  };

  //离房
  leaveRoom = () => {
    this.stopAudioBot(this.config.roomId, this.config.userId);
    this.engine.leaveRoom();
  };
}
// 业务层逻辑
const token = 'Your token';
const username = 'Username';

const audioInputs = await getDevices();
const defaultUsableDevice = audioInputs?.[0];

await RtcClient.joinRoom({ token, username });
await RtcClient.startAudioCapture(defaultUsableDevice);

// 进房
await RtcClient.joinRoom({ token, username });
await RtcClient.startAudioCapture(defaultUsableDevice);

//离房

await RtcClient.stopAudioCapture();
await RtcClient.leaveRoom();
```
### AI 通话
为了实现 AI 通话，你需要调用相关 [AIGC-对话式 AI 实时交互](1315560)接口实现智能体开启、关闭、打断功能。
#### 时序图
![](https://lf3-static.bytednsdoc.com/obj/eden-cn/UJjvKJ[Y/ljhwZthlaukjlkulzlp/1310560_plantuml_diagram1.png =50%x)#{style="margin:auto"}#


#### 示例代码

```typescript
// Event Listeners
export interface IEventListener {
  [VERTC.events.onUserJoined]: (e: onUserJoinedEvent) => void;
  // ... other events
}

//Basic options
export interface BasicOptions {
  appId: string;
  token?: string;
  userId: string;
  roomId: string;
}

//RTC AIClient
export class RtcClient {
  
  //当前 AI Bot 是否启用
  audioBotEnabled = false;

  //监听事件
  addEventListeners = (events: IEventListener) => {
    for (const event of Object.keys(events)) {
      this.engine.on(event, events[event]);
    }
  };

  //@brief 启用 AI bot
  startAudioBot = async (
    roomId: string,
    userId: string,
    config,
  ) => {
    if (this.audioBotEnabled) {
      await this.stopAudioBot(roomId, userId);
    }
    /** 调用 openapi 启用 AI bot, 此处详情请参考 openapi 文档 */
    await openAPIs.StartVoiceChat(config);
    this.audioBotEnabled = true;
  };

  //停止 AI bot
  stopAudioBot = async (roomId: string, userId: string) => {
    if (this.audioBotEnabled) {
      await openAPIs.StopVoiceChat({
        AppId: 'Your App ID',
        BusinessId: 'Your Business ID',
        RoomId: roomId,
        TaskId: userId,
      });
      this.audioBotEnabled = false;
    }
  };

  //打断智能体说话
  stopAudioVoice = async (roomId: string, userId: string) => {
    if (this.audioBotEnabled) {
      const res = await openAPIs.UpdateVoiceChat({
        AppId: 'Your App ID',
        BusinessId: 'Your Business ID',
        RoomId: roomId,
        TaskId: userId,
        Command: 'interrupt',
      });
      return res;
    }
    return Promise.reject(new Error('AI 打断失败'));
  };
}

const roomId = 'Your room id';
const userId = 'Your user id';
const config = {
    // 参考 Openapi 文档进行配置
};

await RtcClient.startAudioBot(roomId, userId, config);
await RtcClient.stopAudioBot(roomId, userId);
await RtcClient.stopAudioVoice(roomId, userId);
```

## 核心功能 API 与回调参考

### API
| 功能点 | API  |
| --- | --- |
| 创建 RTCEngine 实例 | [createEngine()](104478#createengine) |
| 设置视频发布参数 | [setVideoEncoderConfig()](104478#setvideoencoderconfig) |
| 开启本地音频采集 | [startAudioCapture()](104478#startaudiocapture) |
| 开启本地视频采集 | [startVideoCapture()](104478#startvideocapture) |
| 加入 RTC 房间 | [joinRoom()](104478#joinroom) |
| 离开房间 | [leaveRoom()](104478#leaveroom) |
| 销毁引擎实例对象 | [destroyEngine()](104478#destroyengine) |
| 发布本地通过麦克风采集的媒体流 | [publishStream()](104478#publishstream) |
| 取消发布本地通过麦克风采集的媒体流 | [unpublishStream()](104478#unpublishstream) |
| 枚举可用的麦克风设备 | [(enumerateAudioCaptureDevices)](104478#enumerateaudiocapturedevices) |

### 回调

|  功能点 | 回调  |
| --- | --- |
| 远端可见用户加入房间|  [onUserJoined](104479#onuserjoined) |
| 远端可见用户离开房间 | [onUserLeave](104479#onuserleave)  |
| 远端用户麦克风采集音视频流| [onUserPublishStream](104479#onuserpublishstream) |
|远端用户麦克风采集的媒体流移除 | [onUserUnpublishStream](104479#onuserunpublishstream) |
|远端用户麦克风采集开启 | [onUserStartAudioCapture](104479#onuserstartaudiocapture) |
|远端用户麦克风采集关闭 | [onUserStopAudioCapture](104479#onuserstopaudiocapture) |