---
is_dir: False    # True for dir; False for doc
status: 1    # 1 for online; 0 for offline
keywords: 实时音视频    # use ',' as separator
---

检测摄像头设备（一般为 PC 端），以确定用户设备是否支持所需的音视频功能。对摄像头设备进行枚举、选择、预览和视频镜像。

## 时序图

![alt](https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_c1e90c38a68382dbfbacda8c92ebc49b.png)

## 相关 API

| **功能点** || Windows | MacOS |
| :-- | :-- | --- | --- | --- |
| 获取视频设备管理器 || [getVideoDeviceManager](Windows-api#IRTCVideo-getvideodevicemanager) | [getVideoDeviceManager](macOS-api#ByteRTCVideo-getvideodevicemanager) |
| 枚举摄像头 | 枚举设备 | [enumerateVideoCaptureDevices](Windows-api#IVideoDeviceManager-enumeratevideocapturedevices) | [enumerateVideoCaptureDevices](macOS-api#ByteRTCVideoDeviceManager-enumeratevideocapturedevices) |
| ^^ | 获取设备数量 | [getCount](Windows-api#IVideoDeviceCollection-getcount) | [getCount](macOS-api#ByteRTCDeviceCollection-getcount) |
| ^^ | 获取设备 | [getDevice](Windows-api#IVideoDeviceCollection-getdevice) | [getDevice:](macOS-api#ByteRTCDeviceCollection-getdevice-devicename-deviceid) |
| ^^ | 释放设备 | [release](Windows-api#IVideoDeviceCollection-release) |  |
| 切换摄像头 | 获取当前采集设备 | [getVideoCaptureDevice](Windows-api#IVideoDeviceManager-getvideocapturedevice) | [getVideoCaptureDevice:](macOS-api#ByteRTCVideoDeviceManager-getvideocapturedevice) |
| ^^ | 设置新的采集设备 | [setVideoCaptureDevice](Windows-api#IVideoDeviceManager-setvideocapturedevice) | [setVideoCaptureDevice:](macOS-api#ByteRTCVideoDeviceManager-setvideocapturedevice) |
| 预览摄像头 | 设置画布 | [setLocalVideoCanvas](Windows-api#IRTCVideo-setlocalvideocanvas) | [setLocalVideoCanvas:](macOS-api#ByteRTCVideo-setlocalvideocanvas-withcanvas) |
| ^^ | 设置视频配置（可选） | [setVideoCaptureConfig](Windows-api#IRTCVideo-setvideocaptureconfig) | [setVideoCaptureConfig:](macOS-api#ByteRTCVideo-setvideocaptureconfig) |
| ^^ | 开始采集 | [startVideoCapture](Windows-api#IRTCVideo-startvideocapture) | [startVideoCapture](macOS-api#ByteRTCVideo-startvideocapture) |
| ^^ | 更新画布（可选） | [updateLocalVideoCanvas](Windows-api#IRTCVideo-updatelocalvideocanvas) | [updateLocalVideoCanvas:](macOS-api#ByteRTCVideo-updatelocalvideocanvas-withrendermode-withbackgroundcolor) |
| 镜像摄像头 || [setLocalVideoMirrorType](Windows-api#IRTCVideo-setlocalvideomirrortype) | [setLocalVideoMirrorType:](macOS-api#ByteRTCVideo-setlocalvideomirrortype) |
| 关闭摄像头 || [stopVideoCapture](Windows-api#IRTCVideo-stopvideocapture) | [stopVideoCapture](macOS-api#ByteRTCVideo-stopvideocapture) |
| 视频设备状态回调 || [onVideoDeviceStateChanged](Windows-callback#IRTCVideoEventHandler-onvideodevicestatechanged) | [onVideoDeviceStateChanged:](macOS-callback#ByteRTCVideoDelegate-rtcengine-onvideodevicestatechanged-device_type-device_state-device_error) |

## 常见问题

该部分介绍摄像头检测过程中的常见问题，关键词如下：

- 视图绑定切换
	
- 视频画面被裁剪
	
- 设备异常处理
	
- 设备权限配置
	
- 其他
	

### 视图绑定切换

[setLocalVideoCanvas](Windows-api#IRTCVideo-setlocalvideocanvas) 将视频流绑定到本地视图。如果需要切换视图，调用绑定新视图即可；如果需要解除绑定，调用本方法传入空视图。

### 视频画面被裁剪

- 可以通过调用 [setVideoCaptureConfig](Windows-api#IRTCVideo-setvideocaptureconfig) 指定视频采集参数，包括分辨率和帧率。默认情况下，采集模式（capturePreference）设置为自动（KAuto），即 SDK 会根据服务端下发的采集配置和编码参数设置最佳采集参数。
	
- 如果采集参数和编码参数的宽高比例不一致，视频画面会被裁剪。例如，采集参数是 960x540（16:9），而编码参数是 240x180（4:3），编码时会裁剪部分图像，导致远端看到的图像视野变小，且图像会有放大效果。因此，建议采集和编码设置一样宽高比的分辨率，以避免裁剪和图像变形的情况发生。
	

### 设备异常处理

通过监听 [onVideoDeviceStateChanged](Windows-callback#IRTCVideoEventHandler-onvideodevicestatechanged) 回调获取设备状态，并进行相应的错误提示。
具体参考 [设备异常处理](https://www.volcengine.com/docs/6348/1157763)。

> 说明：插拔摄像头，也会回调 [onVideoDeviceStateChanged](Windows-callback#IRTCVideoEventHandler-onvideodevicestatechanged)，可以通过枚举设备更新设备列表；如果设备被移除，由于涉及到用户隐私问题，SDK 不会自动切换到其他设备。因此，需要重新调用 [startVideoCapture](Windows-api#IRTCVideo-startvideocapture) 进行摄像头采集。

### 设备权限配置

> 如果没有摄像头权限，[onVideoDeviceStateChanged](Windows-callback#IRTCVideoEventHandler-onvideodevicestatechanged) 会回调 kMediaDeviceErrorDeviceNoPermission 错误。

在 macOS 系统下，需在 Info.plist 文件中设置 NSCameraUsageDescription；不更改 Windows 系统设置情况下，无需申请权限即可直接访问。
具体参考 [设备权限处理](1157762)。

### 其他

- Windows 摄像头硬件不支持多个app同时使用。
	
- 如果没有调用过 [setVideoCaptureDevice](Windows-api#IVideoDeviceManager-setvideocapturedevice) 或 [startVideoCapture](Windows-api#IRTCVideo-startvideocapture)，调用 [getVideoCaptureDevice](Windows-api#IVideoDeviceManager-getvideocapturedevice) 返回的 device\_id 将是 auto；如果调用过，则返回当前使用的 device\_id。
