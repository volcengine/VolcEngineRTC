/**
 * Copyright (c) 2025 The VolcEngineRTC project authors. All Rights Reserved.
 * @brief VolcEngine Advance API
 * version: 4.58.19
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VERTC=t()}(this,(function(){"use strict";function e(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(r){if("default"!==r&&!(r in e)){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(e)}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){if(this instanceof e){var r=[null];return r.push.apply(r,arguments),new(Function.bind.apply(t,r))}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}var i=function(e){return e&&e.Math===Math&&e},o=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof t&&t)||function(){return this}()||t||Function("return this")(),a=function(e){try{return!!e()}catch(t){return!0}},s=!a((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),c=s,u=Function.prototype,d=u.apply,l=u.call,h="object"==typeof Reflect&&Reflect.apply||(c?l.bind(d):function(){return l.apply(d,arguments)}),p=s,v=Function.prototype,f=v.call,_=p&&v.bind.bind(f,f),m=p?_:function(e){return function(){return f.apply(e,arguments)}},g=m,y=g({}.toString),S=g("".slice),b=function(e){return S(y(e),8,-1)},k=b,E=m,T=function(e){if("Function"===k(e))return E(e)},I="object"==typeof document&&document.all,R={all:I,IS_HTMLDDA:void 0===I&&void 0!==I},A=R.all,w=R.IS_HTMLDDA?function(e){return"function"==typeof e||e===A}:function(e){return"function"==typeof e},C={},x=!a((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})),O=s,P=Function.prototype.call,M=O?P.bind(P):function(){return P.apply(P,arguments)},D={},N={}.propertyIsEnumerable,L=Object.getOwnPropertyDescriptor,U=L&&!N.call({1:2},1);D.f=U?function(e){var t=L(this,e);return!!t&&t.enumerable}:N;var V,F,B=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},j=a,H=b,G=Object,z=m("".split),K=j((function(){return!G("z").propertyIsEnumerable(0)}))?function(e){return"String"===H(e)?z(e,""):G(e)}:G,W=function(e){return null==e},X=W,q=TypeError,Y=function(e){if(X(e))throw q("Can't call method on "+e);return e},J=K,Q=Y,Z=function(e){return J(Q(e))},$=w,ee=R.all,te=R.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:$(e)||e===ee}:function(e){return"object"==typeof e?null!==e:$(e)},re={},ne=re,ie=o,oe=w,ae=function(e){return oe(e)?e:void 0},se=function(e,t){return arguments.length<2?ae(ne[e])||ae(ie[e]):ne[e]&&ne[e][t]||ie[e]&&ie[e][t]},ce=m({}.isPrototypeOf),ue="undefined"!=typeof navigator&&String(navigator.userAgent)||"",de=o,le=ue,he=de.process,pe=de.Deno,ve=he&&he.versions||pe&&pe.version,fe=ve&&ve.v8;fe&&(F=(V=fe.split("."))[0]>0&&V[0]<4?1:+(V[0]+V[1])),!F&&le&&(!(V=le.match(/Edge\/(\d+)/))||V[1]>=74)&&(V=le.match(/Chrome\/(\d+)/))&&(F=+V[1]);var _e=F,me=_e,ge=a,ye=o.String,Se=!!Object.getOwnPropertySymbols&&!ge((function(){var e=Symbol("symbol detection");return!ye(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&me&&me<41})),be=Se&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ke=se,Ee=w,Te=ce,Ie=Object,Re=be?function(e){return"symbol"==typeof e}:function(e){var t=ke("Symbol");return Ee(t)&&Te(t.prototype,Ie(e))},Ae=String,we=function(e){try{return Ae(e)}catch(t){return"Object"}},Ce=w,xe=we,Oe=TypeError,Pe=function(e){if(Ce(e))return e;throw Oe(xe(e)+" is not a function")},Me=Pe,De=W,Ne=function(e,t){var r=e[t];return De(r)?void 0:Me(r)},Le=M,Ue=w,Ve=te,Fe=TypeError,Be={exports:{}},je=o,He=Object.defineProperty,Ge=function(e,t){try{He(je,e,{value:t,configurable:!0,writable:!0})}catch(r){je[e]=t}return t},ze="__core-js_shared__",Ke=o[ze]||Ge(ze,{}),We=Ke;(Be.exports=function(e,t){return We[e]||(We[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.32.1",mode:"pure",copyright:"Â© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.32.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Xe=Be.exports,qe=Y,Ye=Object,Je=function(e){return Ye(qe(e))},Qe=Je,Ze=m({}.hasOwnProperty),$e=Object.hasOwn||function(e,t){return Ze(Qe(e),t)},et=m,tt=0,rt=Math.random(),nt=et(1..toString),it=function(e){return"Symbol("+(void 0===e?"":e)+")_"+nt(++tt+rt,36)},ot=Xe,at=$e,st=it,ct=Se,ut=be,dt=o.Symbol,lt=ot("wks"),ht=ut?dt.for||dt:dt&&dt.withoutSetter||st,pt=function(e){return at(lt,e)||(lt[e]=ct&&at(dt,e)?dt[e]:ht("Symbol."+e)),lt[e]},vt=M,ft=te,_t=Re,mt=Ne,gt=function(e,t){var r,n;if("string"===t&&Ue(r=e.toString)&&!Ve(n=Le(r,e)))return n;if(Ue(r=e.valueOf)&&!Ve(n=Le(r,e)))return n;if("string"!==t&&Ue(r=e.toString)&&!Ve(n=Le(r,e)))return n;throw Fe("Can't convert object to primitive value")},yt=TypeError,St=pt("toPrimitive"),bt=function(e,t){if(!ft(e)||_t(e))return e;var r,n=mt(e,St);if(n){if(void 0===t&&(t="default"),r=vt(n,e,t),!ft(r)||_t(r))return r;throw yt("Can't convert object to primitive value")}return void 0===t&&(t="number"),gt(e,t)},kt=Re,Et=function(e){var t=bt(e,"string");return kt(t)?t:t+""},Tt=te,It=o.document,Rt=Tt(It)&&Tt(It.createElement),At=function(e){return Rt?It.createElement(e):{}},wt=At,Ct=!x&&!a((function(){return 7!==Object.defineProperty(wt("div"),"a",{get:function(){return 7}}).a})),xt=x,Ot=M,Pt=D,Mt=B,Dt=Z,Nt=Et,Lt=$e,Ut=Ct,Vt=Object.getOwnPropertyDescriptor;C.f=xt?Vt:function(e,t){if(e=Dt(e),t=Nt(t),Ut)try{return Vt(e,t)}catch(r){}if(Lt(e,t))return Mt(!Ot(Pt.f,e,t),e[t])};var Ft=a,Bt=w,jt=/#|\.prototype\./,Ht=function(e,t){var r=zt[Gt(e)];return r===Wt||r!==Kt&&(Bt(t)?Ft(t):!!t)},Gt=Ht.normalize=function(e){return String(e).replace(jt,".").toLowerCase()},zt=Ht.data={},Kt=Ht.NATIVE="N",Wt=Ht.POLYFILL="P",Xt=Ht,qt=Pe,Yt=s,Jt=T(T.bind),Qt=function(e,t){return qt(e),void 0===t?e:Yt?Jt(e,t):function(){return e.apply(t,arguments)}},Zt={},$t=x&&a((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),er=te,tr=String,rr=TypeError,nr=function(e){if(er(e))return e;throw rr(tr(e)+" is not an object")},ir=x,or=Ct,ar=$t,sr=nr,cr=Et,ur=TypeError,dr=Object.defineProperty,lr=Object.getOwnPropertyDescriptor,hr="enumerable",pr="configurable",vr="writable";Zt.f=ir?ar?function(e,t,r){if(sr(e),t=cr(t),sr(r),"function"==typeof e&&"prototype"===t&&"value"in r&&vr in r&&!r[vr]){var n=lr(e,t);n&&n[vr]&&(e[t]=r.value,r={configurable:pr in r?r[pr]:n[pr],enumerable:hr in r?r[hr]:n[hr],writable:!1})}return dr(e,t,r)}:dr:function(e,t,r){if(sr(e),t=cr(t),sr(r),or)try{return dr(e,t,r)}catch(n){}if("get"in r||"set"in r)throw ur("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var fr=Zt,_r=B,mr=x?function(e,t,r){return fr.f(e,t,_r(1,r))}:function(e,t,r){return e[t]=r,e},gr=o,yr=h,Sr=T,br=w,kr=C.f,Er=Xt,Tr=re,Ir=Qt,Rr=mr,Ar=$e,wr=function(e){var t=function(r,n,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,n)}return new e(r,n,i)}return yr(e,this,arguments)};return t.prototype=e.prototype,t},Cr=function(e,t){var r,n,i,o,a,s,c,u,d,l=e.target,h=e.global,p=e.stat,v=e.proto,f=h?gr:p?gr[l]:(gr[l]||{}).prototype,_=h?Tr:Tr[l]||Rr(Tr,l,{})[l],m=_.prototype;for(o in t)n=!(r=Er(h?o:l+(p?".":"#")+o,e.forced))&&f&&Ar(f,o),s=_[o],n&&(c=e.dontCallGetSet?(d=kr(f,o))&&d.value:f[o]),a=n&&c?c:t[o],n&&typeof s==typeof a||(u=e.bind&&n?Ir(a,gr):e.wrap&&n?wr(a):v&&br(a)?Sr(a):a,(e.sham||a&&a.sham||s&&s.sham)&&Rr(u,"sham",!0),Rr(_,o,u),v&&(Ar(Tr,i=l+"Prototype")||Rr(Tr,i,{}),Rr(Tr[i],o,a),e.real&&m&&(r||!m[o])&&Rr(m,o,a)))},xr=Math.ceil,Or=Math.floor,Pr=Math.trunc||function(e){var t=+e;return(t>0?Or:xr)(t)},Mr=function(e){var t=+e;return t!=t||0===t?0:Pr(t)},Dr=Mr,Nr=Math.max,Lr=Math.min,Ur=function(e,t){var r=Dr(e);return r<0?Nr(r+t,0):Lr(r,t)},Vr=Mr,Fr=Math.min,Br=function(e){return e>0?Fr(Vr(e),9007199254740991):0},jr=Br,Hr=function(e){return jr(e.length)},Gr=Z,zr=Ur,Kr=Hr,Wr=function(e){return function(t,r,n){var i,o=Gr(t),a=Kr(o),s=zr(n,a);if(e&&r!=r){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===r)return e||s||0;return!e&&-1}},Xr={includes:Wr(!0),indexOf:Wr(!1)},qr={},Yr=$e,Jr=Z,Qr=Xr.indexOf,Zr=qr,$r=m([].push),en=function(e,t){var r,n=Jr(e),i=0,o=[];for(r in n)!Yr(Zr,r)&&Yr(n,r)&&$r(o,r);for(;t.length>i;)Yr(n,r=t[i++])&&(~Qr(o,r)||$r(o,r));return o},tn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],rn=en,nn=tn,on=Object.keys||function(e){return rn(e,nn)},an=Je,sn=on;Cr({target:"Object",stat:!0,forced:a((function(){sn(1)}))},{keys:function(e){return sn(an(e))}});var cn=re.Object.keys,un=r(cn),dn={};dn[pt("toStringTag")]="z";var ln="[object z]"===String(dn),hn=ln,pn=w,vn=b,fn=pt("toStringTag"),_n=Object,mn="Arguments"===vn(function(){return arguments}()),gn=hn?vn:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(r){}}(t=_n(e),fn))?r:mn?vn(t):"Object"===(n=vn(t))&&pn(t.callee)?"Arguments":n},yn=gn,Sn=String,bn=function(e){if("Symbol"===yn(e))throw TypeError("Cannot convert a Symbol value to a string");return Sn(e)},kn={},En=x,Tn=$t,In=Zt,Rn=nr,An=Z,wn=on;kn.f=En&&!Tn?Object.defineProperties:function(e,t){Rn(e);for(var r,n=An(t),i=wn(t),o=i.length,a=0;o>a;)In.f(e,r=i[a++],n[r]);return e};var Cn,xn=se("document","documentElement"),On=it,Pn=Xe("keys"),Mn=function(e){return Pn[e]||(Pn[e]=On(e))},Dn=nr,Nn=kn,Ln=tn,Un=qr,Vn=xn,Fn=At,Bn="prototype",jn="script",Hn=Mn("IE_PROTO"),Gn=function(){},zn=function(e){return"<"+jn+">"+e+"</"+jn+">"},Kn=function(e){e.write(zn("")),e.close();var t=e.parentWindow.Object;return e=null,t},Wn=function(){try{Cn=new ActiveXObject("htmlfile")}catch(i){}var e,t,r;Wn="undefined"!=typeof document?document.domain&&Cn?Kn(Cn):(t=Fn("iframe"),r="java"+jn+":",t.style.display="none",Vn.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(zn("document.F=Object")),e.close(),e.F):Kn(Cn);for(var n=Ln.length;n--;)delete Wn[Bn][Ln[n]];return Wn()};Un[Hn]=!0;var Xn=Object.create||function(e,t){var r;return null!==e?(Gn[Bn]=Dn(e),r=new Gn,Gn[Bn]=null,r[Hn]=e):r=Wn(),void 0===t?r:Nn.f(r,t)},qn={},Yn=en,Jn=tn.concat("length","prototype");qn.f=Object.getOwnPropertyNames||function(e){return Yn(e,Jn)};var Qn={},Zn=Et,$n=Zt,ei=B,ti=function(e,t,r){var n=Zn(t);n in e?$n.f(e,n,ei(0,r)):e[n]=r},ri=Ur,ni=Hr,ii=ti,oi=Array,ai=Math.max,si=function(e,t,r){for(var n=ni(e),i=ri(t,n),o=ri(void 0===r?n:r,n),a=oi(ai(o-i,0)),s=0;i<o;i++,s++)ii(a,s,e[i]);return a.length=s,a},ci=b,ui=Z,di=qn.f,li=si,hi="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Qn.f=function(e){return hi&&"Window"===ci(e)?function(e){try{return di(e)}catch(t){return li(hi)}}(e):di(ui(e))};var pi={};pi.f=Object.getOwnPropertySymbols;var vi=mr,fi=function(e,t,r,n){return n&&n.enumerable?e[t]=r:vi(e,t,r),e},_i=Zt,mi=function(e,t,r){return _i.f(e,t,r)},gi={},yi=pt;gi.f=yi;var Si,bi,ki,Ei=re,Ti=$e,Ii=gi,Ri=Zt.f,Ai=function(e){var t=Ei.Symbol||(Ei.Symbol={});Ti(t,e)||Ri(t,e,{value:Ii.f(e)})},wi=M,Ci=se,xi=pt,Oi=fi,Pi=function(){var e=Ci("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,n=xi("toPrimitive");t&&!t[n]&&Oi(t,n,(function(e){return wi(r,this)}),{arity:1})},Mi=gn,Di=ln?{}.toString:function(){return"[object "+Mi(this)+"]"},Ni=ln,Li=Zt.f,Ui=mr,Vi=$e,Fi=Di,Bi=pt("toStringTag"),ji=function(e,t,r,n){if(e){var i=r?e:e.prototype;Vi(i,Bi)||Li(i,Bi,{configurable:!0,value:t}),n&&!Ni&&Ui(i,"toString",Fi)}},Hi=w,Gi=o.WeakMap,zi=Hi(Gi)&&/native code/.test(String(Gi)),Ki=o,Wi=te,Xi=mr,qi=$e,Yi=Ke,Ji=Mn,Qi=qr,Zi="Object already initialized",$i=Ki.TypeError,eo=Ki.WeakMap;if(zi||Yi.state){var to=Yi.state||(Yi.state=new eo);to.get=to.get,to.has=to.has,to.set=to.set,Si=function(e,t){if(to.has(e))throw $i(Zi);return t.facade=e,to.set(e,t),t},bi=function(e){return to.get(e)||{}},ki=function(e){return to.has(e)}}else{var ro=Ji("state");Qi[ro]=!0,Si=function(e,t){if(qi(e,ro))throw $i(Zi);return t.facade=e,Xi(e,ro,t),t},bi=function(e){return qi(e,ro)?e[ro]:{}},ki=function(e){return qi(e,ro)}}var no={set:Si,get:bi,has:ki,enforce:function(e){return ki(e)?bi(e):Si(e,{})},getterFor:function(e){return function(t){var r;if(!Wi(t)||(r=bi(t)).type!==e)throw $i("Incompatible receiver, "+e+" required");return r}}},io=b,oo=Array.isArray||function(e){return"Array"===io(e)},ao=w,so=Ke,co=m(Function.toString);ao(so.inspectSource)||(so.inspectSource=function(e){return co(e)});var uo=so.inspectSource,lo=m,ho=a,po=w,vo=gn,fo=uo,_o=function(){},mo=[],go=se("Reflect","construct"),yo=/^\s*(?:class|function)\b/,So=lo(yo.exec),bo=!yo.exec(_o),ko=function(e){if(!po(e))return!1;try{return go(_o,mo,e),!0}catch(t){return!1}},Eo=function(e){if(!po(e))return!1;switch(vo(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return bo||!!So(yo,fo(e))}catch(t){return!0}};Eo.sham=!0;var To=!go||ho((function(){var e;return ko(ko.call)||!ko(Object)||!ko((function(){e=!0}))||e}))?Eo:ko,Io=oo,Ro=To,Ao=te,wo=pt("species"),Co=Array,xo=function(e){var t;return Io(e)&&(t=e.constructor,(Ro(t)&&(t===Co||Io(t.prototype))||Ao(t)&&null===(t=t[wo]))&&(t=void 0)),void 0===t?Co:t},Oo=function(e,t){return new(xo(e))(0===t?0:t)},Po=Qt,Mo=K,Do=Je,No=Hr,Lo=Oo,Uo=m([].push),Vo=function(e){var t=1===e,r=2===e,n=3===e,i=4===e,o=6===e,a=7===e,s=5===e||o;return function(c,u,d,l){for(var h,p,v=Do(c),f=Mo(v),_=Po(u,d),m=No(f),g=0,y=l||Lo,S=t?y(c,m):r||a?y(c,0):void 0;m>g;g++)if((s||g in f)&&(p=_(h=f[g],g,v),e))if(t)S[g]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return g;case 2:Uo(S,h)}else switch(e){case 4:return!1;case 7:Uo(S,h)}return o?-1:n||i?i:S}},Fo={forEach:Vo(0),map:Vo(1),filter:Vo(2),some:Vo(3),every:Vo(4),find:Vo(5),findIndex:Vo(6),filterReject:Vo(7)},Bo=Cr,jo=o,Ho=M,Go=m,zo=x,Ko=Se,Wo=a,Xo=$e,qo=ce,Yo=nr,Jo=Z,Qo=Et,Zo=bn,$o=B,ea=Xn,ta=on,ra=qn,na=Qn,ia=pi,oa=C,aa=Zt,sa=kn,ca=D,ua=fi,da=mi,la=Xe,ha=qr,pa=it,va=pt,fa=gi,_a=Ai,ma=Pi,ga=ji,ya=no,Sa=Fo.forEach,ba=Mn("hidden"),ka="Symbol",Ea="prototype",Ta=ya.set,Ia=ya.getterFor(ka),Ra=Object[Ea],Aa=jo.Symbol,wa=Aa&&Aa[Ea],Ca=jo.TypeError,xa=jo.QObject,Oa=oa.f,Pa=aa.f,Ma=na.f,Da=ca.f,Na=Go([].push),La=la("symbols"),Ua=la("op-symbols"),Va=la("wks"),Fa=!xa||!xa[Ea]||!xa[Ea].findChild,Ba=zo&&Wo((function(){return 7!==ea(Pa({},"a",{get:function(){return Pa(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=Oa(Ra,t);n&&delete Ra[t],Pa(e,t,r),n&&e!==Ra&&Pa(Ra,t,n)}:Pa,ja=function(e,t){var r=La[e]=ea(wa);return Ta(r,{type:ka,tag:e,description:t}),zo||(r.description=t),r},Ha=function(e,t,r){e===Ra&&Ha(Ua,t,r),Yo(e);var n=Qo(t);return Yo(r),Xo(La,n)?(r.enumerable?(Xo(e,ba)&&e[ba][n]&&(e[ba][n]=!1),r=ea(r,{enumerable:$o(0,!1)})):(Xo(e,ba)||Pa(e,ba,$o(1,{})),e[ba][n]=!0),Ba(e,n,r)):Pa(e,n,r)},Ga=function(e,t){Yo(e);var r=Jo(t),n=ta(r).concat(Xa(r));return Sa(n,(function(t){zo&&!Ho(za,r,t)||Ha(e,t,r[t])})),e},za=function(e){var t=Qo(e),r=Ho(Da,this,t);return!(this===Ra&&Xo(La,t)&&!Xo(Ua,t))&&(!(r||!Xo(this,t)||!Xo(La,t)||Xo(this,ba)&&this[ba][t])||r)},Ka=function(e,t){var r=Jo(e),n=Qo(t);if(r!==Ra||!Xo(La,n)||Xo(Ua,n)){var i=Oa(r,n);return!i||!Xo(La,n)||Xo(r,ba)&&r[ba][n]||(i.enumerable=!0),i}},Wa=function(e){var t=Ma(Jo(e)),r=[];return Sa(t,(function(e){Xo(La,e)||Xo(ha,e)||Na(r,e)})),r},Xa=function(e){var t=e===Ra,r=Ma(t?Ua:Jo(e)),n=[];return Sa(r,(function(e){!Xo(La,e)||t&&!Xo(Ra,e)||Na(n,La[e])})),n};Ko||(Aa=function(){if(qo(wa,this))throw Ca("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Zo(arguments[0]):void 0,t=pa(e),r=function(e){this===Ra&&Ho(r,Ua,e),Xo(this,ba)&&Xo(this[ba],t)&&(this[ba][t]=!1),Ba(this,t,$o(1,e))};return zo&&Fa&&Ba(Ra,t,{configurable:!0,set:r}),ja(t,e)},ua(wa=Aa[Ea],"toString",(function(){return Ia(this).tag})),ua(Aa,"withoutSetter",(function(e){return ja(pa(e),e)})),ca.f=za,aa.f=Ha,sa.f=Ga,oa.f=Ka,ra.f=na.f=Wa,ia.f=Xa,fa.f=function(e){return ja(va(e),e)},zo&&da(wa,"description",{configurable:!0,get:function(){return Ia(this).description}})),Bo({global:!0,constructor:!0,wrap:!0,forced:!Ko,sham:!Ko},{Symbol:Aa}),Sa(ta(Va),(function(e){_a(e)})),Bo({target:ka,stat:!0,forced:!Ko},{useSetter:function(){Fa=!0},useSimple:function(){Fa=!1}}),Bo({target:"Object",stat:!0,forced:!Ko,sham:!zo},{create:function(e,t){return void 0===t?ea(e):Ga(ea(e),t)},defineProperty:Ha,defineProperties:Ga,getOwnPropertyDescriptor:Ka}),Bo({target:"Object",stat:!0,forced:!Ko},{getOwnPropertyNames:Wa}),ma(),ga(Aa,ka),ha[ba]=!0;var qa=Se&&!!Symbol.for&&!!Symbol.keyFor,Ya=Cr,Ja=se,Qa=$e,Za=bn,$a=Xe,es=qa,ts=$a("string-to-symbol-registry"),rs=$a("symbol-to-string-registry");Ya({target:"Symbol",stat:!0,forced:!es},{for:function(e){var t=Za(e);if(Qa(ts,t))return ts[t];var r=Ja("Symbol")(t);return ts[t]=r,rs[r]=t,r}});var ns=Cr,is=$e,os=Re,as=we,ss=qa,cs=Xe("symbol-to-string-registry");ns({target:"Symbol",stat:!0,forced:!ss},{keyFor:function(e){if(!os(e))throw TypeError(as(e)+" is not a symbol");if(is(cs,e))return cs[e]}});var us=m([].slice),ds=oo,ls=w,hs=b,ps=bn,vs=m([].push),fs=Cr,_s=se,ms=h,gs=M,ys=m,Ss=a,bs=w,ks=Re,Es=us,Ts=function(e){if(ls(e))return e;if(ds(e)){for(var t=e.length,r=[],n=0;n<t;n++){var i=e[n];"string"==typeof i?vs(r,i):"number"!=typeof i&&"Number"!==hs(i)&&"String"!==hs(i)||vs(r,ps(i))}var o=r.length,a=!0;return function(e,t){if(a)return a=!1,t;if(ds(this))return t;for(var n=0;n<o;n++)if(r[n]===e)return t}}},Is=Se,Rs=String,As=_s("JSON","stringify"),ws=ys(/./.exec),Cs=ys("".charAt),xs=ys("".charCodeAt),Os=ys("".replace),Ps=ys(1..toString),Ms=/[\uD800-\uDFFF]/g,Ds=/^[\uD800-\uDBFF]$/,Ns=/^[\uDC00-\uDFFF]$/,Ls=!Is||Ss((function(){var e=_s("Symbol")("stringify detection");return"[null]"!==As([e])||"{}"!==As({a:e})||"{}"!==As(Object(e))})),Us=Ss((function(){return'"\\udf06\\ud834"'!==As("\udf06\ud834")||'"\\udead"'!==As("\udead")})),Vs=function(e,t){var r=Es(arguments),n=Ts(t);if(bs(n)||void 0!==e&&!ks(e))return r[1]=function(e,t){if(bs(n)&&(t=gs(n,this,Rs(e),t)),!ks(t))return t},ms(As,null,r)},Fs=function(e,t,r){var n=Cs(r,t-1),i=Cs(r,t+1);return ws(Ds,e)&&!ws(Ns,i)||ws(Ns,e)&&!ws(Ds,n)?"\\u"+Ps(xs(e,0),16):e};As&&fs({target:"JSON",stat:!0,arity:3,forced:Ls||Us},{stringify:function(e,t,r){var n=Es(arguments),i=ms(Ls?Vs:As,null,n);return Us&&"string"==typeof i?Os(i,Ms,Fs):i}});var Bs=pi,js=Je;Cr({target:"Object",stat:!0,forced:!Se||a((function(){Bs.f(1)}))},{getOwnPropertySymbols:function(e){var t=Bs.f;return t?t(js(e)):[]}});var Hs=re.Object.getOwnPropertySymbols,Gs=r(Hs),zs=a,Ks=_e,Ws=pt("species"),Xs=function(e){return Ks>=51||!zs((function(){var t=[];return(t.constructor={})[Ws]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},qs=Fo.filter;Cr({target:"Array",proto:!0,forced:!Xs("filter")},{filter:function(e){return qs(this,e,arguments.length>1?arguments[1]:void 0)}});var Ys=re,Js=function(e){return Ys[e+"Prototype"]},Qs=Js("Array").filter,Zs=ce,$s=Qs,ec=Array.prototype,tc=function(e){var t=e.filter;return e===ec||Zs(ec,e)&&t===ec.filter?$s:t},rc=r(tc),nc={exports:{}},ic=Cr,oc=a,ac=Z,sc=C.f,cc=x;ic({target:"Object",stat:!0,forced:!cc||oc((function(){sc(1)})),sham:!cc},{getOwnPropertyDescriptor:function(e,t){return sc(ac(e),t)}});var uc=re.Object,dc=nc.exports=function(e,t){return uc.getOwnPropertyDescriptor(e,t)};uc.getOwnPropertyDescriptor.sham&&(dc.sham=!0);var lc=nc.exports,hc=r(lc),pc=x,vc=oo,fc=TypeError,_c=Object.getOwnPropertyDescriptor,mc=pc&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}()?function(e,t){if(vc(e)&&!_c(e,"length").writable)throw fc("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},gc=TypeError,yc=function(e){if(e>9007199254740991)throw gc("Maximum allowed index exceeded");return e},Sc=Je,bc=Hr,kc=mc,Ec=yc;Cr({target:"Array",proto:!0,arity:1,forced:a((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}}()},{push:function(e){var t=Sc(this),r=bc(t),n=arguments.length;Ec(r+n);for(var i=0;i<n;i++)t[r]=arguments[i],r++;return kc(t,r),r}});var Tc,Ic,Rc,Ac=Js("Array").push,wc=ce,Cc=Ac,xc=Array.prototype,Oc=r((function(e){var t=e.push;return e===xc||wc(xc,e)&&t===xc.push?Cc:t})),Pc={},Mc=x,Dc=$e,Nc=Function.prototype,Lc=Mc&&Object.getOwnPropertyDescriptor,Uc=Dc(Nc,"name"),Vc={EXISTS:Uc,PROPER:Uc&&"something"===function(){}.name,CONFIGURABLE:Uc&&(!Mc||Mc&&Lc(Nc,"name").configurable)},Fc=!a((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Bc=$e,jc=w,Hc=Je,Gc=Fc,zc=Mn("IE_PROTO"),Kc=Object,Wc=Kc.prototype,Xc=Gc?Kc.getPrototypeOf:function(e){var t=Hc(e);if(Bc(t,zc))return t[zc];var r=t.constructor;return jc(r)&&t instanceof r?r.prototype:t instanceof Kc?Wc:null},qc=a,Yc=w,Jc=te,Qc=Xn,Zc=Xc,$c=fi,eu=pt("iterator"),tu=!1;[].keys&&("next"in(Rc=[].keys())?(Ic=Zc(Zc(Rc)))!==Object.prototype&&(Tc=Ic):tu=!0);var ru=!Jc(Tc)||qc((function(){var e={};return Tc[eu].call(e)!==e}));Yc((Tc=ru?{}:Qc(Tc))[eu])||$c(Tc,eu,(function(){return this}));var nu={IteratorPrototype:Tc,BUGGY_SAFARI_ITERATORS:tu},iu=nu.IteratorPrototype,ou=Xn,au=B,su=ji,cu=Pc,uu=function(){return this},du=function(e,t,r,n){var i=t+" Iterator";return e.prototype=ou(iu,{next:au(+!n,r)}),su(e,i,!1,!0),cu[i]=uu,e},lu=m,hu=Pe,pu=w,vu=String,fu=TypeError,_u=function(e,t,r){try{return lu(hu(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(n){}},mu=nr,gu=function(e){if("object"==typeof e||pu(e))return e;throw fu("Can't set "+vu(e)+" as a prototype")},yu=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=_u(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch(n){}return function(r,n){return mu(r),gu(n),t?e(r,n):r.__proto__=n,r}}():void 0),Su=Cr,bu=M,ku=Vc,Eu=du,Tu=Xc,Iu=ji,Ru=fi,Au=Pc,wu=nu,Cu=ku.PROPER,xu=wu.BUGGY_SAFARI_ITERATORS,Ou=pt("iterator"),Pu="keys",Mu="values",Du="entries",Nu=function(){return this},Lu=function(e,t,r,n,i,o,a){Eu(r,t,n);var s,c,u,d=function(e){if(e===i&&f)return f;if(!xu&&e in p)return p[e];switch(e){case Pu:case Mu:case Du:return function(){return new r(this,e)}}return function(){return new r(this)}},l=t+" Iterator",h=!1,p=e.prototype,v=p[Ou]||p["@@iterator"]||i&&p[i],f=!xu&&v||d(i),_="Array"===t&&p.entries||v;if(_&&(s=Tu(_.call(new e)))!==Object.prototype&&s.next&&(Iu(s,l,!0,!0),Au[l]=Nu),Cu&&i===Mu&&v&&v.name!==Mu&&(h=!0,f=function(){return bu(v,this)}),i)if(c={values:d(Mu),keys:o?f:d(Pu),entries:d(Du)},a)for(u in c)(xu||h||!(u in p))&&Ru(p,u,c[u]);else Su({target:t,proto:!0,forced:xu||h},c);return a&&p[Ou]!==f&&Ru(p,Ou,f,{name:i}),Au[t]=f,c},Uu=function(e,t){return{value:e,done:t}},Vu=Z,Fu=Pc,Bu=no;Zt.f;var ju=Lu,Hu=Uu,Gu="Array Iterator",zu=Bu.set,Ku=Bu.getterFor(Gu);ju(Array,"Array",(function(e,t){zu(this,{type:Gu,target:Vu(e),index:0,kind:t})}),(function(){var e=Ku(this),t=e.target,r=e.kind,n=e.index++;if(!t||n>=t.length)return e.target=void 0,Hu(void 0,!0);switch(r){case"keys":return Hu(n,!1);case"values":return Hu(t[n],!1)}return Hu([n,t[n]],!1)}),"values"),Fu.Arguments=Fu.Array;var Wu={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Xu=o,qu=gn,Yu=mr,Ju=Pc,Qu=pt("toStringTag");for(var Zu in Wu){var $u=Xu[Zu],ed=$u&&$u.prototype;ed&&qu(ed)!==Qu&&Yu(ed,Qu,Zu),Ju[Zu]=Ju.Array}var td=a,rd=function(e,t){var r=[][e];return!!r&&td((function(){r.call(null,t||function(){return 1},1)}))},nd=Fo.forEach,id=rd("forEach")?[].forEach:function(e){return nd(this,e,arguments.length>1?arguments[1]:void 0)};Cr({target:"Array",proto:!0,forced:[].forEach!==id},{forEach:id});var od=Js("Array").forEach,ad=gn,sd=$e,cd=ce,ud=od,dd=Array.prototype,ld={DOMTokenList:!0,NodeList:!0},hd=r((function(e){var t=e.forEach;return e===dd||cd(dd,e)&&t===dd.forEach||sd(ld,ad(e))?ud:t})),pd=se,vd=qn,fd=pi,_d=nr,md=m([].concat),gd=pd("Reflect","ownKeys")||function(e){var t=vd.f(_d(e)),r=fd.f;return r?md(t,r(e)):t},yd=gd,Sd=Z,bd=C,kd=ti;Cr({target:"Object",stat:!0,sham:!x},{getOwnPropertyDescriptors:function(e){for(var t,r,n=Sd(e),i=bd.f,o=yd(n),a={},s=0;o.length>s;)void 0!==(r=i(n,t=o[s++]))&&kd(a,t,r);return a}});var Ed=r(re.Object.getOwnPropertyDescriptors),Td={exports:{}},Id=Cr,Rd=x,Ad=kn.f;Id({target:"Object",stat:!0,forced:Object.defineProperties!==Ad,sham:!Rd},{defineProperties:Ad});var wd=re.Object,Cd=Td.exports=function(e,t){return wd.defineProperties(e,t)};wd.defineProperties.sham&&(Cd.sham=!0);var xd=r(Td.exports),Od={exports:{}},Pd=Cr,Md=x,Dd=Zt.f;Pd({target:"Object",stat:!0,forced:Object.defineProperty!==Dd,sham:!Md},{defineProperty:Dd});var Nd=re.Object,Ld=Od.exports=function(e,t,r){return Nd.defineProperty(e,t,r)};Nd.defineProperty.sham&&(Ld.sham=!0);var Ud=Od.exports,Vd=r(Ud),Fd=Cr,Bd=a,jd=oo,Hd=te,Gd=Je,zd=Hr,Kd=yc,Wd=ti,Xd=Oo,qd=Xs,Yd=_e,Jd=pt("isConcatSpreadable"),Qd=Yd>=51||!Bd((function(){var e=[];return e[Jd]=!1,e.concat()[0]!==e})),Zd=function(e){if(!Hd(e))return!1;var t=e[Jd];return void 0!==t?!!t:jd(e)};Fd({target:"Array",proto:!0,arity:1,forced:!Qd||!qd("concat")},{concat:function(e){var t,r,n,i,o,a=Gd(this),s=Xd(a,0),c=0;for(t=-1,n=arguments.length;t<n;t++)if(Zd(o=-1===t?a:arguments[t]))for(i=zd(o),Kd(c+i),r=0;r<i;r++,c++)r in o&&Wd(s,c,o[r]);else Kd(c+1),Wd(s,c++,o);return s.length=c,s}}),Ai("asyncIterator"),Ai("hasInstance"),Ai("isConcatSpreadable"),Ai("iterator"),Ai("match"),Ai("matchAll"),Ai("replace"),Ai("search"),Ai("species"),Ai("split");var $d=Pi;Ai("toPrimitive"),$d();var el=se,tl=ji;Ai("toStringTag"),tl(el("Symbol"),"Symbol"),Ai("unscopables"),ji(o.JSON,"JSON",!0);var rl=re.Symbol,nl=pt,il=Zt.f,ol=nl("metadata"),al=Function.prototype;void 0===al[ol]&&il(al,ol,{value:null}),Ai("asyncDispose"),Ai("dispose"),Ai("metadata");var sl=rl,cl=m,ul=se("Symbol"),dl=ul.keyFor,ll=cl(ul.prototype.valueOf),hl=ul.isRegisteredSymbol||function(e){try{return void 0!==dl(ll(e))}catch(t){return!1}};Cr({target:"Symbol",stat:!0},{isRegisteredSymbol:hl});for(var pl=Xe,vl=se,fl=m,_l=Re,ml=pt,gl=vl("Symbol"),yl=gl.isWellKnownSymbol,Sl=vl("Object","getOwnPropertyNames"),bl=fl(gl.prototype.valueOf),kl=pl("wks"),El=0,Tl=Sl(gl),Il=Tl.length;El<Il;El++)try{var Rl=Tl[El];_l(gl[Rl])&&ml(Rl)}catch(Y$){}var Al=function(e){if(yl&&yl(e))return!0;try{for(var t=bl(e),r=0,n=Sl(kl),i=n.length;r<i;r++)if(kl[n[r]]==t)return!0}catch(Y$){}return!1};Cr({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Al}),Ai("matcher"),Ai("observable"),Cr({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:hl}),Cr({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:Al}),Ai("metadataKey"),Ai("patternMatch"),Ai("replaceAll");var wl=r(sl),Cl=m,xl=Mr,Ol=bn,Pl=Y,Ml=Cl("".charAt),Dl=Cl("".charCodeAt),Nl=Cl("".slice),Ll=function(e){return function(t,r){var n,i,o=Ol(Pl(t)),a=xl(r),s=o.length;return a<0||a>=s?e?"":void 0:(n=Dl(o,a))<55296||n>56319||a+1===s||(i=Dl(o,a+1))<56320||i>57343?e?Ml(o,a):n:e?Nl(o,a,a+2):i-56320+(n-55296<<10)+65536}},Ul={codeAt:Ll(!1),charAt:Ll(!0)},Vl=Ul.charAt,Fl=bn,Bl=no,jl=Lu,Hl=Uu,Gl="String Iterator",zl=Bl.set,Kl=Bl.getterFor(Gl);jl(String,"String",(function(e){zl(this,{type:Gl,string:Fl(e),index:0})}),(function(){var e,t=Kl(this),r=t.string,n=t.index;return n>=r.length?Hl(void 0,!0):(e=Vl(r,n),t.index+=e.length,Hl(e,!1))}));var Wl=r(gi.f("iterator"));function Xl(e){return(Xl="function"==typeof wl&&"symbol"==typeof Wl?function(e){return typeof e}:function(e){return e&&"function"==typeof wl&&e.constructor===wl&&e!==wl.prototype?"symbol":typeof e})(e)}var ql=r(gi.f("toPrimitive"));function Yl(e){var t=function(e,t){if("object"!==Xl(e)||null===e)return e;var r=e[ql];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Xl(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Xl(t)?t:String(t)}function Jl(e,t,r){return(t=Yl(t))in e?Vd(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ql(e,t){var r=un(e);if(Gs){var n=Gs(e);t&&(n=rc(n).call(n,(function(t){return hc(e,t).enumerable}))),Oc(r).apply(r,n)}return r}function Zl(e){for(var t=1;t<arguments.length;t++){var r,n,i=null!=arguments[t]?arguments[t]:{};t%2?hd(r=Ql(Object(i),!0)).call(r,(function(t){Jl(e,t,i[t])})):Ed?xd(e,Ed(i)):hd(n=Ql(Object(i))).call(n,(function(t){Vd(e,t,hc(i,t))}))}return e}var $l=function(e){return e[e.VIDEO_SOURCE_TYPE_EXTERNAL=0]="VIDEO_SOURCE_TYPE_EXTERNAL",e[e.VIDEO_SOURCE_TYPE_INTERNAL=1]="VIDEO_SOURCE_TYPE_INTERNAL",e}($l||{}),eh=function(e){return e[e.AUDIO_SOURCE_TYPE_EXTERNAL=0]="AUDIO_SOURCE_TYPE_EXTERNAL",e[e.AUDIO_SOURCE_TYPE_INTERNAL=1]="AUDIO_SOURCE_TYPE_INTERNAL",e}(eh||{}),th=function(e){return e[e.QUIT=0]="QUIT",e[e.DROPPED=1]="DROPPED",e[e.SWITCH_TO_INVISIBLE=2]="SWITCH_TO_INVISIBLE",e[e.KICKED_BY_ADMIN=3]="KICKED_BY_ADMIN",e}(th||{}),rh=function(e){return e[e.CHANNEL_PROFILE_COMMUNICATION=0]="CHANNEL_PROFILE_COMMUNICATION",e[e.CHANNEL_PROFILE_LIVE_BROADCASTING=1]="CHANNEL_PROFILE_LIVE_BROADCASTING",e}(rh||{}),nh=function(e){return e[e.AUTO_SUBSCRIBE_MODE=0]="AUTO_SUBSCRIBE_MODE",e[e.MANUAL_SUBSCRIBE_MODE=1]="MANUAL_SUBSCRIBE_MODE",e}(nh||{}),ih=function(e){return e[e.SUBSCRIBE_SUCC=0]="SUBSCRIBE_SUCC",e[e.SUBSCRIBE_FAIL=1]="SUBSCRIBE_FAIL",e}(ih||{}),oh=function(e){return e[e.PUBLISH_SUCC=0]="PUBLISH_SUCC",e[e.PUBLISH_FAIL=1]="PUBLISH_FAIL",e}(oh||{}),ah=function(e){return e[e.MIRROR_MODE_OFF=0]="MIRROR_MODE_OFF",e[e.MIRROR_MODE_ON=1]="MIRROR_MODE_ON",e}(ah||{}),sh=function(e){return e[e.RENDER_MODE_HIDDEN=0]="RENDER_MODE_HIDDEN",e[e.RENDER_MODE_FIT=1]="RENDER_MODE_FIT",e[e.RENDER_MODE_FILL=2]="RENDER_MODE_FILL",e}(sh||{}),ch=function(e){return e[e.STREAM_INDEX_MAIN=0]="STREAM_INDEX_MAIN",e[e.STREAM_INDEX_SCREEN=1]="STREAM_INDEX_SCREEN",e}(ch||{}),uh=function(e){return e[e.AUDIO=1]="AUDIO",e[e.VIDEO=2]="VIDEO",e[e.AUDIO_AND_VIDEO=3]="AUDIO_AND_VIDEO",e}(uh||{}),dh=function(e){return e[e.STREAM_REMOVE_REASON_UNPUBLISH=0]="STREAM_REMOVE_REASON_UNPUBLISH",e[e.STREAM_REMOVE_REASON_PUBLISH_FAILED=1]="STREAM_REMOVE_REASON_PUBLISH_FAILED",e[e.STREAM_REMOVE_REASON_KEEP_LIVE_FAILED=2]="STREAM_REMOVE_REASON_KEEP_LIVE_FAILED",e[e.STREAM_REMOVE_REASON_CLIENT_DISCONNECTED=3]="STREAM_REMOVE_REASON_CLIENT_DISCONNECTED",e[e.STREAM_REMOVE_REASON_REPUBLISH=4]="STREAM_REMOVE_REASON_REPUBLISH",e[e.STREAM_REMOVE_REASON_OTHER=5]="STREAM_REMOVE_REASON_OTHER",e}(dh||{}),lh=function(e){return e[e.CONNECTION_START=0]="CONNECTION_START",e[e.CONNECTION_STATE_DISCONNECTED=1]="CONNECTION_STATE_DISCONNECTED",e[e.CONNECTION_STATE_CONNECTING=2]="CONNECTION_STATE_CONNECTING",e[e.CONNECTION_STATE_CONNECTED=3]="CONNECTION_STATE_CONNECTED",e[e.CONNECTION_STATE_RECONNECTING=4]="CONNECTION_STATE_RECONNECTING",e[e.CONNECTION_STATE_RECONNECTED=5]="CONNECTION_STATE_RECONNECTED",e[e.CONNECTION_STATE_LOST=6]="CONNECTION_STATE_LOST",e}(lh||{}),hh=function(e){return e[e.MIRROR_TYPE_NONE=0]="MIRROR_TYPE_NONE",e[e.MIRROR_TYPE_RENDER=1]="MIRROR_TYPE_RENDER",e}(hh||{}),ph=function(e){return e[e.NORMAL=0]="NORMAL",e[e.DISCONNECT=1]="DISCONNECT",e[e.RESET=2]="RESET",e}(ph||{}),vh=function(e){return e[e.MICROPHONE=0]="MICROPHONE",e[e.AUDIOMIXING=1]="AUDIOMIXING",e}(vh||{}),fh=function(e){return e[e.domestic=0]="domestic",e[e.overseas=1]="overseas",e}(fh||{}),_h=function(e){return e[e.OFFLINE=0]="OFFLINE",e[e.ONLINE=1]="ONLINE",e[e.UNREACHABLE=2]="UNREACHABLE",e}(_h||{}),mh=function(e){return e[e.AUDIO_AND_VIDEO=0]="AUDIO_AND_VIDEO",e[e.AUDIO_ONLY=1]="AUDIO_ONLY",e[e.VIDEO_ONLY=2]="VIDEO_ONLY",e}(mh||{}),gh=function(e){return e[e.PREV_FRAME=0]="PREV_FRAME",e[e.OTHER_FRAME=1]="OTHER_FRAME",e}(gh||{}),yh=function(e){return e[e.DISABLE=0]="DISABLE",e[e.VIDEO_STREAM_LOW=1]="VIDEO_STREAM_LOW",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e}(yh||{}),Sh=function(e){return e[e.LOW=0]="LOW",e[e.MEDIUM=100]="MEDIUM",e[e.HIGH=200]="HIGH",e}(Sh||{}),bh=function(e){return e[e.UNKNOWN=0]="UNKNOWN",e[e.EXCELLENT=1]="EXCELLENT",e[e.GOOD=2]="GOOD",e[e.POOR=3]="POOR",e[e.BAD=4]="BAD",e[e.VBAD=5]="VBAD",e[e.DOWN=6]="DOWN",e}(bh||{}),kh=function(e){return e[e.Unknown=-1]="Unknown",e[e.SubscribeFallbackByBandwidth=0]="SubscribeFallbackByBandwidth",e[e.SubscribeRecoverByBandwidth=2]="SubscribeRecoverByBandwidth",e}(kh||{}),Eh=function(e){return e[e.communication=0]="communication",e[e.chat=5]="chat",e[e.chatRoom=6]="chatRoom",e[e.coHost=9]="coHost",e[e.meeting=16]="meeting",e[e.classRoom=18]="classRoom",e}(Eh||{}),Th=function(e){return e[e.default=0]="default",e[e.fluent=1]="fluent",e[e.standard=2]="standard",e[e.hd=3]="hd",e[e.standardStereo=4]="standardStereo",e[e.hdMono=5]="hdMono",e}(Th||{}),Ih=function(e){return e[e.AUTO_PLAY=0]="AUTO_PLAY",e[e.VIDEO_ONLY=1]="VIDEO_ONLY",e[e.PLAY_MANUALLY=2]="PLAY_MANUALLY",e}(Ih||{}),Rh=function(e){return e.LC="LC",e.HEv1="HEv1",e.HEv2="HEv2",e}(Rh||{}),Ah=function(e){return e.H264="H264",e.H265="H265",e}(Ah||{}),wh=function(e){return e[e.ASR_ONLY=0]="ASR_ONLY",e[e.ASR_AND_TRANSLATION=1]="ASR_AND_TRANSLATION",e}(wh||{}),Ch=function(e){return e[e.STARTED=0]="STARTED",e[e.STOPPED=1]="STOPPED",e[e.ERROR=2]="ERROR",e}(Ch||{}),xh=function(e){return e[e.FORWARD_STREAM_STATE_SUCCESS=0]="FORWARD_STREAM_STATE_SUCCESS",e[e.FORWARD_STREAM_STATE_FAILURE=1]="FORWARD_STREAM_STATE_FAILURE",e}(xh||{}),Oh=function(e){return e[e.FORWARD_STREAM_ERROR_OK=0]="FORWARD_STREAM_ERROR_OK",e[e.FORWARD_STREAM_ERROR_INVALID_TOKEN=1202]="FORWARD_STREAM_ERROR_INVALID_TOKEN",e[e.FORWARD_STREAM_ERROR_RESPONSE=1203]="FORWARD_STREAM_ERROR_RESPONSE",e[e.FORWARD_STREAM_ERROR_REMOTE_KICKED=1204]="FORWARD_STREAM_ERROR_REMOTE_KICKED",e[e.FORWARD_STREAM_ERROR_NOT_SUPPORT=1205]="FORWARD_STREAM_ERROR_NOT_SUPPORT",e}(Oh||{}),Ph=Object.freeze({__proto__:null,AAC_PROFILE:Rh,AudioProfileType:Th,AudioReportMode:vh,AudioSourceType:eh,ChannelProfile:rh,ConnectionState:lh,FallbackOrRecoverReason:kh,ForwardStreamError:Oh,ForwardStreamState:xh,LocalMainReportMode:ph,LogChannel:fh,MediaType:uh,MirrorMode:ah,MirrorType:hh,NetworkQuality:bh,PublicInterpolationMode:gh,PublicStreamType:mh,PublishState:oh,RTCAutoPlayPolicy:Ih,RemoteUserPriority:Sh,RoomProfileType:Eh,SUBTITLE_MODE:wh,StreamIndex:ch,StreamRemoveReason:dh,SubscribeFallbackOption:yh,SubscribeMode:nh,SubscribeState:ih,SubtitleEventType:Ch,TRANSCODING_VIDEO_CODEC:Ah,USER_ONLINE_STATUS:_h,UserOfflineReason:th,VideoRenderMode:sh,VideoSourceType:$l}),Mh=function(e){return e[e.AUTO=0]="AUTO",e[e.MODE_L=1]="MODE_L",e[e.MODE_R=2]="MODE_R",e[e.MODE_MIX=3]="MODE_MIX",e}(Mh||{}),Dh=function(e){return e[e.PLAYOUT=0]="PLAYOUT",e[e.PUBLISH=1]="PUBLISH",e[e.PLAYOUT_AND_PUBLISH=2]="PLAYOUT_AND_PUBLISH",e}(Dh||{}),Nh=function(e){return e[e.AUDIO_MIXING_STATE_PRELOADED=0]="AUDIO_MIXING_STATE_PRELOADED",e[e.AUDIO_MIXING_STATE_PLAYING=1]="AUDIO_MIXING_STATE_PLAYING",e[e.AUDIO_MIXING_STATE_PAUSED=2]="AUDIO_MIXING_STATE_PAUSED",e[e.AUDIO_MIXING_STATE_STOPPED=3]="AUDIO_MIXING_STATE_STOPPED",e[e.AUDIO_MIXING_STATE_FAILED=4]="AUDIO_MIXING_STATE_FAILED",e[e.AUDIO_MIXING_STATE_FINISHED=5]="AUDIO_MIXING_STATE_FINISHED",e[e.AUDIO_MIXING_STATE_PCM_ENABLED=6]="AUDIO_MIXING_STATE_PCM_ENABLED",e[e.AUDIO_MIXING_STATE_PCM_DISABLED=7]="AUDIO_MIXING_STATE_PCM_DISABLED",e}(Nh||{}),Lh=Object.freeze({__proto__:null,AudioMixingDualMonoMode:Mh,AudioMixingState:Nh,AudioMixingType:Dh}),Uh=function(e){return e.onTrackEnded="onTrackEnded",e.onTrackMute="onTrackMute",e.onTrackUnmute="onTrackUnmute",e.onPlayerEvent="onPlayerEvent",e.onAutoplayFailed="onAutoplayFailed",e.onUserJoined="onUserJoined",e.onUserLeave="onUserLeave",e.onConnectionStateChanged="onConnectionStateChanged",e.onUserPublishStream="onUserPublishStream",e.onUserUnpublishStream="onUserUnpublishStream",e.onUserPublishScreen="onUserPublishScreen",e.onUserUnpublishScreen="onUserUnpublishScreen",e.onRoomMessageReceived="onRoomMessageReceived",e.onRoomBinaryMessageReceived="onRoomBinaryMessageReceived",e.onUserMessageReceived="onUserMessageReceived",e.onUserBinaryMessageReceived="onUserBinaryMessageReceived",e.onVideoFirstFrameRendered="onVideoFirstFrameRendered",e.onVideoFirstFrameDecoded="onVideoFirstFrameDecoded",e.onRemoteVideoFirstFrame="onRemoteVideoFirstFrame",e.onAudioFirstFrameDecoded="onAudioFirstFrameDecoded",e.onRemoteAudioFirstFrame="onRemoteAudioFirstFrame",e.onFirstPublicStreamVideoFrameRendered="onFirstPublicStreamVideoFrameRendered",e.onFirstPublicStreamVideoFrameDecoded="onFirstPublicStreamVideoFrameDecoded",e.onFirstPublicStreamAudioFrameDecoded="onFirstPublicStreamAudioFrameDecoded",e.onVideoDeviceStateChanged="onVideoDeviceStateChanged",e.onAudioDeviceStateChanged="onAudioDeviceStateChanged",e.onRemoteStreamStats="onRemoteStreamStats",e.onPublicStreamStats="onPublicStreamStats",e.onLocalStreamStats="onLocalStreamStats",e.onAudioVolumeIndication="onAudioVolumeIndication",e.onLocalAudioPropertiesReport="onLocalAudioPropertiesReport",e.onRemoteAudioPropertiesReport="onRemoteAudioPropertiesReport",e.onActiveSpeaker="onActiveSpeaker",e.onAudioPlaybackDeviceChanged="onAudioPlaybackDeviceChanged",e.onUserStartVideoCapture="onUserStartVideoCapture",e.onUserStopVideoCapture="onUserStopVideoCapture",e.onUserStartAudioCapture="onUserStartAudioCapture",e.onUserStopAudioCapture="onUserStopAudioCapture",e.onAutoPublishResult="onAutoPublishResult",e.onAutoSubscribeResult="onAutoSubscribeResult",e.onLiveTranscodingResult="onLiveTranscodingResult",e.onStreamMixingEvent="onStreamMixingEvent",e.onAudioPlaybackDeviceTestVolume="onAudioPlaybackDeviceTestVolume",e.onSEIMessageReceived="onSEIMessageReceived",e.onError="onError",e.onAudioMixingStateChanged="onAudioMixingStateChanged",e.onUserMessageReceivedOutsideRoom="onUserMessageReceivedOutsideRoom",e.onUserBinaryMessageReceivedOutsideRoom="onUserBinaryMessageReceivedOutsideRoom",e.onTokenWillExpire="onTokenWillExpire",e.onCloudProxyConnected="onCloudProxyConnected",e.onPushPublicStreamResult="onPushPublicStreamResult",e.onPublicStreamSEIMessageReceived="onPublicStreamSEIMessageReceived",e.onNetworkQuality="onNetworkQuality",e.onSimulcastSubscribeFallback="onSimulcastSubscribeFallback",e.onRemoteVideoSizeChanged="onRemoteVideoSizeChanged",e.onVideoStreamBanned="onVideoStreamBanned",e.onAudioStreamBanned="onAudioStreamBanned",e.onLocalVideoSizeChanged="onLocalVideoSizeChanged",e.onSubtitleStateChanged="onSubtitleStateChanged",e.onSubtitleMessageReceived="onSubtitleMessageReceived",e.onServerParamsSetResult="onServerParamsSetResult",e.onLocalStreamTrackChangedByExtension="onLocalStreamTrackChangedByExtension",e.onVendorConnectionStateChanged="onVendorConnectionStateChanged",e.onForwardStreamError="onForwardStreamError",e.onRejoinWithTcp="onRejoinWithTcp",e.onIceConnectWithTcp="onIceConnectWithTcp",e.onPublishRetry="onPublishRetry",e.onSubscribeRetry="onSubscribeRetry",e.onPublishResult="onPublishResult",e.onSubscribeResult="onSubscribeResult",e}(Uh||{});function Vh(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Vd(e,Yl(n.key),n)}}function Fh(e,t,r){return t&&Vh(e.prototype,t),r&&Vh(e,r),Vd(e,"prototype",{writable:!1}),e}function Bh(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Cr({target:"Object",stat:!0,sham:!x},{create:Xn});var jh=re.Object,Hh=r((function(e,t){return jh.create(e,t)})),Gh=Je,zh=Xc,Kh=Fc;Cr({target:"Object",stat:!0,forced:a((function(){zh(1)})),sham:!Kh},{getPrototypeOf:function(e){return zh(Gh(e))}});var Wh=r(re.Object.getPrototypeOf);Cr({target:"Object",stat:!0},{setPrototypeOf:yu});var Xh=re.Object.setPrototypeOf,qh=r(Xh),Yh=$e,Jh=gd,Qh=C,Zh=Zt,$h=te,ep=mr,tp=Error,rp=m("".replace),np=String(tp("zxcasd").stack),ip=/\n\s*at [^:]*:[^\n]*/,op=ip.test(np),ap=B,sp=!a((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",ap(1,7)),7!==e.stack)})),cp=mr,up=function(e,t){if(op&&"string"==typeof e&&!tp.prepareStackTrace)for(;t--;)e=rp(e,ip,"");return e},dp=sp,lp=Error.captureStackTrace,hp=Pc,pp=pt("iterator"),vp=Array.prototype,fp=function(e){return void 0!==e&&(hp.Array===e||vp[pp]===e)},_p=gn,mp=Ne,gp=W,yp=Pc,Sp=pt("iterator"),bp=function(e){if(!gp(e))return mp(e,Sp)||mp(e,"@@iterator")||yp[_p(e)]},kp=M,Ep=Pe,Tp=nr,Ip=we,Rp=bp,Ap=TypeError,wp=function(e,t){var r=arguments.length<2?Rp(e):t;if(Ep(r))return Tp(kp(r,e));throw Ap(Ip(e)+" is not iterable")},Cp=M,xp=nr,Op=Ne,Pp=function(e,t,r){var n,i;xp(e);try{if(!(n=Op(e,"return"))){if("throw"===t)throw r;return r}n=Cp(n,e)}catch(Y$){i=!0,n=Y$}if("throw"===t)throw r;if(i)throw n;return xp(n),r},Mp=Qt,Dp=M,Np=nr,Lp=we,Up=fp,Vp=Hr,Fp=ce,Bp=wp,jp=bp,Hp=Pp,Gp=TypeError,zp=function(e,t){this.stopped=e,this.result=t},Kp=zp.prototype,Wp=function(e,t,r){var n,i,o,a,s,c,u,d=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),f=Mp(t,d),_=function(e){return n&&Hp(n,"normal",e),new zp(!0,e)},m=function(e){return l?(Np(e),v?f(e[0],e[1],_):f(e[0],e[1])):v?f(e,_):f(e)};if(h)n=e.iterator;else if(p)n=e;else{if(!(i=jp(e)))throw Gp(Lp(e)+" is not iterable");if(Up(i)){for(o=0,a=Vp(e);a>o;o++)if((s=m(e[o]))&&Fp(Kp,s))return s;return new zp(!1)}n=Bp(e,i)}for(c=h?e.next:n.next;!(u=Dp(c,n)).done;){try{s=m(u.value)}catch(Y$){Hp(n,"throw",Y$)}if("object"==typeof s&&s&&Fp(Kp,s))return s}return new zp(!1)},Xp=bn,qp=Cr,Yp=ce,Jp=Xc,Qp=yu,Zp=function(e,t,r){for(var n=Jh(t),i=Zh.f,o=Qh.f,a=0;a<n.length;a++){var s=n[a];Yh(e,s)||r&&Yh(r,s)||i(e,s,o(t,s))}},$p=Xn,ev=mr,tv=B,rv=function(e,t){$h(t)&&"cause"in t&&ep(e,"cause",t.cause)},nv=function(e,t,r,n){dp&&(lp?lp(e,t):cp(e,"stack",up(r,n)))},iv=Wp,ov=function(e,t){return void 0===e?arguments.length<2?"":t:Xp(e)},av=pt("toStringTag"),sv=Error,cv=[].push,uv=function(e,t){var r,n=Yp(dv,this);Qp?r=Qp(sv(),n?Jp(this):dv):(r=n?this:$p(dv),ev(r,av,"Error")),void 0!==t&&ev(r,"message",ov(t)),nv(r,uv,r.stack,1),arguments.length>2&&rv(r,arguments[2]);var i=[];return iv(e,cv,{that:i}),ev(r,"errors",i),r};Qp?Qp(uv,sv):Zp(uv,sv,{name:!0});var dv=uv.prototype=$p(sv.prototype,{constructor:tv(1,uv),message:tv(1,""),name:tv(1,"AggregateError")});qp({global:!0,constructor:!0,arity:2},{AggregateError:uv});var lv,hv,pv,vv,fv="process"===b(o.process),_v=se,mv=mi,gv=x,yv=pt("species"),Sv=function(e){var t=_v(e);gv&&t&&!t[yv]&&mv(t,yv,{configurable:!0,get:function(){return this}})},bv=ce,kv=TypeError,Ev=function(e,t){if(bv(t,e))return e;throw kv("Incorrect invocation")},Tv=To,Iv=we,Rv=TypeError,Av=function(e){if(Tv(e))return e;throw Rv(Iv(e)+" is not a constructor")},wv=nr,Cv=Av,xv=W,Ov=pt("species"),Pv=function(e,t){var r,n=wv(e).constructor;return void 0===n||xv(r=wv(n)[Ov])?t:Cv(r)},Mv=TypeError,Dv=function(e,t){if(e<t)throw Mv("Not enough arguments");return e},Nv=/(?:ipad|iphone|ipod).*applewebkit/i.test(ue),Lv=o,Uv=h,Vv=Qt,Fv=w,Bv=$e,jv=a,Hv=xn,Gv=us,zv=At,Kv=Dv,Wv=Nv,Xv=fv,qv=Lv.setImmediate,Yv=Lv.clearImmediate,Jv=Lv.process,Qv=Lv.Dispatch,Zv=Lv.Function,$v=Lv.MessageChannel,ef=Lv.String,tf=0,rf={},nf="onreadystatechange";jv((function(){lv=Lv.location}));var of=function(e){if(Bv(rf,e)){var t=rf[e];delete rf[e],t()}},af=function(e){return function(){of(e)}},sf=function(e){of(e.data)},cf=function(e){Lv.postMessage(ef(e),lv.protocol+"//"+lv.host)};qv&&Yv||(qv=function(e){Kv(arguments.length,1);var t=Fv(e)?e:Zv(e),r=Gv(arguments,1);return rf[++tf]=function(){Uv(t,void 0,r)},hv(tf),tf},Yv=function(e){delete rf[e]},Xv?hv=function(e){Jv.nextTick(af(e))}:Qv&&Qv.now?hv=function(e){Qv.now(af(e))}:$v&&!Wv?(vv=(pv=new $v).port2,pv.port1.onmessage=sf,hv=Vv(vv.postMessage,vv)):Lv.addEventListener&&Fv(Lv.postMessage)&&!Lv.importScripts&&lv&&"file:"!==lv.protocol&&!jv(cf)?(hv=cf,Lv.addEventListener("message",sf,!1)):hv=nf in zv("script")?function(e){Hv.appendChild(zv("script"))[nf]=function(){Hv.removeChild(this),of(e)}}:function(e){setTimeout(af(e),0)});var uf={set:qv,clear:Yv},df=function(){this.head=null,this.tail=null};df.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var lf,hf,pf,vf,ff,_f=df,mf=/ipad|iphone|ipod/i.test(ue)&&"undefined"!=typeof Pebble,gf=/web0s(?!.*chrome)/i.test(ue),yf=o,Sf=Qt,bf=C.f,kf=uf.set,Ef=_f,Tf=Nv,If=mf,Rf=gf,Af=fv,wf=yf.MutationObserver||yf.WebKitMutationObserver,Cf=yf.document,xf=yf.process,Of=yf.Promise,Pf=bf(yf,"queueMicrotask"),Mf=Pf&&Pf.value;if(!Mf){var Df=new Ef,Nf=function(){var e,t;for(Af&&(e=xf.domain)&&e.exit();t=Df.get();)try{t()}catch(Y$){throw Df.head&&lf(),Y$}e&&e.enter()};Tf||Af||Rf||!wf||!Cf?!If&&Of&&Of.resolve?((vf=Of.resolve(void 0)).constructor=Of,ff=Sf(vf.then,vf),lf=function(){ff(Nf)}):Af?lf=function(){xf.nextTick(Nf)}:(kf=Sf(kf,yf),lf=function(){kf(Nf)}):(hf=!0,pf=Cf.createTextNode(""),new wf(Nf).observe(pf,{characterData:!0}),lf=function(){pf.data=hf=!hf}),Mf=function(e){Df.head||lf(),Df.add(e)}}var Lf=Mf,Uf=function(e){try{return{error:!1,value:e()}}catch(Y$){return{error:!0,value:Y$}}},Vf=o.Promise,Ff="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Bf=!Ff&&!fv&&"object"==typeof window&&"object"==typeof document,jf=o,Hf=Vf,Gf=w,zf=Xt,Kf=uo,Wf=pt,Xf=Bf,qf=Ff,Yf=_e,Jf=Hf&&Hf.prototype,Qf=Wf("species"),Zf=!1,$f=Gf(jf.PromiseRejectionEvent),e_={CONSTRUCTOR:zf("Promise",(function(){var e=Kf(Hf),t=e!==String(Hf);if(!t&&66===Yf)return!0;if(!Jf.catch||!Jf.finally)return!0;if(!Yf||Yf<51||!/native code/.test(e)){var r=new Hf((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((r.constructor={})[Qf]=n,!(Zf=r.then((function(){}))instanceof n))return!0}return!t&&(Xf||qf)&&!$f})),REJECTION_EVENT:$f,SUBCLASSING:Zf},t_={},r_=Pe,n_=TypeError,i_=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw n_("Bad Promise constructor");t=e,r=n})),this.resolve=r_(t),this.reject=r_(r)};t_.f=function(e){return new i_(e)};var o_,a_,s_=Cr,c_=fv,u_=o,d_=M,l_=fi,h_=ji,p_=Sv,v_=Pe,f_=w,__=te,m_=Ev,g_=Pv,y_=uf.set,S_=Lf,b_=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(Y$){}},k_=Uf,E_=_f,T_=no,I_=Vf,R_=e_,A_=t_,w_="Promise",C_=R_.CONSTRUCTOR,x_=R_.REJECTION_EVENT,O_=T_.getterFor(w_),P_=T_.set,M_=I_&&I_.prototype,D_=I_,N_=M_,L_=u_.TypeError,U_=u_.document,V_=u_.process,F_=A_.f,B_=F_,j_=!!(U_&&U_.createEvent&&u_.dispatchEvent),H_="unhandledrejection",G_=function(e){var t;return!(!__(e)||!f_(t=e.then))&&t},z_=function(e,t){var r,n,i,o=t.value,a=1===t.state,s=a?e.ok:e.fail,c=e.resolve,u=e.reject,d=e.domain;try{s?(a||(2===t.rejection&&Y_(t),t.rejection=1),!0===s?r=o:(d&&d.enter(),r=s(o),d&&(d.exit(),i=!0)),r===e.promise?u(L_("Promise-chain cycle")):(n=G_(r))?d_(n,r,c,u):c(r)):u(o)}catch(Y$){d&&!i&&d.exit(),u(Y$)}},K_=function(e,t){e.notified||(e.notified=!0,S_((function(){for(var r,n=e.reactions;r=n.get();)z_(r,e);e.notified=!1,t&&!e.rejection&&X_(e)})))},W_=function(e,t,r){var n,i;j_?((n=U_.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),u_.dispatchEvent(n)):n={promise:t,reason:r},!x_&&(i=u_["on"+e])?i(n):e===H_&&b_("Unhandled promise rejection",r)},X_=function(e){d_(y_,u_,(function(){var t,r=e.facade,n=e.value;if(q_(e)&&(t=k_((function(){c_?V_.emit("unhandledRejection",n,r):W_(H_,r,n)})),e.rejection=c_||q_(e)?2:1,t.error))throw t.value}))},q_=function(e){return 1!==e.rejection&&!e.parent},Y_=function(e){d_(y_,u_,(function(){var t=e.facade;c_?V_.emit("rejectionHandled",t):W_("rejectionhandled",t,e.value)}))},J_=function(e,t,r){return function(n){e(t,n,r)}},Q_=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,K_(e,!0))},Z_=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw L_("Promise can't be resolved itself");var n=G_(t);n?S_((function(){var r={done:!1};try{d_(n,t,J_(Z_,r,e),J_(Q_,r,e))}catch(Y$){Q_(r,Y$,e)}})):(e.value=t,e.state=1,K_(e,!1))}catch(Y$){Q_({done:!1},Y$,e)}}};C_&&(N_=(D_=function(e){m_(this,N_),v_(e),d_(o_,this);var t=O_(this);try{e(J_(Z_,t),J_(Q_,t))}catch(Y$){Q_(t,Y$)}}).prototype,(o_=function(e){P_(this,{type:w_,done:!1,notified:!1,parent:!1,reactions:new E_,rejection:!1,state:0,value:void 0})}).prototype=l_(N_,"then",(function(e,t){var r=O_(this),n=F_(g_(this,D_));return r.parent=!0,n.ok=!f_(e)||e,n.fail=f_(t)&&t,n.domain=c_?V_.domain:void 0,0===r.state?r.reactions.add(n):S_((function(){z_(n,r)})),n.promise})),a_=function(){var e=new o_,t=O_(e);this.promise=e,this.resolve=J_(Z_,t),this.reject=J_(Q_,t)},A_.f=F_=function(e){return e===D_||undefined===e?new a_(e):B_(e)}),s_({global:!0,constructor:!0,wrap:!0,forced:C_},{Promise:D_}),h_(D_,w_,!1,!0),p_(w_);var $_=pt("iterator"),em=!1;try{var tm=0,rm={next:function(){return{done:!!tm++}},return:function(){em=!0}};rm[$_]=function(){return this},Array.from(rm,(function(){throw 2}))}catch(Y$){}var nm=function(e,t){if(!t&&!em)return!1;var r=!1;try{var n={};n[$_]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(Y$){}return r},im=Vf,om=e_.CONSTRUCTOR||!nm((function(e){im.all(e).then(void 0,(function(){}))})),am=M,sm=Pe,cm=t_,um=Uf,dm=Wp;Cr({target:"Promise",stat:!0,forced:om},{all:function(e){var t=this,r=cm.f(t),n=r.resolve,i=r.reject,o=um((function(){var r=sm(t.resolve),o=[],a=0,s=1;dm(e,(function(e){var c=a++,u=!1;s++,am(r,t,e).then((function(e){u||(u=!0,o[c]=e,--s||n(o))}),i)})),--s||n(o)}));return o.error&&i(o.value),r.promise}});var lm=Cr,hm=e_.CONSTRUCTOR;Vf&&Vf.prototype,lm({target:"Promise",proto:!0,forced:hm,real:!0},{catch:function(e){return this.then(void 0,e)}});var pm=M,vm=Pe,fm=t_,_m=Uf,mm=Wp;Cr({target:"Promise",stat:!0,forced:om},{race:function(e){var t=this,r=fm.f(t),n=r.reject,i=_m((function(){var i=vm(t.resolve);mm(e,(function(e){pm(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}});var gm=M,ym=t_;Cr({target:"Promise",stat:!0,forced:e_.CONSTRUCTOR},{reject:function(e){var t=ym.f(this);return gm(t.reject,void 0,e),t.promise}});var Sm=nr,bm=te,km=t_,Em=function(e,t){if(Sm(e),bm(t)&&t.constructor===e)return t;var r=km.f(e);return(0,r.resolve)(t),r.promise},Tm=Cr,Im=Vf,Rm=e_.CONSTRUCTOR,Am=Em,wm=se("Promise"),Cm=!Rm;Tm({target:"Promise",stat:!0,forced:true},{resolve:function(e){return Am(Cm&&this===wm?Im:this,e)}});var xm=M,Om=Pe,Pm=t_,Mm=Uf,Dm=Wp;Cr({target:"Promise",stat:!0,forced:om},{allSettled:function(e){var t=this,r=Pm.f(t),n=r.resolve,i=r.reject,o=Mm((function(){var r=Om(t.resolve),i=[],o=0,a=1;Dm(e,(function(e){var s=o++,c=!1;a++,xm(r,t,e).then((function(e){c||(c=!0,i[s]={status:"fulfilled",value:e},--a||n(i))}),(function(e){c||(c=!0,i[s]={status:"rejected",reason:e},--a||n(i))}))})),--a||n(i)}));return o.error&&i(o.value),r.promise}});var Nm=M,Lm=Pe,Um=se,Vm=t_,Fm=Uf,Bm=Wp,jm="No one promise resolved";Cr({target:"Promise",stat:!0,forced:om},{any:function(e){var t=this,r=Um("AggregateError"),n=Vm.f(t),i=n.resolve,o=n.reject,a=Fm((function(){var n=Lm(t.resolve),a=[],s=0,c=1,u=!1;Bm(e,(function(e){var d=s++,l=!1;c++,Nm(n,t,e).then((function(e){l||u||(u=!0,i(e))}),(function(e){l||u||(l=!0,a[d]=e,--c||o(new r(a,jm)))}))})),--c||o(new r(a,jm))}));return a.error&&o(a.value),n.promise}});var Hm=Cr,Gm=Vf,zm=a,Km=se,Wm=w,Xm=Pv,qm=Em,Ym=Gm&&Gm.prototype;Hm({target:"Promise",proto:!0,real:!0,forced:!!Gm&&zm((function(){Ym.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=Xm(this,Km("Promise")),r=Wm(e);return this.then(r?function(r){return qm(t,e()).then((function(){return r}))}:e,r?function(r){return qm(t,e()).then((function(){throw r}))}:e)}});var Jm=re.Promise,Qm=t_;Cr({target:"Promise",stat:!0},{withResolvers:function(){var e=Qm.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var Zm=Jm,$m=t_,eg=Uf;Cr({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=$m.f(this),r=eg(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}});var tg=Zm,rg=r(tg),ng=Cr,ig=oo,og=m([].reverse),ag=[1,2];ng({target:"Array",proto:!0,forced:String(ag)===String(ag.reverse())},{reverse:function(){return ig(this)&&(this.length=this.length),og(this)}});var sg=Js("Array").reverse,cg=ce,ug=sg,dg=Array.prototype,lg=function(e){var t=e.reverse;return e===dg||cg(dg,e)&&t===dg.reverse?ug:t},hg=r(lg),pg=Cr,vg=oo,fg=To,_g=te,mg=Ur,gg=Hr,yg=Z,Sg=ti,bg=pt,kg=us,Eg=Xs("slice"),Tg=bg("species"),Ig=Array,Rg=Math.max;pg({target:"Array",proto:!0,forced:!Eg},{slice:function(e,t){var r,n,i,o=yg(this),a=gg(o),s=mg(e,a),c=mg(void 0===t?a:t,a);if(vg(o)&&(r=o.constructor,(fg(r)&&(r===Ig||vg(r.prototype))||_g(r)&&null===(r=r[Tg]))&&(r=void 0),r===Ig||void 0===r))return kg(o,s,c);for(n=new(void 0===r?Ig:r)(Rg(c-s,0)),i=0;s<c;s++,i++)s in o&&Sg(n,i,o[s]);return n.length=i,n}});var Ag=Js("Array").slice,wg=ce,Cg=Ag,xg=Array.prototype,Og=function(e){var t=e.slice;return e===xg||wg(xg,e)&&t===xg.slice?Cg:t},Pg=r(Og);function Mg(){Mg=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Vd||function(e,t,r){e[t]=r.value},o="function"==typeof wl?wl:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(e,t,r){return Vd(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(O){u=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var o=t&&t.prototype instanceof m?t:m,a=Hh(o.prototype),s=new C(n||[]);return i(a,"_invoke",{value:I(e,r,s)}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(n){return{type:"throw",arg:n}}}t.wrap=d;var h="suspendedStart",p="suspendedYield",v="executing",f="completed",_={};function m(){}function g(){}function y(){}var S={};u(S,a,(function(){return this}));var b=Wh&&Wh(Wh(x([])));b&&b!==r&&n.call(b,a)&&(S=b);var k=y.prototype=m.prototype=Hh(S);function E(e){var t;hd(t=["next","throw","return"]).call(t,(function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(i,o,a,s){var c=l(e[i],e,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==Xl(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function I(t,r,n){var i=h;return function(o,a){if(i===v)throw new Error("Generator is already running");if(i===f){if("throw"===o)throw a;return{value:e,done:!0}}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var c=R(s,n);if(c){if(c===_)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=l(t,r,n);if("normal"===u.type){if(i=n.done?f:p,u.arg===_)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=f,n.method="throw",n.arg=u.arg)}}}function R(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,R(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),_;var o=l(i,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,_;var a=o.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,_):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,_)}function A(e){var t,r={tryLoc:e[0]};1 in e&&(r.catchLoc=e[1]),2 in e&&(r.finallyLoc=e[2],r.afterLoc=e[3]),Oc(t=this.tryEntries).call(t,r)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],hd(e).call(e,A,this),this.reset(!0)}function x(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(Xl(t)+" is not iterable")}return g.prototype=y,i(k,"constructor",{value:y,configurable:!0}),i(y,"constructor",{value:g,configurable:!0}),g.displayName=u(y,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return qh?qh(e,y):(e.__proto__=y,u(e,c,"GeneratorFunction")),e.prototype=Hh(k),e},t.awrap=function(e){return{__await:e}},E(T.prototype),u(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,i,o){void 0===o&&(o=rg);var a=new T(d(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(k),u(k,c,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)Oc(r).call(r,n);return hg(r).call(r),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=x,C.prototype={constructor:C,reset:function(t){var r;if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,hd(r=this.tryEntries).call(r,w),!t)for(var i in this)"t"===i.charAt(0)&&n.call(this,i)&&!isNaN(+Pg(i).call(i,1))&&(this[i]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,_):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),_},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),_}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;w(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:x(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),_}},t}function Dg(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(Y$){return void r(Y$)}s.done?t(c):rg.resolve(c).then(n,i)}function Ng(e){return function(){var t=this,r=arguments;return new rg((function(n,i){var o=e.apply(t,r);function a(e){Dg(o,n,i,a,s,"next",e)}function s(e){Dg(o,n,i,a,s,"throw",e)}a(void 0)}))}}var Lg=Js("Array").concat,Ug=ce,Vg=Lg,Fg=Array.prototype,Bg=r((function(e){var t=e.concat;return e===Fg||Ug(Fg,e)&&t===Fg.concat?Vg:t})),jg=re,Hg=h;jg.JSON||(jg.JSON={stringify:JSON.stringify});var Gg=function(e,t,r){return Hg(jg.JSON.stringify,null,arguments)},zg=r(Gg),Kg=Fo.map;Cr({target:"Array",proto:!0,forced:!Xs("map")},{map:function(e){return Kg(this,e,arguments.length>1?arguments[1]:void 0)}});var Wg=Js("Array").map,Xg=ce,qg=Wg,Yg=Array.prototype,Jg=r((function(e){var t=e.map;return e===Yg||Xg(Yg,e)&&t===Yg.map?qg:t})),Qg=r(bp);Cr({target:"Array",stat:!0},{isArray:oo});var Zg=r(re.Array.isArray),$g=nr,ey=Pp,ty=Qt,ry=M,ny=Je,iy=function(e,t,r,n){try{return n?t($g(r)[0],r[1]):t(r)}catch(Y$){ey(e,"throw",Y$)}},oy=fp,ay=To,sy=Hr,cy=ti,uy=wp,dy=bp,ly=Array,hy=function(e){var t=ny(e),r=ay(this),n=arguments.length,i=n>1?arguments[1]:void 0,o=void 0!==i;o&&(i=ty(i,n>2?arguments[2]:void 0));var a,s,c,u,d,l,h=dy(t),p=0;if(!h||this===ly&&oy(h))for(a=sy(t),s=r?new this(a):ly(a);a>p;p++)l=o?i(t[p],p):t[p],cy(s,p,l);else for(d=(u=uy(t,h)).next,s=r?new this:[];!(c=ry(d,u)).done;p++)l=o?iy(u,i,[c.value,p],!0):c.value,cy(s,p,l);return s.length=p,s},py=hy;Cr({target:"Array",stat:!0,forced:!nm((function(e){Array.from(e)}))},{from:py});var vy=re.Array.from,fy=r(vy);function _y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function my(e,t){var r;if(e){if("string"==typeof e)return _y(e,t);var n=Pg(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?fy(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_y(e,t):void 0}}function gy(e,t){var r=void 0!==wl&&Qg(e)||e["@@iterator"];if(!r){if(Zg(e)||(r=my(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function yy(e,t){return function(e){if(Zg(e))return e}(e)||function(e,t){var r=null==e?null:void 0!==wl&&Qg(e)||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(Oc(s).call(s,n.value),s.length!==t);c=!0);}catch(d){u=!0,i=d}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}(e,t)||my(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Sy=Cr,by=a,ky=Qn.f;Sy({target:"Object",stat:!0,forced:by((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:ky});var Ey=re.Object,Ty=r((function(e){return Ey.getOwnPropertyNames(e)})),Iy=r(tc),Ry=Xr.includes;Cr({target:"Array",proto:!0,forced:a((function(){return!Array(1).includes()}))},{includes:function(e){return Ry(this,e,arguments.length>1?arguments[1]:void 0)}});var Ay=Js("Array").includes,wy=te,Cy=b,xy=pt("match"),Oy=function(e){var t;return wy(e)&&(void 0!==(t=e[xy])?!!t:"RegExp"===Cy(e))},Py=TypeError,My=function(e){if(Oy(e))throw Py("The method doesn't accept regular expressions");return e},Dy=pt("match"),Ny=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[Dy]=!1,"/./"[e](t)}catch(n){}}return!1},Ly=Cr,Uy=My,Vy=Y,Fy=bn,By=Ny,jy=m("".indexOf);Ly({target:"String",proto:!0,forced:!By("includes")},{includes:function(e){return!!~jy(Fy(Vy(this)),Fy(Uy(e)),arguments.length>1?arguments[1]:void 0)}});var Hy=Js("String").includes,Gy=ce,zy=Ay,Ky=Hy,Wy=Array.prototype,Xy=String.prototype,qy=r((function(e){var t=e.includes;return e===Wy||Gy(Wy,e)&&t===Wy.includes?zy:"string"==typeof e||e===Xy||Gy(Xy,e)&&t===Xy.includes?Ky:t})),Yy=Pe,Jy=Je,Qy=K,Zy=Hr,$y=TypeError,eS=function(e){return function(t,r,n,i){Yy(r);var o=Jy(t),a=Qy(o),s=Zy(o),c=e?s-1:0,u=e?-1:1;if(n<2)for(;;){if(c in a){i=a[c],c+=u;break}if(c+=u,e?c<0:s<=c)throw $y("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=u)c in a&&(i=r(i,a[c],c,o));return i}},tS={left:eS(!1),right:eS(!0)}.left;Cr({target:"Array",proto:!0,forced:!fv&&_e>79&&_e<83||!rd("reduce")},{reduce:function(e){var t=arguments.length;return tS(this,e,t,t>1?arguments[1]:void 0)}});var rS=Js("Array").reduce,nS=ce,iS=rS,oS=Array.prototype,aS=r((function(e){var t=e.reduce;return e===oS||nS(oS,e)&&t===oS.reduce?iS:t})),sS=x,cS=a,uS=m,dS=Xc,lS=on,hS=Z,pS=uS(D.f),vS=uS([].push),fS=sS&&cS((function(){var e=Object.create(null);return e[2]=2,!pS(e,2)})),_S=function(e){return function(t){for(var r,n=hS(t),i=lS(n),o=fS&&null===dS(n),a=i.length,s=0,c=[];a>s;)r=i[s++],sS&&!(o?r in n:pS(n,r))||vS(c,e?[r,n[r]]:n[r]);return c}},mS={entries:_S(!0),values:_S(!1)}.entries;Cr({target:"Object",stat:!0},{entries:function(e){return mS(e)}});var gS,yS,SS,bS,kS,ES,TS,IS,RS,AS,wS,CS,xS,OS,PS,MS,DS,NS=r(re.Object.entries),LS=r(cn),US={};function VS(e,t){try{var r;return qy(r=e[t].toString()).call(r,"[native code]")?"native":"non-native"}catch(n){return"untouchable"}}var FS=aS(gS="undefined"!=typeof window?[[null===(yS=window.RTCPeerConnection)||void 0===yS?void 0:yS.prototype,"RTCPeerConnection.prototype"],[window.RTCPeerConnection,"RTCPeerConnection"],[null===(SS=window.RTCDataChannel)||void 0===SS?void 0:SS.prototype,"RTCDataChannel.prototype"],[window.RTCDataChannel,"RTCDataChannel"],[null===(bS=window.MediaStreamTrack)||void 0===bS?void 0:bS.prototype,"MediaStreamTrack.prototype"],[window.MediaStreamTrack,"MediaStreamTrack"],[null===(kS=window.MediaStream)||void 0===kS?void 0:kS.prototype,"MediaStream.prototype"],[window.MediaStream,"MediaStream"],[null===(ES=window.HTMLAudioElement)||void 0===ES?void 0:ES.prototype,"HTMLAudioElement.prototype"],[null===(TS=window.HTMLVideoElement)||void 0===TS?void 0:TS.prototype,"HTMLVideoElement.prototype"],[null===(IS=window.HTMLMediaElement)||void 0===IS?void 0:IS.prototype,"HTMLMediaElement.prototype"],[null!==(RS=null===(AS=window.AudioContext)||void 0===AS?void 0:AS.prototype)&&void 0!==RS?RS:null===(wS=window.webkitAudioContext)||void 0===wS?void 0:wS.prototype,"AudioContext.prototype"],[null===(CS=window.BaseAudioContext)||void 0===CS?void 0:CS.prototype,"BaseAudioContext.prototype"],[null===(xS=window.AudioNode)||void 0===xS?void 0:xS.prototype,"AudioNode.prototype"],[window.navigator.mediaDevices,"navigator.mediaDevices"],[window.console,"console"]]:[]).call(gS,(function(e,t){var r=yy(t,2),n=r[0],i=r[1];return Bg(e).call(e,function(e,t){var r;if(!e)return[];var n=Ty(e);return Jg(r=Iy(n).call(n,(function(t){if("peerIdentity"===t)return!1;try{return"function"==typeof e[t]||void 0===e[t]}catch(r){return!1}}))).call(r,(function(r){return{obj:e,prefix:t,attr:r}}))}(n,i))}),[]);"undefined"!=typeof window&&FS.push({obj:window.navigator.mediaDevices,prefix:"navigator.mediaDevices",attr:"getUserMedia"},{obj:window.navigator.mediaDevices,prefix:"navigator.mediaDevices",attr:"getDisplayMedia"},{obj:window.navigator.mediaDevices,prefix:"navigator.mediaDevices",attr:"enumerateDevices"},{obj:window.navigator.mediaDevices,prefix:"navigator.mediaDevices",attr:"getSupportedConstraints"});var BS,jS=gy(FS);try{for(jS.s();!(BS=jS.n()).done;){var HS,GS=BS.value,zS=GS.obj,KS=GS.prefix,WS=GS.attr,XS=Bg(HS="".concat(KS,".")).call(HS,WS);US[XS]=VS(zS,WS)}}catch(J$){jS.e(J$)}finally{jS.f()}"undefined"!=typeof window&&(qy(OS=window.location.search).call(OS,"_rtc_debug_")||(null===(PS=window.localStorage)||void 0===PS?void 0:PS.getItem("_rtc_debug_")))&&console.log("RTC_AMBULANCE",US);var qS=Jg(MS=Iy(DS=NS(US)).call(DS,(function(e){var t=yy(e,2);return t[0],"non-native"===t[1]}))).call(MS,(function(e){var t=yy(e,2),r=t[0];return t[1],r}));LS(qS).length&&console.warn("RTC_AMBULANCE","have non-native code:\n",qS.join("\n"));var YS="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",JS=Y,QS=bn,ZS=YS,$S=m("".replace),eb=RegExp("^["+ZS+"]+"),tb=RegExp("(^|[^"+ZS+"])["+ZS+"]+$"),rb=function(e){return function(t){var r=QS(JS(t));return 1&e&&(r=$S(r,eb,"")),2&e&&(r=$S(r,tb,"$1")),r}},nb={start:rb(1),end:rb(2),trim:rb(3)},ib=o,ob=a,ab=m,sb=bn,cb=nb.trim,ub=YS,db=ib.parseInt,lb=ib.Symbol,hb=lb&&lb.iterator,pb=/^[+-]?0x/i,vb=ab(pb.exec),fb=8!==db(ub+"08")||22!==db(ub+"0x16")||hb&&!ob((function(){db(Object(hb))}))?function(e,t){var r=cb(sb(e));return db(r,t>>>0||(vb(pb,r)?16:10))}:db;Cr({global:!0,forced:parseInt!==fb},{parseInt:fb});var _b=r(re.parseInt),mb={exports:{}},gb=a((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),yb=a,Sb=te,bb=b,kb=gb,Eb=Object.isExtensible,Tb=yb((function(){Eb(1)}))||kb?function(e){return!!Sb(e)&&((!kb||"ArrayBuffer"!==bb(e))&&(!Eb||Eb(e)))}:Eb,Ib=!a((function(){return Object.isExtensible(Object.preventExtensions({}))})),Rb=Cr,Ab=m,wb=qr,Cb=te,xb=$e,Ob=Zt.f,Pb=qn,Mb=Qn,Db=Tb,Nb=Ib,Lb=!1,Ub=it("meta"),Vb=0,Fb=function(e){Ob(e,Ub,{value:{objectID:"O"+Vb++,weakData:{}}})},Bb=mb.exports={enable:function(){Bb.enable=function(){},Lb=!0;var e=Pb.f,t=Ab([].splice),r={};r[Ub]=1,e(r).length&&(Pb.f=function(r){for(var n=e(r),i=0,o=n.length;i<o;i++)if(n[i]===Ub){t(n,i,1);break}return n},Rb({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Mb.f}))},fastKey:function(e,t){if(!Cb(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!xb(e,Ub)){if(!Db(e))return"F";if(!t)return"E";Fb(e)}return e[Ub].objectID},getWeakData:function(e,t){if(!xb(e,Ub)){if(!Db(e))return!0;if(!t)return!1;Fb(e)}return e[Ub].weakData},onFreeze:function(e){return Nb&&Lb&&Db(e)&&!xb(e,Ub)&&Fb(e),e}};wb[Ub]=!0;var jb=mb.exports,Hb=Cr,Gb=o,zb=jb,Kb=a,Wb=mr,Xb=Wp,qb=Ev,Yb=w,Jb=te,Qb=W,Zb=ji,$b=Zt.f,ek=Fo.forEach,tk=x,rk=no.set,nk=no.getterFor,ik=function(e,t,r){var n,i=-1!==e.indexOf("Map"),o=-1!==e.indexOf("Weak"),a=i?"set":"add",s=Gb[e],c=s&&s.prototype,u={};if(tk&&Yb(s)&&(o||c.forEach&&!Kb((function(){(new s).entries().next()})))){var d=(n=t((function(t,r){rk(qb(t,d),{type:e,collection:new s}),Qb(r)||Xb(r,t[a],{that:t,AS_ENTRIES:i})}))).prototype,l=nk(e);ek(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(e){var t="add"===e||"set"===e;!(e in c)||o&&"clear"===e||Wb(d,e,(function(r,n){var i=l(this).collection;if(!t&&o&&!Jb(r))return"get"===e&&void 0;var a=i[e](0===r?0:r,n);return t?this:a}))})),o||$b(d,"size",{configurable:!0,get:function(){return l(this).collection.size}})}else n=r.getConstructor(t,e,i,a),zb.enable();return Zb(n,e,!1,!0),u[e]=n,Hb({global:!0,forced:!0},u),o||r.setStrong(n,e,i),n},ok=fi,ak=function(e,t,r){for(var n in t)r&&r.unsafe&&e[n]?e[n]=t[n]:ok(e,n,t[n],r);return e},sk=Xn,ck=mi,uk=ak,dk=Qt,lk=Ev,hk=W,pk=Wp,vk=Lu,fk=Uu,_k=Sv,mk=x,gk=jb.fastKey,yk=no.set,Sk=no.getterFor,bk={getConstructor:function(e,t,r,n){var i=e((function(e,i){lk(e,o),yk(e,{type:t,index:sk(null),first:void 0,last:void 0,size:0}),mk||(e.size=0),hk(i)||pk(i,e[n],{that:e,AS_ENTRIES:r})})),o=i.prototype,a=Sk(t),s=function(e,t,r){var n,i,o=a(e),s=c(e,t);return s?s.value=r:(o.last=s={index:i=gk(t,!0),key:t,value:r,previous:n=o.last,next:void 0,removed:!1},o.first||(o.first=s),n&&(n.next=s),mk?o.size++:e.size++,"F"!==i&&(o.index[i]=s)),e},c=function(e,t){var r,n=a(e),i=gk(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key===t)return r};return uk(o,{clear:function(){for(var e=a(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,mk?e.size=0:this.size=0},delete:function(e){var t=this,r=a(t),n=c(t,e);if(n){var i=n.next,o=n.previous;delete r.index[n.index],n.removed=!0,o&&(o.next=i),i&&(i.previous=o),r.first===n&&(r.first=i),r.last===n&&(r.last=o),mk?r.size--:t.size--}return!!n},forEach:function(e){for(var t,r=a(this),n=dk(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!c(this,e)}}),uk(o,r?{get:function(e){var t=c(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),mk&&ck(o,"size",{configurable:!0,get:function(){return a(this).size}}),i},setStrong:function(e,t,r){var n=t+" Iterator",i=Sk(t),o=Sk(n);vk(e,t,(function(e,t){yk(this,{type:n,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?fk("keys"===t?r.key:"values"===t?r.value:[r.key,r.value],!1):(e.target=void 0,fk(void 0,!0))}),r?"entries":"values",!r,!0),_k(t)}};ik("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),bk);var kk=re.Map,Ek=function(e,t){return 1===t?function(t,r){return t[e](r)}:function(t,r,n){return t[e](r,n)}},Tk=Ek,Ik=se("Map"),Rk={Map:Ik,set:Tk("set",2),get:Tk("get",1),has:Tk("has",1),remove:Tk("delete",1),proto:Ik.prototype},Ak=Cr,wk=Pe,Ck=Y,xk=Wp,Ok=Rk.Map,Pk=Rk.has,Mk=Rk.get,Dk=Rk.set,Nk=m([].push);Ak({target:"Map",stat:!0,forced:true},{groupBy:function(e,t){Ck(e),wk(t);var r=new Ok,n=0;return xk(e,(function(e){var i=t(e,n++);Pk(r,i)?Nk(Mk(r,i),e):Dk(r,i,[e])})),r}});var Lk=kk,Uk=Qt,Vk=M,Fk=Pe,Bk=Av,jk=W,Hk=Wp,Gk=[].push,zk=function(e){var t,r,n,i,o=arguments.length,a=o>1?arguments[1]:void 0;return Bk(this),(t=void 0!==a)&&Fk(a),jk(e)?new this:(r=[],t?(n=0,i=Uk(a,o>2?arguments[2]:void 0),Hk(e,(function(e){Vk(Gk,r,i(e,n++))}))):Hk(e,Gk,{that:r}),new this(r))};Cr({target:"Map",stat:!0,forced:!0},{from:zk});var Kk=us,Wk=function(){return new this(Kk(arguments))};Cr({target:"Map",stat:!0,forced:!0},{of:Wk});var Xk=we,qk=function(e){if("object"==typeof e&&"size"in e&&"has"in e&&"get"in e&&"set"in e&&"delete"in e&&"entries"in e)return e;throw TypeError(Xk(e)+" is not a map")},Yk=qk,Jk=Rk.remove;Cr({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=Yk(this),r=!0,n=0,i=arguments.length;n<i;n++)e=Jk(t,arguments[n]),r=r&&e;return!!r}});var Qk=qk,Zk=Rk.get,$k=Rk.has,eE=Rk.set;Cr({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function(e,t){var r,n,i=Qk(this);return $k(i,e)?(r=Zk(i,e),"update"in t&&(r=t.update(r,e,i),eE(i,e,r)),r):(n=t.insert(e,i),eE(i,e,n),n)}});var tE=M,rE=function(e,t,r){for(var n,i,o=r?e:e.iterator,a=e.next;!(n=tE(a,o)).done;)if(void 0!==(i=t(n.value)))return i},nE=rE,iE=function(e,t,r){return r?nE(e.entries(),(function(e){return t(e[1],e[0])}),!0):e.forEach(t)},oE=Qt,aE=qk,sE=iE;Cr({target:"Map",proto:!0,real:!0,forced:!0},{every:function(e){var t=aE(this),r=oE(e,arguments.length>1?arguments[1]:void 0);return!1!==sE(t,(function(e,n){if(!r(e,n,t))return!1}),!0)}});var cE=Qt,uE=qk,dE=iE,lE=Rk.Map,hE=Rk.set;Cr({target:"Map",proto:!0,real:!0,forced:!0},{filter:function(e){var t=uE(this),r=cE(e,arguments.length>1?arguments[1]:void 0),n=new lE;return dE(t,(function(e,i){r(e,i,t)&&hE(n,i,e)})),n}});var pE=Qt,vE=qk,fE=iE;Cr({target:"Map",proto:!0,real:!0,forced:!0},{find:function(e){var t=vE(this),r=pE(e,arguments.length>1?arguments[1]:void 0),n=fE(t,(function(e,n){if(r(e,n,t))return{value:e}}),!0);return n&&n.value}});var _E=Qt,mE=qk,gE=iE;Cr({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function(e){var t=mE(this),r=_E(e,arguments.length>1?arguments[1]:void 0),n=gE(t,(function(e,n){if(r(e,n,t))return{key:n}}),!0);return n&&n.key}});var yE=function(e,t){return e===t||e!=e&&t!=t},SE=qk,bE=iE;Cr({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(e){return!0===bE(SE(this),(function(t){if(yE(t,e))return!0}),!0)}});var kE=M,EE=Wp,TE=w,IE=Pe,RE=Rk.Map;Cr({target:"Map",stat:!0,forced:!0},{keyBy:function(e,t){var r=new(TE(this)?this:RE);IE(t);var n=IE(r.set);return EE(e,(function(e){kE(n,r,t(e),e)})),r}});var AE=qk,wE=iE;Cr({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function(e){var t=wE(AE(this),(function(t,r){if(t===e)return{key:r}}),!0);return t&&t.key}});var CE=Qt,xE=qk,OE=iE,PE=Rk.Map,ME=Rk.set;Cr({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function(e){var t=xE(this),r=CE(e,arguments.length>1?arguments[1]:void 0),n=new PE;return OE(t,(function(e,i){ME(n,r(e,i,t),e)})),n}});var DE=Qt,NE=qk,LE=iE,UE=Rk.Map,VE=Rk.set;Cr({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function(e){var t=NE(this),r=DE(e,arguments.length>1?arguments[1]:void 0),n=new UE;return LE(t,(function(e,i){VE(n,i,r(e,i,t))})),n}});var FE=qk,BE=Wp,jE=Rk.set;Cr({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function(e){for(var t=FE(this),r=arguments.length,n=0;n<r;)BE(arguments[n++],(function(e,r){jE(t,e,r)}),{AS_ENTRIES:!0});return t}});var HE=Pe,GE=qk,zE=iE,KE=TypeError;Cr({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=GE(this),r=arguments.length<2,n=r?void 0:arguments[1];if(HE(e),zE(t,(function(i,o){r?(r=!1,n=i):n=e(n,i,o,t)})),r)throw KE("Reduce of empty map with no initial value");return n}});var WE=Qt,XE=qk,qE=iE;Cr({target:"Map",proto:!0,real:!0,forced:!0},{some:function(e){var t=XE(this),r=WE(e,arguments.length>1?arguments[1]:void 0);return!0===qE(t,(function(e,n){if(r(e,n,t))return!0}),!0)}});var YE=Pe,JE=qk,QE=TypeError,ZE=Rk.get,$E=Rk.has,eT=Rk.set;Cr({target:"Map",proto:!0,real:!0,forced:!0},{update:function(e,t){var r=JE(this),n=arguments.length;YE(t);var i=$E(r,e);if(!i&&n<3)throw QE("Updating absent value");var o=i?ZE(r,e):YE(n>2?arguments[2]:void 0)(e,r);return eT(r,e,t(o,e,r)),r}});var tT=M,rT=Pe,nT=w,iT=nr,oT=TypeError,aT=function(e,t){var r,n=iT(this),i=rT(n.get),o=rT(n.has),a=rT(n.set),s=arguments.length>2?arguments[2]:void 0;if(!nT(t)&&!nT(s))throw oT("At least one callback required");return tT(o,n,e)?(r=tT(i,n,e),nT(t)&&(r=t(r),tT(a,n,e,r))):nT(s)&&(r=s(),tT(a,n,e,r)),r};Cr({target:"Map",proto:!0,real:!0,forced:!0},{upsert:aT}),Cr({target:"Map",proto:!0,real:!0,name:"upsert",forced:!0},{updateOrInsert:aT});var sT=Lk,cT=r(sT),uT=r(sT),dT=r(Ud),lT=x,hT=m,pT=M,vT=a,fT=on,_T=pi,mT=D,gT=Je,yT=K,ST=Object.assign,bT=Object.defineProperty,kT=hT([].concat),ET=!ST||vT((function(){if(lT&&1!==ST({b:1},ST(bT({},"a",{enumerable:!0,get:function(){bT(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol("assign detection"),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!==ST({},e)[r]||fT(ST({},t)).join("")!==n}))?function(e,t){for(var r=gT(e),n=arguments.length,i=1,o=_T.f,a=mT.f;n>i;)for(var s,c=yT(arguments[i++]),u=o?kT(fT(c),o(c)):fT(c),d=u.length,l=0;d>l;)s=u[l++],lT&&!pT(a,c,s)||(r[s]=c[s]);return r}:ST,TT=ET;Cr({target:"Object",stat:!0,arity:2,forced:Object.assign!==TT},{assign:TT});var IT=r(re.Object.assign),RT=Cr,AT=T;C.f;var wT=Br,CT=bn,xT=My,OT=Y,PT=Ny,MT=AT("".endsWith),DT=AT("".slice),NT=Math.min;RT({target:"String",proto:!0,forced:!PT("endsWith")},{endsWith:function(e){var t=CT(OT(this));xT(e);var r=arguments.length>1?arguments[1]:void 0,n=t.length,i=void 0===r?n:NT(wT(r),n),o=CT(e);return MT?MT(t,o,i):DT(t,i-o.length,i)===o}});var LT=Js("String").endsWith,UT=ce,VT=LT,FT=String.prototype,BT=r((function(e){var t=e.endsWith;return"string"==typeof e||e===FT||UT(FT,e)&&t===FT.endsWith?VT:t})),jT=!0,HT=!0;function GT(e,t,r){var n=e.match(t);return n&&n.length>=r&&_b(n[r],10)}function zT(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=r(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new uT),this._eventMap[t].set(n,o),i.apply(this,[e,o])};var o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(r))return o.apply(this,arguments);var n=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===LS(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,n])},dT(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function KT(e){return"boolean"!=typeof e?new Error("Argument type: "+Xl(e)+". Please use a boolean."):(jT=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function WT(e){return"boolean"!=typeof e?new Error("Argument type: "+Xl(e)+". Please use a boolean."):(HT=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function XT(){if("object"===("undefined"==typeof window?"undefined":Xl(window))){if(jT)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function qT(e,t){HT&&console.warn(e+" is deprecated, please use "+t+" instead.")}function YT(e){return"[object Object]"===Object.prototype.toString.call(e)}function JT(e){var t;return YT(e)?aS(t=LS(e)).call(t,(function(t,r){var n=YT(e[r]),i=n?JT(e[r]):e[r],o=n&&!LS(i).length;return void 0===i||o?t:IT(t,Jl({},r,i))}),{}):e}function QT(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),LS(t).forEach((function(n){BT(n).call(n,"Id")?QT(e,e.get(t[n]),r):BT(n).call(n,"Ids")&&t[n].forEach((function(t){QT(e,e.get(t),r)}))})))}function ZT(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new uT;if(null===t)return i;var o=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((function(t){e.forEach((function(r){r.type===n&&r.trackId===t.id&&QT(e,r,i)}))})),i}var $T=Cr,eI=Fo.find,tI="find",rI=!0;tI in[]&&Array(1)[tI]((function(){rI=!1})),$T({target:"Array",proto:!0,forced:rI},{find:function(e){return eI(this,e,arguments.length>1?arguments[1]:void 0)}});var nI=Js("Array").find,iI=ce,oI=nI,aI=Array.prototype,sI=r((function(e){var t=e.find;return e===aI||iI(aI,e)&&t===aI.find?oI:t})),cI=r(Og),uI=Cr,dI=Xr.indexOf,lI=rd,hI=T([].indexOf),pI=!!hI&&1/hI([1],1,-0)<0;uI({target:"Array",proto:!0,forced:pI||!lI("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return pI?hI(this,e,t)||0:dI(this,e,t)}});var vI=Js("Array").indexOf,fI=ce,_I=vI,mI=Array.prototype,gI=function(e){var t=e.indexOf;return e===mI||fI(mI,e)&&t===mI.indexOf?_I:t},yI=r(gI),SI=r(gI),bI=we,kI=TypeError,EI=function(e,t){if(!delete e[t])throw kI("Cannot delete property "+bI(t)+" of "+bI(e))},TI=Cr,II=Je,RI=Ur,AI=Mr,wI=Hr,CI=mc,xI=yc,OI=Oo,PI=ti,MI=EI,DI=Xs("splice"),NI=Math.max,LI=Math.min;TI({target:"Array",proto:!0,forced:!DI},{splice:function(e,t){var r,n,i,o,a,s,c=II(this),u=wI(c),d=RI(e,u),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=u-d):(r=l-2,n=LI(NI(AI(t),0),u-d)),xI(u+r-n),i=OI(c,n),o=0;o<n;o++)(a=d+o)in c&&PI(i,o,c[a]);if(i.length=n,r<n){for(o=d;o<u-n;o++)s=o+r,(a=o+n)in c?c[s]=c[a]:MI(c,s);for(o=u;o>u-n+r;o--)MI(c,o-1)}else if(r>n)for(o=u-n;o>d;o--)s=o+r-1,(a=o+n-1)in c?c[s]=c[a]:MI(c,s);for(o=0;o<r;o++)c[o+d]=arguments[o+2];return CI(c,u-n+r),i}});var UI=Js("Array").splice,VI=ce,FI=UI,BI=Array.prototype,jI=r((function(e){var t=e.splice;return e===BI||VI(BI,e)&&t===BI.splice?FI:t})),HI=r(tg),GI=r(lc),zI=XT;function KI(e,t){var r=e&&e.navigator;if(r.mediaDevices){var n=function(e){if("object"!==Xl(e)||e.mandatory||e.optional)return e;var t,r={};(LS(e).forEach((function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var n="object"===Xl(e[t])?e[t]:{ideal:e[t]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+cI(t).call(t,1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){r.optional=r.optional||[];var o={};"number"==typeof n.ideal?(o[i("min",t)]=n.ideal,r.optional.push(o),(o={})[i("max",t)]=n.ideal,r.optional.push(o)):(o[i("",t)]=n.ideal,r.optional.push(o))}void 0!==n.exact&&"number"!=typeof n.exact?(r.mandatory=r.mandatory||{},r.mandatory[i("",t)]=n.exact):["min","max"].forEach((function(e){void 0!==n[e]&&(r.mandatory=r.mandatory||{},r.mandatory[i(e,t)]=n[e])}))}})),e.advanced)&&(r.optional=Bg(t=r.optional||[]).call(t,e.advanced));return r},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(zg(e)))&&"object"===Xl(e.audio)){var o=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};o((e=JSON.parse(zg(e))).audio,"autoGainControl","googAutoGainControl"),o(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"===Xl(e.video)){var a=e.video.facingMode;a=a&&("object"===Xl(a)?a:{ideal:a});var s,c=t.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||c))if(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?s=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(s=["front"]),s)return r.mediaDevices.enumerateDevices().then((function(t){t=Iy(t).call(t,(function(e){return"videoinput"===e.kind}));var r=sI(t).call(t,(function(e){return s.some((function(t){var r;return qy(r=e.label.toLowerCase()).call(r,t)}))}));return!r&&t.length&&qy(s).call(s,"back")&&(r=t[t.length-1]),r&&(e.video.deviceId=a.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=n(e.video),zI("chrome: "+zg(e)),i(e)}));e.video=n(e.video)}return zI("chrome: "+zg(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(e,t,n){i(e,(function(e){r.webkitGetUserMedia(e,t,(function(e){n&&n(o(e))}))}))}.bind(r),r.mediaDevices.getUserMedia){var a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return i(e,(function(e){return a(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return HI.reject(o(e))}))}))}}}}function WI(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function XI(e){if("object"===Xl(e)&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){dT(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(n){var i,o;e.RTCPeerConnection.prototype.getReceivers?i=sI(o=r.getReceivers()).call(o,(function(e){return e.track&&e.track.id===n.track.id})):i={track:n.track};var a=new Event("track");a.track=n.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],r.dispatchEvent(a)})),t.stream.getTracks().forEach((function(n){var i,o;e.RTCPeerConnection.prototype.getReceivers?i=sI(o=r.getReceivers()).call(o,(function(e){return e.track&&e.track.id===n.id})):i={track:n};var a=new Event("track");a.track=n,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],r.dispatchEvent(a)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else zT(e,"track",(function(e){return e.transceiver||dT(e,"transceiver",{value:{receiver:e.receiver}}),e}))}function qI(e){if("object"===Xl(e)&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){var e;return this._senders=this._senders||[],cI(e=this._senders).call(e)};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t;n.apply(this,arguments);var r,i=SI(t=this._senders).call(t,e);-1!==i&&jI(r=this._senders).call(r,i,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((function(e){r._senders.push(t(r,e))}))};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach((function(e){var r,n,i,o=sI(r=t._senders).call(r,(function(t){return t.track===e}));o&&jI(n=t._senders).call(n,SI(i=t._senders).call(i,o),1)}))}}else if("object"===Xl(e)&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},dT(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function YI(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,r=cI(Array.prototype).call(arguments),n=r[0],i=r[1],o=r[2];if(arguments.length>0&&"function"==typeof n)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof n))return t.apply(this,[]);var a=function(e){var t={};return e.result().forEach((function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){r[t]=e.stat(t)})),t[r.id]=r})),t},s=function(e){var t;return new uT(Jg(t=LS(e)).call(t,(function(t){return[t,e[t]]})))};if(arguments.length>=2){return t.apply(this,[function(e){i(s(a(e)))},n])}return new HI((function(r,n){t.apply(e,[function(e){r(s(a(e)))},n])})).then(i,o)}}}function JI(e){if("object"===Xl(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return ZT(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=n.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),zT(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return ZT(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,r,n,o=arguments[0];return this.getSenders().forEach((function(e){e.track===o&&(t?n=!0:t=e)})),this.getReceivers().forEach((function(e){return e.track===o&&(r?n=!0:r=e),e.track===o})),n||t&&r?HI.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():HI.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}}function QI(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e,t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Jg(e=LS(this._shimmedLocalStreams)).call(e,(function(e){return t._shimmedLocalStreams[e][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var n;if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var i=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===SI(n=this._shimmedLocalStreams[r.id]).call(n,i)&&this._shimmedLocalStreams[r.id].push(i):this._shimmedLocalStreams[r.id]=[r,i],i};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t,n,i=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){var t;if(sI(t=i.getSenders()).call(t,(function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var o=this.getSenders();r.apply(this,arguments);var a=Iy(t=this.getSenders()).call(t,(function(e){return-1===SI(o).call(o,e)}));this._shimmedLocalStreams[e.id]=Bg(n=[e]).call(n,a)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&LS(this._shimmedLocalStreams).forEach((function(r){var n,i,o=SI(n=t._shimmedLocalStreams[r]).call(n,e);-1!==o&&jI(i=t._shimmedLocalStreams[r]).call(i,o,1);1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]})),i.apply(this,arguments)}}function ZI(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return QI(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},Jg(t).call(t,(function(t){return e._reverseStreams[t.id]}))};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){var t;if(sI(t=r.getSenders()).call(t,(function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}n.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n,i,o,a=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var s=cI([]).call(arguments,1);if(1!==s.length||!sI(n=s[0].getTracks()).call(n,(function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(sI(i=this.getSenders()).call(i,(function(e){return e.track===t})))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var c=this._streams[r.id];if(c)c.addTrack(t),HI.resolve().then((function(){a.dispatchEvent(new Event("negotiationneeded"))}));else{var u=new e.MediaStream([t]);this._streams[r.id]=u,this._reverseStreams[u.id]=r,this.addStream(u)}return sI(o=this.getSenders()).call(o,(function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=Jl({},t,(function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[function(r){var n=s(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then((function(t){return s(e,t)}))}));e.RTCPeerConnection.prototype[t]=n[t]}));var o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(e=this,r=(t=arguments[0]).sdp,LS(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:r})),o.apply(this,arguments)):o.apply(this,arguments);var e,t,r};var a=GI(e.RTCPeerConnection.prototype,"localDescription");dT(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},LS(this._streams).forEach((function(n){var i;sI(i=r._streams[n].getTracks()).call(i,(function(t){return e.track===t}))&&(t=r._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function s(e,t){var r=t.sdp;return LS(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}}function $I(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=Jl({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=n[t]}))}function eR(e,t){zT(e,"negotiationneeded",(function(e){var r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e}))}var tR=Object.freeze({__proto__:null,fixNegotiationNeeded:eR,shimAddTrackRemoveTrack:ZI,shimAddTrackRemoveTrackWithNative:QI,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((function(t){var n=r.video&&r.video.width,i=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:qI,shimGetStats:YI,shimGetUserMedia:KI,shimMediaStream:WI,shimOnTrack:XI,shimPeerConnection:$I,shimSenderReceiverGetStats:JI});function rR(e){return function(e){if(Zg(e))return _y(e)}(e)||function(e){if(void 0!==wl&&null!=Qg(e)||null!=e["@@iterator"])return fy(e)}(e)||my(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var nR=o,iR=a,oR=bn,aR=nb.trim,sR=YS,cR=m("".charAt),uR=nR.parseFloat,dR=nR.Symbol,lR=dR&&dR.iterator,hR=1/uR(sR+"-0")!=-1/0||lR&&!iR((function(){uR(Object(lR))}))?function(e){var t=aR(oR(e)),r=uR(t);return 0===r&&"-"===cR(t,0)?-0:r}:uR;Cr({global:!0,forced:parseFloat!==hR},{parseFloat:hR});var pR=r(re.parseFloat);function vR(e,t){var r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){qT("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var i=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===Xl(e)&&"object"===Xl(e.audio)&&(e=JSON.parse(zg(e)),i(e.audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),o(e)},n&&n.prototype.getSettings){var a=n.prototype.getSettings;n.prototype.getSettings=function(){var e=a.apply(this,arguments);return i(e,"mozAutoGainControl","autoGainControl"),i(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var s=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===Xl(e)&&(e=JSON.parse(zg(e)),i(e,"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[e])}}}}function fR(e){"object"===Xl(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&dT(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function _R(e,t){if("object"===Xl(e)&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=Jl({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=n[t]}));var r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=cI(Array.prototype).call(arguments),i=e[0],o=e[1],a=e[2];return n.apply(this,[i||null]).then((function(e){if(t.version<53&&!o)try{e.forEach((function(e){e.type=r[e.type]||e.type}))}catch(n){if("TypeError"!==n.name)throw n;e.forEach((function(t,n){e.set(n,IT({},t,{type:r[t.type]||t.type}))}))}return e})).then(o,a)}}}function mR(e){if("object"===Xl(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):HI.resolve(new uT)}}}function gR(e){if("object"===Xl(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r}),zT(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function yR(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;qT("removeStream","removeTrack"),this.getSenders().forEach((function(r){var n;r.track&&qy(n=e.getTracks()).call(n,r.track)&&t.removeTrack(r)}))})}function SR(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function bR(e){if("object"===Xl(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);var r=(e=rR(e)).length>0;r&&e.forEach((function(e){if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(pR(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(pR(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var n=t.apply(this,arguments);if(r){var i=n.sender,o=i.getParameters();(!("encodings"in o)||1===o.encodings.length&&0===LS(o.encodings[0]).length)&&(o.encodings=e,i.sendEncodings=e,this.setParametersPromises.push(i.setParameters(o).then((function(){delete i.sendEncodings})).catch((function(){delete i.sendEncodings}))))}return n})}}function kR(e){if("object"===Xl(e)&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e,r=t.apply(this,arguments);"encodings"in r||(r.encodings=Bg(e=[]).call(e,this.sendEncodings||[{}]));return r})}}function ER(e){if("object"===Xl(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?HI.all(this.setParametersPromises).then((function(){return t.apply(r,e)})).finally((function(){r.setParametersPromises=[]})):t.apply(this,arguments)}}}function TR(e){if("object"===Xl(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?HI.all(this.setParametersPromises).then((function(){return t.apply(r,e)})).finally((function(){r.setParametersPromises=[]})):t.apply(this,arguments)}}}var IR=Object.freeze({__proto__:null,shimAddTransceiver:bR,shimCreateAnswer:TR,shimCreateOffer:ER,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,HI.reject(n)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:kR,shimGetUserMedia:vR,shimOnTrack:fR,shimPeerConnection:_R,shimRTCDataChannel:SR,shimReceiverGetStats:gR,shimRemoveStream:yR,shimSenderGetStats:mR});function RR(e){if("object"===Xl(e)&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r,n=this;this._localStreams||(this._localStreams=[]),qy(r=this._localStreams).call(r,e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(r){return t.call(n,r,e)})),e.getVideoTracks().forEach((function(r){return t.call(n,r,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var r=this,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return i&&i.forEach((function(e){var t;r._localStreams?qy(t=r._localStreams).call(t,e)||r._localStreams.push(e):r._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t,r,n=this;this._localStreams||(this._localStreams=[]);var i=SI(t=this._localStreams).call(t,e);if(-1!==i){jI(r=this._localStreams).call(r,i,1);var o=e.getTracks();this.getSenders().forEach((function(e){qy(o).call(o,e.track)&&n.removeTrack(e)}))}})}}function AR(e){if("object"===Xl(e)&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){dT(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){var r;if(t._remoteStreams||(t._remoteStreams=[]),!qy(r=t._remoteStreams).call(r,e)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){var r;if(e._remoteStreams||(e._remoteStreams=[]),!(SI(r=e._remoteStreams).call(r,t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}}))}),t.apply(e,arguments)}}}function wR(e){if("object"===Xl(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),HI.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),HI.resolve()):i};var s=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),HI.resolve()):n};t.setLocalDescription=s,s=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),HI.resolve()):n},t.setRemoteDescription=s,s=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),HI.resolve()):n},t.addIceCandidate=s}}function CR(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return n(xR(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))}function xR(e){return e&&void 0!==e.video?IT({},e,{video:JT(e.video)}):e}function OR(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(qT("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(zg(o))).urls=o.url,delete o.url,n.push(o)):n.push(e.iceServers[i])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&dT(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function PR(e){"object"===Xl(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&dT(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function MR(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){var r,n;void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var i=sI(r=this.getTransceivers()).call(r,(function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveAudio||i||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var o=sI(n=this.getTransceivers()).call(n,(function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&o?"sendrecv"===o.direction?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":"recvonly"===o.direction&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):!0!==e.offerToReceiveVideo||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function DR(e){"object"!==Xl(e)||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var NR=Object.freeze({__proto__:null,shimAudioContext:DR,shimCallbacksAPI:wR,shimConstraints:xR,shimCreateOfferLegacy:MR,shimGetUserMedia:CR,shimLocalStreamsAPI:RR,shimRTCIceServerUrls:OR,shimRemoteStreamsAPI:AR,shimTrackEventTransceiver:PR}),LR=Vc.PROPER,UR=a,VR=YS,FR=nb.trim;Cr({target:"String",proto:!0,forced:function(e){return UR((function(){return!!VR[e]()||"âÂá "!=="âÂá "[e]()||LR&&VR[e].name!==e}))}("trim")},{trim:function(){return FR(this)}});var BR,jR,HR=Js("String").trim,GR=ce,zR=HR,KR=String.prototype,WR=r((function(e){var t=e.trim;return"string"==typeof e||e===KR||GR(KR,e)&&t===KR.trim?zR:t})),XR={exports:{}};BR=XR,(jR={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}}).localCName=jR.generateIdentifier(),jR.splitLines=function(e){var t;return Jg(t=WR(e).call(e).split("\n")).call(t,(function(e){return WR(e).call(e)}))},jR.splitSections=function(e){var t=e.split("\nm=");return Jg(t).call(t,(function(e,t){var r;return WR(r=t>0?"m="+e:e).call(r)+"\r\n"}))},jR.getDescription=function(e){var t=jR.splitSections(e);return t&&t[0]},jR.getMediaSections=function(e){var t=jR.splitSections(e);return t.shift(),t},jR.matchPrefix=function(e,t){var r;return Iy(r=jR.splitLines(e)).call(r,(function(e){return 0===SI(e).call(e,t)}))},jR.parseCandidate=function(e){for(var t,r={foundation:(t=0===SI(e).call(e,"a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:_b(t[3],10),ip:t[4],address:t[4],port:_b(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=_b(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:void 0===r[t[n]]&&(r[t[n]]=t[n+1])}return r},jR.writeCandidate=function(e){var t=[];t.push(e.foundation);var r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},jR.parseIceOptions=function(e){return e.substr(14).split(" ")},jR.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:_b(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=_b(t[1],10),r.channels=3===t.length?_b(t[2],10):1,r.numChannels=r.channels,r},jR.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},jR.parseExtmap=function(e){var t,r=e.substr(9).split(" ");return{id:_b(r[0],10),direction:SI(t=r[0]).call(t,"/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1]}},jR.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},jR.parseFmtp=function(e){for(var t,r={},n=e.substr(SI(e).call(e," ")+1).split(";"),i=0;i<n.length;i++){var o,a;t=WR(o=n[i]).call(o).split("="),r[WR(a=t[0]).call(a)]=t[1]}return r},jR.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&LS(e.parameters).length){var n=[];LS(e.parameters).forEach((function(t){void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},jR.parseRtcpFb=function(e){var t=e.substr(SI(e).call(e," ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},jR.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},jR.parseSsrcMedia=function(e){var t=SI(e).call(e," "),r={ssrc:_b(e.substr(7,t-7),10)},n=SI(e).call(e,":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},jR.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:Jg(t).call(t,(function(e){return _b(e,10)}))}},jR.getMid=function(e){var t=jR.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},jR.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},jR.getDtlsParameters=function(e,t){var r=jR.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:Jg(r).call(r,jR.parseFingerprint)}},jR.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},jR.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:_b(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:cI(t).call(t,3)}},jR.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===Xl(e.keyParams)?jR.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},jR.parseCryptoKeyParams=function(e){if(0!==SI(e).call(e,"inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},jR.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},jR.getCryptoParameters=function(e,t){var r=jR.matchPrefix(e+t,"a=crypto:");return Jg(r).call(r,jR.parseCryptoLine)},jR.getIceParameters=function(e,t){var r=jR.matchPrefix(e+t,"a=ice-ufrag:")[0],n=jR.matchPrefix(e+t,"a=ice-pwd:")[0];return r&&n?{usernameFragment:r.substr(12),password:n.substr(10)}:null},jR.writeIceParameters=function(e){var t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},jR.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=jR.splitLines(e)[0].split(" "),n=3;n<r.length;n++){var i=r[n],o=jR.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(o){var a,s=jR.parseRtpMap(o),c=jR.matchPrefix(e,"a=fmtp:"+i+" ");switch(s.parameters=c.length?jR.parseFmtp(c[0]):{},s.rtcpFeedback=Jg(a=jR.matchPrefix(e,"a=rtcp-fb:"+i+" ")).call(a,jR.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return jR.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(jR.parseExtmap(e))})),t},jR.writeRtpDescription=function(e,t){var r,n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=Jg(r=t.codecs).call(r,(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){n+=jR.writeRtpMap(e),n+=jR.writeFmtp(e),n+=jR.writeRtcpFb(e)}));var i=0;return t.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(n+="a=maxptime:"+i+"\r\n"),t.headerExtensions&&t.headerExtensions.forEach((function(e){n+=jR.writeExtmap(e)})),n},jR.parseRtpEncodingParameters=function(e){var t,r,n,i,o,a,s=[],c=jR.parseRtpParameters(e),u=-1!==SI(t=c.fecMechanisms).call(t,"RED"),d=-1!==SI(r=c.fecMechanisms).call(r,"ULPFEC"),l=Iy(n=Jg(i=jR.matchPrefix(e,"a=ssrc:")).call(i,(function(e){return jR.parseSsrcMedia(e)}))).call(n,(function(e){return"cname"===e.attribute})),h=l.length>0&&l[0].ssrc,p=Jg(o=jR.matchPrefix(e,"a=ssrc-group:FID")).call(o,(function(e){var t=e.substr(17).split(" ");return Jg(t).call(t,(function(e){return _b(e,10)}))}));p.length>0&&p[0].length>1&&p[0][0]===h&&(a=p[0][1]),c.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:h,codecPayloadType:_b(e.parameters.apt,10)};h&&a&&(t.rtx={ssrc:a}),s.push(t),u&&((t=JSON.parse(zg(t))).fec={ssrc:h,mechanism:d?"red+ulpfec":"red"},s.push(t))}})),0===s.length&&h&&s.push({ssrc:h});var v,f,_=jR.matchPrefix(e,"b=");return _.length&&(_=0===SI(v=_[0]).call(v,"b=TIAS:")?_b(_[0].substr(7),10):0===SI(f=_[0]).call(f,"b=AS:")?1e3*_b(_[0].substr(5),10)*.95-16e3:void 0,s.forEach((function(e){e.maxBitrate=_}))),s},jR.parseRtcpParameters=function(e){var t,r,n={},i=Iy(t=Jg(r=jR.matchPrefix(e,"a=ssrc:")).call(r,(function(e){return jR.parseSsrcMedia(e)}))).call(t,(function(e){return"cname"===e.attribute}))[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);var o=jR.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=o.length>0,n.compound=0===o.length;var a=jR.matchPrefix(e,"a=rtcp-mux");return n.mux=a.length>0,n},jR.writeRtcpParameters=function(e){var t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},jR.parseMsid=function(e){var t,r,n,i=jR.matchPrefix(e,"a=msid:");if(1===i.length)return{stream:(n=i[0].substr(7).split(" "))[0],track:n[1]};var o=Iy(t=Jg(r=jR.matchPrefix(e,"a=ssrc:")).call(r,(function(e){return jR.parseSsrcMedia(e)}))).call(t,(function(e){return"msid"===e.attribute}));return o.length>0?{stream:(n=o[0].value.split(" "))[0],track:n[1]}:void 0},jR.parseSctpDescription=function(e){var t,r=jR.parseMLine(e),n=jR.matchPrefix(e,"a=max-message-size:");n.length>0&&(t=_b(n[0].substr(19),10)),isNaN(t)&&(t=65536);var i=jR.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:_b(i[0].substr(12),10),protocol:r.fmt,maxMessageSize:t};var o=jR.matchPrefix(e,"a=sctpmap:");if(o.length>0){var a=o[0].substr(10).split(" ");return{port:_b(a[0],10),protocol:a[1],maxMessageSize:t}}},jR.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},jR.generateSessionId=function(){return Math.random().toString().substr(2,21)},jR.writeSessionBoilerplate=function(e,t,r){var n=void 0!==t?t:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||jR.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},jR.getDirection=function(e,t){for(var r=jR.splitLines(e),n=0;n<r.length;n++)switch(r[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[n].substr(2)}return t?jR.getDirection(t):"sendrecv"},jR.getKind=function(e){return jR.splitLines(e)[0].split(" ")[0].substr(2)},jR.isRejected=function(e){return"0"===e.split(" ",2)[1]},jR.parseMLine=function(e){var t=jR.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:_b(t[1],10),protocol:t[2],fmt:cI(t).call(t,3).join(" ")}},jR.parseOLine=function(e){var t=jR.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:_b(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},jR.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=jR.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},BR.exports=jR;var qR=XR.exports,YR=r(qR),JR=e({__proto__:null,default:YR},[qR]);function QR(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){var r;if("object"===Xl(e)&&e.candidate&&0===SI(r=e.candidate).call(r,"a=")&&((e=JSON.parse(zg(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),i=YR.parseCandidate(e.candidate),o=IT(n,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,zT(e,"icecandidate",(function(t){return t.candidate&&dT(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}}function ZR(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||zT(e,"icecandidate",(function(e){if(e.candidate){var t=YR.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function $R(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||dT(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e,n;(this._sctp=null,"chrome"===t.browser&&t.version>=76)&&("plan-b"===this.getConfiguration().sdpSemantics&&dT(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}));if(function(e){if(!e||!e.sdp)return!1;var t=YR.splitSections(e.sdp);return t.shift(),t.some((function(e){var t,r=YR.parseMLine(e);return r&&"application"===r.kind&&-1!==SI(t=r.protocol).call(t,"SCTP")}))}(arguments[0])){var i,o=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=_b(t[1],10);return r!=r?-1:r}(arguments[0]),a=(e=o,n=65536,"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n),s=function(e,r){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var i=YR.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?n=_b(i[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n}(arguments[0],o);i=0===a&&0===s?Number.POSITIVE_INFINITY:0===a||0===s?Math.max(a,s):Math.min(a,s);var c={};dT(c,"maxMessageSize",{get:function(){return i}}),this._sctp=c}return r.apply(this,arguments)}}}function eA(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e),e},zT(e,"datachannel",(function(e){return r(e.channel,e.target),e}))}function r(e,t){var r=e.send;e.send=function(){return r.apply(e,arguments)}}}function tA(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;dT(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),dT(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}}function rA(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){var n;if(t&&t.sdp&&-1!==SI(n=t.sdp).call(n,"\na=extmap-allow-mixed")){var i,o=Iy(i=t.sdp.split("\n")).call(i,(function(e){return"a=extmap-allow-mixed"!==WR(e).call(e)})).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:o}):t.sdp=o}return r.apply(this,arguments)}}}function nA(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?HI.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),HI.resolve())})}}function iA(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this,t=arguments[0]||{};if("object"!==Xl(t)||t.type&&t.sdp)return r.apply(this,arguments);if(!(t={type:t.type,sdp:t.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}return t.sdp||"offer"!==t.type&&"answer"!==t.type?r.apply(this,[t]):("offer"===t.type?this.createOffer:this.createAnswer).apply(this).then((function(t){return r.apply(e,[t])}))})}}var oA=Object.freeze({__proto__:null,removeExtmapAllowMixed:rA,shimAddIceCandidateNullOrEmpty:nA,shimConnectionState:tA,shimMaxMessageSize:$R,shimParameterlessSetLocalDescription:iA,shimRTCIceCandidate:QR,shimRTCIceCandidateRelayProtocol:ZR,shimSendThrowTypeError:eA});if(function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},r=XT,n=function(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var r=e.navigator;if(r.mozGetUserMedia)t.browser="firefox",t.version=GT(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=GT(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=GT(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),i={browserDetails:n,commonShim:oA,extractVersion:GT,disableLog:KT,disableWarnings:WT,sdp:JR};switch(n.browser){case"chrome":if(!tR||!$I||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(null===n.version)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=tR,nA(e,n),iA(e),KI(e,n),WI(e),$I(e,n),XI(e),ZI(e,n),qI(e),YI(e),JI(e),eR(e,n),QR(e),ZR(e),tA(e),$R(e,n),eA(e),rA(e,n);break;case"firefox":if(!IR||!_R||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=IR,nA(e,n),iA(e),vR(e,n),_R(e,n),fR(e),yR(e),mR(e),gR(e),SR(e),bR(e),kR(e),ER(e),TR(e),QR(e),tA(e),$R(e,n),eA(e);break;case"safari":if(!NR||!t.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=NR,nA(e,n),iA(e),OR(e),MR(e),wR(e),RR(e),AR(e),PR(e),CR(e),DR(e),QR(e),ZR(e),$R(e,n),eA(e),rA(e,n);break;default:r("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window}),"undefined"!=typeof MediaStreamTrack){var aA=MediaStreamTrack.prototype.getSettings;MediaStreamTrack.prototype.getSettings=function(){var e=aA.call(this);return e.width&&(e.width=Math.floor(e.width)),e.height&&(e.height=Math.floor(e.height)),e.frameRate&&(e.frameRate=Math.floor(e.frameRate)),e}}function sA(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var cA=$e,uA=function(e){return void 0!==e&&(cA(e,"value")||cA(e,"writable"))},dA=M,lA=te,hA=nr,pA=uA,vA=C,fA=Xc;Cr({target:"Reflect",stat:!0},{get:function e(t,r){var n,i,o=arguments.length<3?t:arguments[2];return hA(t)===o?t[r]:(n=vA.f(t,r))?pA(n)?n.value:void 0===n.get?void 0:dA(n.get,o):lA(i=fA(t))?e(i,r,o):void 0}});var _A=re.Reflect.get,mA=r(_A),gA=m,yA=Pe,SA=te,bA=$e,kA=us,EA=s,TA=Function,IA=gA([].concat),RA=gA([].join),AA={},wA=EA?TA.bind:function(e){var t=yA(this),r=t.prototype,n=kA(arguments,1),i=function(){var r=IA(n,kA(arguments));return this instanceof i?function(e,t,r){if(!bA(AA,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";AA[t]=TA("C,a","return new C("+RA(n,",")+")")}return AA[t](e,r)}(t,r.length,r):t.apply(e,r)};return SA(r)&&(i.prototype=r),i},CA=wA;Cr({target:"Function",proto:!0,forced:Function.bind!==CA},{bind:CA});var xA=Js("Function").bind,OA=ce,PA=xA,MA=Function.prototype,DA=r((function(e){var t=e.bind;return e===MA||OA(MA,e)&&t===MA.bind?PA:t}));function NA(e){var t;return(NA=qh?DA(t=Wh).call(t):function(e){return e.__proto__||Wh(e)})(e)}function LA(){var e;"undefined"!=typeof Reflect&&mA?LA=DA(e=mA).call(e):LA=function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=NA(e)););return e}(e,t);if(n){var i=hc(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}};return LA.apply(this,arguments)}function UA(e,t){var r;return(UA=qh?DA(r=qh).call(r):function(e,t){return e.__proto__=t,e})(e,t)}function VA(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Hh(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Vd(e,"prototype",{writable:!1}),t&&UA(e,t)}var FA=Cr,BA=h,jA=wA,HA=Av,GA=nr,zA=te,KA=Xn,WA=a,XA=se("Reflect","construct"),qA=Object.prototype,YA=[].push,JA=WA((function(){function e(){}return!(XA((function(){}),[],e)instanceof e)})),QA=!WA((function(){XA((function(){}))})),ZA=JA||QA;FA({target:"Reflect",stat:!0,forced:ZA,sham:ZA},{construct:function(e,t){HA(e),GA(t);var r=arguments.length<3?e:HA(arguments[2]);if(QA&&!JA)return XA(e,t,r);if(e===r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return BA(YA,n,t),new(BA(jA,e,n))}var i=r.prototype,o=KA(zA(i)?i:qA),a=BA(e,o,t);return zA(a)?a:o}});var $A=r(re.Reflect.construct);function ew(){if("undefined"==typeof Reflect||!$A)return!1;if($A.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call($A(Boolean,[],(function(){}))),!0}catch(e){return!1}}function tw(e){var t=ew();return function(){var r,n=NA(e);if(t){var i=NA(this).constructor;r=$A(n,arguments,i)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Xl(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return sA(e)}(this,r)}}var rw=Js("Array").values,nw=gn,iw=$e,ow=ce,aw=rw,sw=Array.prototype,cw={DOMTokenList:!0,NodeList:!0},uw=r((function(e){var t=e.values;return e===sw||ow(sw,e)&&t===sw.values||iw(cw,nw(e))?aw:t})),dw=si,lw=Math.floor,hw=function(e,t){var r=e.length,n=lw(r/2);return r<8?pw(e,t):vw(e,hw(dw(e,0,n),t),hw(dw(e,n),t),t)},pw=function(e,t){for(var r,n,i=e.length,o=1;o<i;){for(n=o,r=e[o];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==o++&&(e[n]=r)}return e},vw=function(e,t,r,n){for(var i=t.length,o=r.length,a=0,s=0;a<i||s<o;)e[a+s]=a<i&&s<o?n(t[a],r[s])<=0?t[a++]:r[s++]:a<i?t[a++]:r[s++];return e},fw=hw,_w=ue.match(/firefox\/(\d+)/i),mw=!!_w&&+_w[1],gw=/MSIE|Trident/.test(ue),yw=ue.match(/AppleWebKit\/(\d+)\./),Sw=!!yw&&+yw[1],bw=Cr,kw=m,Ew=Pe,Tw=Je,Iw=Hr,Rw=EI,Aw=bn,ww=a,Cw=fw,xw=rd,Ow=mw,Pw=gw,Mw=_e,Dw=Sw,Nw=[],Lw=kw(Nw.sort),Uw=kw(Nw.push),Vw=ww((function(){Nw.sort(void 0)})),Fw=ww((function(){Nw.sort(null)})),Bw=xw("sort"),jw=!ww((function(){if(Mw)return Mw<70;if(!(Ow&&Ow>3)){if(Pw)return!0;if(Dw)return Dw<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)Nw.push({k:t+n,v:r})}for(Nw.sort((function(e,t){return t.v-e.v})),n=0;n<Nw.length;n++)t=Nw[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));bw({target:"Array",proto:!0,forced:Vw||!Fw||!Bw||!jw},{sort:function(e){void 0!==e&&Ew(e);var t=Tw(this);if(jw)return void 0===e?Lw(t):Lw(t,e);var r,n,i=[],o=Iw(t);for(n=0;n<o;n++)n in t&&Uw(i,t[n]);for(Cw(i,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:Aw(t)>Aw(r)?1:-1}}(e)),r=Iw(i),n=0;n<r;)t[n]=i[n++];for(;n<o;)Rw(t,n++);return t}});var Hw=Js("Array").sort,Gw=ce,zw=Hw,Kw=Array.prototype,Ww=r((function(e){var t=e.sort;return e===Kw||Gw(Kw,e)&&t===Kw.sort?zw:t})),Xw=Cr,qw=Fo.findIndex,Yw="findIndex",Jw=!0;Yw in[]&&Array(1)[Yw]((function(){Jw=!1})),Xw({target:"Array",proto:!0,forced:Jw},{findIndex:function(e){return qw(this,e,arguments.length>1?arguments[1]:void 0)}});var Qw=Js("Array").findIndex,Zw=ce,$w=Qw,eC=Array.prototype,tC=r((function(e){var t=e.findIndex;return e===eC||Zw(eC,e)&&t===eC.findIndex?$w:t})),rC=Cr,nC=T;C.f;var iC=Br,oC=bn,aC=My,sC=Y,cC=Ny,uC=nC("".startsWith),dC=nC("".slice),lC=Math.min;rC({target:"String",proto:!0,forced:!cC("startsWith")},{startsWith:function(e){var t=oC(sC(this));aC(e);var r=iC(lC(arguments.length>1?arguments[1]:void 0,t.length)),n=oC(e);return uC?uC(t,n,r):dC(t,r,r+n.length)===n}});var hC=Js("String").startsWith,pC=ce,vC=hC,fC=String.prototype,_C=r((function(e){var t=e.startsWith;return"string"==typeof e||e===fC||pC(fC,e)&&t===fC.startsWith?vC:t})),mC=function(e){return e.INVALID_ENGINE="INVALID_ENGINE",e.INVALID_PARAMS="INVALID_PARAMS",e.INVOKED_BEFORE_JOIN_ROOM="INVOKED_BEFORE_JOIN_ROOM",e.INVALID_TOKEN="INVALID_TOKEN",e.JOIN_ROOM_FAILED="JOIN_ROOM_FAILED",e.UPDATE_TOKEN_WITH_INVALID_TOKEN="UPDATE_TOKEN_WITH_INVALID_TOKEN",e.UPDATE_TOKEN_BEFORE_JOIN="UPDATE_TOKEN_BEFORE_JOIN",e.REPEAT_JOIN="REPEAT_JOIN",e.REPEAT_PUBLISH="REPEAT_PUBLISH",e.REPEAT_PUSH="REPEAT_PUSH",e.REPEAT_PLAY="REPEAT_PLAY",e.PUBLISH_BEFORE_JOIN="PUBLISH_BEFORE_JOIN",e.UNPUBLISH_BEFORE_JOIN="UNPUBLISH_BEFORE_JOIN",e.SUBSCRIBE_BEFORE_JOIN="SUBSCRIBE_BEFORE_JOIN",e.UNSUBSCRIBE_BEFORE_JOIN="UNSUBSCRIBE_BEFORE_JOIN",e.NO_PUBLISH_PERMISSION="NO_PUBLISH_PERMISSION",e.STREAM_NOT_EXIST="STREAM_NOT_EXIST",e.EMPTY_STREAM="EMPTY_STREAM",e.NOT_CONNECTED_YET="NOT_CONNECTED_YET",e.IM_BEFORE_JOIN="IM_BEFORE_JOIN",e.USER_NOT_EXIST="USER_NOT_EXIST",e.ALREADY_IN_ROOM="ALREADY_IN_ROOM",e.KICKED_OUT="KICKED_OUT",e.ROOM_DISMISS="ROOM_DISMISS",e.TOKEN_EXPIRED="TOKEN_EXPIRED",e.DUPLICATE_LOGIN="DUPLICATE_LOGIN",e.INVOKED_BEFORE_CAPTURE="INVOKED_BEFORE_CAPTURE",e.REPEAT_CAPTURE="REPEAT_CAPTURE",e.GET_VIDEO_TRACK_FAILED="GET_VIDEO_TRACK_FAILED",e.GET_AUDIO_TRACK_FAILED="GET_AUDIO_TRACK_FAILED",e.GET_SCREEN_TRACK_FAILED="GET_SCREEN_TRACK_FAILED",e.STREAM_TYPE_NOT_MATCH="STREAM_TYPE_NOT_MATCH",e.CANT_FIND_DOM="CANT_FIND_DOM",e.INVALID_DEVICE_ID="INVALID_DEVICE_ID",e.NO_PERMISSION="NO_PERMISSION",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INTERRUPT="INTERRUPT",e.ICE_SERVER_WRONG="ICE_SERVER_WRONG",e.ESTABLISH_DATACHANNEL_FAILED="ESTABLISH_DATACHANNEL_FAILED",e.LOAD_RESOURCES_FAILED="LOAD_RESOURCES_FAILED",e.SIGNALING_CHANNEL_NOT_OPEN="SIGNALING_CHANNEL_NOT_OPEN",e.TIME_OUT="TIME_OUT",e.REFUSE_OPERATION_IN_DISCONNECT="REFUSE_OPERATION_IN_DISCONNECT",e.ADD_TRANSCEIVER_FAILED="ADD_TRANSCEIVER_FAILED",e.UPDATE_TRACK_FAILED="UPDATE_TRACK_FAILED",e.PUBLISH_FAILED="PUBLISH_FAILED",e.UNPUBLISH_FAILED="UNPUBLISH_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.OPERATION_CANCEL="OPERATION_CANCEL",e.START_CLOUD_PROXY_AFTER_JOIN="START_CLOUD_PROXY_AFTER_JOIN",e.STOP_CLOUD_PROXY_BEFORE_LEAVE="STOP_CLOUD_PROXY_BEFORE_LEAVE",e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.REPEAT_DEVICE_TEST="REPEAT_DEVICE_TEST",e.AUDIO_DEVICE_TEST_FAILED="AUDIO_DEVICE_RECORD_FAILED",e.ALREADY_LOGIN="ALREADY_LOGIN",e.LOGIN_FAILED="LOGIN_FAILED",e.NOT_LOGIN="NOT_LOGIN",e.RTM_DUPLICATE_LOGIN="RTM_DUPLICATE_LOGIN",e.RTM_TOKEN_ERROR="RTM_TOKEN_ERROR",e.USER_MESSAGE_TIMEOUT="USER_MESSAGE_TIMEOUT",e.USER_MESSAGE_BROKEN="USER_MESSAGE_BROKEN",e.USER_MESSAGE_NO_RECEIVER="USER_MESSAGE_NO_RECEIVER",e.USER_MESSAGE_NO_RELAYPATH="USER_MESSAGE_NO_RELAYPATH",e.USER_MESSAGE_EXCEED_QPS="USER_MESSAGE_EXCEED_QPS",e.USER_MESSAGE_SEND_TO_SERVER_ERROR="USER_MESSAGE_SEND_TO_SERVER_ERROR",e.USER_MESSAGE_SERVER_RESPONSE_ERROR="USER_MESSAGE_SERVER_RESPONSE_ERROR",e.USER_MESSAGE_NOT_JOIN="USER_MESSAGE_NOT_JOIN",e.USER_MESSAGE_INIT="USER_MESSAGE_INIT",e.USER_MESSAGE_NO_CONNECTION="USER_MESSAGE_NO_CONNECTION",e.USER_MESSAGE_NOT_LOGIN="USER_MESSAGE_NOT_LOGIN",e.USER_MESSAGE_SERVER_PARAMS_NOTSET="USER_MESSAGE_SERVER_PARAMS_NOTSET",e.USER_MESSAGE_UNKNOWN="USER_MESSAGE_UNKNOWN",e.START_PUBLIC_STREAM_BEFORE_JOIN="START_PUBLIC_STREAM_BEFORE_JOIN",e.RECONNECT_FAILED="RECONNECT_FAILED",e.SUBTITLE_ALREADY_ON="SUBTITLE_ALREADY_ON",e.SUBTITLE_NOT_TURNED_ON="SUBTITLE_NOT_TURNED_ON",e.SUBTITLE_ERR_POSTPROCESS="SUBTITLE_ERR_POSTPROCESS",e.SUBTITLE_ERR_CONNECTION_ERROR="SUBTITLE_ERR_CONNECTION_ERROR",e.SUBTITLE_ERR_PROCESS_ERROR="SUBTITLE_ERR_PROCESS_ERROR",e.SUBTITLE_ERR_UNKNOWN="SUBTITLE_ERR_UNKNOWN",e.UNEXPECTED_INVOKE_FORWARD_STREAM="UNEXPECTED_INVOKE_FORWARD_STREAM",e.ROOM_FORBIDDEN="ROOM_FORBIDDEN",e.USER_FORBIDDEN="USER_FORBIDDEN",e}(mC||{}),gC=function(e){return e[e.AUDIO_MIXING_ERROR_OK=0]="AUDIO_MIXING_ERROR_OK",e[e.AUDIO_MIXING_ERROR_PRELOAD_FAILED=1]="AUDIO_MIXING_ERROR_PRELOAD_FAILED",e[e.AUDIO_MIXING_ERROR_START_FAILED=2]="AUDIO_MIXING_ERROR_START_FAILED",e[e.AUDIO_MIXING_ERROR_ID_NOT_FOUND=3]="AUDIO_MIXING_ERROR_ID_NOT_FOUND",e[e.AUDIO_MIXING_ERROR_SET_POSITION_FAILED=4]="AUDIO_MIXING_ERROR_SET_POSITION_FAILED",e[e.AUDIO_MIXING_ERROR_INVALID_VOLUME=5]="AUDIO_MIXING_ERROR_INVALID_VOLUME",e[e.AUDIO_MIXING_ERROR_LOAD_CONFLICT=6]="AUDIO_MIXING_ERROR_LOAD_CONFLICT",e[e.AUDIO_MIXING_ERROR_ID_TYPE_NOT_MATCH=7]="AUDIO_MIXING_ERROR_ID_TYPE_NOT_MATCH",e[e.AUDIO_MIXING_ERROR_ID_TYPE_INVALID_PITCH=8]="AUDIO_MIXING_ERROR_ID_TYPE_INVALID_PITCH",e[e.AUDIO_MIXING_ERROR_INVALID_AUDIO_TRACK=9]="AUDIO_MIXING_ERROR_INVALID_AUDIO_TRACK",e}(gC||{});function yC(e,t,r){var n;ew()?yC=DA(n=$A).call(n):yC=function(e,t,r){var n=[null];Oc(n).apply(n,t);var i=new(DA(Function).apply(e,n));return r&&UA(i,r.prototype),i};return yC.apply(null,arguments)}function SC(e){var t="function"==typeof cT?new cT:void 0;return SC=function(e){if(null===e||(r=e,-1===yI(n=Function.toString.call(r)).call(n,"[native code]")))return e;var r,n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return yC(e,arguments,NA(this).constructor)}return i.prototype=Hh(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),UA(i,e)},SC(e)}var bC=r(Xh),kC=function(e){VA(r,e);var t=tw(r);function r(e,n,i){var o;return Bh(this,r),Jl(sA(o=t.call(this,n)),"code",void 0),Jl(sA(o),"message",void 0),Jl(sA(o),"error",void 0),o.code=e,o.message=n,o.error=i,bC(sA(o),r.prototype),o}return Fh(r,[{key:"toString",value:function(){var e;return Bg(e="SDKError: ".concat(this.code," ")).call(e,this.message)}}]),r}(SC(Error)),EC=Mr,TC=bn,IC=Y,RC=RangeError,AC=m,wC=Br,CC=bn,xC=function(e){var t=TC(IC(this)),r="",n=EC(e);if(n<0||n===1/0)throw RC("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(r+=t);return r},OC=Y,PC=AC(xC),MC=AC("".slice),DC=Math.ceil,NC=function(e){return function(t,r,n){var i,o,a=CC(OC(t)),s=wC(r),c=a.length,u=void 0===n?" ":CC(n);return s<=c||""===u?a:((o=PC(u,DC((i=s-c)/u.length))).length>i&&(o=MC(o,0,i)),e?a+o:o+a)}},LC={start:NC(!1),end:NC(!0)},UC=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(ue),VC=LC.end;Cr({target:"String",proto:!0,forced:UC},{padEnd:function(e){return VC(this,e,arguments.length>1?arguments[1]:void 0)}});var FC=Js("String").padEnd,BC=ce,jC=FC,HC=String.prototype,GC=r((function(e){var t=e.padEnd;return"string"==typeof e||e===HC||BC(HC,e)&&t===HC.padEnd?jC:t})),zC=fb;Cr({target:"Number",stat:!0,forced:Number.parseInt!==zC},{parseInt:zC});var KC=r(re.Number.parseInt),WC=r(vy),XC=r(lg),qC=Math.log,YC=Math.LOG10E;Cr({target:"Math",stat:!0},{log10:Math.log10||function(e){return qC(e)*YC}});var JC,QC=r(re.Math.log10),ZC=Js("Array").keys,$C=gn,ex=$e,tx=ce,rx=ZC,nx=Array.prototype,ix={DOMTokenList:!0,NodeList:!0},ox=r((function(e){var t=e.keys;return e===nx||tx(nx,e)&&t===nx.keys||ex(ix,$C(e))?rx:t})),ax=new Uint8Array(16);function sx(){if(!JC&&!(JC="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return JC(ax)}var cx=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var ux=[],dx=0;dx<256;++dx)ux.push((dx+256).toString(16).substr(1));function lx(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(ux[e[t+0]]+ux[e[t+1]]+ux[e[t+2]]+ux[e[t+3]]+"-"+ux[e[t+4]]+ux[e[t+5]]+"-"+ux[e[t+6]]+ux[e[t+7]]+"-"+ux[e[t+8]]+ux[e[t+9]]+"-"+ux[e[t+10]]+ux[e[t+11]]+ux[e[t+12]]+ux[e[t+13]]+ux[e[t+14]]+ux[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&cx.test(e)}(r))throw TypeError("Stringified UUID is invalid");return r}function hx(e,t,r){var n=(e=e||{}).random||(e.rng||sx)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return lx(n)}var px=function(){return"undefined"==typeof window},vx=function(){return hx()},fx=function(e){return"number"==typeof e},_x=function(e){var t;return qy(t=Function.prototype.toString.call(e)).call(t,"[native code]")};function mx(e){return null==e?"undefined | null":"string"==typeof e?e:zg({contentHint:e.contentHint,enabled:e.enabled,id:e.id,kind:e.kind,label:e.label,muted:e.muted,readyState:e.readyState})}function gx(e){return null==e?"undefined | null":"string"==typeof e?e:zg({id:e.id,active:e.active})}function yx(e){return null==e?"undefined | null":"string"==typeof e?e:zg({track:mx(e.track)})}function Sx(e){return null==e?"undefined | null":"string"==typeof e?e:zg({track:mx(e.track)})}function bx(e){return null==e?"undefined | null":"string"==typeof e?e:zg({currentDirection:e.currentDirection,direction:e.direction,mid:e.mid,stopped:e.stopped,receiver:Sx(e.receiver),sender:yx(e.sender)})}var kx="@byted/ve-rtc",Ex="@byted/ve-rtc-cache-size",Tx=function(){function e(){Bh(this,e),Jl(this,"storeKey",void 0),Jl(this,"logLevel",void 0),Jl(this,"LogfileSize",void 0),Jl(this,"db",void 0),Jl(this,"logId",void 0),Jl(this,"cacheLog",void 0),Jl(this,"cachedSize",void 0),Jl(this,"preCacheTime",void 0),Jl(this,"timer",void 0),Jl(this,"_getSize",(function(e){return new Blob(e).size/1048576})),this.storeKey="",this.logId=1,this.cacheLog="",this.logLevel="none",this.LogfileSize=100,this._createStore()}return Fh(e,[{key:"_createStore",value:function(){var e=this;if(!px()&&window.indexedDB){var t=indexedDB.open("@byted/ve-rtc");t.onupgradeneeded=function(){t.result.createObjectStore(kx);try{localStorage.removeItem(Ex)}catch(Y$){}},t.onerror=function(e){},t.onsuccess=function(){e.db=t.result,e._getCachedSize()}}}},{key:"_getCachedSize",value:function(){var e=this;try{var t=localStorage.getItem(Ex);if(t)this.cachedSize=Number(t);else uw(this).call(this).then((function(t){e.cachedSize=e._getSize(t),e._setCachedSize()}))}catch(Y$){}}},{key:"_setCachedSize",value:function(){try{localStorage.setItem(Ex,"".concat(this.cachedSize))}catch(Y$){}}},{key:"_getStore",value:function(e){if(this.db)return this.db.transaction(kx,e).objectStore(kx)}},{key:"set",value:function(e){var t=this;return new HI((function(r,n){if("none"===t.logLevel)return r();var i;if(e&&t.preCacheTime&&t.preCacheTime-Date.now()<1e3)return t.cacheLog+=Bg(i="\n\n".concat(t.logId,": ")).call(i,e),t.logId++,t.timer||(t.timer=setTimeout((function(){t.set("")}),1e3-(t.preCacheTime-Date.now()))),r();clearTimeout(t.timer),t.timer=null;var o=t._getStore("readwrite");if(!o)return n("get store fail");t.cachedSize&&t.cachedSize>t.LogfileSize&&t.keyEarliest().then((function(e){t.get(e).then((function(r){t.del(e).then((function(){t.cachedSize=t.cachedSize-t._getSize(["".concat(r)]),t._setCachedSize()}))}))}));var a=o.get(t.storeKey);a.onsuccess=function(){try{var i,s,c,u,d,l=Bg(i="".concat(a.result||"")).call(i,t.cacheLog),h=e?Bg(s=Bg(c="".concat(l?"\n\n":"")).call(c,t.logId,": ")).call(s,e):"";o.put(Bg(u="".concat(l)).call(u,h),t.storeKey),e&&t.logId++,t.cacheLog="",t.cachedSize=(t.cachedSize||0)+t._getSize([Bg(d="".concat(t.cacheLog)).call(d,h)]),t._setCachedSize(),t.preCacheTime=Date.now(),r()}catch(J$){var p;if(!e)return n(J$);t.cacheLog+=Bg(p="\n\n".concat(t.logId,": ")).call(p,e),t.logId++,n(J$)}},a.onerror=function(r){var i;if(!e)return n(r);t.cacheLog+=Bg(i="\n\n".concat(t.logId,": ")).call(i,e),t.logId++,n(r)}}))}},{key:"get",value:function(e){var t=this;return new HI((function(r,n){var i=t._getStore("readonly");if(!i)return n();var o=i.get(e);o.onsuccess=function(){r(o.result)},o.onerror=function(e){n(e)}}))}},{key:"del",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.storeKey;return new HI((function(r,n){var i=e._getStore("readwrite");if(!i)return n();var o=i.delete(t);o.onsuccess=function(){return r(o.result)},o.onerror=function(e){return n(e)}}))}},{key:"keyEarliest",value:function(){return ox(this).call(this).then((function(e){var t,r=Date.now();return e.forEach((function(e){if(e&&e.length){var n=e.split("-")[0];Number(n)<r&&(r=Number(n),t=e)}})),t}))}},{key:"keys",value:function(){var e=this;return new HI((function(t,r){var n=e._getStore("readonly");if(!n)return r();if(n.getAllKeys){var i=n.getAllKeys();return i.onsuccess=function(){t(i.result)},void(i.onerror=function(){r()})}var o=[];n.openCursor().onsuccess=function(){this.result&&(o.push(this.result.key),this.result.continue())},n.transaction.oncomplete=function(){return t(o)}}))}},{key:"values",value:function(){var e=this;return new HI((function(t,r){var n=e._getStore("readonly");if(!n)return r();if(n.getAll){var i=n.getAll();return i.onsuccess=function(){t(i.result)},void(i.onerror=function(){r()})}var o=[];n.openCursor().onsuccess=function(){this.result&&(o.push(this.result.value),this.result.continue())},n.transaction.oncomplete=function(){return t(o)}}))}},{key:"download",value:function(e){e=e||this.storeKey,this.get(e).then((function(t){var r=document.createElement("a");r.download="".concat(e,".txt"),r.href="data:text/paint;utf-8,".concat(t||""),r.click()}))}}]),e}(),Ix=new Tx,Rx=LC.start;Cr({target:"String",proto:!0,forced:UC},{padStart:function(e){return Rx(this,e,arguments.length>1?arguments[1]:void 0)}});var Ax=Js("String").padStart,wx=ce,Cx=Ax,xx=String.prototype,Ox=r((function(e){var t=e.padStart;return"string"==typeof e||e===xx||wx(xx,e)&&t===xx.padStart?Cx:t})),Px=function(){function e(){Bh(this,e),Jl(this,"_all",{})}return Fh(e,[{key:"on",value:function(e,t){var r=this._all[e];r?r.push(t):this._all[e]=[t]}},{key:"once",value:function(e,t){var r=this;this.on(e,(function n(){t.apply(void 0,arguments),r.off(e,n)}))}},{key:"off",value:function(e,t){var r=this._all[e];null==r||jI(r).call(r,SI(r).call(r,t)>>>0,1)}},{key:"emit",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=this._all[e];null==i||cI(i).call(i).forEach((function(e){return e.apply(void 0,r)}))}},{key:"safeEmit",value:function(e){try{for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return this.emit.apply(this,Bg(t=[e]).call(t,n))}catch(Y$){console.error(Y$)}}},{key:"destroy",value:function(){this._all={}}}]),e}(),Mx=["UPLOAD_CONSOLE_LENGTH_CUT","UPLOAD_REPORT_LIMIT"];var Dx=function(e){VA(r,e);var t=tw(r);function r(){var e,n;Bh(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return Jl(sA(n=t.call.apply(t,Bg(e=[this]).call(e,o))),"config",{UPLOAD_CONSOLE_ON:!1,UPLOAD_CONSOLE_LENGTH_CUT:200,UPLOAD_REPORT_LIMIT:45e4,ENABLE_REPORT_IDB_BUFFER:!1}),n}return Fh(r,[{key:"setParameter",value:function(e,t){if(function(e){return qy(Mx).call(Mx,e)}(e))try{var r=Number(t);if(Number.isNaN(r))return;this.config[e]=r}catch(i){var n;return void console.warn(Bg(n="Cannot convert core lib parameter ".concat(e,":")).call(n,t," into number"))}else this.config[e]=t;this.emit(e,this.config[e])}},{key:"getParameter",value:function(e){return this.config[e]}},{key:"getKeys",value:function(){return LS(this.config)}}]),r}(Px),Nx=new Dx,Lx=oo,Ux=Hr,Vx=yc,Fx=Qt,Bx=function(e,t,r,n,i,o,a,s){for(var c,u,d=i,l=0,h=!!a&&Fx(a,s);l<n;)l in r&&(c=h?h(r[l],l,t):r[l],o>0&&Lx(c)?(u=Ux(c),d=Bx(e,t,c,u,d,o-1)-1):(Vx(d+1),e[d]=c),d++),l++;return d},jx=Bx,Hx=Je,Gx=Hr,zx=Mr,Kx=Oo;Cr({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=Hx(this),r=Gx(t),n=Kx(t,0);return n.length=jx(n,t,t,r,0,void 0===e?1:zx(e)),n}});var Wx=Js("Array").flat,Xx=ce,qx=Wx,Yx=Array.prototype,Jx=r((function(e){var t=e.flat;return e===Yx||Xx(Yx,e)&&t===Yx.flat?qx:t})),Qx={};!function(e){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.assign=function(e){for(var t=cI(Array.prototype).call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!==Xl(n))throw new TypeError(n+"must be non-object");for(var i in n)r(n,i)&&(e[i]=n[i])}}return e},e.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){var t,r,n,i,o,a;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(a=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)o=e[t],a.set(o,i),i+=o.length;return a}},i={arraySet:function(e,t,r,n,i){for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){return Bg([]).apply([],e)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,n)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,i))},e.setTyped(t)}(Qx);var Zx={},$x={},eO={},tO=Qx,rO=0,nO=1;function iO(e){for(var t=e.length;--t>=0;)e[t]=0}var oO=0,aO=29,sO=256,cO=sO+1+aO,uO=30,dO=19,lO=2*cO+1,hO=15,pO=16,vO=7,fO=256,_O=16,mO=17,gO=18,yO=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],SO=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],bO=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],kO=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],EO=new Array(2*(cO+2));iO(EO);var TO=new Array(2*uO);iO(TO);var IO=new Array(512);iO(IO);var RO=new Array(256);iO(RO);var AO=new Array(aO);iO(AO);var wO,CO,xO,OO=new Array(uO);function PO(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function MO(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function DO(e){return e<256?IO[e]:IO[256+(e>>>7)]}function NO(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function LO(e,t,r){e.bi_valid>pO-r?(e.bi_buf|=t<<e.bi_valid&65535,NO(e,e.bi_buf),e.bi_buf=t>>pO-e.bi_valid,e.bi_valid+=r-pO):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function UO(e,t,r){LO(e,r[2*t],r[2*t+1])}function VO(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function FO(e,t,r){var n,i,o=new Array(hO+1),a=0;for(n=1;n<=hO;n++)o[n]=a=a+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=VO(o[s]++,s))}}function BO(e){var t;for(t=0;t<cO;t++)e.dyn_ltree[2*t]=0;for(t=0;t<uO;t++)e.dyn_dtree[2*t]=0;for(t=0;t<dO;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*fO]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function jO(e){e.bi_valid>8?NO(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function HO(e,t,r,n){var i=2*t,o=2*r;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[r]}function GO(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&HO(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!HO(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function zO(e,t,r){var n,i,o,a,s=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0===n?UO(e,i,t):(UO(e,(o=RO[i])+sO+1,t),0!==(a=yO[o])&&LO(e,i-=AO[o],a),UO(e,o=DO(--n),r),0!==(a=SO[o])&&LO(e,n-=OO[o],a))}while(s<e.last_lit);UO(e,fO,t)}function KO(e,t){var r,n,i,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=lO,r=0;r<c;r++)0!==o[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):o[2*r+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=a[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;r>=1;r--)GO(e,o,r);i=c;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],GO(e,o,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,o[2*i]=o[2*r]+o[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,o[2*r+1]=o[2*n+1]=i,e.heap[1]=i++,GO(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,o,a,s,c=t.dyn_tree,u=t.max_code,d=t.stat_desc.static_tree,l=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,v=t.stat_desc.max_length,f=0;for(o=0;o<=hO;o++)e.bl_count[o]=0;for(c[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<lO;r++)(o=c[2*c[2*(n=e.heap[r])+1]+1]+1)>v&&(o=v,f++),c[2*n+1]=o,n>u||(e.bl_count[o]++,a=0,n>=p&&(a=h[n-p]),s=c[2*n],e.opt_len+=s*(o+a),l&&(e.static_len+=s*(d[2*n+1]+a)));if(0!==f){do{for(o=v-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[v]--,f-=2}while(f>0);for(o=v;0!==o;o--)for(n=e.bl_count[o];0!==n;)(i=e.heap[--r])>u||(c[2*i+1]!==o&&(e.opt_len+=(o-c[2*i+1])*c[2*i],c[2*i+1]=o),n--)}}(e,t),FO(o,u,e.bl_count)}function WO(e,t,r){var n,i,o=-1,a=t[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=t[2*(n+1)+1],++s<c&&i===a||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[2*_O]++):s<=10?e.bl_tree[2*mO]++:e.bl_tree[2*gO]++,s=0,o=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4))}function XO(e,t,r){var n,i,o=-1,a=t[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),n=0;n<=r;n++)if(i=a,a=t[2*(n+1)+1],!(++s<c&&i===a)){if(s<u)do{UO(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(UO(e,i,e.bl_tree),s--),UO(e,_O,e.bl_tree),LO(e,s-3,2)):s<=10?(UO(e,mO,e.bl_tree),LO(e,s-3,3)):(UO(e,gO,e.bl_tree),LO(e,s-11,7));s=0,o=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4)}}iO(OO);var qO=!1;function YO(e,t,r,n){LO(e,(oO<<1)+(n?1:0),3),function(e,t,r,n){jO(e),n&&(NO(e,r),NO(e,~r)),tO.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}eO._tr_init=function(e){qO||(!function(){var e,t,r,n,i,o=new Array(hO+1);for(r=0,n=0;n<aO-1;n++)for(AO[n]=r,e=0;e<1<<yO[n];e++)RO[r++]=n;for(RO[r-1]=n,i=0,n=0;n<16;n++)for(OO[n]=i,e=0;e<1<<SO[n];e++)IO[i++]=n;for(i>>=7;n<uO;n++)for(OO[n]=i<<7,e=0;e<1<<SO[n]-7;e++)IO[256+i++]=n;for(t=0;t<=hO;t++)o[t]=0;for(e=0;e<=143;)EO[2*e+1]=8,e++,o[8]++;for(;e<=255;)EO[2*e+1]=9,e++,o[9]++;for(;e<=279;)EO[2*e+1]=7,e++,o[7]++;for(;e<=287;)EO[2*e+1]=8,e++,o[8]++;for(FO(EO,cO+1,o),e=0;e<uO;e++)TO[2*e+1]=5,TO[2*e]=VO(e,5);wO=new PO(EO,yO,sO+1,cO,hO),CO=new PO(TO,SO,0,uO,hO),xO=new PO(new Array(0),bO,0,dO,vO)}(),qO=!0),e.l_desc=new MO(e.dyn_ltree,wO),e.d_desc=new MO(e.dyn_dtree,CO),e.bl_desc=new MO(e.bl_tree,xO),e.bi_buf=0,e.bi_valid=0,BO(e)},eO._tr_stored_block=YO,eO._tr_flush_block=function(e,t,r,n){var i,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return rO;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return nO;for(t=32;t<sO;t++)if(0!==e.dyn_ltree[2*t])return nO;return rO}(e)),KO(e,e.l_desc),KO(e,e.d_desc),a=function(e){var t;for(WO(e,e.dyn_ltree,e.l_desc.max_code),WO(e,e.dyn_dtree,e.d_desc.max_code),KO(e,e.bl_desc),t=dO-1;t>=3&&0===e.bl_tree[2*kO[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=i&&(i=o)):i=o=r+5,r+4<=i&&-1!==t?YO(e,t,r,n):4===e.strategy||o===i?(LO(e,2+(n?1:0),3),zO(e,EO,TO)):(LO(e,4+(n?1:0),3),function(e,t,r,n){var i;for(LO(e,t-257,5),LO(e,r-1,5),LO(e,n-4,4),i=0;i<n;i++)LO(e,e.bl_tree[2*kO[i]+1],3);XO(e,e.dyn_ltree,t-1),XO(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),zO(e,e.dyn_ltree,e.dyn_dtree)),BO(e),n&&jO(e)},eO._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(RO[r]+sO+1)]++,e.dyn_dtree[2*DO(t)]++),e.last_lit===e.lit_bufsize-1},eO._tr_align=function(e){LO(e,2,3),UO(e,fO,EO),function(e){16===e.bi_valid?(NO(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)};var JO=function(e,t,r,n){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==r;){r-=a=r>2e3?2e3:r;do{o=o+(i=i+t[n++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0};var QO=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();var ZO,$O=function(e,t,r,n){var i=QO,o=n+r;e^=-1;for(var a=n;a<o;a++)e=e>>>8^i[255&(e^t[a])];return-1^e},eP={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},tP=Qx,rP=eO,nP=JO,iP=$O,oP=eP,aP=0,sP=4,cP=0,uP=-2,dP=-1,lP=4,hP=2,pP=8,vP=9,fP=286,_P=30,mP=19,gP=2*fP+1,yP=15,SP=3,bP=258,kP=bP+SP+1,EP=42,TP=103,IP=113,RP=666,AP=1,wP=2,CP=3,xP=4;function OP(e,t){return e.msg=oP[t],t}function PP(e){return(e<<1)-(e>4?9:0)}function MP(e){for(var t=e.length;--t>=0;)e[t]=0}function DP(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(tP.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function NP(e,t){rP._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,DP(e.strm)}function LP(e,t){e.pending_buf[e.pending++]=t}function UP(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function VP(e,t){var r,n,i=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-kP?e.strstart-(e.w_size-kP):0,u=e.window,d=e.w_mask,l=e.prev,h=e.strstart+bP,p=u[o+a-1],v=u[o+a];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(r=t)+a]===v&&u[r+a-1]===p&&u[r]===u[o]&&u[++r]===u[o+1]){o+=2,r++;do{}while(u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&o<h);if(n=bP-(h-o),o=h-bP,n>a){if(e.match_start=t,a=n,n>=s)break;p=u[o+a-1],v=u[o+a]}}}while((t=l[t&d])>c&&0!=--i);return a<=e.lookahead?a:e.lookahead}function FP(e){var t,r,n,i,o,a,s,c,u,d,l=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=l+(l-kP)){tP.arraySet(e.window,e.window,l,l,0),e.match_start-=l,e.strstart-=l,e.block_start-=l,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=l?n-l:0}while(--r);t=r=l;do{n=e.prev[--t],e.prev[t]=n>=l?n-l:0}while(--r);i+=l}if(0===e.strm.avail_in)break;if(a=e.strm,s=e.window,c=e.strstart+e.lookahead,u=i,d=void 0,(d=a.avail_in)>u&&(d=u),r=0===d?0:(a.avail_in-=d,tP.arraySet(s,a.input,a.next_in,d,c),1===a.state.wrap?a.adler=nP(a.adler,s,d,c):2===a.state.wrap&&(a.adler=iP(a.adler,s,d,c)),a.next_in+=d,a.total_in+=d,d),e.lookahead+=r,e.lookahead+e.insert>=SP)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+SP-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<SP)););}while(e.lookahead<kP&&0!==e.strm.avail_in)}function BP(e,t){for(var r,n;;){if(e.lookahead<kP){if(FP(e),e.lookahead<kP&&t===aP)return AP;if(0===e.lookahead)break}if(r=0,e.lookahead>=SP&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+SP-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-kP&&(e.match_length=VP(e,r)),e.match_length>=SP)if(n=rP._tr_tally(e,e.strstart-e.match_start,e.match_length-SP),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=SP){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+SP-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=rP._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(NP(e,!1),0===e.strm.avail_out))return AP}return e.insert=e.strstart<SP-1?e.strstart:SP-1,t===sP?(NP(e,!0),0===e.strm.avail_out?CP:xP):e.last_lit&&(NP(e,!1),0===e.strm.avail_out)?AP:wP}function jP(e,t){for(var r,n,i;;){if(e.lookahead<kP){if(FP(e),e.lookahead<kP&&t===aP)return AP;if(0===e.lookahead)break}if(r=0,e.lookahead>=SP&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+SP-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=SP-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-kP&&(e.match_length=VP(e,r),e.match_length<=5&&(1===e.strategy||e.match_length===SP&&e.strstart-e.match_start>4096)&&(e.match_length=SP-1)),e.prev_length>=SP&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-SP,n=rP._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-SP),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+SP-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=SP-1,e.strstart++,n&&(NP(e,!1),0===e.strm.avail_out))return AP}else if(e.match_available){if((n=rP._tr_tally(e,0,e.window[e.strstart-1]))&&NP(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return AP}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=rP._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<SP-1?e.strstart:SP-1,t===sP?(NP(e,!0),0===e.strm.avail_out?CP:xP):e.last_lit&&(NP(e,!1),0===e.strm.avail_out)?AP:wP}function HP(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function GP(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=pP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new tP.Buf16(2*gP),this.dyn_dtree=new tP.Buf16(2*(2*_P+1)),this.bl_tree=new tP.Buf16(2*(2*mP+1)),MP(this.dyn_ltree),MP(this.dyn_dtree),MP(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new tP.Buf16(yP+1),this.heap=new tP.Buf16(2*fP+1),MP(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new tP.Buf16(2*fP+1),MP(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function zP(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=hP,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?EP:IP,e.adler=2===t.wrap?0:1,t.last_flush=aP,rP._tr_init(t),cP):OP(e,uP)}function KP(e){var t,r=zP(e);return r===cP&&((t=e.state).window_size=2*t.w_size,MP(t.head),t.max_lazy_match=ZO[t.level].max_lazy,t.good_match=ZO[t.level].good_length,t.nice_match=ZO[t.level].nice_length,t.max_chain_length=ZO[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=SP-1,t.match_available=0,t.ins_h=0),r}function WP(e,t,r,n,i,o){if(!e)return uP;var a=1;if(t===dP&&(t=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),i<1||i>vP||r!==pP||n<8||n>15||t<0||t>9||o<0||o>lP)return OP(e,uP);8===n&&(n=9);var s=new GP;return e.state=s,s.strm=e,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+SP-1)/SP),s.window=new tP.Buf8(2*s.w_size),s.head=new tP.Buf16(s.hash_size),s.prev=new tP.Buf16(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new tP.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=o,s.method=r,KP(e)}ZO=[new HP(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(FP(e),0===e.lookahead&&t===aP)return AP;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,NP(e,!1),0===e.strm.avail_out))return AP;if(e.strstart-e.block_start>=e.w_size-kP&&(NP(e,!1),0===e.strm.avail_out))return AP}return e.insert=0,t===sP?(NP(e,!0),0===e.strm.avail_out?CP:xP):(e.strstart>e.block_start&&(NP(e,!1),e.strm.avail_out),AP)})),new HP(4,4,8,4,BP),new HP(4,5,16,8,BP),new HP(4,6,32,32,BP),new HP(4,4,16,16,jP),new HP(8,16,32,32,jP),new HP(8,16,128,128,jP),new HP(8,32,128,256,jP),new HP(32,128,258,1024,jP),new HP(32,258,258,4096,jP)],$x.deflateInit=function(e,t){return WP(e,t,pP,15,8,0)},$x.deflateInit2=WP,$x.deflateReset=KP,$x.deflateResetKeep=zP,$x.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?uP:(e.state.gzhead=t,cP):uP},$x.deflate=function(e,t){var r,n,i,o;if(!e||!e.state||t>5||t<0)return e?OP(e,uP):uP;if(n=e.state,!e.output||!e.input&&0!==e.avail_in||n.status===RP&&t!==sP)return OP(e,0===e.avail_out?-5:uP);if(n.strm=e,r=n.last_flush,n.last_flush=t,n.status===EP)if(2===n.wrap)e.adler=0,LP(n,31),LP(n,139),LP(n,8),n.gzhead?(LP(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),LP(n,255&n.gzhead.time),LP(n,n.gzhead.time>>8&255),LP(n,n.gzhead.time>>16&255),LP(n,n.gzhead.time>>24&255),LP(n,9===n.level?2:n.strategy>=2||n.level<2?4:0),LP(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(LP(n,255&n.gzhead.extra.length),LP(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=iP(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(LP(n,0),LP(n,0),LP(n,0),LP(n,0),LP(n,0),LP(n,9===n.level?2:n.strategy>=2||n.level<2?4:0),LP(n,3),n.status=IP);else{var a=pP+(n.w_bits-8<<4)<<8;a|=(n.strategy>=2||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(a|=32),a+=31-a%31,n.status=IP,UP(n,a),0!==n.strstart&&(UP(n,e.adler>>>16),UP(n,65535&e.adler)),e.adler=1}if(69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(e.adler=iP(e.adler,n.pending_buf,n.pending-i,i)),DP(e),i=n.pending,n.pending!==n.pending_buf_size));)LP(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(e.adler=iP(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=iP(e.adler,n.pending_buf,n.pending-i,i)),DP(e),i=n.pending,n.pending===n.pending_buf_size)){o=1;break}o=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,LP(n,o)}while(0!==o);n.gzhead.hcrc&&n.pending>i&&(e.adler=iP(e.adler,n.pending_buf,n.pending-i,i)),0===o&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=iP(e.adler,n.pending_buf,n.pending-i,i)),DP(e),i=n.pending,n.pending===n.pending_buf_size)){o=1;break}o=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,LP(n,o)}while(0!==o);n.gzhead.hcrc&&n.pending>i&&(e.adler=iP(e.adler,n.pending_buf,n.pending-i,i)),0===o&&(n.status=TP)}else n.status=TP;if(n.status===TP&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&DP(e),n.pending+2<=n.pending_buf_size&&(LP(n,255&e.adler),LP(n,e.adler>>8&255),e.adler=0,n.status=IP)):n.status=IP),0!==n.pending){if(DP(e),0===e.avail_out)return n.last_flush=-1,cP}else if(0===e.avail_in&&PP(t)<=PP(r)&&t!==sP)return OP(e,-5);if(n.status===RP&&0!==e.avail_in)return OP(e,-5);if(0!==e.avail_in||0!==n.lookahead||t!==aP&&n.status!==RP){var s=2===n.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(FP(e),0===e.lookahead)){if(t===aP)return AP;break}if(e.match_length=0,r=rP._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(NP(e,!1),0===e.strm.avail_out))return AP}return e.insert=0,t===sP?(NP(e,!0),0===e.strm.avail_out?CP:xP):e.last_lit&&(NP(e,!1),0===e.strm.avail_out)?AP:wP}(n,t):3===n.strategy?function(e,t){for(var r,n,i,o,a=e.window;;){if(e.lookahead<=bP){if(FP(e),e.lookahead<=bP&&t===aP)return AP;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=SP&&e.strstart>0&&(n=a[i=e.strstart-1])===a[++i]&&n===a[++i]&&n===a[++i]){o=e.strstart+bP;do{}while(n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<o);e.match_length=bP-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=SP?(r=rP._tr_tally(e,1,e.match_length-SP),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=rP._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(NP(e,!1),0===e.strm.avail_out))return AP}return e.insert=0,t===sP?(NP(e,!0),0===e.strm.avail_out?CP:xP):e.last_lit&&(NP(e,!1),0===e.strm.avail_out)?AP:wP}(n,t):ZO[n.level].func(n,t);if(s!==CP&&s!==xP||(n.status=RP),s===AP||s===CP)return 0===e.avail_out&&(n.last_flush=-1),cP;if(s===wP&&(1===t?rP._tr_align(n):5!==t&&(rP._tr_stored_block(n,0,0,!1),3===t&&(MP(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),DP(e),0===e.avail_out))return n.last_flush=-1,cP}return t!==sP?cP:n.wrap<=0?1:(2===n.wrap?(LP(n,255&e.adler),LP(n,e.adler>>8&255),LP(n,e.adler>>16&255),LP(n,e.adler>>24&255),LP(n,255&e.total_in),LP(n,e.total_in>>8&255),LP(n,e.total_in>>16&255),LP(n,e.total_in>>24&255)):(UP(n,e.adler>>>16),UP(n,65535&e.adler)),DP(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?cP:1)},$x.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==EP&&69!==t&&73!==t&&91!==t&&t!==TP&&t!==IP&&t!==RP?OP(e,uP):(e.state=null,t===IP?OP(e,-3):cP):uP},$x.deflateSetDictionary=function(e,t){var r,n,i,o,a,s,c,u,d=t.length;if(!e||!e.state)return uP;if(2===(o=(r=e.state).wrap)||1===o&&r.status!==EP||r.lookahead)return uP;for(1===o&&(e.adler=nP(e.adler,t,d,0)),r.wrap=0,d>=r.w_size&&(0===o&&(MP(r.head),r.strstart=0,r.block_start=0,r.insert=0),u=new tP.Buf8(r.w_size),tP.arraySet(u,t,d-r.w_size,r.w_size,0),t=u,d=r.w_size),a=e.avail_in,s=e.next_in,c=e.input,e.avail_in=d,e.next_in=0,e.input=t,FP(r);r.lookahead>=SP;){n=r.strstart,i=r.lookahead-(SP-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+SP-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--i);r.strstart=n,r.lookahead=SP-1,FP(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=SP-1,r.match_available=0,e.next_in=s,e.input=c,e.avail_in=a,r.wrap=o,cP},$x.deflateInfo="pako deflate (from Nodeca project)";var XP={},qP=Qx,YP=!0,JP=!0;try{String.fromCharCode.apply(null,[0])}catch(Q$){YP=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Q$){JP=!1}for(var QP=new qP.Buf8(256),ZP=0;ZP<256;ZP++)QP[ZP]=ZP>=252?6:ZP>=248?5:ZP>=240?4:ZP>=224?3:ZP>=192?2:1;function $P(e,t){if(t<65534&&(e.subarray&&JP||!e.subarray&&YP))return String.fromCharCode.apply(null,qP.shrinkBuf(e,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}QP[254]=QP[254]=1,XP.string2buf=function(e){var t,r,n,i,o,a=e.length,s=0;for(i=0;i<a;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new qP.Buf8(s),o=0,i=0;o<s;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},XP.buf2binstring=function(e){return $P(e,e.length)},XP.binstring2buf=function(e){for(var t=new qP.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t},XP.buf2string=function(e,t){var r,n,i,o,a=t||e.length,s=new Array(2*a);for(n=0,r=0;r<a;)if((i=e[r++])<128)s[n++]=i;else if((o=QP[i])>4)s[n++]=65533,r+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&r<a;)i=i<<6|63&e[r++],o--;o>1?s[n++]=65533:i<65536?s[n++]=i:(i-=65536,s[n++]=55296|i>>10&1023,s[n++]=56320|1023&i)}return $P(s,n)},XP.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+QP[e[r]]>t?r:t};var eM=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},tM=$x,rM=Qx,nM=XP,iM=eP,oM=eM,aM=Object.prototype.toString,sM=0,cM=-1,uM=0,dM=8;function lM(e){if(!(this instanceof lM))return new lM(e);this.options=rM.assign({level:cM,method:dM,chunkSize:16384,windowBits:15,memLevel:8,strategy:uM,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new oM,this.strm.avail_out=0;var r=tM.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==sM)throw new Error(iM[r]);if(t.header&&tM.deflateSetHeader(this.strm,t.header),t.dictionary){var n;if(n="string"==typeof t.dictionary?nM.string2buf(t.dictionary):"[object ArrayBuffer]"===aM.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=tM.deflateSetDictionary(this.strm,n))!==sM)throw new Error(iM[r]);this._dict_set=!0}}function hM(e,t){var r=new lM(t);if(r.push(e,!0),r.err)throw r.msg||iM[r.err];return r.result}lM.prototype.push=function(e,t){var r,n,i=this.strm,o=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?4:0,"string"==typeof e?i.input=nM.string2buf(e):"[object ArrayBuffer]"===aM.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new rM.Buf8(o),i.next_out=0,i.avail_out=o),1!==(r=tM.deflate(i,n))&&r!==sM)return this.onEnd(r),this.ended=!0,!1;0!==i.avail_out&&(0!==i.avail_in||4!==n&&2!==n)||("string"===this.options.to?this.onData(nM.buf2binstring(rM.shrinkBuf(i.output,i.next_out))):this.onData(rM.shrinkBuf(i.output,i.next_out)))}while((i.avail_in>0||0===i.avail_out)&&1!==r);return 4===n?(r=tM.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===sM):2!==n||(this.onEnd(sM),i.avail_out=0,!0)},lM.prototype.onData=function(e){this.chunks.push(e)},lM.prototype.onEnd=function(e){e===sM&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=rM.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},Zx.Deflate=lM,Zx.deflate=hM,Zx.deflateRaw=function(e,t){return(t=t||{}).raw=!0,hM(e,t)},Zx.gzip=function(e,t){return(t=t||{}).gzip=!0,hM(e,t)};var pM={},vM=nr,fM=M,_M=$e,mM=ce,gM=function(){var e=vM(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},yM=RegExp.prototype,SM=ce,bM=function(e){var t=e.flags;return void 0!==t||"flags"in yM||_M(e,"flags")||!mM(yM,e)?t:fM(gM,e)},kM=RegExp.prototype,EM=r((function(e){return e===kM||SM(kM,e)?bM(e):e.flags})),TM={},IM=Qx,RM=15,AM=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],wM=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],CM=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],xM=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],OM=Qx,PM=JO,MM=$O,DM=function(e,t){var r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I,R;r=e.state,n=e.next_in,I=e.input,i=n+(e.avail_in-5),o=e.next_out,R=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),c=r.dmax,u=r.wsize,d=r.whave,l=r.wnext,h=r.window,p=r.hold,v=r.bits,f=r.lencode,_=r.distcode,m=(1<<r.lenbits)-1,g=(1<<r.distbits)-1;e:do{v<15&&(p+=I[n++]<<v,v+=8,p+=I[n++]<<v,v+=8),y=f[p&m];t:for(;;){if(p>>>=S=y>>>24,v-=S,0===(S=y>>>16&255))R[o++]=65535&y;else{if(!(16&S)){if(0==(64&S)){y=f[(65535&y)+(p&(1<<S)-1)];continue t}if(32&S){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}b=65535&y,(S&=15)&&(v<S&&(p+=I[n++]<<v,v+=8),b+=p&(1<<S)-1,p>>>=S,v-=S),v<15&&(p+=I[n++]<<v,v+=8,p+=I[n++]<<v,v+=8),y=_[p&g];r:for(;;){if(p>>>=S=y>>>24,v-=S,!(16&(S=y>>>16&255))){if(0==(64&S)){y=_[(65535&y)+(p&(1<<S)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(k=65535&y,v<(S&=15)&&(p+=I[n++]<<v,(v+=8)<S&&(p+=I[n++]<<v,v+=8)),(k+=p&(1<<S)-1)>c){e.msg="invalid distance too far back",r.mode=30;break e}if(p>>>=S,v-=S,k>(S=o-a)){if((S=k-S)>d&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(E=0,T=h,0===l){if(E+=u-S,S<b){b-=S;do{R[o++]=h[E++]}while(--S);E=o-k,T=R}}else if(l<S){if(E+=u+l-S,(S-=l)<b){b-=S;do{R[o++]=h[E++]}while(--S);if(E=0,l<b){b-=S=l;do{R[o++]=h[E++]}while(--S);E=o-k,T=R}}}else if(E+=l-S,S<b){b-=S;do{R[o++]=h[E++]}while(--S);E=o-k,T=R}for(;b>2;)R[o++]=T[E++],R[o++]=T[E++],R[o++]=T[E++],b-=3;b&&(R[o++]=T[E++],b>1&&(R[o++]=T[E++]))}else{E=o-k;do{R[o++]=R[E++],R[o++]=R[E++],R[o++]=R[E++],b-=3}while(b>2);b&&(R[o++]=R[E++],b>1&&(R[o++]=R[E++]))}break}}break}}while(n<i&&o<s);n-=b=v>>3,p&=(1<<(v-=b<<3))-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=o<s?s-o+257:257-(o-s),r.hold=p,r.bits=v},NM=function(e,t,r,n,i,o,a,s){var c,u,d,l,h,p,v,f,_,m=s.bits,g=0,y=0,S=0,b=0,k=0,E=0,T=0,I=0,R=0,A=0,w=null,C=0,x=new IM.Buf16(16),O=new IM.Buf16(16),P=null,M=0;for(g=0;g<=RM;g++)x[g]=0;for(y=0;y<n;y++)x[t[r+y]]++;for(k=m,b=RM;b>=1&&0===x[b];b--);if(k>b&&(k=b),0===b)return i[o++]=20971520,i[o++]=20971520,s.bits=1,0;for(S=1;S<b&&0===x[S];S++);for(k<S&&(k=S),I=1,g=1;g<=RM;g++)if(I<<=1,(I-=x[g])<0)return-1;if(I>0&&(0===e||1!==b))return-1;for(O[1]=0,g=1;g<RM;g++)O[g+1]=O[g]+x[g];for(y=0;y<n;y++)0!==t[r+y]&&(a[O[t[r+y]]++]=y);if(0===e?(w=P=a,p=19):1===e?(w=AM,C-=257,P=wM,M-=257,p=256):(w=CM,P=xM,p=-1),A=0,y=0,g=S,h=o,E=k,T=0,d=-1,l=(R=1<<k)-1,1===e&&R>852||2===e&&R>592)return 1;for(;;){v=g-T,a[y]<p?(f=0,_=a[y]):a[y]>p?(f=P[M+a[y]],_=w[C+a[y]]):(f=96,_=0),c=1<<g-T,S=u=1<<E;do{i[h+(A>>T)+(u-=c)]=v<<24|f<<16|_|0}while(0!==u);for(c=1<<g-1;A&c;)c>>=1;if(0!==c?(A&=c-1,A+=c):A=0,y++,0==--x[g]){if(g===b)break;g=t[r+a[y]]}if(g>k&&(A&l)!==d){for(0===T&&(T=k),h+=S,I=1<<(E=g-T);E+T<b&&!((I-=x[E+T])<=0);)E++,I<<=1;if(R+=1<<E,1===e&&R>852||2===e&&R>592)return 1;i[d=A&l]=k<<24|E<<16|h-o|0}}return 0!==A&&(i[h+A]=g-T<<24|64<<16|0),s.bits=k,0},LM=1,UM=2,VM=0,FM=-2,BM=1,jM=12,HM=30,GM=852,zM=592;function KM(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function WM(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new OM.Buf16(320),this.work=new OM.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function XM(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=BM,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new OM.Buf32(GM),t.distcode=t.distdyn=new OM.Buf32(zM),t.sane=1,t.back=-1,VM):FM}function qM(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,XM(e)):FM}function YM(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?FM:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,qM(e))):FM}function JM(e,t){var r,n;return e?(n=new WM,e.state=n,n.window=null,(r=YM(e,t))!==VM&&(e.state=null),r):FM}var QM,ZM,$M=!0;function eD(e){if($M){var t;for(QM=new OM.Buf32(512),ZM=new OM.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(NM(LM,e.lens,0,288,QM,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;NM(UM,e.lens,0,32,ZM,0,e.work,{bits:5}),$M=!1}e.lencode=QM,e.lenbits=9,e.distcode=ZM,e.distbits=5}function tD(e,t,r,n){var i,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new OM.Buf8(o.wsize)),n>=o.wsize?(OM.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((i=o.wsize-o.wnext)>n&&(i=n),OM.arraySet(o.window,t,r-n,i,o.wnext),(n-=i)?(OM.arraySet(o.window,t,r-n,n,0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}TM.inflateReset=qM,TM.inflateReset2=YM,TM.inflateResetKeep=XM,TM.inflateInit=function(e){return JM(e,15)},TM.inflateInit2=JM,TM.inflate=function(e,t){var r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I,R=0,A=new OM.Buf8(4),w=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return FM;(r=e.state).mode===jM&&(r.mode=13),a=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,u=r.hold,d=r.bits,l=s,h=c,E=VM;e:for(;;)switch(r.mode){case BM:if(0===r.wrap){r.mode=13;break}for(;d<16;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(2&r.wrap&&35615===u){r.check=0,A[0]=255&u,A[1]=u>>>8&255,r.check=MM(r.check,A,2,0),u=0,d=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",r.mode=HM;break}if(8!=(15&u)){e.msg="unknown compression method",r.mode=HM;break}if(d-=4,k=8+(15&(u>>>=4)),0===r.wbits)r.wbits=k;else if(k>r.wbits){e.msg="invalid window size",r.mode=HM;break}r.dmax=1<<k,e.adler=r.check=1,r.mode=512&u?10:jM,u=0,d=0;break;case 2:for(;d<16;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(r.flags=u,8!=(255&EM(r))){e.msg="unknown compression method",r.mode=HM;break}if(57344&EM(r)){e.msg="unknown header flags set",r.mode=HM;break}r.head&&(r.head.text=u>>8&1),512&EM(r)&&(A[0]=255&u,A[1]=u>>>8&255,r.check=MM(r.check,A,2,0)),u=0,d=0,r.mode=3;case 3:for(;d<32;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.head&&(r.head.time=u),512&EM(r)&&(A[0]=255&u,A[1]=u>>>8&255,A[2]=u>>>16&255,A[3]=u>>>24&255,r.check=MM(r.check,A,4,0)),u=0,d=0,r.mode=4;case 4:for(;d<16;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&EM(r)&&(A[0]=255&u,A[1]=u>>>8&255,r.check=MM(r.check,A,2,0)),u=0,d=0,r.mode=5;case 5:if(1024&EM(r)){for(;d<16;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.length=u,r.head&&(r.head.extra_len=u),512&EM(r)&&(A[0]=255&u,A[1]=u>>>8&255,r.check=MM(r.check,A,2,0)),u=0,d=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&EM(r)&&((p=r.length)>s&&(p=s),p&&(r.head&&(k=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),OM.arraySet(r.head.extra,n,o,p,k)),512&EM(r)&&(r.check=MM(r.check,n,p,o)),s-=p,o+=p,r.length-=p),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&EM(r)){if(0===s)break e;p=0;do{k=n[o+p++],r.head&&k&&r.length<65536&&(r.head.name+=String.fromCharCode(k))}while(k&&p<s);if(512&EM(r)&&(r.check=MM(r.check,n,p,o)),s-=p,o+=p,k)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&EM(r)){if(0===s)break e;p=0;do{k=n[o+p++],r.head&&k&&r.length<65536&&(r.head.comment+=String.fromCharCode(k))}while(k&&p<s);if(512&EM(r)&&(r.check=MM(r.check,n,p,o)),s-=p,o+=p,k)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&EM(r)){for(;d<16;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(u!==(65535&r.check)){e.msg="header crc mismatch",r.mode=HM;break}u=0,d=0}r.head&&(r.head.hcrc=EM(r)>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=jM;break;case 10:for(;d<32;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}e.adler=r.check=KM(u),u=0,d=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=u,r.bits=d,2;e.adler=r.check=1,r.mode=jM;case jM:if(5===t||6===t)break e;case 13:if(r.last){u>>>=7&d,d-=7&d,r.mode=27;break}for(;d<3;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}switch(r.last=1&u,d-=1,3&(u>>>=1)){case 0:r.mode=14;break;case 1:if(eD(r),r.mode=20,6===t){u>>>=2,d-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=HM}u>>>=2,d-=2;break;case 14:for(u>>>=7&d,d-=7&d;d<32;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",r.mode=HM;break}if(r.length=65535&u,u=0,d=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(p=r.length){if(p>s&&(p=s),p>c&&(p=c),0===p)break e;OM.arraySet(i,n,o,p,a),s-=p,o+=p,c-=p,a+=p,r.length-=p;break}r.mode=jM;break;case 17:for(;d<14;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(r.nlen=257+(31&u),u>>>=5,d-=5,r.ndist=1+(31&u),u>>>=5,d-=5,r.ncode=4+(15&u),u>>>=4,d-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=HM;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;d<3;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.lens[w[r.have++]]=7&u,u>>>=3,d-=3}for(;r.have<19;)r.lens[w[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,T={bits:r.lenbits},E=NM(0,r.lens,0,19,r.lencode,0,r.work,T),r.lenbits=T.bits,E){e.msg="invalid code lengths set",r.mode=HM;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;m=(R=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,g=65535&R,!((_=R>>>24)<=d);){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(g<16)u>>>=_,d-=_,r.lens[r.have++]=g;else{if(16===g){for(I=_+2;d<I;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(u>>>=_,d-=_,0===r.have){e.msg="invalid bit length repeat",r.mode=HM;break}k=r.lens[r.have-1],p=3+(3&u),u>>>=2,d-=2}else if(17===g){for(I=_+3;d<I;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}d-=_,k=0,p=3+(7&(u>>>=_)),u>>>=3,d-=3}else{for(I=_+7;d<I;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}d-=_,k=0,p=11+(127&(u>>>=_)),u>>>=7,d-=7}if(r.have+p>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=HM;break}for(;p--;)r.lens[r.have++]=k}}if(r.mode===HM)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=HM;break}if(r.lenbits=9,T={bits:r.lenbits},E=NM(LM,r.lens,0,r.nlen,r.lencode,0,r.work,T),r.lenbits=T.bits,E){e.msg="invalid literal/lengths set",r.mode=HM;break}if(r.distbits=6,r.distcode=r.distdyn,T={bits:r.distbits},E=NM(UM,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,T),r.distbits=T.bits,E){e.msg="invalid distances set",r.mode=HM;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(s>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=u,r.bits=d,DM(e,h),a=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,u=r.hold,d=r.bits,r.mode===jM&&(r.back=-1);break}for(r.back=0;m=(R=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,g=65535&R,!((_=R>>>24)<=d);){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(m&&0==(240&m)){for(y=_,S=m,b=g;m=(R=r.lencode[b+((u&(1<<y+S)-1)>>y)])>>>16&255,g=65535&R,!(y+(_=R>>>24)<=d);){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}u>>>=y,d-=y,r.back+=y}if(u>>>=_,d-=_,r.back+=_,r.length=g,0===m){r.mode=26;break}if(32&m){r.back=-1,r.mode=jM;break}if(64&m){e.msg="invalid literal/length code",r.mode=HM;break}r.extra=15&m,r.mode=22;case 22:if(r.extra){for(I=r.extra;d<I;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,d-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;m=(R=r.distcode[u&(1<<r.distbits)-1])>>>16&255,g=65535&R,!((_=R>>>24)<=d);){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(0==(240&m)){for(y=_,S=m,b=g;m=(R=r.distcode[b+((u&(1<<y+S)-1)>>y)])>>>16&255,g=65535&R,!(y+(_=R>>>24)<=d);){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}u>>>=y,d-=y,r.back+=y}if(u>>>=_,d-=_,r.back+=_,64&m){e.msg="invalid distance code",r.mode=HM;break}r.offset=g,r.extra=15&m,r.mode=24;case 24:if(r.extra){for(I=r.extra;d<I;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,d-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=HM;break}r.mode=25;case 25:if(0===c)break e;if(p=h-c,r.offset>p){if((p=r.offset-p)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=HM;break}p>r.wnext?(p-=r.wnext,v=r.wsize-p):v=r.wnext-p,p>r.length&&(p=r.length),f=r.window}else f=i,v=a-r.offset,p=r.length;p>c&&(p=c),c-=p,r.length-=p;do{i[a++]=f[v++]}while(--p);0===r.length&&(r.mode=21);break;case 26:if(0===c)break e;i[a++]=r.length,c--,r.mode=21;break;case 27:if(r.wrap){for(;d<32;){if(0===s)break e;s--,u|=n[o++]<<d,d+=8}if(h-=c,e.total_out+=h,r.total+=h,h&&(e.adler=r.check=EM(r)?MM(r.check,i,h,a-h):PM(r.check,i,h,a-h)),h=c,(EM(r)?u:KM(u))!==r.check){e.msg="incorrect data check",r.mode=HM;break}u=0,d=0}r.mode=28;case 28:if(r.wrap&&EM(r)){for(;d<32;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(u!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=HM;break}u=0,d=0}r.mode=29;case 29:E=1;break e;case HM:E=-3;break e;case 31:return-4;default:return FM}return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=u,r.bits=d,(r.wsize||h!==e.avail_out&&r.mode<HM&&(r.mode<27||4!==t))&&tD(e,e.output,e.next_out,h-e.avail_out),l-=e.avail_in,h-=e.avail_out,e.total_in+=l,e.total_out+=h,r.total+=h,r.wrap&&h&&(e.adler=r.check=EM(r)?MM(r.check,i,h,e.next_out-h):PM(r.check,i,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(r.mode===jM?128:0)+(20===r.mode||15===r.mode?256:0),(0===l&&0===h||4===t)&&E===VM&&(E=-5),E},TM.inflateEnd=function(e){if(!e||!e.state)return FM;var t=e.state;return t.window&&(t.window=null),e.state=null,VM},TM.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?FM:(r.head=t,t.done=!1,VM):FM},TM.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?FM:11===r.mode&&PM(1,t,n,0)!==r.check?-3:tD(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,VM):FM},TM.inflateInfo="pako inflate (from Nodeca project)";var rD={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};var nD=TM,iD=Qx,oD=XP,aD=rD,sD=eP,cD=eM,uD=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},dD=Object.prototype.toString;function lD(e){if(!(this instanceof lD))return new lD(e);this.options=iD.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new cD,this.strm.avail_out=0;var r=nD.inflateInit2(this.strm,t.windowBits);if(r!==aD.Z_OK)throw new Error(sD[r]);if(this.header=new uD,nD.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=oD.string2buf(t.dictionary):"[object ArrayBuffer]"===dD.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=nD.inflateSetDictionary(this.strm,t.dictionary))!==aD.Z_OK))throw new Error(sD[r])}function hD(e,t){var r=new lD(t);if(r.push(e,!0),r.err)throw r.msg||sD[r.err];return r.result}lD.prototype.push=function(e,t){var r,n,i,o,a,s=this.strm,c=this.options.chunkSize,u=this.options.dictionary,d=!1;if(this.ended)return!1;n=t===~~t?t:!0===t?aD.Z_FINISH:aD.Z_NO_FLUSH,"string"==typeof e?s.input=oD.binstring2buf(e):"[object ArrayBuffer]"===dD.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new iD.Buf8(c),s.next_out=0,s.avail_out=c),(r=nD.inflate(s,aD.Z_NO_FLUSH))===aD.Z_NEED_DICT&&u&&(r=nD.inflateSetDictionary(this.strm,u)),r===aD.Z_BUF_ERROR&&!0===d&&(r=aD.Z_OK,d=!1),r!==aD.Z_STREAM_END&&r!==aD.Z_OK)return this.onEnd(r),this.ended=!0,!1;s.next_out&&(0!==s.avail_out&&r!==aD.Z_STREAM_END&&(0!==s.avail_in||n!==aD.Z_FINISH&&n!==aD.Z_SYNC_FLUSH)||("string"===this.options.to?(i=oD.utf8border(s.output,s.next_out),o=s.next_out-i,a=oD.buf2string(s.output,i),s.next_out=o,s.avail_out=c-o,o&&iD.arraySet(s.output,s.output,i,o,0),this.onData(a)):this.onData(iD.shrinkBuf(s.output,s.next_out)))),0===s.avail_in&&0===s.avail_out&&(d=!0)}while((s.avail_in>0||0===s.avail_out)&&r!==aD.Z_STREAM_END);return r===aD.Z_STREAM_END&&(n=aD.Z_FINISH),n===aD.Z_FINISH?(r=nD.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===aD.Z_OK):n!==aD.Z_SYNC_FLUSH||(this.onEnd(aD.Z_OK),s.avail_out=0,!0)},lD.prototype.onData=function(e){this.chunks.push(e)},lD.prototype.onEnd=function(e){e===aD.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=iD.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},pM.Inflate=lD,pM.inflate=hD,pM.inflateRaw=function(e,t){return(t=t||{}).raw=!0,hD(e,t)},pM.ungzip=hD;var pD={};(0,Qx.assign)(pD,Zx,pM,rD);var vD=r(pD),fD=1,_D=function(){function e(t){Bh(this,e),Jl(this,"lockingPromise",HI.resolve()),Jl(this,"locks",0),Jl(this,"name",""),Jl(this,"lockId",void 0),this.lockId=fD++,t&&(this.name=t)}return Fh(e,[{key:"isLocked",get:function(){return this.locks>0}},{key:"lock",value:function(){var e,t=this;this.locks+=1;var r=new HI((function(r){e=function(){t.locks-=1,r()}})),n=this.lockingPromise.then((function(){return e}));return this.lockingPromise=this.lockingPromise.then((function(){return r})),n}}]),e}(),mD="VERTC",gD=function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},yD=function(){function e(t){Bh(this,e),Jl(this,"storeName",void 0),Jl(this,"pendingList",[]),this.storeName=t,!px()&&gD()&&this._checkAndCreateStore(t)}var t,r,n,i,o,a,s;return Fh(e,[{key:"_checkAndCreateStore",value:(s=Ng(Mg().mark((function t(r,n){var i,o,a=this;return Mg().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._promiseLock.lock();case 2:if(i=t.sent,!gD.databases){t.next=6;break}return t.next=6,new HI((function(e){var t=function(){return gD.databases().finally(e)};o=setInterval(t,100),t()})).finally((function(){return clearInterval(o)}));case 6:return t.abrupt("return",new HI((function(t){e.db&&(e.db.close(),delete e.db);var o=n?gD().open(mD,n):gD().open(mD);o.onupgradeneeded=function(){o.result.createObjectStore(r)},o.onerror=function(){console.error("IndexedDBInterface error",o.error)},o.onsuccess=function(){var n=o.result;e.db=n;try{e.db.transaction(a.storeName,"readonly"),a.pendingList.forEach(function(){var e=Ng(Mg().mark((function e(t){var r,n,i,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.txMode,n=t.pendResolve,i=t.pendReject,e.prev=1,e.next=4,a._getStore(r);case 4:o=e.sent,n(o),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),i();case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()),t()}catch(s){t(a._checkAndCreateStore(r,n.version+1))}finally{i()}}})));case 7:case"end":return t.stop()}}),t)}))),function(e,t){return s.apply(this,arguments)})},{key:"_getStore",value:(a=Ng(Mg().mark((function t(r){var n,i=this;return Mg().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._promiseLock.lock();case 2:return n=t.sent,t.abrupt("return",new HI((function(t,o){if(!e.db)return i.pendingList.push({txMode:r,pendResolve:t,pendReject:o}),void n();try{t(e.db.transaction(i.storeName,r).objectStore(i.storeName))}catch(a){return void i.pendingList.push({txMode:r,pendResolve:t,pendReject:o})}finally{n()}})));case 4:case"end":return t.stop()}}),t)}))),function(e){return a.apply(this,arguments)})},{key:"put2String",value:(o=Ng(Mg().mark((function e(t,r){var n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{n=zg(t)}catch(i){n=t}return e.next=3,this.put(n,r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"get4String",value:(i=Ng(Mg().mark((function e(t){var r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:r=e.sent;try{n=JSON.parse(r)}catch(i){n=r}return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"put",value:(n=Ng(Mg().mark((function e(t,r){var n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getStore("readwrite");case 2:return n=e.sent,e.abrupt("return",new HI((function(e,i){var o=n.put(t,r);o.onsuccess=function(){e()},o.onerror=function(e){i(e)}})));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"get",value:(r=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getStore("readonly");case 2:return r=e.sent,e.abrupt("return",new HI((function(e,n){var i=r.get(t);i.onsuccess=function(){e(i.result)},i.onerror=function(e){n(e)}})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"del",value:(t=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getStore("readwrite");case 2:return r=e.sent,e.abrupt("return",new HI((function(e,n){var i=r.delete(t);i.onsuccess=function(){e()},i.onerror=function(e){n(e)}})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function SD(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=un(e);for(n=0;n<o.length;n++)r=o[n],yI(t).call(t,r)>=0||(i[r]=e[r]);return i}(e,t);if(Gs){var o=Gs(e);for(n=0;n<o.length;n++)r=o[n],yI(t).call(t,r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}Jl(yD,"db",void 0),Jl(yD,"state","init"),Jl(yD,"_promiseLock",new _D("iDB"));var bD=["message"];var kD,ED,TD,ID=new(function(){function e(){Bh(this,e),Jl(this,"name","LongStringReportor"),Jl(this,"inBuffer",[]),Jl(this,"outBuffer",[])}return Fh(e,[{key:"push",value:function(e){var t;e.message&&this.inBuffer.push(Zl(Zl({},e),{},{message:{id:cI(t=vx()).call(t,0,3),index:0,end:!0,msg:e.message}}))}},{key:"splice",value:function(e){for(var t=[],r=0;this.outBuffer.length;){var n=zg(this.outBuffer[0]).length;if(!(n<e))break;e-=n,r+=n,t.push(this.outBuffer.shift())}for(;this.inBuffer[0]&&e>0;){var i=this.inBuffer[0],o=i.message,a=Zl(Zl({},SD(i,bD)),{},{message:Zl(Zl({},o),{},{msg:""})}),s=zg(a).length,c=e-s,u=Zl({},a);if(c>o.msg.length)u.message.msg=o.msg,this.inBuffer.shift();else{if(!(c>=10))break;var d,l,h=cI(d=o.msg).call(d,0,c);u.message.msg=h,u.message.end=!1,this.inBuffer[0].message.msg=cI(l=o.msg).call(l,c),this.inBuffer[0].message.index++}var p=zg(u.message),v=p.length;e-=v+s,r+=v+s,t.push(Zl(Zl({},u),{},{message:p}))}return{payload:t,payloadSize:r}}},{key:"unshift",value:function(e){this.outBuffer=Bg(e).call(e,this.outBuffer)}},{key:"get",value:function(){var e,t;return Bg(e=[]).call(e,rR(this.outBuffer),rR(Jg(t=this.inBuffer).call(t,(function(e){return Zl(Zl({},e),{},{message:zg(e.message)})}))))}},{key:"set",value:function(e){var t=this,r=[],n=[];e.forEach((function(e){!function(e){return void 0!==e.report_id}(e)?(e.message||(e.message=""),t.inBuffer.push(Zl(Zl({},e),{},{message:JSON.parse(e.message)}))):t.outBuffer.push(e)})),this.outBuffer=Bg(r).call(r,this.outBuffer),this.inBuffer=Bg(n).call(n,this.inBuffer)}},{key:"isEmpty",value:function(){return 0===this.inBuffer.length&&0===this.outBuffer.length}}]),e}()),RD={product_line:"rtc",report_version:"5",os:"web",user_agent:px()?"":null===(kD=navigator)||void 0===kD?void 0:kD.userAgent,platform:"web",product:"webrtc",app_state:"active"},AD="LogReportor",wD="undefined"!=typeof window&&(qy(ED=window.location.search).call(ED,"_rtc_debug_")||(null===(TD=window.localStorage)||void 0===TD?void 0:TD.getItem("_rtc_debug_"))),CD=function(){function e(t){Bh(this,e),Jl(this,"_buffer",void 0),this._buffer=new yD(t)}var t,r;return Fh(e,[{key:"set",value:(r=Ng(Mg().mark((function e(t,r){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._buffer.put2String(t,r);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"get",value:(t=Ng(Mg().mark((function e(t){var r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],e.prev=1,e.next=4,this._buffer.get4String(t);case 4:n=e.sent,e.next=9;break;case 7:e.prev=7,e.t0=e.catch(1);case 9:return e.abrupt("return",null!==(r=n)&&void 0!==r?r:[]);case 10:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return t.apply(this,arguments)})}]),e}(),xD=function(){function e(){var t=this;Bh(this,e),Jl(this,"reportCommon",RD),Jl(this,"reportIds",new uT),Jl(this,"dataBuffer",[]),Jl(this,"reportorList",[]),Jl(this,"dbBuffer",void 0),Jl(this,"posting",!1),Jl(this,"sucSendTimer",void 0),Jl(this,"preSucTime",0),Jl(this,"errSendTimer",void 0),Jl(this,"errSendDelay",100),Jl(this,"_logServerUrl",void 0),Jl(this,"_retryCount",0),Jl(this,"_reportLimit",5e5),Jl(this,"_disableTimeout",!1),px()||(window.addEventListener("beforeunload",(function(){clearTimeout(t.errSendTimer),clearTimeout(t.sucSendTimer),t.send(void 0,!0)})),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState?t.setCommonStats({app_state:"active"}):"hidden"===document.visibilityState&&t.setCommonStats({app_state:"background"})})),wD&&(window.__rtc_debug_reportor__=this)),Nx.on("UPLOAD_REPORT_LIMIT",(function(e){t.setReportLimit(e)})),Nx.on("ENABLE_REPORT_IDB_BUFFER",(function(e){e&&t.enableIndexedDBBuffer()})),setTimeout((function(){t.reportorList.push(aN),t.reportorList.push(ID)}))}var t;return Fh(e,[{key:"setUrl",value:function(e){this._logServerUrl=e}},{key:"setCommonStats",value:function(e){this.reportCommon=IT(this.reportCommon,e)}},{key:"getCommonStats",value:function(){return this.reportCommon}},{key:"setReportLimit",value:function(e){this._reportLimit=Math.max(e,5e4),this._reportLimit=Math.min(e,5e5)}},{key:"getReportId",value:function(e){var t;e=null!==(t=e)&&void 0!==t?t:"__global__",this.reportIds.has(e)||this.reportIds.set(e,0);var r=this.reportIds.get(e);return void 0===r&&(HD("no reportId in reportId map with engine-session-id ".concat(e),0,{}),r=0),this.reportIds.set(e,r+1),r}},{key:"push",value:function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])this.send(e);else{var t,r=null!==(t=e.engine_session_id)&&void 0!==t?t:"__global__";this.reportIds.has(r)||this.reportIds.set(r,0),this.dataBuffer.push(e),!this.posting&&!this.errSendTimer&&Date.now()-this.preSucTime>2e3&&(clearTimeout(this.sucSendTimer),this.send())}}},{key:"enableIndexedDBBuffer",value:function(){var e=this;this.dbBuffer||(this.dbBuffer=new CD("ReportorDBBuffer"),this.dbBuffer.get(AD).then((function(t){t.forEach((function(t){e.push(t)}))})),this.reportorList.forEach((function(t){var r;null===(r=e.dbBuffer)||void 0===r||r.get(t.name).then((function(e){t.set(e)}))})))}},{key:"backup",value:function(){var e=this;try{var t;null===(t=this.dbBuffer)||void 0===t||t.set(rR(this.dataBuffer),AD),this.reportorList.forEach((function(t){var r;null===(r=e.dbBuffer)||void 0===r||r.set(rR(t.get()),t.name)}))}catch(r){HD("Error when save log into IDB",-1,r)}}},{key:"unshift",value:function(e){var t;this.dataBuffer=Bg(t=e[0]).call(t,this.dataBuffer),this.reportorList.forEach((function(t,r){var n;t.unshift(null!==(n=e[r+1])&&void 0!==n?n:[])}))}},{key:"_splice",value:function(){var e,t=this,r=function(e,t){for(var r=0,n=0;n<e.length;n++)if((r+=zg(e[n]).length)>t)return n;return e.length}(this.dataBuffer,this._reportLimit);0===r&&this.dataBuffer.length>0&&(this._reportLimit=zg(this.dataBuffer[0]).length+10,r=1,HD("update report limit to ".concat(this._reportLimit),0,null));var n=jI(e=this.dataBuffer).call(e,0,r),i=zg(n).length,o=[n],a=this._reportLimit-i;return this.reportorList.forEach((function(e){var r=jI(e).call(e,a),n=r.payload,i=r.payloadSize;n.forEach((function(e){var r,n,i;void 0===e.report_id&&(e.report_id=t.getReportId(e.engine_session_id),!px()&&window.__onRTCReport&&(null===(r=(n=window).__onRTCReport)||void 0===r||r.call(n,null!==(i=e.engine_session_id)&&void 0!==i?i:"global",e,t.getCommonStats())))})),o.push(n),a-=i})),o}},{key:"send",value:(t=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.backup(),i=aS(n=this.reportorList).call(n,(function(e,t){return e&&t.isEmpty()}),!0),(t||this.dataBuffer.length||!i)&&this._logServerUrl){e.next=4;break}return e.abrupt("return");case 4:if(t||(this.posting=!0),o=[],t||(o=this._splice()),a=wD,s={data:t||Jx(o).call(o),header:Zl(Zl({},this.reportCommon),{},{http_retry_count:this._retryCount}),from:"web",os:"web",version:"1"},c={method:"POST",body:a?zg(s):vD.gzip(zg(s))},!this._disableTimeout)try{u=new AbortController,c.signal=u.signal,setTimeout((function(){u.abort()}),1e4)}catch(p){console.warn("AbortController is not supported"),this._disableTimeout=!0}return a||(c.headers={"Content-Encoding":"gzip","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}),h=null,e.prev=13,e.next=16,fetch(this._logServerUrl,c);case 16:if(200!==(d=e.sent).status&&304!==d.status){e.next=23;break}return e.t0=JSON,e.next=21,d.text();case 21:e.t1=e.sent,h=e.t0.parse.call(e.t0,e.t1);case 23:e.next=28;break;case 25:e.prev=25,e.t2=e.catch(13),l=e.t2;case 28:t||(this.posting=!1),h&&0===h.StatusCode?t||r||this.sucSend():(setTimeout((function(){var e,t,r,n;HD(Bg(e="reportor post error, resJSON:".concat(null===(t=h)||void 0===t?void 0:t.toString()," err:")).call(e,l),null!==(r=null===(n=d)||void 0===n?void 0:n.status)&&void 0!==r?r:-1,l)}),0),t?this.send(t):(this.unshift(o),r?this.send():this.errSend()));case 30:case"end":return e.stop()}}),e,this,[[13,25]])}))),function(e,r){return t.apply(this,arguments)})},{key:"sucSend",value:function(){this.errSendDelay=100,this._retryCount=0,this.preSucTime=Date.now(),this.sucSendTimer=window.setTimeout(this.send.bind(this),2e3)}},{key:"errSend",value:function(){var e=this;this.errSendTimer=window.setTimeout((function(){e.send(),delete e.errSendTimer}),this.errSendDelay),this.errSendDelay*=2,this._retryCount++}}]),e}();var OD=new xD,PD=function(){function e(t){Bh(this,e),Jl(this,"modifyIds",{}),this.id=t}return Fh(e,[{key:"report",value:function(e,t){var r,n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=Zl(Zl(Zl({event_key:e,rtc_timestamp:Date.now()},this.modifyIds),t),{},{common_extra_info:zg(i),report_id:OD.getReportId(this.modifyIds.engine_session_id)});!px()&&window.__onRTCReport&&(null===(r=(n=window).__onRTCReport)||void 0===r||r.call(n,this.modifyIds.engine_session_id,o,OD.getCommonStats()));OD.push(o)}},{key:"reportLog",value:function(e){var t=Zl(Zl({event_key:"rtc_invoke_status",sdk_api_name:"console_log",rtc_timestamp:Date.now()},this.modifyIds),{},{message:e});aN.push(t)}},{key:"reportLongString",value:function(e,t){var r=Zl(Zl({event_key:"rtc_invoke_status",sdk_api_name:"sdk_long_string_".concat(e),rtc_timestamp:Date.now()},this.modifyIds),{},{message:t});ID.push(r)}},{key:"set",value:function(e){this.modifyIds=IT(this.modifyIds,e)}},{key:"destroy",value:function(){}}]),e}(),MD=function(){function e(t){Bh(this,e),Jl(this,"_preTime",Date.now()),Jl(this,"_one2oneNum",0),Jl(this,"_one2manyNum",0),Jl(this,"_one2oneMsgCache",new uT),Jl(this,"_one2manyMsgCache",new uT),Jl(this,"roomId",""),Jl(this,"userId",""),Jl(this,"rtsSessionId",""),Jl(this,"logger",void 0),this.id=t,this.logger=new lN("MessageReportor",1)}return Fh(e,[{key:"needReport",value:function(t){return!!e.config&&(Date.now()-this._preTime>=36e5&&(this._preTime=Date.now(),this._one2oneNum=0,this._one2manyNum=0),"one2one"===t&&this._one2oneNum<e.config.max_one2one_fpt_per_hour&&Math.random()<=e.config.one2one_fpt_ratio/100||"one2many"===t&&this._one2manyNum<e.config.max_one2many_fpt_per_hour&&Math.random()<=e.config.one2many_fpt_ratio/100)}},{key:"cacheP2PMsg",value:function(t){var r;this._one2oneMsgCache.set(t.msg_id,Zl({config_version:(null===(r=e.config)||void 0===r?void 0:r.version)||""},t))}},{key:"updateP2PMsg",value:function(e,t){var r=this._one2oneMsgCache.get(e);r&&this._one2oneMsgCache.set(e,Zl(Zl({},r),t))}},{key:"cacheCustomMsg",value:function(t){var r;this._one2manyMsgCache.set(t.msg_id,Zl({config_version:(null===(r=e.config)||void 0===r?void 0:r.version)||""},t))}},{key:"updateOne2ManyMsg",value:function(e,t){var r=this._one2manyMsgCache.get(e);r&&this._one2manyMsgCache.set(e,Zl(Zl({},r),t))}},{key:"reportP2PMsg",value:function(e){var t,r=this._one2oneMsgCache.get(e);r&&(this.logger.info("reportP2PMsg",r.type,zg(r)),null===(t=KD(this.id))||void 0===t||t.report("rts_message",r))}},{key:"reportOne2ManyMsg",value:function(e){var t,r=this._one2manyMsgCache.get(e);r&&(this.logger.info("reportOne2ManyMsg",r.type,zg(r)),null===(t=KD(this.id))||void 0===t||t.report("rts_message",r))}},{key:"reportMsgRecv",value:function(t){var r,n;t.config_version=(null===(r=e.config)||void 0===r?void 0:r.version)||"",this.logger.info("reportMsgRecv",t.type,zg(t)),null===(n=KD(this.id))||void 0===n||n.report("rts_message",t)}},{key:"destroy",value:function(){this._one2manyNum=0,this._one2oneNum=0,this._one2manyMsgCache.clear(),this._one2oneMsgCache.clear(),this._preTime=Date.now(),this.roomId="",this.userId="",this.rtsSessionId=""}}]),e}();Jl(MD,"config",void 0);var DD=new uT,ND={_cache:DD,setConfig:function(e){new lN("MessageReportor",1).info("setConfig","get config: ".concat(zg(e))),MD.config=e},setRtsSessionId:function(e,t){var r=DD.get(e);r&&(r.rtsSessionId=t)},createRTSMsgReportor:function(e){var t=DD.get(e)||new MD(e);return DD.set(e,t),t},destroyRTSMsgReportor:function(e){var t=DD.get(e);t&&(t.destroy(),DD.delete(e))},setRoomId:function(e,t){var r=DD.get(e);r&&(r.roomId=t||"")},setUserId:function(e,t){var r=DD.get(e);r&&(r.userId=t||"")},samplingP2PMsg:function(e,t){var r=DD.get(e);if(null!=r&&r.needReport("one2one")){var n,i=Bg(n="".concat(t.from)).call(n,t.id),o=t.to?"one2one":"one2server";t.enable_report=!0,t.report_msg_id=t.id,r.cacheP2PMsg({rts_session_id:r.rtsSessionId,msg_id:i,node_role:"src_sdk",from:t.from,to:t.to||"server",type:o,rts_room_id:t.room,req_ts:Date.now(),send_ts:Date.now(),ack_ts:Date.now(),msg_size:0,error_code:0,recv_msg_ts:0,fwd_msg_ts:0,reply_ack_ts:0,cur_dst_uid:""})}return t},updateP2PMsgReq:function(e,t,r){var n,i;t.enable_report&&fx(t.report_msg_id)&&(null===(n=DD.get(e))||void 0===n||n.updateP2PMsg(Bg(i="".concat(t.from)).call(i,t.report_msg_id),{send_ts:Date.now(),msg_size:r}))},updateP2PMsgAck:function(e,t,r){if(t.enable_report&&fx(t.report_msg_id)){var n,i,o=DD.get(e);null==o||o.updateP2PMsg(Bg(n="".concat(t.from)).call(n,t.report_msg_id),{ack_ts:Date.now(),error_code:r}),null==o||o.reportP2PMsg(Bg(i="".concat(t.from)).call(i,t.report_msg_id))}},samplingOne2ManyMsg:function(e,t,r){var n,i=DD.get(e);null!=i&&i.needReport("one2many")&&(r.enable_report=!0,r.report_msg_id=t,i.cacheCustomMsg({rts_session_id:i.rtsSessionId,msg_id:Bg(n="".concat(r.clientId)).call(n,t),node_role:"src_sdk",from:r.clientId,to:i.roomId,type:"one2many",rts_room_id:i.roomId,req_ts:Date.now(),send_ts:Date.now(),ack_ts:Date.now(),msg_size:0,error_code:0,recv_msg_ts:0,fwd_msg_ts:0,reply_ack_ts:0,cur_dst_uid:""}));return r},reportP2PMsgRecv:function(e,t,r){if(t.enable_report&&fx(t.report_msg_id)){var n,i=DD.get(e),o=t.to?"one2one":"one2many";null==i||i.reportMsgRecv({rts_session_id:i.rtsSessionId,msg_id:Bg(n="".concat(t.from)).call(n,t.report_msg_id),msg_size:r.msg_size,node_role:"dst_sdk",type:o,rts_room_id:t.room,from:t.from,to:t.to||t.room,error_code:0,recv_msg_ts:r.recv_msg_ts,fwd_msg_ts:r.fwd_msg_ts,reply_ack_ts:Date.now(),cur_dst_uid:t.to?"":i.userId,config_version:"",req_ts:0,send_ts:0,ack_ts:0})}},updateOne2ManyMsgAck:function(e,t,r){if(t.enable_report&&fx(t.report_msg_id)){var n,i,o=DD.get(e);if(o)null==o||o.updateOne2ManyMsg(Bg(n="".concat(t.clientId)).call(n,t.report_msg_id),{ack_ts:Date.now(),error_code:r}),null==o||o.reportOne2ManyMsg(Bg(i="".concat(t.clientId)).call(i,t.report_msg_id))}},updateOne2ManyMsgReq:function(e,t,r){if(t.enable_report&&fx(t.report_msg_id)){var n,i=DD.get(e);if(i)i.updateOne2ManyMsg(Bg(n="".concat(t.clientId)).call(n,t.report_msg_id),{send_ts:Date.now(),msg_size:r})}},reportOne2ManyMsgRecv:function(e,t,r){if(t.enable_report&&fx(t.report_msg_id)){var n,i=DD.get(e);null==i||i.reportMsgRecv({rts_session_id:i.rtsSessionId,msg_id:Bg(n="".concat(t.clientId)).call(n,t.report_msg_id),msg_size:r.msg_size,node_role:"dst_sdk",type:"one2many",rts_room_id:t.roomId,from:t.clientId,to:t.roomId,error_code:0,recv_msg_ts:r.recv_msg_ts,fwd_msg_ts:r.fwd_msg_ts,reply_ack_ts:Date.now(),cur_dst_uid:i.userId,config_version:"",req_ts:0,send_ts:0,ack_ts:0})}}},LD=function(){function e(t){Bh(this,e),Jl(this,"_timer",void 0),Jl(this,"userMessage",{}),Jl(this,"roomMessage",{}),this.id=t,this._setTimer()}return Fh(e,[{key:"_setTimer",value:function(){var e=this;!function t(){e._reportAndgReset(),clearTimeout(e._timer),e._timer=setTimeout(t,1e4)}()}},{key:"_reportAndgReset",value:function(){(LS(this.userMessage).length||LS(this.roomMessage).length)&&(this._report(),this._reset())}},{key:"_report",value:function(){var e,t,r,n=this;null===(e=KD(this.id))||void 0===e||e.report("rtc_message_statistics",{dc_user_message:Jg(t=LS(this.userMessage)).call(t,(function(e){return n.userMessage[e]})),dc_room_message:Jg(r=LS(this.roomMessage)).call(r,(function(e){return n.roomMessage[e]})),media_server_ip:""})}},{key:"_reset",value:function(){this.userMessage={},this.roomMessage={}}},{key:"_checkInitUserMessage",value:function(e,t){var r,n;this.userMessage[Bg(r="".concat(t,"-")).call(r,e)]||(this.userMessage[Bg(n="".concat(t,"-")).call(n,e)]={dc_peer_user_id:e,dc_send_total:0,dc_recv_total:0,dc_send_ack:0,dc_send_fail:0,dc_fail_timeout:0,dc_fail_no_receiver:0,dc_fail_no_relay_path:0,dc_cost_time:0,dc_cost_e2s:0,dc_cost_s2s:0,dc_least_time:Number(1/0),dc_most_time:0,dc_cost_peer_s2e:0,dc_send_ack_100:0,dc_send_ack_200:0,dc_send_ack_400:0,dc_send_ack_1s:0,dc_message_type:t,dc_send_binary:0})}},{key:"_sendUserMessage",value:function(e,t,r){var n,i;(this._checkInitUserMessage(e,t),this.userMessage[Bg(n="".concat(t,"-")).call(n,e)].dc_send_total++,r)&&this.userMessage[Bg(i="".concat(t,"-")).call(i,e)].dc_send_binary++}},{key:"_recvUserMessage",value:function(e,t){var r;this._checkInitUserMessage(e,t),this.userMessage[Bg(r="".concat(t,"-")).call(r,e)].dc_recv_total++}},{key:"_sendUserFail",value:function(e,t,r){var n,i=this.userMessage[Bg(n="".concat(t,"-")).call(n,e)];i&&(i.dc_send_fail++,this._handleUserFail(i,r))}},{key:"_handleUserFail",value:function(e,t){var r;t&&(t.code||t.err)&&(qy(r=["TIME_OUT","USER_MESSAGE_TIMEOUT"]).call(r,t.code)?e.dc_fail_timeout++:3===t.err?e.dc_fail_no_receiver++:4===t.err?e.dc_fail_no_relay_path++:1===t.err&&e.dc_fail_timeout++)}},{key:"_sendUserAck",value:function(e,t,r,n,i){var o,a=this.userMessage[Bg(o="".concat(t,"-")).call(o,e)];a&&(a.dc_send_ack++,a.dc_cost_time+=r,a.dc_cost_s2s+=n||0,a.dc_cost_peer_s2e+=i,a.dc_cost_e2s+=r-(n||0)-i,r<=100?(a.dc_send_ack_100++,a.dc_send_ack_200++,a.dc_send_ack_400++,a.dc_send_ack_1s++):r<=200?(a.dc_send_ack_200++,a.dc_send_ack_400++,a.dc_send_ack_1s++):r<=400?(a.dc_send_ack_400++,a.dc_send_ack_1s++):r<=1e3&&a.dc_send_ack_1s++,r<a.dc_least_time&&(a.dc_least_time=r),r>a.dc_most_time&&(a.dc_most_time=r))}},{key:"sendRoomMessage",value:function(e,t){this.roomMessage[e]||(this.roomMessage[e]={dc_room_id:e,dc_send_total:0,dc_send_ack:0,dc_cost_time:0,dc_least_time:Number(1/0),dc_most_time:0,dc_send_fail:0,dc_send_ack_100:0,dc_send_ack_200:0,dc_send_ack_400:0,dc_send_ack_1s:0,dc_send_binary:0}),this.roomMessage[e].dc_send_total++,t&&this.roomMessage[e].dc_send_binary++}},{key:"sendRoomFail",value:function(e){var t=this.roomMessage[e];t&&t.dc_send_fail++}},{key:"sendRoomAck",value:function(e,t){var r=this.roomMessage[e];r&&(r.dc_send_ack++,r.dc_cost_time+=t,t<r.dc_least_time&&(r.dc_least_time=t),t>r.dc_most_time&&(r.dc_most_time=t),t<=100?(r.dc_send_ack_100++,r.dc_send_ack_200++,r.dc_send_ack_400++,r.dc_send_ack_1s++):t<=200?(r.dc_send_ack_200++,r.dc_send_ack_400++,r.dc_send_ack_1s++):t<=400?(r.dc_send_ack_400++,r.dc_send_ack_1s++):t<=1e3&&r.dc_send_ack_1s++)}},{key:"sendP2PMessage",value:function(e,t){this._sendUserMessage(e,"p2p",t)}},{key:"recvP2PMessage",value:function(e){this._recvUserMessage(e,"p2p")}},{key:"sendP2PFail",value:function(e,t){this._sendUserFail(e,"p2p",t)}},{key:"sendP2PAck",value:function(e,t,r,n){this._sendUserAck(e,"p2p",t,r,n)}},{key:"sendP2POutRoomMessage",value:function(e,t){this._sendUserMessage(e,"p2p_outside_room",t)}},{key:"recvP2POutRoomMessage",value:function(e){this._recvUserMessage(e,"p2p_outside_room")}},{key:"sendP2POutRoomFail",value:function(e,t){this._sendUserFail(e,"p2p_outside_room",t)}},{key:"sendP2POutRoomAck",value:function(e,t,r,n){this._sendUserAck(e,"p2p_outside_room",t,r,n)}},{key:"sendP2serverMessage",value:function(e){this._sendUserMessage("","p2server",e)}},{key:"sendP2serverFail",value:function(e){this._sendUserFail("","p2server",e)}},{key:"sendP2serveAck",value:function(e,t,r){this._sendUserAck("","p2server",e,t,r)}},{key:"countP2PMessage",value:function(e,t,r,n,i){this.sendP2PMessage(t,r),e?this.sendP2PAck(t,Date.now()-n,i.s2s_time,i.s2e_time):this.sendP2PFail(t,i)}},{key:"countRoomMessage",value:function(e,t,r,n){this.sendRoomMessage(t,r),e?this.sendRoomAck(t,Date.now()-n):this.sendRoomFail(t)}},{key:"countUserMessageOutsideRoom",value:function(e,t,r,n,i){this.sendP2POutRoomMessage(t,r),e?this.sendP2POutRoomAck(t,Date.now()-n,i.s2s_time,i.s2e_time):this.sendP2POutRoomFail(t,i)}},{key:"countServerMessage",value:function(e,t,r,n){this.sendP2serverMessage(t),e?(n=n||{},this.sendP2serveAck(Date.now()-r,n.s2s_time||0,n.s2e_time||0)):this.sendP2serverFail(n)}},{key:"destroy",value:function(){this._reset(),clearTimeout(this._timer)}}]),e}(),UD=function(e){OD.setCommonStats(e)},VD=function(e){OD.setUrl(e)},FD=new PD("global"),BD=function(e,t,r){FD.report("rtc_sdk_api_call",{sdk_api_name:e,error_code:t,message:r})},jD=function(e,t,r){FD.report("rtc_sdk_callback",{sdk_callback_name:e,error_code:t,message:r})},HD=function(e,t,r){FD.report("rtc_error",{message:e,error_code:t},r)},GD=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0;FD.report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:r,stream_id:n,elapse:0},i)};var zD=new uT,KD=function(e){return zD.get(e)},WD=function(e,t){var r=new PD(e);return r.set(Zl(Zl({},t),{},{engine_session_id:vx()})),r.report("sdk_init_engine",{start:Date.now(),type:"begin"}),zD.set(e,r),r};function XD(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e,r,n){if("function"==typeof n.value){var i=n.value;n.value=function(){for(var e,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];var s,c,u=this.engineId||this.id,d={};(t.forEach((function(e,t){d[e]=o[t]})),"joinRoom"===r)&&(null===(s=KD(u))||void 0===s||s.set({room_id:o[1],user_id:null===(c=o[2])||void 0===c?void 0:c.userId}));null===(e=KD(u))||void 0===e||e.report("rtc_sdk_api_call",{sdk_api_name:r,message:zg(ZD(o)),error_code:0},d);var l=i.apply(this,o);return"function"==typeof(null==l?void 0:l.then)?l.then((function(e){return YD(u,r,[e||{}]),e})).catch((function(e){throw YD(u,r,e.message,e.code),e})):(YD(u,r,[l||{}]),l)}}}}var qD,YD=function(e,t,r){var n,i=arguments.length>4?arguments[4]:void 0,o={sdk_callback_name:t,error_code:arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,message:zg(Array.isArray(r)?ZD(r):r)};i&&(o.room_id=i),null===(n=KD(e))||void 0===n||n.report("rtc_sdk_callback",o)},JD=function(e,t,r){var n,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5?arguments[5]:void 0;null===(n=KD(e))||void 0===n||n.report("rtc_invoke_status",{sdk_api_name:t,message:r,error_code:i,stream_id:o,elapse:0},a)},QD=10;function ZD(e){return Jg(e).call(e,(function e(t){var r;if(null!=t&&t._reportName)return t._reportName;if(t instanceof HTMLElement)return t.toString();if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){var n,i,o=ArrayBuffer.isView(t)?t.buffer:t,a=o.byteLength,s=[];if(a>QD){var c,u,d,l,h,p=new DataView(o),v=Jg(c=WC({length:QD/2})).call(c,(function(e,t){return p.getUint8(t)})),f=Jg(u=XC(d=Jg(l=WC({length:QD/2})).call(l,(function(e,t){return a-1-t}))).call(d)).call(u,(function(e){return p.getUint8(e)}));s=Bg(h=[]).call(h,rR(v),["..."],rR(f))}else s=WC(new Uint8Array(o));return Bg(n=Bg(i="".concat(t.constructor.name,"(")).call(i,a,") [")).call(n,s.join(", "),"]")}if(t instanceof ImageData)return"ImageData";if(Array.isArray(t))return Jg(t).call(t,e);if(qy(r=["[object Object]","[object MediaStreamTrack]"]).call(r,Object.prototype.toString.call(t))){var _={};for(var m in t)_[m]=e(t[m]);return _}return t}))}var $D="undefined"!=typeof window&&qy(qD=window.location.search).call(qD,"_rtc_upload_console_"),eN=function(){function e(){var t=this;Bh(this,e),Jl(this,"name","ConsoleReportor"),Jl(this,"_uuid","".concat(Math.floor(899*Math.random())+100)),Jl(this,"_consoleReportId",0),Jl(this,"_engineReportIdMap",new uT),Jl(this,"_enabled","NULL"),Jl(this,"_consoleCutLength",Nx.getParameter("UPLOAD_CONSOLE_LENGTH_CUT")),Jl(this,"buffer",[]),$D&&setTimeout((function(){t.switchOn()}),0),Nx.on("UPLOAD_CONSOLE_ON",(function(e){e?t.switchOn():t.turnOff()})),Nx.on("UPLOAD_CONSOLE_LENGTH_CUT",(function(e){t._consoleCutLength=e}))}return Fh(e,[{key:"enabled",get:function(){return"OFF"!==this._enabled}},{key:"switchOn",value:function(){"NULL"===this._enabled&&(console.log("[LoggerReportor.constructor] console upload switch ON"),this._enabled="ON")}},{key:"turnOff",value:function(){"NULL"===this._enabled&&(console.log("[LoggerReportor.constructor] console upload switch OFF"),this._enabled="OFF",this.buffer=[])}},{key:"getEngineConsoleId",value:function(e){var t,r=null!==(t=this._engineReportIdMap.get(e))&&void 0!==t?t:0;return this._engineReportIdMap.set(e,r+1),r}},{key:"report",value:function(e,t,r,n,i,o,a,s,c){var u,d,l,h,p,v,f,_,m,g,y,S=this;if("OFF"!==this._enabled){var b,k=KD(t),E=this._consoleReportId++,T=this.getEngineConsoleId(t),I=tN(c,this._consoleCutLength),R=rR(c),A="".concat(s).replace(/%o|%s/gi,(function(){return tN([R.shift()],S._consoleCutLength)})),w=Bg(u=Bg(d=Bg(l=Bg(h=Bg(p=Bg(v=Bg(f=Bg(_=Bg(m=Bg(g=Bg(y="[".concat(this._uuid,"-")).call(y,E,"][")).call(g,t,"-")).call(m,T,"]-")).call(_,r,"-")).call(f,e,"[")).call(v,n,"]")).call(p,i,"[")).call(h,o,".")).call(l,a,"] ")).call(d,A," ")).call(u,I);k?k.reportLog(w):(b=w,FD.reportLog(b))}}},{key:"push",value:function(e){"OFF"!==this._enabled&&this.buffer.push(e)}},{key:"splice",value:function(e){var t;if("ON"!==this._enabled)return{payload:[],payloadSize:0};var r=function(e,t){for(var r=0,n=0;n<e.length;n++){var i=zg(e[n]).length;if((r+=i)>t)return{index:n,size:r-i}}return{index:e.length,size:r}}(this.buffer,e),n=r.index,i=r.size;return{payload:jI(t=this.buffer).call(t,0,n),payloadSize:i}}},{key:"unshift",value:function(e){this.buffer=Bg(e).call(e,this.buffer)}},{key:"get",value:function(){return this.buffer}},{key:"set",value:function(e){this.buffer=Bg(e).call(e,this.buffer)}},{key:"isEmpty",value:function(){return"OFF"===this._enabled||0===this.buffer.length}}]),e}();function tN(e,t){return Jg(e).call(e,(function(e){var r="";try{if("string"==typeof e)return e;if(void 0===e)return"undefined";if(null===e)return"null";if(e instanceof MediaStreamTrack)return mx(e);if(e instanceof MediaStream)return gx(e);if(e instanceof RTCRtpSender)return yx(e);if(e instanceof RTCRtpReceiver)return Sx(e);if(e instanceof RTCRtpTransceiver)return bx(e);r=zg(e)}catch(n){r=e.toString()}return r&&r.length>=t&&(r=cI(r).call(r,0,t)),r})).join(", ")}var rN,nN,iN,oN,aN=new eN,sN="[VERTC]",cN="#0050b3",uN=(Jl(rN={},"DEBUG","rgba(0, 0, 0, 0)"),Jl(rN," INFO","rgba(93, 173, 226, 0)"),Jl(rN," WARN","rgba(255, 119, 0, 0.3)"),Jl(rN,"ERROR","rgba(255, 0, 0, 0.3)"),Jl(rN," SUCC","rgba(0, 119, 0, 0.3)"),rN),dN="undefined"!=typeof window&&(qy(nN=window.location.search).call(nN,"_rtc_debug_")||(null===(iN=window.localStorage)||void 0===iN?void 0:iN.getItem("_rtc_debug_"))),lN=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"global";Bh(this,e),Jl(this,"indent",void 0),Jl(this,"module",void 0),Jl(this,"_engineId",void 0),this.module=t,this.indent=r,this._engineId=n}return Fh(e,[{key:"_print",value:function(e,t){for(var r,n,i,o,a,s,c,u,d=arguments.length,l=new Array(d>2?d-2:0),h=2;h<d;h++)l[h-2]=arguments[h];var p=l.shift();try{var v,f,_,m,g=Bg(v=[]).call(v,l),y="".concat(p).replace(/%o/gi,(function(){var e=g.shift();return zg(e)}));Ix.set(Bg(f=Bg(_=Bg(m="".concat(sN,"[").concat(this.module,".")).call(m,t,"] ")).call(_,y," ")).call(f,Jg(g).call(g,(function(e){return zg(e)})).join(", ")))}catch(Y$){}for(var S="",b=0;b<this.indent;b++)S+="    ";var k=hN();aN.report(sN,this._engineId,k,e,S,this.module,t,p,l),dN&&(r=console).log.apply(r,Bg(n=[Bg(i=Bg(o=Bg(a=Bg(s=Bg(c=Bg(u="%c".concat(k,"-")).call(u,sN,"%c[")).call(c,e,"]%c")).call(s,S,"[")).call(a,this.module,".")).call(o,t,"] ")).call(i,p),"color:".concat(cN,";"),"background-color:".concat(uN[e],";"),"color:".concat(cN,";")]).call(n,l))}},{key:"print",value:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this._print.apply(this,Bg(t=[" INFO",e]).call(t,n))}},{key:"debug",value:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this._print.apply(this,Bg(t=["DEBUG",e]).call(t,n))}},{key:"info",value:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this._print.apply(this,Bg(t=[" INFO",e]).call(t,n))}},{key:"warn",value:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this._print.apply(this,Bg(t=[" WARN",e]).call(t,n))}},{key:"error",value:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this._print.apply(this,Bg(t=["ERROR",e]).call(t,n))}},{key:"success",value:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this._print.apply(this,Bg(t=[" SUCC",e]).call(t,n))}}]),e}(),hN=function(){var e,t,r=new Date;return Bg(e="".concat(r.toTimeString().split(" ")[0],":")).call(e,Ox(t=r.getMilliseconds().toString()).call(t,3,"0"))},pN=function(e){var t,r=KD(e.engineId),n={keys:ox(e),labelSelector:"",sdkVersion:e.sdkVersion,deviceType:"web",appId:e.appId,deviceId:e.deviceId,userAgent:"undefined"!=typeof navigator?navigator.userAgent:void 0},i=Jg(t=e.requestDomains).call(t,(function(e){return"https://".concat(e,"/decision/v1/multi")}));null==r||r.report("rtc_get_config",{error_code:0,message:zg(n),elapse:0,host:i.join(","),type:"request",config_id:"",enable_cloud_proxy:!1});var o=Jg(i).call(i,function(){var e=Ng(Mg().mark((function e(t,r){var i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"POST",body:zg(n)}).then((function(e){return e.json()}));case 2:return i=e.sent,e.abrupt("return",{result:i,index:r});case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}());return new HI((function(e){(function(e){return new HI((function(t,r){var n=(e=Array.isArray(e)?e:[]).length,i=[];0===n?r([]):e.forEach((function(e){e.then((function(e){t(e)}),(function(e){n--,i.push(e),0===n&&r(i)}))}))}))})(o).then((function(t){var n=t.result,o=t.index;null==r||r.report("rtc_get_config",{error_code:200,message:zg(n),elapse:0,host:i[o],type:"response",config_id:"",enable_cloud_proxy:!1}),e(n)})).catch((function(e){var t;null==r||r.report("rtc_get_config",{error_code:500,message:null===(t=e[0])||void 0===t?void 0:t.message,elapse:0,host:"",type:"response",config_id:"",enable_cloud_proxy:!1})}))}))},vN=new Uint8Array(16);function fN(){if(!oN&&!(oN="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return oN(vN)}for(var _N=[],mN=0;mN<256;++mN){var gN;_N.push(cI(gN=(mN+256).toString(16)).call(gN,1))}var yN={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function SN(e,t,r){if(yN.randomUUID&&!t&&!e)return yN.randomUUID();var n=(e=e||{}).random||(e.rng||fN)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(_N[e[t+0]]+_N[e[t+1]]+_N[e[t+2]]+_N[e[t+3]]+"-"+_N[e[t+4]]+_N[e[t+5]]+"-"+_N[e[t+6]]+_N[e[t+7]]+"-"+_N[e[t+8]]+_N[e[t+9]]+"-"+_N[e[t+10]]+_N[e[t+11]]+_N[e[t+12]]+_N[e[t+13]]+_N[e[t+14]]+_N[e[t+15]]).toLowerCase()}(n)}var bN={exports:{}},kN=o;Cr({global:!0,forced:kN.globalThis!==kN},{globalThis:kN});var EN=r(o);var TN,IN={exports:{}},RN=new Proxy({},{get(e,t){throw new Error(`Module "" has been externalized for browser compatibility. Cannot access ".${t}" in client code.  See http://vitejs.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)}}),AN=n(Object.freeze({__proto__:null,default:RN}));function wN(){return TN||(TN=1,function(e,r){var n;e.exports=(n=n||function(e,r){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),void 0!==EN&&EN.crypto&&(n=EN.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==t&&t.crypto&&(n=t.crypto),!n)try{n=AN}catch(J$){}var i=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(J$){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(J$){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),a={},s=a.lib={},c=s.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},u=s.WordArray=c.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=t!=r?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var a=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=a<<24-(n+o)%4*8}else for(var s=0;s<i;s+=4)t[n+s>>>2]=r[s>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e,t=c.clone.call(this);return t.words=cI(e=this.words).call(e,0),t},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(i());return new u.init(t,e)}}),d=a.enc={},l=d.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=_b(e.substr(n,2),16)<<24-n%8*4;return new u.init(r,t/2)}},h=d.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new u.init(r,t)}},p=d.Utf8={stringify:function(e){try{return decodeURIComponent(escape(h.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return h.parse(unescape(encodeURIComponent(e)))}},v=s.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(e){var t;"string"==typeof e&&(e=p.parse(e)),Bg(t=this._data).call(t,e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,i=n.words,o=n.sigBytes,a=this.blockSize,s=o/(4*a),c=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,d=e.min(4*c,o);if(c){for(var l=0;l<c;l+=a)this._doProcessBlock(i,l);r=jI(i).call(i,0,c),n.sigBytes-=d}return new u.init(r,d)},clone:function(){var e=c.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});s.Hasher=v.extend({cfg:c.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){v.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new f.HMAC.init(e,r).finalize(t)}}});var f=a.algo={};return a}(Math),n)}(IN)),IN.exports}!function(e,t){var r;e.exports=(r=wN(),function(){if("function"==typeof ArrayBuffer){var e=r.lib.WordArray,t=e.init,n=e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var r=e.byteLength,n=[],i=0;i<r;i++)n[i>>>2]|=e[i]<<24-i%4*8;t.call(this,n,r)}else t.apply(this,arguments)};n.prototype=e}}(),r.lib.WordArray)}(bN);var CN,xN=r(bN.exports),ON={exports:{}},PN={exports:{}};function MN(){return CN||(CN=1,function(e,t){var r;e.exports=(r=wN(),function(){var e=r,t=e.lib.WordArray;function n(e,r,n){for(var i=[],o=0,a=0;a<r;a++)if(a%4){var s=n[e.charCodeAt(a-1)]<<a%4*2|n[e.charCodeAt(a)]>>>6-a%4*2;i[o>>>2]|=s<<24-o%4*8,o++}return t.create(i,o)}e.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],o=0;o<r;o+=3)for(var a=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,s=0;s<4&&o+.75*s<r;s++)i.push(n.charAt(a>>>6*(3-s)&63));var c=n.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,r=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var o=0;o<r.length;o++)i[r.charCodeAt(o)]=o}var a=r.charAt(64);if(a){var s=SI(e).call(e,a);-1!==s&&(t=s)}return n(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),r.enc.Base64)}(PN)),PN.exports}var DN,NN={exports:{}};function LN(){return DN||(DN=1,function(e,t){var r;e.exports=(r=wN(),function(e){var t=r,n=t.lib,i=n.WordArray,o=n.Hasher,a=t.algo,s=[];!function(){for(var t=0;t<64;t++)s[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=a.MD5=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,i=e[n];e[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,a=e[t+0],c=e[t+1],p=e[t+2],v=e[t+3],f=e[t+4],_=e[t+5],m=e[t+6],g=e[t+7],y=e[t+8],S=e[t+9],b=e[t+10],k=e[t+11],E=e[t+12],T=e[t+13],I=e[t+14],R=e[t+15],A=o[0],w=o[1],C=o[2],x=o[3];A=u(A,w,C,x,a,7,s[0]),x=u(x,A,w,C,c,12,s[1]),C=u(C,x,A,w,p,17,s[2]),w=u(w,C,x,A,v,22,s[3]),A=u(A,w,C,x,f,7,s[4]),x=u(x,A,w,C,_,12,s[5]),C=u(C,x,A,w,m,17,s[6]),w=u(w,C,x,A,g,22,s[7]),A=u(A,w,C,x,y,7,s[8]),x=u(x,A,w,C,S,12,s[9]),C=u(C,x,A,w,b,17,s[10]),w=u(w,C,x,A,k,22,s[11]),A=u(A,w,C,x,E,7,s[12]),x=u(x,A,w,C,T,12,s[13]),C=u(C,x,A,w,I,17,s[14]),A=d(A,w=u(w,C,x,A,R,22,s[15]),C,x,c,5,s[16]),x=d(x,A,w,C,m,9,s[17]),C=d(C,x,A,w,k,14,s[18]),w=d(w,C,x,A,a,20,s[19]),A=d(A,w,C,x,_,5,s[20]),x=d(x,A,w,C,b,9,s[21]),C=d(C,x,A,w,R,14,s[22]),w=d(w,C,x,A,f,20,s[23]),A=d(A,w,C,x,S,5,s[24]),x=d(x,A,w,C,I,9,s[25]),C=d(C,x,A,w,v,14,s[26]),w=d(w,C,x,A,y,20,s[27]),A=d(A,w,C,x,T,5,s[28]),x=d(x,A,w,C,p,9,s[29]),C=d(C,x,A,w,g,14,s[30]),A=l(A,w=d(w,C,x,A,E,20,s[31]),C,x,_,4,s[32]),x=l(x,A,w,C,y,11,s[33]),C=l(C,x,A,w,k,16,s[34]),w=l(w,C,x,A,I,23,s[35]),A=l(A,w,C,x,c,4,s[36]),x=l(x,A,w,C,f,11,s[37]),C=l(C,x,A,w,g,16,s[38]),w=l(w,C,x,A,b,23,s[39]),A=l(A,w,C,x,T,4,s[40]),x=l(x,A,w,C,a,11,s[41]),C=l(C,x,A,w,v,16,s[42]),w=l(w,C,x,A,m,23,s[43]),A=l(A,w,C,x,S,4,s[44]),x=l(x,A,w,C,E,11,s[45]),C=l(C,x,A,w,R,16,s[46]),A=h(A,w=l(w,C,x,A,p,23,s[47]),C,x,a,6,s[48]),x=h(x,A,w,C,g,10,s[49]),C=h(C,x,A,w,I,15,s[50]),w=h(w,C,x,A,_,21,s[51]),A=h(A,w,C,x,E,6,s[52]),x=h(x,A,w,C,v,10,s[53]),C=h(C,x,A,w,b,15,s[54]),w=h(w,C,x,A,c,21,s[55]),A=h(A,w,C,x,y,6,s[56]),x=h(x,A,w,C,R,10,s[57]),C=h(C,x,A,w,m,15,s[58]),w=h(w,C,x,A,T,21,s[59]),A=h(A,w,C,x,f,6,s[60]),x=h(x,A,w,C,k,10,s[61]),C=h(C,x,A,w,p,15,s[62]),w=h(w,C,x,A,S,21,s[63]),o[0]=o[0]+A|0,o[1]=o[1]+w|0,o[2]=o[2]+C|0,o[3]=o[3]+x|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;r[i>>>5]|=128<<24-i%32;var o=e.floor(n/4294967296),a=n;r[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r[14+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(r.length+1),this._process();for(var s=this._hash,c=s.words,u=0;u<4;u++){var d=c[u];c[u]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)}return s},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,r,n,i,o,a){var s=e+(t&r|~t&n)+i+a;return(s<<o|s>>>32-o)+t}function d(e,t,r,n,i,o,a){var s=e+(t&n|r&~n)+i+a;return(s<<o|s>>>32-o)+t}function l(e,t,r,n,i,o,a){var s=e+(t^r^n)+i+a;return(s<<o|s>>>32-o)+t}function h(e,t,r,n,i,o,a){var s=e+(r^(t|~n))+i+a;return(s<<o|s>>>32-o)+t}t.MD5=o._createHelper(c),t.HmacMD5=o._createHmacHelper(c)}(Math),r.MD5)}(NN)),NN.exports}var UN,VN={exports:{}},FN={exports:{}};function BN(){return UN||(UN=1,function(e,t){var r,n,i,o,a,s,c,u;e.exports=(u=wN(),n=(r=u).lib,i=n.WordArray,o=n.Hasher,a=r.algo,s=[],c=a.SHA1=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],a=r[3],c=r[4],u=0;u<80;u++){if(u<16)s[u]=0|e[t+u];else{var d=s[u-3]^s[u-8]^s[u-14]^s[u-16];s[u]=d<<1|d>>>31}var l=(n<<5|n>>>27)+c+s[u];l+=u<20?1518500249+(i&o|~i&a):u<40?1859775393+(i^o^a):u<60?(i&o|i&a|o&a)-1894007588:(i^o^a)-899497514,c=a,a=o,o=i<<30|i>>>2,i=n,n=l}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+a|0,r[4]=r[4]+c|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}}),r.SHA1=o._createHelper(c),r.HmacSHA1=o._createHmacHelper(c),u.SHA1)}(FN)),FN.exports}var jN,HN,GN={exports:{}};function zN(){return jN||(jN=1,function(e,t){var r,n,i,o;e.exports=(r=wN(),i=(n=r).lib.Base,o=n.enc.Utf8,void(n.algo.HMAC=i.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=o.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),a=this._iKey=t.clone(),s=i.words,c=a.words,u=0;u<r;u++)s[u]^=1549556828,c[u]^=909522486;i.sigBytes=a.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t,r=this._hasher,n=r.finalize(e);return r.reset(),r.finalize(Bg(t=this._oKey.clone()).call(t,n))}})))}(GN)),GN.exports}function KN(){return HN||(HN=1,function(e,t){var r,n,i,o,a,s,c,u;e.exports=(u=wN(),BN(),zN(),n=(r=u).lib,i=n.Base,o=n.WordArray,a=r.algo,s=a.MD5,c=a.EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:s,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,n=this.cfg,i=n.hasher.create(),a=o.create(),s=a.words,c=n.keySize,u=n.iterations;s.length<c;){r&&i.update(r),r=i.update(e).finalize(t),i.reset();for(var d=1;d<u;d++)r=i.finalize(r),i.reset();Bg(a).call(a,r)}return a.sigBytes=4*c,a}}),r.EvpKDF=function(e,t,r){return c.create(r).compute(e,t)},u.EvpKDF)}(VN)),VN.exports}var WN,XN={exports:{}};function qN(){return WN||(WN=1,function(e,t){var r;e.exports=(r=wN(),KN(),void(r.lib.Cipher||function(e){var t=r,n=t.lib,i=n.Base,o=n.WordArray,a=n.BufferedBlockAlgorithm,s=t.enc;s.Utf8;var c=s.Base64,u=t.algo.EvpKDF,d=n.Cipher=a.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?y:m}return function(t){return{encrypt:function(r,n,i){return e(n).encrypt(t,r,n,i)},decrypt:function(r,n,i){return e(n).decrypt(t,r,n,i)}}}}()});n.StreamCipher=d.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var l=t.mode={},h=n.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),p=l.CBC=function(){var t=h.extend();function r(t,r,n){var i,o=this._iv;o?(i=o,this._iv=e):i=this._prevBlock;for(var a=0;a<n;a++)t[r+a]^=i[a]}return t.Encryptor=t.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize;r.call(this,e,t,i),n.encryptBlock(e,t),this._prevBlock=cI(e).call(e,t,t+i)}}),t.Decryptor=t.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,o=cI(e).call(e,t,t+i);n.decryptBlock(e,t),r.call(this,e,t,i),this._prevBlock=o}}),t}(),v=(t.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,i=n<<24|n<<16|n<<8|n,a=[],s=0;s<n;s+=4)a.push(i);var c=o.create(a,n);Bg(e).call(e,c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};n.BlockCipher=d.extend({cfg:d.cfg.extend({mode:p,padding:v}),reset:function(){var e;d.reset.call(this);var t=this.cfg,r=t.iv,n=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,r&&r.words):(this._mode=e.call(n,this,r&&r.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var f=n.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),_=(t.format={}).OpenSSL={stringify:function(e){var t,r,n=e.ciphertext,i=e.salt;return(i?Bg(t=Bg(r=o.create([1398893684,1701076831])).call(r,i)).call(t,n):n).toString(c)},parse:function(e){var t,r=c.parse(e),n=r.words;return 1398893684==n[0]&&1701076831==n[1]&&(t=o.create(cI(n).call(n,2,4)),jI(n).call(n,0,4),r.sigBytes-=16),f.create({ciphertext:r,salt:t})}},m=n.SerializableCipher=i.extend({cfg:i.extend({format:_}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var i=e.createEncryptor(r,n),o=i.finalize(t),a=i.cfg;return f.create({ciphertext:o,key:r,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),g=(t.kdf={}).OpenSSL={execute:function(e,t,r,n,i){var a;if(n||(n=o.random(8)),i)s=u.create({keySize:t+r,hasher:i}).compute(e,n);else var s=u.create({keySize:t+r}).compute(e,n);var c=o.create(cI(a=s.words).call(a,t),4*r);return s.sigBytes=4*t,f.create({key:s,iv:c,salt:n})}},y=n.PasswordBasedCipher=m.extend({cfg:m.cfg.extend({kdf:g}),encrypt:function(e,t,r,n){var i=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize,n.salt,n.hasher);n.iv=i.iv;var o=m.encrypt.call(this,e,t,i.key,n);return o.mixIn(i),o},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var i=n.kdf.execute(r,e.keySize,e.ivSize,t.salt,n.hasher);return n.iv=i.iv,m.decrypt.call(this,e,t,i.key,n)}})}()))}(XN)),XN.exports}!function(e,t){var r;e.exports=(r=wN(),MN(),LN(),KN(),qN(),function(){var e=r,t=e.lib.BlockCipher,n=e.algo,i=[],o=[],a=[],s=[],c=[],u=[],d=[],l=[],h=[],p=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,n=0;for(t=0;t<256;t++){var v=n^n<<1^n<<2^n<<3^n<<4;v=v>>>8^255&v^99,i[r]=v,o[v]=r;var f=e[r],_=e[f],m=e[_],g=257*e[v]^16843008*v;a[r]=g<<24|g>>>8,s[r]=g<<16|g>>>16,c[r]=g<<8|g>>>24,u[r]=g,g=16843009*m^65537*_^257*f^16843008*r,d[v]=g<<24|g>>>8,l[v]=g<<16|g>>>16,h[v]=g<<8|g>>>24,p[v]=g,r?(r=f^e[e[e[m^f]]],n^=e[e[n]]):r=n=1}}();var v=[0,1,2,4,8,16,32,64,128,27,54],f=n.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,n=4*((this._nRounds=r+6)+1),o=this._keySchedule=[],a=0;a<n;a++)a<r?o[a]=t[a]:(u=o[a-1],a%r?r>6&&a%r==4&&(u=i[u>>>24]<<24|i[u>>>16&255]<<16|i[u>>>8&255]<<8|i[255&u]):(u=i[(u=u<<8|u>>>24)>>>24]<<24|i[u>>>16&255]<<16|i[u>>>8&255]<<8|i[255&u],u^=v[a/r|0]<<24),o[a]=o[a-r]^u);for(var s=this._invKeySchedule=[],c=0;c<n;c++){if(a=n-c,c%4)var u=o[a];else u=o[a-4];s[c]=c<4||a<=4?u:d[i[u>>>24]]^l[i[u>>>16&255]]^h[i[u>>>8&255]]^p[i[255&u]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,s,c,u,i)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,d,l,h,p,o),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,i,o,a,s){for(var c=this._nRounds,u=e[t]^r[0],d=e[t+1]^r[1],l=e[t+2]^r[2],h=e[t+3]^r[3],p=4,v=1;v<c;v++){var f=n[u>>>24]^i[d>>>16&255]^o[l>>>8&255]^a[255&h]^r[p++],_=n[d>>>24]^i[l>>>16&255]^o[h>>>8&255]^a[255&u]^r[p++],m=n[l>>>24]^i[h>>>16&255]^o[u>>>8&255]^a[255&d]^r[p++],g=n[h>>>24]^i[u>>>16&255]^o[d>>>8&255]^a[255&l]^r[p++];u=f,d=_,l=m,h=g}f=(s[u>>>24]<<24|s[d>>>16&255]<<16|s[l>>>8&255]<<8|s[255&h])^r[p++],_=(s[d>>>24]<<24|s[l>>>16&255]<<16|s[h>>>8&255]<<8|s[255&u])^r[p++],m=(s[l>>>24]<<24|s[h>>>16&255]<<16|s[u>>>8&255]<<8|s[255&d])^r[p++],g=(s[h>>>24]<<24|s[u>>>16&255]<<16|s[d>>>8&255]<<8|s[255&l])^r[p++],e[t]=f,e[t+1]=_,e[t+2]=m,e[t+3]=g},keySize:8});e.AES=t._createHelper(f)}(),r.AES)}(ON);var YN=ON.exports,JN={exports:{}};!function(e,t){e.exports=wN().enc.Hex}(JN);var QN=r(JN.exports),ZN={exports:{}};!function(e,t){var r,n,i;e.exports=(i=wN(),qN(),i.mode.CTR=(r=i.lib.BlockCipherMode.extend(),n=r.Encryptor=r.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,i=this._iv,o=this._counter;i&&(o=this._counter=cI(i).call(i,0),this._iv=void 0);var a=cI(o).call(o,0);r.encryptBlock(a,0),o[n-1]=o[n-1]+1|0;for(var s=0;s<n;s++)e[t+s]^=a[s]}}),r.Decryptor=n,r),i.mode.CTR)}(ZN);var $N=r(ZN.exports),eL={exports:{}};!function(e,t){var r;e.exports=(r=wN(),qN(),r.pad.NoPadding={pad:function(){},unpad:function(){}},r.pad.NoPadding)}(eL);var tL=r(eL.exports),rL=new TextDecoder,nL=new TextEncoder,iL=function(){return SN()},oL=function(){return Date.now()},aL=!px()&&"function"==typeof HTMLVideoElement.prototype.requestVideoFrameCallback;function sL(e){for(var t=0,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var o=0,a=n;o<a.length;o++){t+=a[o].length}for(var s=new e(t),c=0,u=0,d=n;u<d.length;u++){var l=d[u];s.set(l,c),c+=l.length}return s}var cL=function(){function e(){Bh(this,e)}var t,r;return Fh(e,null,[{key:"token2auth",value:function(t,r,n,i){return i?"Bearer ".concat(i):"Basic ".concat(e.createUnsafeToken(t,r,n))}},{key:"createUnsafeToken",value:function(e,t,r){var n;return window.btoa(Iy(n=[e,t,r]).call(n,(function(e){return null!==e})).join(":"))}},{key:"merge",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=0,i=NS(t);n<i.length;n++){var o=yy(i[n],2),a=o[0],s=o[1];null!==s&&"object"===Xl(s)?e.merge(t[a],r[a]):void 0!==r[a]&&(t[a]=r[a])}}},{key:"ab2str",value:function(e){return rL.decode(e)}},{key:"ab2obj",value:function(t){try{var r=e.ab2str(t);return JSON.parse(r)}catch(n){return{}}}},{key:"str2ab",value:function(e){return nL.encode(e).buffer}},{key:"ab2b64str",value:(r=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new HI((function(e){var r=new FileReader;r.onload=function(){return e(r.result)},r.readAsDataURL(new Blob([t]))}));case 2:return r=e.sent,e.abrupt("return",r.split(",",2)[1]);case 4:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"b64str2ab",value:(t=Ng(Mg().mark((function e(t,r){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("data:application/octet;base64,".concat(t)).then((function(e){return e.arrayBuffer()})).catch((function(e){var n;throw r&&r.report("rtc_error",{error_code:2001,message:Bg(n="".concat(e.message," -> ")).call(n,t)}),e})));case 1:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})}]),e}();function uL(){for(var e,t,r=Number(GC(e=cI(t="".concat(Math.random())).call(t,-7)).call(e,7,"0")).toString(2),n=GC(r).call(r,28,"1").split(""),i=[];n.length;)i.push(jI(n).call(n,0,7));return Jg(i).call(i,(function(e,t){var r=t===i.length-1?"0":"1";return KC(r+e.join(""),2)}))}var dL=function(){return Math.floor(65535*Math.random())};function lL(e){return"string"==typeof e&&SI(e).call(e,"__web__rtc__rtt__")>-1}var hL,pL,vL,fL,_L,mL,gL,yL,SL=function(){var e=Ng(Mg().mark((function e(){var t,r,n,i=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],(r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"})).createDataChannel("default"),r.addTransceiver("audio",{direction:"recvonly"}),r.addTransceiver("video",{direction:"recvonly"}),t&&(r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"sendonly"})),e.next=8,r.createOffer();case 8:return n=e.sent,r.close(),e.abrupt("return",n.sdp);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),bL=function(e){return new HI((function(t,r){var n=(e=Array.isArray(e)?e:[]).length,i=[];0===n?r([]):e.forEach((function(e){e.then((function(e){t(e)}),(function(e){n--,i.push(e),0===n&&r(i)}))}))}))};function kL(e){return Number(Math.max(-127,10*QC(Math.pow(e/255,2))).toFixed(2))}function EL(e){return(e&uh.AUDIO)===uh.AUDIO}function TL(e){return(e&uh.VIDEO)===uh.VIDEO}function IL(e){var t={};return LS(e).forEach((function(r){"object"===Xl(e[r])?t[r]=IL(e[r]):_C(r).call(r,"_")||(t[r]=e[r])})),t}function RL(e){var t=new DataView(e.buffer);if(t.byteLength<=4||65535!==t.getUint16(0))return{seiCount:1,seis:[e]};for(var r={seiCount:0,seis:[]},n=!1,i=2;i<t.byteLength;){var o=t.getUint16(i);if(i+=2,t.byteLength-i<o){n=!0;break}var a=new Uint8Array(e.buffer,i,o);if(i+=o,t.byteLength-i>0&&t.byteLength-i<=2){n=!0;break}r.seiCount++,r.seis.push(a)}return n&&(r.seiCount=1,r.seis=[e]),r}function AL(e){return void 0===e}function wL(e){return function(t,r,n){var i=n.value;n.value=function(){var t;console.warn(Bg(t="[RTC WebSDK]: Api: ".concat(r," has been abandoned from version ")).call(t,e));for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return i.apply(this,o)}}}function CL(e){console.warn("[RTC WebSDK]: ".concat(e))}function xL(e){return"number"==typeof e?e:"number"==typeof(null==e?void 0:e.exact)?e.exact:"number"==typeof(null==e?void 0:e.ideal)?e.ideal:"number"==typeof(null==e?void 0:e.max)?e.max:"number"==typeof(null==e?void 0:e.min)?e.min:1}function OL(e){for(var t=atob(e),r=t.length,n=new Uint8Array(r),i=0;i<r;i++)n[i]=t.charCodeAt(i);return n}function PL(e){for(var t="",r=e.byteLength,n=0;n<r;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function ML(e,t,r){var n=DL(e),i=DL(t),o=DL(r);return function(e){for(var t=e.toString(QN),r=new Uint8Array(t.length/2),n=0;n<t.length;n+=2)r[n/2]=_b(t.substr(n,2),16);return r}(YN.encrypt(n,i,{iv:o,mode:$N,padding:tL}).ciphertext)}function DL(e){for(var t=[],r=0;r<e.length;r+=4)t.push(e[r]<<24|(e[r+1]||0)<<16|(e[r+2]||0)<<8|(e[r+3]||0));return xN.create(t,e.length)}var NL=function(){return"undefined"==typeof window},LL=NL()?"":window.navigator.userAgent;function UL(){var e="none";return NL()||(null!==LL.match("Firefox")?e="mozilla":null!==LL.match("Chrome")?(e="chrome-stable",null!==LL.match("Electron")&&(e="electron")):(null!==LL.match("Safari")||null!==LL.match("AppleWebKit"))&&(e="safari")),e}var VL,FL="mozilla"===UL(),BL="safari"===UL(),jL="chrome-stable"===UL(),HL=!NL()&&/CriOS/i.test(LL),GL=!NL()&&/Edg\//i.test(LL),zL=!NL()&&/EdgA/i.test(LL),KL=!NL()&&/EdgiOS/i.test(LL),WL=GL||zL||KL,XL=!NL()&&/DingTalk/i.test(navigator.userAgent),qL=!NL()&&(!!/(iPad)/i.exec(LL)||/Macintosh/i.test(LL)&&"ontouchend"in document),YL=!NL()&&/Macintosh/i.test(LL),JL=!NL()&&/MicroMessenger/i.test(LL),QL=!NL()&&qy(hL=LL.toLowerCase()).call(hL,"mobile"),ZL=!NL()&&!!/(iPhone|iPad|iPod)/i.exec(LL),$L=!NL()&&/Android/i.test(LL),eU=!NL()&&/Windows/i.test(LL),tU=0,rU="0",nU=!NL()&&(null===(pL=LL.match(/version\/(\d+)/i))||void 0===pL?void 0:pL[1]);BL&&nU&&(tU=Number(nU),rU=null===(VL=navigator.userAgent.match(/version\/(\d+\.\d+)/i))||void 0===VL?void 0:VL[1]);var iU=!NL()&&(null===(vL=LL.match(/Firefox\/(\d+)/i))||void 0===vL?void 0:vL[1]);FL&&iU&&(tU=Number(iU));var oU=tU,aU=tU,sU=rU,cU=null!==(fL=!NL()&&(null===(_L=LL.match(/ ([\d_]+) like Mac OS X/i))||void 0===_L||null===(mL=_L[1])||void 0===mL?void 0:Jg(gL=mL.split("_")).call(gL,(function(e){return _b(e)}))))&&void 0!==fL?fL:[],uU=0,dU=!NL()&&(null===(yL=LL.match(/Chrome\/(\d+)/i))||void 0===yL?void 0:yL[1]);dU&&(uU=Number(dU));var lU=uU,hU="VolcEngine",pU="RTC_DEVICE_ID",vU="RTC_ACCESS_URLS",fU="ENGINE_WEB_CONFIG",_U="SERVER_CONFIG",mU=function(){function e(){Bh(this,e)}return Fh(e,[{key:"get",value:function(e){var t=localStorage.getItem(e);if(!t)return null;try{var r=JSON.parse(t);return r.ttl>0&&Date.now()-r.saveTime>r.ttl?(this.delete(e),null):r.message}catch(n){return null}}},{key:"set",value:function(e,t){var r={ttl:arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,saveTime:Date.now(),message:t};try{return localStorage.setItem(e,zg(r)),!0}catch(n){return!1}}},{key:"getTtl",value:function(e){var t=localStorage.getItem(e);if(!t)return null;try{return JSON.parse(t).ttl}catch(r){return null}}},{key:"delete",value:function(e){try{return localStorage.removeItem(e),!0}catch(t){return!1}}}]),e}(),gU=function(e){VA(r,e);var t=tw(r);function r(){var e,n;Bh(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return Jl(sA(n=t.call.apply(t,Bg(e=[this]).call(e,o))),"_accessVersion","v2"),n}return Fh(r,[{key:"getDeviceId",value:function(){if(NL())return"";var e=this.get(pU);return e&&!/^[0-9a-f]{8}(-[0-9a-f]{4}){3}-[0-9a-f]{12}$/.test(e)||(e=function(e){for(var t="",r=0;r<e;r++)t+=Math.floor(10*Math.random());return t}(30)),this.setDeviceId(e),e}},{key:"setDeviceId",value:function(e){return UD({device_id:e}),this.set(pU,e),e}},{key:"getAccessKey",value:function(e){var t,r;return Bg(t=Bg(r="".concat("RTC_ACCESS_NODE","_").concat(e,"-")).call(r,hU,"-")).call(t,this._accessVersion)}},{key:"getAccessNode",value:function(e){return this.get(this.getAccessKey(e))}},{key:"setAccessNode",value:function(e,t,r){return this.set(this.getAccessKey(e),t,1e3*r)}},{key:"deleteAccessNode",value:function(e,t){var r=this.getAccessNode(e),n=this.getTtl(this.getAccessKey(e));Array.isArray(r)&&r.length>0&&((r=Iy(r).call(r,(function(e){return e.mediaID!==t.mediaID&&e.msgKey!==t.msgKey}))).length>0?this.setAccessNode(e,r,n||0):this.clearAccessNode(e))}},{key:"clearAccessNode",value:function(e){this.delete(this.getAccessKey(e))}},{key:"getAccessUrls",value:function(){return this.get("".concat(vU,"-").concat(hU))}},{key:"setAccessUrls",value:function(e){var t=Jg(e).call(e,(function(e){var t,r=e.host,n=e.path;return Bg(t="https://".concat(r)).call(t,n)}));return this.set("".concat(vU,"-").concat(hU),t)}},{key:"clearAccessUrls",value:function(){this.delete("".concat(vU,"-").concat(hU))}},{key:"getEngineWebConfig",value:function(e,t){var r,n,i,o=Bg(r=Bg(n="".concat(e,"_")).call(n,t,"_")).call(r,this.getDeviceId()),a=this.get(fU);return(null==a||null===(i=sI(a).call(a,(function(e){return e.key===o})))||void 0===i?void 0:i.config)||{}}},{key:"setEngineWebConfig",value:function(e,t,r){var n,i;if(r){var o=Bg(n=Bg(i="".concat(e,"_")).call(i,t,"_")).call(n,this.getDeviceId()),a=this.get(fU)||[];return(a=Iy(a).call(a,(function(e){return e.key!==o}))).push({key:o,config:r}),this.set(fU,cI(a).call(a,-5))}}},{key:"getServerConfig",value:function(e){var t,r="".concat(e),n=this.get(_U);return(null==n||null===(t=sI(n).call(n,(function(e){return e.key===r})))||void 0===t?void 0:t.config)||{}}},{key:"setServerConfig",value:function(e,t){if(t){var r="".concat(e),n=this.get(_U)||[];return(n=Iy(n).call(n,(function(e){return e.key!==r}))).push({key:r,config:t}),this.set(_U,cI(n).call(n,-5))}}}]),r}(mU),yU=new gU,SU=new lN("JoinRoomConfig",0),bU=function(){function e(t){var r;Bh(this,e),Jl(this,"_useTcpAfterJoinTimeout",e.DEFAULT_CONF.useTcpAfterJoinTimeout),Jl(this,"_joinWithTcpOnly",e.DEFAULT_CONF.joinWithTcpOnly),Jl(this,"_joinWithTcpOnlyDelay",e.DEFAULT_CONF.joinWithTcpOnlyDelay),Jl(this,"_blackBrowserRegexList",[]),this._engineId=t,SI(r=location.search).call(r,"__rtc_tcp_only__")>-1&&(this._joinWithTcpOnly=!0,this._joinWithTcpOnlyDelay=0),this._report()}return Fh(e,[{key:"useTcpAfterJoinTimeout",get:function(){return this._useTcpAfterJoinTimeout}},{key:"useTcpJoin",get:function(){return this._joinWithTcpOnly}},{key:"useTcpJoinDelay",get:function(){return this._joinWithTcpOnlyDelay}},{key:"isBlackBrower",value:function(){var e;return sI(e=this._blackBrowserRegexList).call(e,(function(e){return new RegExp(e).test(navigator.userAgent)}))}},{key:"setServerConfig",value:function(e){var t,r,n,i,o,a,s=!1;"boolean"==typeof(null==e||null===(t=e.use_tcp_after_join_timeout)||void 0===t?void 0:t.enable)&&(this._useTcpAfterJoinTimeout=null===(i=e.use_tcp_after_join_timeout)||void 0===i?void 0:i.enable,s=!0);"boolean"==typeof(null==e||null===(r=e.join_with_tcp_only)||void 0===r?void 0:r.enable)&&(this._joinWithTcpOnly=null===(o=e.join_with_tcp_only)||void 0===o?void 0:o.enable,s=!0);"number"==typeof(null==e||null===(n=e.join_with_tcp_only)||void 0===n?void 0:n.delay_ms)&&(this._joinWithTcpOnlyDelay=null===(a=e.join_with_tcp_only)||void 0===a?void 0:a.delay_ms,s=!0);e&&Array.isArray(e.black_browser_regex_list)&&(this._blackBrowserRegexList=e.black_browser_regex_list,s=!0),s&&this._report()}},{key:"toString",value:function(){return zg({use_tcp_after_join_timeout:this._useTcpAfterJoinTimeout,join_with_tcp_only:this._joinWithTcpOnly,join_with_tcp_only_delay:this._joinWithTcpOnlyDelay,black_browser_regex_list:this._blackBrowserRegexList})}},{key:"_report",value:function(){SU.print("_report",this.toString()),JD(this._engineId,"web_join_room_config",this.toString())}}],[{key:"setDefaulConf",value:function(t){var r=t.useTcpAfterJoinTimeout,n=t.joinWithTcpOnly,i=t.joinWithTcpOnlyDelay;return"boolean"==typeof r&&(e.DEFAULT_CONF.useTcpAfterJoinTimeout=r),"boolean"==typeof n&&(e.DEFAULT_CONF.joinWithTcpOnly=n),"number"==typeof i&&(e.DEFAULT_CONF.joinWithTcpOnlyDelay=Math.max(0,i)),e.DEFAULT_CONF}}]),e}();Jl(bU,"DEFAULT_CONF",{useTcpAfterJoinTimeout:!0,joinWithTcpOnly:!1,joinWithTcpOnlyDelay:5e3});var kU="access.rtc.volcvideo.com,access2-hl.rtc.volcvideo.com,rtcg-access.volcvideos.com".split(",");function EU(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/^https?:\/\/.+/.test(e)||(e="https://".concat(e)),"".concat(e,"/dispatch/v1/AccessInfo?Action=GetAccessInfo")}var TU="https://web-log-report.rtc.volcvideo.com/video/v1/webrtc_log/",IU="common.rtc.volcvideo.com,rtcg.volcvideos.com".split(","),RU={VERSION:"4.58.19",ICE_CONFIG_REQUEST_URLS_INTERNAL:Jg(kU).call(kU,EU),ICE_CONFIG_REQUEST_URLS:[],EXPECTED_ADDR:"",LOG_SERVER_URL:TU,CONFIG_REQUEST_DOMAINS:IU,DEVICE_ID:"",OVERSEA:!1,PLATFORM:"",PRODUCT:"",FORCE_ENABLED_REPORT_CALLBACKS:[],SKIP_WEB_AUDIO_IN_TRACK:!1,AUDIO_STALL:!0,VIDEO_STALL:!0,VIDEO_STALL_100MS:!1,STATS_SCALLBACK_SUPPORT:!0,JOIN_ROOM_CONFIG:bU.DEFAULT_CONF,SIGNAL_COMPRESSION:!0,SIGNAL_CROP_JOINROOM:!0,VIDEO_STALL_DATA:500,AUDIO_STALL_DATA:200,IOS_SAFARI_ORIENTATION:!1,FALLBACK_ENCODE_CODEC:"",ENABLE_FALLBACK_HANDLER:!1,ENABLE_STANDARD_HANDLER:!1,PC_KILLSWITCH:{}};function AU(e,t){var r;if(BD("setParameter",0,Bg(r="key: ".concat(e,", value: ")).call(r,t)),"VERSION"!==e){if("JOIN_ROOM_CONFIG"===e)return bU.setDefaulConf(t);if("ICE_CONFIG_REQUEST_URLS"!==e)if("VIDEO_STALL_DATA"!==e)if("AUDIO_STALL_DATA"!==e)if("VIDEO_STALL_100MS"!==e)if("PLATFORM"!==e||"string"!=typeof t)if("PRODUCT"!==e||"string"!=typeof t)if("FORCE_ENABLED_REPORT_CALLBACKS"!==e){if("LOG_SERVER_URL"===e){var n=t===fh.overseas?"https://web-log-report.volcvideos.com/video/v1/webrtc_log/":t===fh.domestic?TU:"string"==typeof t?t:void 0;n&&(RU.LOG_SERVER_URL=n,VD(n))}else if("OVERSEA"===e)return UD({extra_is_oversea:t?"1":"0"}),void(RU.OVERSEA=t);if("CONFIG_REQUEST_DOMAINS"===e&&Array.isArray(t)&&t.length>0)RU.CONFIG_REQUEST_DOMAINS=t;else{"DEVICE_ID"===e&&yU.setDeviceId(t);var i=Nx.getKeys();qy(i).call(i,e)?Nx.setParameter(e,t):RU[e]=t}}else{var o="string"==typeof t?[t]:t;RU.FORCE_ENABLED_REPORT_CALLBACKS=o}else UD({product:t});else UD({platform:t});else RU.VIDEO_STALL_100MS=aL&&!!t;else RU.AUDIO_STALL_DATA=Math.max(200,Number(t));else RU.VIDEO_STALL_DATA=Math.max(500,Number(t));else{var a="string"==typeof t?[t]:t;RU.ICE_CONFIG_REQUEST_URLS=Jg(a).call(a,EU)}}}function wU(e){return"DEVICE_ID"===e?yU.getDeviceId():RU[e]}function CU(e,t,r){var n,i,o,a,s,c,u,d,l;return{type:"publicstream",action:t,publicStreamID:e,publicStreamMeta:{audio:{},video:{fps:(null===(n=r.video)||void 0===n?void 0:n.fps)||15,bitrate:1e3*((null===(i=r.video)||void 0===i?void 0:i.kBitRate)||40),width:(null===(o=r.video)||void 0===o?void 0:o.width)||640,height:(null===(a=r.video)||void 0===a?void 0:a.height)||360},layout:{layoutMode:2,interpolationMode:(null===(s=r.layout)||void 0===s?void 0:s.interpolationMode)||gh.PREV_FRAME,canvas:{bgColor:(null===(c=r.layout)||void 0===c?void 0:c.backgroundColor)||"#000000",bgImage:(null===(u=r.layout)||void 0===u?void 0:u.backgroundImage)||""},regions:(null===(d=r.layout)||void 0===d||null===(l=d.regions)||void 0===l?void 0:Jg(l).call(l,(function(e){return{roomId:e.roomId,userId:e.userId,alterImage:e.alertImage||"",alpha:!e.alpha||Number(e.alpha)>1||Number(e.alpha)<=0?1:Number(e.alpha),x:!e.x||Number(e.x)>=1||Number(e.x)<0?0:Number(e.x),y:!e.y||Number(e.y)>=1||Number(e.y)<0?0:Number(e.y),w:!e.w||Number(e.w)>1||Number(e.w)<=0?1:Number(e.w),h:!e.h||Number(e.h)>1||Number(e.h)<=0?1:Number(e.h),zorder:!e.zorder||Number(e.zorder)<0||Number(e.zorder)>100?0:Number(e.zorder),renderMode:void 0===e.renderMode?1:e.renderMode,streamType:e.isScreenStream?1:0,mediaType:e.mediaType||0,sourceCrop:e.sourceCrop}})))||[]}}}}var xU=[];function OU(e){xU=e}var PU={width:640,height:480,frameRate:15,maxKbps:600},MU={width:1920,height:1080,frameRate:15,maxKbps:3e3};function DU(e,t){if("boolean"!=typeof e)throw new kC(mC.INVALID_PARAMS,"Invalid ".concat(t,": The value should be boolean type."))}function NU(e,t){var r,n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;if(e<i||e>o||"number"!=typeof e)throw new kC(mC.INVALID_PARAMS,Bg(r=Bg(n="Invalid ".concat(t,": the value range is [")).call(n,i,", ")).call(r,o,"]. integer only"))}function LU(e,t){var r,n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;if(null==e)throw new kC(mC.INVALID_PARAMS,"".concat(t," cannot be empty"));if(!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return"string"==typeof e&&e.length<=r&&e.length>=t}(e,i,o))throw new kC(mC.INVALID_PARAMS,Bg(r=Bg(n="Invalid ".concat(t,": The value should be string type. Length of the string: [")).call(n,i,",")).call(r,o,"]"))}function UU(e,t,r){var n;if(!qy(r).call(r,e))throw new kC(mC.INVALID_PARAMS,Bg(n="Invalid ".concat(t,": The value can only be set as ")).call(n,zg(r)))}function VU(e){if(!(e instanceof MediaStreamTrack))throw new kC(mC.INVALID_PARAMS,"Invalid track, The value should be MediaStreamTrack type.")}function FU(e,t){if(HU(e))throw new kC(mC.INVALID_PARAMS,"Invalid ".concat(t,", should not be empty"))}function BU(e,t){if(!(e instanceof ArrayBuffer))throw new kC(mC.INVALID_PARAMS,"Invalid ".concat(t,", should be ArrayBuffer"))}function jU(e){try{for(var t=navigator.mediaDevices.getSupportedConstraints(),r=0,n=LS(e);r<n.length;r++){var i=n[r];t[i]||delete e[i]}}catch(o){}}function HU(e){return null==e}function GU(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._\-]{1,128}$/.test(e))throw new kC(mC.INVALID_PARAMS,"The RoomId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function zU(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._\-]{1,128}$/.test(e))throw new kC(mC.INVALID_PARAMS,"The userId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function KU(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._\-]{1,128}$/.test(e))throw new kC(mC.INVALID_PARAMS,"The publicStreamId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function WU(e){FU(e,"userInfo"),zU(e.userId),HU(e.extraInfo)||LU(e.extraInfo,"userInfo.extraInfo",1,200)}function XU(e){FU(e,"roomConfig"),DU(e.isAutoPublish,"roomConfig.isAutoPublish"),DU(e.isAutoSubscribeAudio,"roomConfig.isAutoSubscribeAudio"),DU(e.isAutoSubscribeVideo,"roomConfig.isAutoSubscribeVideo"),HU(e.roomProfileType)||UU(e.roomProfileType,"roomConfig",[Eh.communication,Eh.chat,Eh.chatRoom,Eh.coHost,Eh.meeting,Eh.classRoom])}function qU(e){FU(e,"videoPlayerOption")}function YU(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64;if(!e||0===(null==e?void 0:e.byteLength))throw new kC(mC.INVALID_PARAMS,"The message cannot be empty");if((null===(t=e instanceof ArrayBuffer?e:cL.str2ab(zg(e)))||void 0===t?void 0:t.byteLength)>1e3*r)throw new kC(mC.INVALID_PARAMS,"The message length must be less than ".concat(r,"K"))}function JU(e){if("number"!=typeof(null==e?void 0:e.width)||"number"!=typeof(null==e?void 0:e.height))throw new kC(mC.INVALID_PARAMS,"remoteVideoConfig must contain width, height, frameRate")}function QU(e,t){if("number"!=typeof e||Number.isNaN(e)||!(e>=1)){var r=e;if(!(null!=r&&r.min||null!=r&&r.max||null!=r&&r.exact||null!=r&&r.ideal))throw new kC(mC.INVALID_PARAMS,"".concat(t," is not a valid ConstrainULong"))}}function ZU(e){var t,r=gy(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;NU(null==n?void 0:n.maxKbps,"maxKbps"),QU(null==n?void 0:n.width,"width"),QU(null==n?void 0:n.height,"height"),QU(null==n?void 0:n.frameRate,"frameRate")}}catch(J$){r.e(J$)}finally{r.f()}}function $U(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.NEGATIVE_INFINITY,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;return NU(e,t,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),e=(e=e>r?e:r)<n?e:n}var eV=r(Hs),tV={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,n,o,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,o||e,a),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?cI(n).call(n,1):n);return eV?Bg(i).call(i,eV(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=new Array(o);i<o;i++)a[i]=n[i].fn;return a},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,o,a){var s=r?r+e:e;if(!this._events[s])return!1;var c,u,d=this._events[s],l=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),l){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,n),!0;case 4:return d.fn.call(d.context,t,n,i),!0;case 5:return d.fn.call(d.context,t,n,i,o),!0;case 6:return d.fn.call(d.context,t,n,i,o,a),!0}for(u=1,c=new Array(l-1);u<l;u++)c[u-1]=arguments[u];d.fn.apply(d.context,c)}else{var h,p=d.length;for(u=0;u<p;u++)switch(d[u].once&&this.removeListener(e,d[u].fn,void 0,!0),l){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,t);break;case 3:d[u].fn.call(d[u].context,t,n);break;case 4:d[u].fn.call(d[u].context,t,n,i);break;default:if(!c)for(h=1,c=new Array(l-1);h<l;h++)c[h-1]=arguments[h];d[u].fn.apply(d[u].context,c)}}return!0},s.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||a(this,o);else{for(var c=0,u=[],d=s.length;c<d;c++)(s[c].fn!==t||i&&!s[c].once||n&&s[c].context!==n)&&u.push(s[c]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}(tV);var rV=tV.exports,nV=r(rV),iV=new lN("VERTC",0),oV=function(e){VA(r,e);var t=tw(r);function r(){return Bh(this,r),t.apply(this,arguments)}return Fh(r,[{key:"safeEmit",value:function(e){var t=this.listenerCount(e);try{for(var n,i,o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return(n=LA(NA(r.prototype),"emit",this)).call.apply(n,Bg(i=[this,e]).call(i,a))}catch(Y$){return iV.error("safeEmit","safeEmit() | event listener threw an error [event:%s]:%o",e,Y$),console.error(Y$),Boolean(t)}}}]),r}(rV.EventEmitter),aV=r(_A),sV=M,cV=nr,uV=te,dV=uA,lV=Zt,hV=C,pV=Xc,vV=B;Cr({target:"Reflect",stat:!0,forced:a((function(){var e=function(){},t=lV.f(new e,"a",{configurable:!0});return!1!==Reflect.set(e.prototype,"a",1,t)}))},{set:function e(t,r,n){var i,o,a,s=arguments.length<4?t:arguments[3],c=hV.f(cV(t),r);if(!c){if(uV(o=pV(t)))return e(o,r,n,s);c=vV(0)}if(dV(c)){if(!1===c.writable||!uV(s))return!1;if(i=hV.f(s,r)){if(i.get||i.set||!1===i.writable)return!1;i.value=n,lV.f(s,r,i)}else lV.f(s,r,vV(0,n))}else{if(void 0===(a=c.set))return!1;sV(a,s,n)}return!0}});var fV=r(re.Reflect.set),_V=r(gi.f("asyncIterator"));function mV(e){var t,r,n,i=2;for(void 0!==wl&&(r=_V,n=Wl);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new gV(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function gV(e){function t(e){if(Object(e)!==e)return rg.reject(new TypeError(e+" is not an object."));var t=e.done;return rg.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(gV=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?rg.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?rg.reject(e):t(r.apply(this.s,arguments))}},new gV(e)}var yV=[{maxLayers:3,totalPixels:2073600},{maxLayers:3,totalPixels:921600},{maxLayers:3,totalPixels:518400},{maxLayers:2,totalPixels:230400},{maxLayers:2,totalPixels:129600},{maxLayers:1,totalPixels:57600},{maxLayers:1,totalPixels:0}];ik("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),bk);var SV=re.Set,bV=we,kV=function(e){if("object"==typeof e&&"size"in e&&"has"in e&&"add"in e&&"delete"in e&&"keys"in e)return e;throw TypeError(bV(e)+" is not a set")},EV=Ek,TV=se("Set"),IV=TV.prototype,RV={Set:TV,add:EV("add",1),has:EV("has",1),remove:EV("delete",1),proto:IV},AV=rE,wV=function(e,t,r){return r?AV(e.keys(),t,!0):e.forEach(t)},CV=wV,xV=RV.Set,OV=RV.add,PV=function(e){var t=new xV;return CV(e,(function(e){OV(t,e)})),t},MV=function(e){return e.size},DV=Pe,NV=nr,LV=M,UV=Mr,VV=function(e){return{iterator:e,next:e.next,done:!1}},FV="Invalid size",BV=RangeError,jV=TypeError,HV=Math.max,GV=function(e,t,r,n){this.set=e,this.size=t,this.has=r,this.keys=n};GV.prototype={getIterator:function(){return VV(NV(LV(this.keys,this.set)))},includes:function(e){return LV(this.has,this.set,e)}};var zV=function(e){NV(e);var t=+e.size;if(t!=t)throw jV(FV);var r=UV(t);if(r<0)throw BV(FV);return new GV(e,HV(r,0),DV(e.has),DV(e.keys))},KV=kV,WV=PV,XV=MV,qV=zV,YV=wV,JV=rE,QV=RV.has,ZV=RV.remove,$V=function(e){var t=KV(this),r=qV(e),n=WV(t);return XV(t)<=r.size?YV(t,(function(e){r.includes(e)&&ZV(n,e)})):JV(r.getIterator(),(function(e){QV(t,e)&&ZV(n,e)})),n},eF=function(){return!1},tF=$V;Cr({target:"Set",proto:!0,real:!0,forced:!eF()},{difference:tF});var rF=kV,nF=MV,iF=zV,oF=wV,aF=rE,sF=RV.Set,cF=RV.add,uF=RV.has,dF=function(e){var t=rF(this),r=iF(e),n=new sF;return nF(t)>r.size?aF(r.getIterator(),(function(e){uF(t,e)&&cF(n,e)})):oF(t,(function(e){r.includes(e)&&cF(n,e)})),n},lF=dF;Cr({target:"Set",proto:!0,real:!0,forced:!eF()},{intersection:lF});var hF=kV,pF=RV.has,vF=MV,fF=zV,_F=wV,mF=rE,gF=Pp,yF=function(e){var t=hF(this),r=fF(e);if(vF(t)<=r.size)return!1!==_F(t,(function(e){if(r.includes(e))return!1}),!0);var n=r.getIterator();return!1!==mF(n,(function(e){if(pF(t,e))return gF(n,"normal",!1)}))},SF=yF;Cr({target:"Set",proto:!0,real:!0,forced:!eF()},{isDisjointFrom:SF});var bF=kV,kF=MV,EF=wV,TF=zV,IF=function(e){var t=bF(this),r=TF(e);return!(kF(t)>r.size)&&!1!==EF(t,(function(e){if(!r.includes(e))return!1}),!0)},RF=IF;Cr({target:"Set",proto:!0,real:!0,forced:!eF()},{isSubsetOf:RF});var AF=kV,wF=RV.has,CF=MV,xF=zV,OF=rE,PF=Pp,MF=function(e){var t=AF(this),r=xF(e);if(CF(t)<r.size)return!1;var n=r.getIterator();return!1!==OF(n,(function(e){if(!wF(t,e))return PF(n,"normal",!1)}))},DF=MF;Cr({target:"Set",proto:!0,real:!0,forced:!eF()},{isSupersetOf:DF});var NF=kV,LF=PV,UF=zV,VF=rE,FF=RV.add,BF=RV.has,jF=RV.remove,HF=function(e){var t=NF(this),r=UF(e).getIterator(),n=LF(t);return VF(r,(function(e){BF(t,e)?jF(n,e):FF(n,e)})),n},GF=HF;Cr({target:"Set",proto:!0,real:!0,forced:!eF()},{symmetricDifference:GF});var zF=kV,KF=RV.add,WF=PV,XF=zV,qF=rE,YF=function(e){var t=zF(this),r=XF(e).getIterator(),n=WF(t);return qF(r,(function(e){KF(n,e)})),n},JF=YF;Cr({target:"Set",proto:!0,real:!0,forced:!eF()},{union:JF});var QF=SV;Cr({target:"Set",stat:!0,forced:!0},{from:zk}),Cr({target:"Set",stat:!0,forced:!0},{of:Wk});var ZF=kV,$F=RV.add;Cr({target:"Set",proto:!0,real:!0,forced:!0},{addAll:function(){for(var e=ZF(this),t=0,r=arguments.length;t<r;t++)$F(e,arguments[t]);return e}});var eB=kV,tB=RV.remove;Cr({target:"Set",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=eB(this),r=!0,n=0,i=arguments.length;n<i;n++)e=tB(t,arguments[n]),r=r&&e;return!!r}});var rB=Qt,nB=kV,iB=wV;Cr({target:"Set",proto:!0,real:!0,forced:!0},{every:function(e){var t=nB(this),r=rB(e,arguments.length>1?arguments[1]:void 0);return!1!==iB(t,(function(e){if(!r(e,e,t))return!1}),!0)}});var oB=gn,aB=$e,sB=W,cB=Pc,uB=pt("iterator"),dB=Object,lB=w,hB=function(e){if(sB(e))return!1;var t=dB(e);return void 0!==t[uB]||"@@iterator"in t||aB(cB,oB(t))},pB=te,vB=se("Set"),fB=function(e){return function(e){return pB(e)&&"number"==typeof e.size&&lB(e.has)&&lB(e.keys)}(e)?e:hB(e)?new vB(e):e},_B=M,mB=fB,gB=$V;Cr({target:"Set",proto:!0,real:!0,forced:!0},{difference:function(e){return _B(gB,this,mB(e))}});var yB=Qt,SB=kV,bB=wV,kB=RV.Set,EB=RV.add;Cr({target:"Set",proto:!0,real:!0,forced:!0},{filter:function(e){var t=SB(this),r=yB(e,arguments.length>1?arguments[1]:void 0),n=new kB;return bB(t,(function(e){r(e,e,t)&&EB(n,e)})),n}});var TB=Qt,IB=kV,RB=wV;Cr({target:"Set",proto:!0,real:!0,forced:!0},{find:function(e){var t=IB(this),r=TB(e,arguments.length>1?arguments[1]:void 0),n=RB(t,(function(e){if(r(e,e,t))return{value:e}}),!0);return n&&n.value}});var AB=M,wB=fB,CB=dF;Cr({target:"Set",proto:!0,real:!0,forced:!0},{intersection:function(e){return AB(CB,this,wB(e))}});var xB=M,OB=fB,PB=yF;Cr({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function(e){return xB(PB,this,OB(e))}});var MB=M,DB=fB,NB=IF;Cr({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function(e){return MB(NB,this,DB(e))}});var LB=M,UB=fB,VB=MF;Cr({target:"Set",proto:!0,real:!0,forced:!0},{isSupersetOf:function(e){return LB(VB,this,UB(e))}});var FB=Cr,BB=m,jB=kV,HB=wV,GB=bn,zB=BB([].join),KB=BB([].push);FB({target:"Set",proto:!0,real:!0,forced:!0},{join:function(e){var t=jB(this),r=void 0===e?",":GB(e),n=[];return HB(t,(function(e){KB(n,e)})),zB(n,r)}});var WB=Qt,XB=kV,qB=wV,YB=RV.Set,JB=RV.add;Cr({target:"Set",proto:!0,real:!0,forced:!0},{map:function(e){var t=XB(this),r=WB(e,arguments.length>1?arguments[1]:void 0),n=new YB;return qB(t,(function(e){JB(n,r(e,e,t))})),n}});var QB=Pe,ZB=kV,$B=wV,ej=TypeError;Cr({target:"Set",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=ZB(this),r=arguments.length<2,n=r?void 0:arguments[1];if(QB(e),$B(t,(function(i){r?(r=!1,n=i):n=e(n,i,i,t)})),r)throw ej("Reduce of empty set with no initial value");return n}});var tj=Qt,rj=kV,nj=wV;Cr({target:"Set",proto:!0,real:!0,forced:!0},{some:function(e){var t=rj(this),r=tj(e,arguments.length>1?arguments[1]:void 0);return!0===nj(t,(function(e){if(r(e,e,t))return!0}),!0)}});var ij=M,oj=fB,aj=HF;Cr({target:"Set",proto:!0,real:!0,forced:!0},{symmetricDifference:function(e){return ij(aj,this,oj(e))}});var sj=M,cj=fB,uj=YF;Cr({target:"Set",proto:!0,real:!0,forced:!0},{union:function(e){return sj(uj,this,cj(e))}});var dj=r(QF),lj=function(){var e=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!NL()&&window.RTCPeerConnection&&window.RTCPeerConnection.prototype.addTransceiver&&window.RTCPeerConnection.prototype.createDataChannel){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,Sj();case 5:if(e.t0=e.sent,!e.t0){e.next=10;break}return e.next=9,yj();case 9:e.t0=e.sent;case 10:return e.abrupt("return",e.t0);case 13:return e.prev=13,e.t1=e.catch(0),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(){return e.apply(this,arguments)}}(),hj=function(){var e=Ng(Mg().mark((function e(){var t;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,Sj();case 3:if(e.t0=e.sent,!e.t0){e.next=8;break}return e.next=7,yj();case 7:e.t0=e.sent;case 8:if(!e.t0){e.next=10;break}t.push("H264");case 10:return e.next=12,kj();case 12:if(e.t1=e.sent,!e.t1){e.next=17;break}return e.next=16,bj();case 16:e.t1=e.sent;case 17:if(!e.t1){e.next=19;break}t.push("vp8");case 19:return e.abrupt("return",t);case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),pj=function(){var e=Ng(Mg().mark((function e(){var t;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hj();case 2:return t=e.sent,e.abrupt("return",Jg(t).call(t,(function(e){return e.toUpperCase()})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),vj={};function fj(e){var t,r=!1,n=gy(e.split("\n"));try{for(n.s();!(t=n.n()).done;){var i=t.value;if(qy(i).call(i,"level-asymmetry-allowed=1")&&qy(i).call(i,"packetization-mode=1")&&qy(i).call(i,"profile-level-id=42e0")){r=!0;break}}}catch(J$){n.e(J$)}finally{n.f()}if(r){for(var o=navigator.userAgent.toLowerCase(),a=!1,s=0,c=[/miuibrowser/,/70.*HeyTapBrowser/i];s<c.length;s++){c[s].test(o)&&(a=!0)}return!a}return!1}var _j=function(){var e=Ng(Mg().mark((function e(t){var r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new RTCPeerConnection).addTransceiver("video",{direction:t}),e.next=4,r.createOffer();case 4:return n=e.sent,r.close(),e.abrupt("return",n.sdp.toLowerCase());case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),mj=function(){var e=Ng(Mg().mark((function e(){var t,r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_j("sendonly");case 2:if(r=e.sent,!qy(t=navigator.userAgent).call(t,"VivoBrowser")){e.next=7;break}return e.next=6,_j("sendonly");case 6:r=e.sent;case 7:return vj.h264encode=fj(r),vj.vp8encode=SI(r).call(r,"vp8")>-1,e.abrupt("return",vj);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),gj=function(){var e=Ng(Mg().mark((function e(){var t,r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_j("recvonly");case 2:if(r=e.sent,!qy(t=navigator.userAgent).call(t,"VivoBrowser")){e.next=7;break}return e.next=6,_j("recvonly");case 6:r=e.sent;case 7:return vj.h264decode=fj(r),vj.vp8decode=SI(r).call(r,"vp8")>-1,e.abrupt("return",vj);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),yj=function(){var e=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==vj.h264encode){e.next=9;break}return e.prev=1,e.next=4,mj();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",vj.h264encode||!1);case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(){return e.apply(this,arguments)}}(),Sj=function(){var e=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==vj.h264decode){e.next=9;break}return e.prev=1,e.next=4,gj();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",vj.h264decode||!1);case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(){return e.apply(this,arguments)}}(),bj=function(){var e=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==vj.vp8encode){e.next=9;break}return e.prev=1,e.next=4,mj();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",vj.vp8encode||!1);case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(){return e.apply(this,arguments)}}(),kj=function(){var e=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==vj.vp8decode){e.next=9;break}return e.prev=1,e.next=4,gj();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",vj.vp8decode||!1);case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(){return e.apply(this,arguments)}}(),Ej=function(){return"undefined"!=typeof TransformStream&&"undefined"!=typeof RTCRtpSender&&"undefined"!=typeof RTCRtpReceiver&&void 0!==RTCRtpSender.prototype.createEncodedStreams&&void 0!==RTCRtpReceiver.prototype.createEncodedStreams},Tj=function(){return YL?jL&&lU>=70||FL&&aU>=80||BL&&oU>=14:eU?jL&&lU>=70||FL&&aU>=80:ZL?cU[0]>=14:!!$L&&(jL&&lU>=86)},Ij=jL&&lU<=114,Rj=!FL||aU>=96,Aj=!(BL&&oU<=14),wj=$L&&jL||ZL&&(17===cU[0]||16===cU[0]),Cj=new uT,xj=!0,Oj=function(){var e=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new HI((function(e){var r={all:[],getTrackStats:function(){return[]}},n=wU("STATS_SCALLBACK_SUPPORT");if(xj&&jL&&void 0===window.InstallTrigger&&Ij&&n)try{var i,o,a,s;null===(i=t.getStats((function(t){var r=[];t.result().forEach((function(e){if(!qy(Nj).call(Nj,e.type)){var t={};e.names().forEach((function(r){t[r]=e.stat(r)})),r.push(Zl(Zl({},t),{},{id:e.id,type:e.type,timestamp:e.timestamp}))}})),e({all:r,getTrackStats:function(e){return Iy(r).call(r,(function(t){return"ssrc"!==t.type||t.googTrackId===e}))}})})))||void 0===i||null===(o=i.then)||void 0===o||null===(a=o.call(i,(function(){e(r)})))||void 0===a||null===(s=a.catch)||void 0===s||s.call(a,(function(){xj=!1,e(r)}))}catch(c){xj=!1,e(r)}else e(r)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Pj=function(){var e=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getStats();case 2:return n=e.sent,i={all:[]},o=new uT,n.forEach((function(e){var t=o.get(e.type)||new uT;t.set(e.id,e),o.set(e.type,t),i.all.push(e)})),a=function(e,t){e.forEach((function(e){var r,n,i,a,s,c,u=e.codecId,d=e.transportId,l=e.trackId,h=e.playoutId;if(null===(r=o.get(Dj.codec))||void 0===r||r.forEach((function(e){e.id===u&&t.add(e)})),null===(n=o.get(Dj.transport))||void 0===n||n.forEach((function(e){e.id===d&&(s=e,t.add(e))})),null===(i=o.get(Dj.track))||void 0===i||i.forEach((function(e){e.id===l&&t.add(e)})),null===(a=o.get(Dj.mediaPlayout))||void 0===a||a.forEach((function(e){e.id===h&&t.add(e)})),s){var p,v,f=s,_=f.localCertificateId,m=f.remoteCertificateId,g=f.selectedCandidatePairId;null===(p=o.get(Dj.certificate))||void 0===p||p.forEach((function(e){(e.id===_||e.id===m)&&t.add(e)})),null===(v=o.get(Dj.candidatePair))||void 0===v||v.forEach((function(e){e.id===g&&(c=e,t.add(e))}))}if(c){var y,S,b=c,k=b.localCandidateId,E=b.remoteCandidateId;null===(y=o.get(Dj.localCandidate))||void 0===y||y.forEach((function(e){e.id===k&&t.add(e)})),null===(S=o.get(Dj.remoteCandidate))||void 0===S||S.forEach((function(e){e.id===E&&t.add(e)}))}}))},o.get(Dj.mediaSource)?null===(s=o.get(Dj.mediaSource))||void 0===s||s.forEach((function(e){var t,r=new dj;r.add(e);var n=[];null===(t=o.get(Dj.outboundRtp))||void 0===t||t.forEach((function(t){var i;t.mediaSourceId===e.id&&(r.add(t),n.push(t),null===(i=o.get(Dj.remoteInboundRtp))||void 0===i||i.forEach((function(e){e.localId===t.id&&r.add(e)})))})),a(n,r),i[e.trackIdentifier]=WC(r)})):o.get(Dj.track)&&(null===(c=o.get(Dj.track))||void 0===c||c.forEach((function(e){var t,r=new dj;r.add(e);var n=[];null===(t=o.get(Dj.outboundRtp))||void 0===t||t.forEach((function(t){var i;t.trackId===e.id&&(r.add(t),n.push(t),null===(i=o.get(Dj.remoteInboundRtp))||void 0===i||i.forEach((function(e){e.localId===t.id&&r.add(e)})))})),a(n,r),i[e.trackIdentifier]=WC(r)}))),null===(r=o.get(Dj.inboundRtp))||void 0===r||r.forEach((function(e){var t,r=new dj;r.add(e),null===(t=o.get(Dj.remoteOutboundRtp))||void 0===t||t.forEach((function(t){t.localId===e.id&&r.add(t)})),a([e],r);var n,s=e.trackIdentifier;s||(null===(n=o.get(Dj.track))||void 0===n||n.forEach((function(t){t.id===e.trackId&&(s=t.trackIdentifier)})));i[s]=WC(r)})),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Mj=function(){var e=Ng(Mg().mark((function e(t,r,n){var i,o,a,s,c,u;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null==r?void 0:r.id,t instanceof RTCPeerConnection){e.next=3;break}return e.abrupt("return",[]);case 3:if(!FL&&!BL){e.next=15;break}return o=[],e.prev=5,e.next=8,t.getStats(r);case 8:e.sent.forEach((function(e){o.push(e)})),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(5);case 14:return e.abrupt("return",o);case 15:return(!(a=Cj.get(t))||Date.now()-a.timestamp>150)&&(a={timestamp:Date.now(),statsPromise:Pj(t),extraStatsPromise:Oj(t)},Cj.set(t,a)),e.next=19,a.statsPromise;case 19:if(s=e.sent,c=(i?s[i]:s.all)||[],n){e.next=26;break}return e.next=24,a.extraStatsPromise;case 24:u=e.sent,c=Bg(c).call(c,(i?u.getTrackStats(i):u.all)||[]);case 26:return e.abrupt("return",c);case 27:case"end":return e.stop()}}),e,null,[[5,12]])})));return function(t,r,n){return e.apply(this,arguments)}}(),Dj=function(e){return e.codec="codec",e.inboundRtp="inbound-rtp",e.outboundRtp="outbound-rtp",e.remoteInboundRtp="remote-inbound-rtp",e.remoteOutboundRtp="remote-outbound-rtp",e.mediaSource="media-source",e.csrc="csrc",e.peerConnection="peer-connection",e.dataChannel="data-channel",e.stream="stream",e.track="track",e.transceiver="transceiver",e.sender="sender",e.receiver="receiver",e.transport="transport",e.sctpTransport="sctp-transport",e.candidatePair="candidate-pair",e.localCandidate="local-candidate",e.remoteCandidate="remote-candidate",e.certificate="certificate",e.iceServer="ice-server",e.mediaPlayout="media-playout",e}(Dj||{}),Nj=["codec","inbound-rtp","outbound-rtp","remote-inbound-rtp","remote-outbound-rtp","media-source","csrc","peer-connection","data-channel","stream","track","transceiver","sender","receiver","transport","sctp-transport","candidate-pair","local-candidate","remote-candidate","certificate","ice-server"],Lj={},Uj={},Vj={exports:{}},Fj=Vj.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};LS(Fj).forEach((function(e){Fj[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}));var Bj=Vj.exports;!function(e){var t=function(e){return String(Number(e))===e?Number(e):e},r=function(e,r,n){var i=e.name&&e.names;e.push&&!r[e.push]?r[e.push]=[]:i&&!r[e.name]&&(r[e.name]={});var o=e.push?{}:i?r[e.name]:r;!function(e,r,n,i){if(i&&!n)r[i]=t(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(r[n[o]]=t(e[o+1]))}(n.match(e.reg),o,e.names,e.name),e.push&&r[e.push].push(o)},n=Bj,i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t,o={},a=[],s=o;return Iy(t=e.split(/(\r\n|\r|\n)/)).call(t,i).forEach((function(e){var t=e[0],i=cI(e).call(e,2);"m"===t&&(a.push({rtp:[],fmtp:[]}),s=a[a.length-1]);for(var o=0;o<(n[t]||[]).length;o+=1){var c=n[t][o];if(c.reg.test(i))return r(c,s,i)}})),o.media=a,o};var o=function(e,r){var n=r.split(/=(.+)/,2);return 2===n.length?e[n[0]]=t(n[1]):1===n.length&&r.length>1&&(e[n[0]]=void 0),e};e.parseParams=function(e){var t;return aS(t=e.split(/;\s?/)).call(t,o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){var t;return Jg(t=e.toString().split(" ")).call(t,Number)},e.parseRemoteCandidates=function(e){for(var r,n=[],i=Jg(r=e.split(" ")).call(r,t),o=0;o<i.length;o+=3)n.push({component:i[o],ip:i[o+1],port:i[o+2]});return n},e.parseImageAttributes=function(e){var t;return Jg(t=e.split(" ")).call(t,(function(e){var t;return aS(t=e.substring(1,e.length-1).split(",")).call(t,o,{})}))},e.parseSimulcastStreamList=function(e){var r;return Jg(r=e.split(";")).call(r,(function(e){var r;return Jg(r=e.split(",")).call(r,(function(e){var r,n=!1;return"~"!==e[0]?r=t(e):(r=t(e.substring(1,e.length)),n=!0),{scid:r,paused:n}}))}))}}(Uj);var jj=Bj,Hj=/%[sdv%]/g,Gj=function(e){var t=1,r=arguments,n=r.length;return e.replace(Hj,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},zj=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var o=t.names[i];t.name?n.push(r[t.name][o]):n.push(r[t.names[i]])}else n.push(r[t.name]);return Gj.apply(null,n)},Kj=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Wj=["i","c","b","a"],Xj=Uj,qj=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||Kj,n=t.innerOrder||Wj,i=[];return r.forEach((function(t){jj[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(zj(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(zj(t,r,e))}))}))})),e.media.forEach((function(e){i.push(zj("m",jj.m[0],e)),n.forEach((function(t){jj[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(zj(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(zj(t,r,e))}))}))}))})),i.join("\r\n")+"\r\n"};Lj.write=qj,Lj.parse=Xj.parse,Lj.parseParams=Xj.parseParams,Lj.parseFmtpConfig=Xj.parseFmtpConfig,Lj.parsePayloads=Xj.parsePayloads,Lj.parseRemoteCandidates=Xj.parseRemoteCandidates,Lj.parseImageAttributes=Xj.parseImageAttributes,Lj.parseSimulcastStreamList=Xj.parseSimulcastStreamList;var Yj=Je,Jj=Ur,Qj=Hr,Zj=function(e){for(var t=Yj(this),r=Qj(t),n=arguments.length,i=Jj(n>1?arguments[1]:void 0,r),o=n>2?arguments[2]:void 0,a=void 0===o?r:Jj(o,r);a>i;)t[i++]=e;return t};Cr({target:"Array",proto:!0},{fill:Zj});var $j=Js("Array").fill,eH=ce,tH=$j,rH=Array.prototype,nH=r((function(e){var t=e.fill;return e===rH||eH(rH,e)&&t===rH.fill?tH:t})),iH=new lN("FirefoxHandler",3),oH=Math.pow(2,32),aH="kp34Za0H+aVf862l";function sH(e){return e>oH-18?(iH.warn("generateAllSsrc","reset start id",e),sH(e=e-oH+1e4+18)):{audio:e,audioFec:e+1,audioRtx:e+2,video:e+3,videoFec:e+4,videoRtx:e+5,next:e+18}}var cH=function(e,t,r){var n,i,o;return[{id:r,attribute:"cname",value:arguments.length>3&&void 0!==arguments[3]?arguments[3]:"o/i14u9pJrxRKAsu"},{id:r,attribute:"msid",value:Bg(n=Bg(i="".concat(e," ")).call(i,e,"-")).call(n,t)},{id:r,attribute:"mslabel",value:"".concat(e)},{id:r,attribute:"label",value:Bg(o="".concat(e,"-")).call(o,t)}]},uH=function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t.video,o=t.videoRtx,a=t.videoFec,s=[i,o],c=n.cname,u=n.flexfec;u&&s.push(a);var d,l=aS(s).call(s,(function(t,r){return Bg(t).call(t,cH(e,"video",r,c))}),[]),h=[{semantics:"FID",ssrcs:Bg(r="".concat(i," ")).call(r,o)}];u&&h.push({semantics:"FEC-FR",ssrcs:Bg(d="".concat(i," ")).call(d,a)});return{ssrcs:l,ssrcGroups:h}};function dH(e){return e.direction="inactive",e.port=0,delete e.ext,delete e.ssrcs,delete e.ssrcGroups,delete e.simulcast,delete e.simulcast_03,delete e.rids,delete e.extmapAllowMixed,delete e.msid,delete e.bundleOnly,e}var lH=function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=Zl(Zl({},e),{},{media:[]});return n&&(i.invalid=[{value:"realx-exts:rscp"}]),t&&i.media.push(t),r&&i.media.push(r),delete i.groups,delete i.msidSemantic,Lj.write(i)};function hH(e){return pH.apply(this,arguments)}function pH(){return(pH=Ng(Mg().mark((function e(t){var r,n,i,o,a;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n=t.publicIPs,i=t.certFingerprint,o=t.iceParams,a=t.iceConfig,r.fingerprint={type:"sha-256",hash:i},r.icePwd=o.serverIcePwd,e.next=6,fH(o.serverIceUfrag);case 6:return r.iceUfrag=e.sent,r.candidates=vH(n,a),r.setup="active",r.iceOptions="renomination",e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vH(e,t){if(!Array.isArray(e))return[];var r=0,n=2130706431,i=[];return e.forEach((function(e){var o={component:1,ip:e.ip,type:"host",generation:e.generation};e.udpPorts&&!t.tcpOnly&&e.udpPorts.forEach((function(e){i.push(Zl(Zl({},o),{},{foundation:r++,transport:"udp",port:e,priority:n}))})),e.tcpPorts&&e.tcpPorts.forEach((function(e){i.push(Zl(Zl({},o),{},{foundation:r++,transport:"tcp",port:e,tcptype:"passive",priority:2130705431}))}))})),i}var fH=function(){var e=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new TextEncoder,n=r.encode("PREC"),e.t0=Uint8Array,e.next=5,cL.b64str2ab(t);case 5:return e.t1=e.sent,i=new e.t0(e.t1),o=new Uint8Array(4),crypto.getRandomValues(o),(a=new Uint8Array(2))[0]=0,a[1]=1,s=sL(Uint8Array,n,i,o,a),e.next=15,cL.ab2b64str(s.buffer);case 15:return c=e.sent,e.abrupt("return",c);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_H=function(e){return e[e.kICEConfigTypeSrtpDtlsType=0]="kICEConfigTypeSrtpDtlsType",e[e.kICEConfigTypeRenominationType=1]="kICEConfigTypeRenominationType",e[e.kICEConfigTypeTcpType=2]="kICEConfigTypeTcpType",e[e.kICEConfigTypeMultiSendType=3]="kICEConfigTypeMultiSendType",e[e.kICEConfigTypeKcpType=4]="kICEConfigTypeKcpType",e[e.kICEConfigTypeSrtpSdesType=5]="kICEConfigTypeSrtpSdesType",e}(_H||{});function mH(e){var t,r=e.random,n=e.serverUfrag,i=e.serverPwd,o=e.clientPwd,a=e.options,s=(new TextEncoder).encode("WPRE");r||(r=new Uint8Array(4),crypto.getRandomValues(r));var c=OL(n);c.byteLength;var u=ML(OL(o),OL(i).subarray(0,16),OL(n).subarray(0,16));u.byteLength;var d=new Uint8Array(aS(t=LS(a)).call(t,(function(e,t){var r=Number(t);return e.push(r),e.push(a[r]?1:0),e}),[]));d.byteLength;var l,h=sL(Uint8Array,s,r,[c.byteLength],c,[u.byteLength],u,d);h.byteLength%3!=0&&(h=sL(Uint8Array,h,nH(l=new Uint8Array(3-h.byteLength%3)).call(l,255)));return[PL(h),PL(sL(Uint8Array,r,c.subarray(0,20)))]}var gH=function(e,t){var r=0;if(Array.isArray(e.fmtp)&&Array.isArray(e.rtp)){var n,i=gy(e.fmtp);try{for(i.s();!(n=i.n()).done;){var o,a,s,c=n.value;if(qy(o=c.config).call(o,"level-asymmetry-allowed=1")&&qy(a=c.config).call(a,"packetization-mode=1")&&qy(s=c.config).call(s,"profile-level-id=42e0")){r=c.payload;break}}}catch(J$){i.e(J$)}finally{i.f()}for(var u=0;u<e.rtp.length;u++){var d=e.rtp[u];if("H264"===t){if(d.payload===r){var l;e.rtp.unshift(jI(l=e.rtp).call(l,u,1)[0]);break}}else if(d.codec===t){var h;e.rtp.unshift(jI(h=e.rtp).call(h,u,1)[0]);break}}var p=[];e.rtp.forEach((function(e){return p.push(e.payload)})),e.payloads=p.join(" ")}},yH=function(e){var t,r=Lj.parse(e);return r.media=Jg(t=r.media).call(t,(function(e){return"audio"===e.type?kH(e,r):bH(e,["H264","VP8"],r)})),Lj.write(r)},SH=function(e){e.media.forEach((function(e){"audio"!==e.type&&"video"!==e.type||e.rtp.forEach((function(t){var r;e.rtcpFb||(e.rtcpFb=[]),sI(r=e.rtcpFb).call(r,(function(e){return e.payload===t.payload&&"rrtr"===e.type}))||e.rtcpFb.push({payload:t.payload,type:"rrtr"})}))}))},bH=function(e,t,r){var n,i,o,a,s,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{rrtr:!1},u={},d={},l=-1,h=[];(Array.isArray(e.fmtp)&&e.fmtp.forEach((function(e){var t=e.payload,r=e.config;if(_C(r).call(r,"apt=")){var n=cI(r).call(r,4);u[t]=n}else qy(r).call(r,"42e0")&&qy(r).call(r,"packetization-mode=1")&&(l=t)})),Array.isArray(e.rtp))&&(e.rtp=Iy(n=e.rtp).call(n,(function(e){var r,n=e.codec,i=e.payload;switch(n){case"H264":return r=!1,Jg(t).call(t,(function(e){"H264"===e&&i===l&&(d[i]=i,h.push(i),r=!0)})),r;case"rtx":return!!d[u[i]]&&(d[i]=i,!0);case"red":case"ulpfec":case"flexfec-03":return d[i]=i,!0;default:return r=!1,Jg(t).call(t,(function(e){e===n&&(d[i]=i,h.push(i),r=!0)})),r}})));Array.isArray(e.fmtp)&&(e.fmtp=Iy(i=e.fmtp).call(i,(function(e){return d[e.payload]})));Array.isArray(e.rtcpFb)?e.rtcpFb=Iy(o=e.rtcpFb).call(o,(function(e){return d[e.payload]})):e.rtcpFb=[];(c.rrtr&&h.forEach((function(t){var r;null===(r=e.rtcpFb)||void 0===r||r.push({payload:t,type:"rrtr"})})),EH(e,r),Array.isArray(e.ext))&&(e.ext=Iy(a=e.ext).call(a,(function(e){if("http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"!==e.uri&&"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"!==e.uri&&"http://www.webrtc.org/experiments/rtp-hdrext/color-space"!==e.uri)return e})));"string"==typeof e.payloads&&(e.payloads=Iy(s=e.payloads.split(" ")).call(s,(function(e){return d[e]})).join(" "));return e},kH=function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{rrtr:!1},i={};Array.isArray(e.rtp)&&(e.rtp=Iy(r=e.rtp).call(r,(function(e){var t=e.codec,r=e.payload;return("opus"===t||"red"===t)&&(i[r]=r,!0)})));if(Array.isArray(e.rtcpFb)||(e.rtcpFb=[]),n.rrtr&&LS(i).forEach((function(t){var r;null===(r=e.rtcpFb)||void 0===r||r.push({payload:Number(t),type:"rrtr"})})),EH(e,t),"string"==typeof e.payloads){var o=[];e.payloads.split(" ").forEach((function(e){i[e]&&o.push(e)})),e.payloads=o.join(" ")}return e},EH=function(e,t){e.iceOptions&&delete e.iceOptions,e.icePwd&&(t.icePwd=e.icePwd,delete e.icePwd),e.iceUfrag&&(t.iceUfrag=e.iceUfrag,delete e.iceUfrag),e.fingerprint&&(t.fingerprint=e.fingerprint,delete e.fingerprint)},TH=function(e){VA(n,e);var t,r=tw(n);function n(e,t){var i;return Bh(this,n),Jl(sA(i=r.call(this)),"_peerConnection",void 0),Jl(sA(i),"_dataChannel",void 0),Jl(sA(i),"_context",void 0),Jl(sA(i),"peerConnectionMode",0),Jl(sA(i),"id",void 0),Jl(sA(i),"_monitor",void 0),Jl(sA(i),"logger",void 0),Jl(sA(i),"_nextSsrc",Math.floor(Math.random()*oH+1e4)),Jl(sA(i),"_aSendonlyAnswerTpl",void 0),Jl(sA(i),"_vSendonlyAnswerTpl",void 0),Jl(sA(i),"_enableSubFlexfec",!1),Jl(sA(i),"audioTrack4ff",void 0),Jl(sA(i),"setLocalDescription",void 0),Jl(sA(i),"setRemoteDescription",void 0),i.peer=t,i.id=e.id,i._monitor=KD(i.id),i.logger=new lN("BasicHandler",3,e.id),i._peerConnection=t.getOriginRTCPeerConnection(),i._dataChannel=t.getOriginRTCDataChannel(),i.setLocalDescription=t.setLocalDescription.bind(t),i.setRemoteDescription=t.setRemoteDescription.bind(t),i._context=e,i.peer.on("ontrack",(function(e){i.emit("ontrack",e)})),i}return Fh(n,[{key:"destroy",value:function(){this.logger.info("destroy",this.peerConnectionId||""),LA(NA(n.prototype),"removeAllListeners",this).call(this)}},{key:"getTransceivers",value:function(){return this._peerConnection.getTransceivers()}},{key:"getConnectionState",value:function(){return this._peerConnection.connectionState}},{key:"_simulcast",value:function(e,t,r,n,i){var o,a,s,c=[];1===e.videoEncodeConfig.length?(c=function(e,t){var r=[];if(t<=1)return r;var n=Math.min(e.width,e.height)/90;return r.push({scaleResolutionDownBy:n,width:Math.floor(e.width/n),height:Math.floor(e.height/n),maxkbps:100,frameRate:10}),t<=2||r.unshift({scaleResolutionDownBy:2,width:Math.floor(e.width/2),height:Math.floor(e.height/2),maxkbps:Math.floor(e.maxKbps/2),frameRate:e.frameRate>=30?Math.floor(e.frameRate/2):e.frameRate}),r}(t,i),this.logger.info("simulcast() ","simulcastLayers: %o",c)):(c=Jg(o=cI(a=cI(s=e.videoEncodeConfig).call(s,1)).call(a,1-i)).call(o,(function(e){if(e.width>e.height&&t.width<t.height||e.width<e.height&&t.width>t.height){var r=e.width;e.width=e.height,e.height=r}var n=xL(e.width),i=t.width/n;return{width:n,height:Math.floor(t.height/i),scaleResolutionDownBy:i,frameRate:xL(e.frameRate)||15,maxkbps:e.maxKbps||600}})),this.logger.info("simulcast() ","simulcastLayers2: %o",c));var u=[!0];c.forEach((function(e,t){var i,o={maxBitrate:1e3*e.maxkbps,scaleResolutionDownBy:e.scaleResolutionDownBy,rid:"".concat(t+1),maxFramerate:e.frameRate};null===(i=r.sendEncodings)||void 0===i||i.unshift(o),n.push({width:e.width,height:e.height,framerate:e.frameRate,maxkbps:e.maxkbps,rid:"".concat(t+1)}),u.push(!0)})),this._context&&(this._context.activeSimStreams=u)}},{key:"internalPublish",value:function(e){var t=e.stream,r=e.videoTrack,n=e.audioTrack,i=e.enableSimulcast,o=e.pubAudio,a=e.pubVideo,s={direction:"sendonly",streams:[t]},c={direction:"sendonly",streams:[t]},u=[],d=[];if(Array.isArray(null==e?void 0:e.videoEncodeConfig)&&e.videoEncodeConfig.length){var l,h,p=null==r?void 0:r.preprocessingTrack,v=Zl({},PU);if(p){var f=null==p?void 0:p.getSettings();v={width:Math.floor(f.width),height:Math.floor(f.height),frameRate:Math.floor(f.frameRate)}}"number"!=typeof v.frameRate&&(v.frameRate=30);var _=null==e?void 0:e.videoEncodeConfig[0],m={maxBitrate:1e3*_.maxKbps,rid:"0"};if(e.prevBitrate=_.maxKbps,c.sendEncodings=[m],u.push({width:v.width,height:v.height,framerate:v.frameRate,maxkbps:_.maxKbps,rid:"0"}),i&&(!FL||"VP8"===(null===(l=this._context)||void 0===l||null===(h=l.serverConfig)||void 0===h?void 0:h.videoCodec))){var g,y,S=function(e){for(var t=0,r=e.width*e.height,n=0;n<yV.length;n++)if(r>=yV[n].totalPixels){t=n;break}if(0===t)return yV[t].maxLayers;var i=yV[t-1].totalPixels;return(i-r)/(i-yV[t].totalPixels)<.1?yV[t-1].maxLayers:yV[t].maxLayers}(v);if(this.logger.info("simulcast() ","maxLayers: %o",S),S>1)this._simulcast(e,Zl(Zl({},v),{},{maxKbps:_.maxKbps}),c,u,S),null!==(g=this._context)&&void 0!==g&&null!==(y=g.serverConfig)&&void 0!==y&&y.simulcastOnDemand&&(d=Jg(u).call(u,(function(e,t){return Zl(Zl({},e),{},{video_index:t,sub_index:t})})))}}this.logger.info("publish videoTransceiverInit videoDescriptions","",c,u);var b=null==n?void 0:n.preprocessingTrack;(null==n?void 0:n.mixType)!==Dh.PLAYOUT&&null!=n&&n.mixedAudioTrack&&(b=null==n?void 0:n.mixedAudioTrack),b=o&&b?b:"audio";var k=null==r?void 0:r.preprocessingTrack;k=a&&k?k:"video";try{this._reportRtcInvokeStatus("Handler.internalPublish",zg({aTrack:mx(b),vTrack:mx(k),audioTransceiverInit:s,videoTransceiverInit:c}))}catch(Y$){}return{semantics:"unified-plan",videoDescriptions:u,subVideoDescriptions:d,audioTransceiverInit:{track:b,init:s},videoTransceiverInit:{track:k,init:c}}}},{key:"updateMaxBitrate",value:function(e){var t,r,n,i;this.logger.info("updateMaxBitrate()");var o=null===(t=e.videoTrack)||void 0===t?void 0:t.preprocessingTrack,a=e.videoTransceiver;if(o&&e.pubVideo&&a){var s=null===(r=e.videoEncodeConfig)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.maxKbps;if(s){if(s===e.prevBitrate)return void this.logger.warn("updateMaxBitrate()","no change");e.prevBitrate=s}var c=null===(i=a.sender)||void 0===i?void 0:i.getParameters();if(c){var u;c.encodings=null==c||null===(u=c.encodings)||void 0===u?void 0:Jg(u).call(u,(function(t){var r,n=Number(t.rid)||0,i=null===(r=e.videoEncodeConfig[n])||void 0===r?void 0:r.maxKbps;return"number"==typeof i&&(t.maxBitrate=1e3*i),t})),null==a||a.sender.setParameters(c);try{this._reportRtcInvokeStatus("Handler.updateScaleResolutionDownBy",zg(c.encodings))}catch(Y$){}}}else this.logger.warn("updateMaxBitrate()","no pub")}},{key:"getStats",value:function(e,t){return Mj(this._peerConnection,e,t)}},{key:"setCurrentDescription",value:(t=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"createAVMlineAnswerTpl",value:function(e){var t=this,r=Lj.parse(e);r.media.forEach((function(e){if("audio"===e.type){if("sendonly"===e.direction){var r,n=null==e?void 0:sI(r=e.rtp).call(r,(function(e){return"opus"===e.codec}));if(n&&null!=e&&e.fmtp){var i,o=null==e?void 0:sI(i=e.fmtp).call(i,(function(e){return e.payload===n.payload}));o&&t._context&&(o.config+=";stereo=1;sprop-stereo=1")}t._aSendonlyAnswerTpl=e}}else"video"===e.type&&("sendonly"===e.direction&&(t._vSendonlyAnswerTpl=e),Array.isArray(e.rtp)&&e.rtp.forEach((function(e){var r;null!==(r=e.codec)&&void 0!==r&&qy(r).call(r,"flexfec")&&(t._enableSubFlexfec=!0)})))})),Aj&&SH(r)}},{key:"pc",get:function(){return this._peerConnection}},{key:"peerConnectionId",get:function(){return this.peer.getConnectionId()||""}},{key:"addBitrateLimit",value:function(e,t){null==e||e.rtp.forEach((function(r){var n,i=r.codec,o=r.payload;if(qy(n=["vp8","h264"]).call(n,i.toLocaleLowerCase())){var a,s,c=sI(a=e.fmtp).call(a,(function(e){return e.payload===o}));if(c)c.config=Bg(s=[]).call(s,rR(c.config.split(";")),["x-google-min-bitrate=100","x-google-start-bitrate=".concat(t)]).join(";");else e.fmtp.push({payload:o,config:"x-google-min-bitrate=100;x-google-start-bitrate=".concat(t)})}}))}},{key:"_report",value:function(e,t,r){var n;null===(n=this._monitor)||void 0===n||n.report(e,Zl(Zl({},t),{},{connection_id:this.peer.getConnectionId(),group_connection_id:this.peer.getGroupConnectionId()}),r)}},{key:"_reportRtcInvokeStatus",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0;this._report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:r,stream_id:n,elapse:0},i)}}]),n}(rV.EventEmitter),IH=function(e){VA(v,e);var t,r,n,i,o,a,s,c,u,d,l,h,p=tw(v);function v(){var e,t,r;return Bh(this,v),Jl(sA(r=p.call(this)),"deviceMap",{audioinput:new uT,audiooutput:new uT,videoinput:new uT}),Jl(sA(r),"checkDeviceChangeTimer",null),Jl(sA(r),"isSupportedPermissionsQuery",!1),Jl(sA(r),"isGrantedMicrophonePermission",!1),Jl(sA(r),"isGrantedCameraPermission",!1),r.isSupportedPermissionsQuery=!NL()&&!(null===(e=navigator)||void 0===e||null===(t=e.permissions)||void 0===t||!t.query),r._handleDeviceChange=r._handleDeviceChange.bind(sA(r)),!NL()&&r.initListener().then((function(){r.updateDeviceListInSilent()})),r}return Fh(v,[{key:"refreshDevices",value:(h=Ng(Mg().mark((function e(){var t,r,n,i=this,o=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:"audio",navigator.mediaDevices){e.next=3;break}return e.abrupt("return");case 3:if(r=void 0,!FL){e.next=19;break}if(e.prev=5,"audio"!==t){e.next=12;break}return e.next=9,navigator.mediaDevices.getUserMedia({audio:!0});case 9:r=e.sent,e.next=15;break;case 12:return e.next=14,navigator.mediaDevices.getUserMedia({video:!0});case 14:r=e.sent;case 15:e.next=19;break;case 17:e.prev=17,e.t0=e.catch(5);case 19:return e.next=21,navigator.mediaDevices.enumerateDevices();case 21:n=e.sent,r&&r.getTracks().forEach((function(e){return e.stop()})),n.forEach((function(e){var t;e.deviceId&&(null===(t=i.deviceMap[e.kind])||void 0===t||t.set(e.deviceId,e))}));case 24:case"end":return e.stop()}}),e,null,[[5,17]])}))),function(){return h.apply(this,arguments)})},{key:"initListener",value:(l=Ng(Mg().mark((function e(){var t,r,n,i,o=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null===(t=navigator.mediaDevices)||void 0===t?void 0:t.ondevicechange)&&"function"==typeof(null===(r=navigator.mediaDevices)||void 0===r?void 0:r.addEventListener)?navigator.mediaDevices.addEventListener("devicechange",(function(){o._handleDeviceChange(),setTimeout((function(){o._handleDeviceChange()}),300)})):this.checkDeviceChangeTimer=window.setInterval((function(){o._handleDeviceChange()}),3e3),!this.isSupportedPermissionsQuery){e.next=22;break}return e.prev=2,e.next=5,navigator.permissions.query({name:"microphone"});case 5:n=e.sent,this.isGrantedMicrophonePermission="granted"===n.state,n.addEventListener("change",(function(){o.isGrantedMicrophonePermission="granted"===n.state})),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(2);case 12:return e.prev=12,e.next=15,navigator.permissions.query({name:"camera"});case 15:i=e.sent,this.isGrantedCameraPermission="granted"===i.state,i.addEventListener("change",(function(){o.isGrantedCameraPermission="granted"===i.state})),e.next=22;break;case 20:e.prev=20,e.t1=e.catch(12);case 22:case"end":return e.stop()}}),e,this,[[2,10],[12,20]])}))),function(){return l.apply(this,arguments)})},{key:"_handleDeviceChange",value:(d=Ng(Mg().mark((function e(){var t,r,n,i,o,a,s,c=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices){e.next=2;break}return e.abrupt("return");case 2:if(o=void 0,!FL){e.next=7;break}return e.next=6,navigator.mediaDevices.getUserMedia({audio:!0});case 6:o=e.sent;case 7:return e.next=9,navigator.mediaDevices.enumerateDevices();case 9:a=e.sent,a=Iy(a).call(a,(function(e){return!!e.deviceId})),o&&o.getTracks().forEach((function(e){return e.stop()})),s=WC(Bg(t=[]).call(t,rR(uw(r=this.deviceMap.audioinput).call(r)),rR(uw(n=this.deviceMap.videoinput).call(n)),rR(uw(i=this.deviceMap.audiooutput).call(i)))),(QL||qL)&&!s.length&&a.length&&a.forEach((function(e){var t;null===(t=c.deviceMap[e.kind])||void 0===t||t.set(e.deviceId,e)})),a.forEach((function(e){var t,r,n=c.deviceMap[e.kind].get(e.deviceId);c.deviceMap[e.kind].set(e.deviceId,e),n||(qy(t=e.kind).call(t,"video")?c.emit(Uh.onVideoDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"active"}):qy(r=e.kind).call(r,"audio")&&c.emit(Uh.onAudioDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"active"}))})),s.forEach((function(e){var t,r;sI(a).call(a,(function(t){return t.deviceId===e.deviceId&&t.kind===e.kind}))||(c.deviceMap[e.kind].delete(e.deviceId),qy(t=e.kind).call(t,"video")?c.emit(Uh.onVideoDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"inactive"}):qy(r=e.kind).call(r,"audio")&&c.emit(Uh.onAudioDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"inactive"}))}));case 16:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"getUserMedia",value:(u=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia(t);case 2:return r=e.sent,null!=t&&t.audio&&(this.isGrantedMicrophonePermission=!0),null!=t&&t.video&&(this.isGrantedCameraPermission=!0),null!=t&&t.video?this.refreshDevices("video"):this.refreshDevices("audio"),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"checkPermissionsByDevices",value:(c=Ng(Mg().mark((function e(){var t,r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={audio:!1,video:!1},navigator.mediaDevices){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,navigator.mediaDevices.enumerateDevices();case 5:return r=e.sent,t.audio=Iy(r).call(r,(function(e){return"audioinput"===e.kind&&e.label&&e.deviceId})).length>0,t.video=Iy(r).call(r,(function(e){return"videoinput"===e.kind&&e.label&&e.deviceId})).length>0,e.abrupt("return",t);case 9:case"end":return e.stop()}}),e)}))),function(){return c.apply(this,arguments)})},{key:"getPermissions",value:(s=Ng(Mg().mark((function e(){var t,r,n,i,o,a,s,c,u,d,l=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(r=l.length>0&&void 0!==l[0]?l[0]:{}).audio,i=r.video,o=r.force,n||i||(n=!0,i=!0),a={audio:!1,video:!1,reason:void 0},o){e.next=30;break}if(!this.isSupportedPermissionsQuery){e.next=20;break}if(!n||!i){e.next=14;break}if(!this.isGrantedMicrophonePermission||!this.isGrantedCameraPermission){e.next=12;break}return a.audio=!0,a.video=!0,e.abrupt("return",a);case 12:e.next=18;break;case 14:if(!(n&&this.isGrantedMicrophonePermission||i&&this.isGrantedCameraPermission)){e.next=18;break}return a.audio=this.isGrantedMicrophonePermission,a.video=this.isGrantedCameraPermission,e.abrupt("return",a);case 18:e.next=30;break;case 20:return e.next=22,this.checkPermissionsByDevices();case 22:if(s=e.sent,!n||!i){e.next=28;break}if(!s.audio||!s.video){e.next=26;break}return e.abrupt("return",s);case 26:e.next=30;break;case 28:if(!(n&&s.audio||i&&s.video)){e.next=30;break}return e.abrupt("return",s);case 30:if(null===(t=navigator.mediaDevices)||void 0===t||!t.getUserMedia){e.next=70;break}return e.prev=31,e.next=34,navigator.mediaDevices.getUserMedia({audio:n,video:i});case 34:(c=e.sent)&&(c.getTracks().forEach((function(e){return e.stop()})),n&&(a.audio=!0,this.isGrantedMicrophonePermission=!0),i&&(a.video=!0,this.isGrantedCameraPermission=!0)),e.next=70;break;case 38:if(e.prev=38,e.t0=e.catch(31),a.reason=e.t0,!this.isSupportedPermissionsQuery){e.next=70;break}if(!n){e.next=56;break}return e.next=45,navigator.permissions.query({name:"microphone"}).catch((function(){}));case 45:if(e.t2=u=e.sent,e.t1=null===e.t2,e.t1){e.next=49;break}e.t1=void 0===u;case 49:if(!e.t1){e.next=53;break}e.t3=void 0,e.next=54;break;case 53:e.t3=u.state;case 54:e.t4=e.t3,a.audio="granted"===e.t4;case 56:if(!i){e.next=70;break}return e.next=59,navigator.permissions.query({name:"camera"}).catch((function(){}));case 59:if(e.t6=d=e.sent,e.t5=null===e.t6,e.t5){e.next=63;break}e.t5=void 0===d;case 63:if(!e.t5){e.next=67;break}e.t7=void 0,e.next=68;break;case 67:e.t7=d.state;case 68:e.t8=e.t7,a.video="granted"===e.t8;case 70:if(!n){e.next=75;break}return e.next=73,this.refreshDevices("audio");case 73:e.next=77;break;case 75:return e.next=77,this.refreshDevices("video");case 77:return e.abrupt("return",a);case 78:case"end":return e.stop()}}),e,this,[[31,38]])}))),function(){return s.apply(this,arguments)})},{key:"updateDeviceListInSilent",value:(a=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.isGrantedCameraPermission&&this.isGrantedMicrophonePermission&&this.refreshDevices("audio");case 1:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"enumerateDevices",value:(o=Ng(Mg().mark((function e(){var t,r,n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions();case 2:return e.next=4,this.refreshDevices();case 4:return e.abrupt("return",WC(Bg(t=[]).call(t,rR(uw(r=this.deviceMap.audioinput).call(r)),rR(uw(n=this.deviceMap.videoinput).call(n)),rR(uw(i=this.deviceMap.audiooutput).call(i)))));case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"enumerateAudioCaptureDevices",value:(i=Ng(Mg().mark((function e(){var t;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions({audio:!0});case 2:return e.next=4,this.refreshDevices();case 4:return e.abrupt("return",WC(uw(t=this.deviceMap.audioinput).call(t)));case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"enumerateVideoCaptureDevices",value:(n=Ng(Mg().mark((function e(){var t;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions({video:!0});case 2:return e.next=4,this.refreshDevices("video");case 4:return e.abrupt("return",WC(uw(t=this.deviceMap.videoinput).call(t)));case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"enumerateAudioPlaybackDevices",value:(r=Ng(Mg().mark((function e(){var t;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions({audio:!0});case 2:return e.next=4,this.refreshDevices("audio");case 4:return e.abrupt("return",WC(uw(t=this.deviceMap.audiooutput).call(t)));case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getDeviceById",value:(t=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices();case 2:return r=e.sent,e.abrupt("return",sI(r).call(r,(function(e){return e.deviceId===t})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),v}(oV),RH=new IH;!NL()&&(window.__rtc_dd__=RH);var AH=new lN("InternalEventBus",1),wH=function(e){return e.ON_IOS_INTERRUPTION_START="ON_IOS_INTERRUPTION_START",e.ON_IOS_INTERRUPTION_END="ON_IOS_INTERRUPTION_END",e.ON_IOS_LOCAL_TRACK_MUTE="ON_IOS_LOCAL_TRACK_MUTE",e.ON_IOS_LOCAL_TRACK_UNMUTE="ON_IOS_LOCAL_TRACK_UNMUTE",e}(wH||{}),CH=function(e){VA(r,e);var t=tw(r);function r(){return Bh(this,r),t.apply(this,arguments)}return Fh(r,[{key:"emit",value:function(e){var t,n;AH.info(e);for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return(t=LA(NA(r.prototype),"emit",this)).call.apply(t,Bg(n=[this,e]).call(n,o))}}]),r}(rV.EventEmitter),xH=new CH,OH=new lN("AudioContext",1),PH=function(){function e(){var t=this;Bh(this,e),Jl(this,"_audioContextInstance",void 0),Jl(this,"_previousState",""),Jl(this,"_currentState",""),Jl(this,"_contextStuckAt",0);var r=0;NL()||setInterval((function(){if(t._audioContextInstance){var e=t._audioContextInstance.currentTime;t._contextStuckAt?t._contextStuckAt!==e&&(t._contextStuckAt=0,OH.info("currentTime resume"),GD("currentTime resume","")):e&&r===e&&(t._contextStuckAt=e,OH.warn("currentTime stuck",t._contextStuckAt),t._audioContextInstance.suspend(),t._audioContextInstance.resume(),GD("AudioContext currentTime stuck",t._contextStuckAt)),r=e}}),3e3)}return Fh(e,[{key:"getAudioContextInstance",value:function(){var e=this;if(!this._audioContextInstance){var t=window.AudioContext||window.webkitAudioContext;this._audioContextInstance=new t,this._audioContextInstance.onstatechange=function(){var t,r,n;OH.warn("state change",null===(t=e._audioContextInstance)||void 0===t?void 0:t.state),e._previousState=e._currentState,e._currentState=(null===(r=e._audioContextInstance)||void 0===r?void 0:r.state)||"","interrupted"===(null===(n=e._audioContextInstance)||void 0===n?void 0:n.state)&&e._audioContextInstance.resume(),(ZL||qL)&&("running"===e._previousState&&"interrupted"===e._currentState&&xH.emit(wH.ON_IOS_INTERRUPTION_START),"interrupted"===e._previousState&&"running"===e._currentState&&xH.emit(wH.ON_IOS_INTERRUPTION_END))}}return this._audioContextInstance}}]),e}(),MH=function(){function e(t){Bh(this,e),Jl(this,"_ctx",void 0),Jl(this,"_analyserNode",void 0),Jl(this,"_audioSource",void 0),Jl(this,"currentTrackId",void 0),this.currentTrackId=t.id;var r=DH.getAudioContextInstance();if(t instanceof MediaStreamTrack){var n=new MediaStream;n.addTrack(t),this._audioSource=r.createMediaStreamSource(n)}else this._audioSource=r.createMediaElementSource(t),this._audioSource.connect(r.destination);var i=r.createAnalyser();this._audioSource.connect(i),this._analyserNode=i,this._ctx=r}var t;return Fh(e,[{key:"getAudioLevel",value:function(){var e;"suspended"===(null===(e=this._ctx)||void 0===e?void 0:e.state)&&this._ctx.resume();var t=new Uint8Array(2048);this._analyserNode.getByteTimeDomainData(t);var r=0;t.forEach((function(e){return r=Math.max(r,Math.abs(e-128))}));var n=r/128*255;return n>2?n:0}},{key:"resume",value:(t=Ng(Mg().mark((function e(){var t;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=this._ctx)||void 0===t?void 0:t.resume();case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){this._audioSource.disconnect(),this._analyserNode.disconnect()}}]),e}(),DH=new PH,NH=function(e){return e[e.CAPTURE=0]="CAPTURE",e[e.PRE_PROCESSING=1]="PRE_PROCESSING",e[e.ENCODE=2]="ENCODE",e[e.TRANSFER=3]="TRANSFER",e[e.POST_PROCESSING=4]="POST_PROCESSING",e[e.DECODE=5]="DECODE",e[e.RENDERING=6]="RENDERING",e}(NH||{}),LH=function(){function e(t){Bh(this,e),Jl(this,"_plugins",new uT),this.id=t}var t;return Fh(e,[{key:"register",value:function(e){var t=this._plugins.get(e.type)||[];if(tC(t).call(t,(function(t){return t.name===e.name}))>-1)throw new Error("Failed to register ".concat(e.name,": name is repeated."));t.push(e),this._plugins.set(e.type,t)}},{key:"getPluginsByType",value:function(e){return this._plugins.get(e)||[]}},{key:"getPluginByName",value:function(e,t){var r;return sI(r=this._plugins.get(e)||[]).call(r,(function(e){return e.name===t}))}},{key:"getPreProcessingTrack",value:(t=Ng(Mg().mark((function e(t){var r,n,i,o,a;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this._plugins.get(1)||[],n=t.mediaTrack,i=gy(r),e.prev=3,i.s();case 5:if((o=i.n()).done){e.next=12;break}return a=o.value,e.next=9,a.effect(t,n);case 9:n=e.sent;case 10:e.next=5;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),i.e(e.t0);case 17:return e.prev=17,i.f(),e.finish(17);case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,this,[[3,14,17,20]])}))),function(e){return t.apply(this,arguments)})},{key:"destroy",value:function(){this._plugins.forEach((function(e){e.forEach((function(e){return e.destroy()}))})),this._plugins.clear()}}]),e}(),UH=function(e){return e[e.EXTERNAL=0]="EXTERNAL",e[e.INTERNAL=1]="INTERNAL",e}(UH||{}),VH=new lN("VERTC",0),FH=function(){function e(){Bh(this,e),Jl(this,"_ac",void 0),Jl(this,"_sourceNode",void 0),Jl(this,"_gainNode",void 0),Jl(this,"_destNode",void 0),this._ac=DH.getAudioContextInstance(),this._gainNode=this._ac.createGain(),this._destNode=this._ac.createMediaStreamDestination(),this._gainNode.connect(this._destNode)}return Fh(e,[{key:"setVolume",value:function(e){this._gainNode.gain.value=e/100}},{key:"getVolume",value:function(){return Math.round(100*this._gainNode.gain.value)}},{key:"updateInputTrack",value:function(e){this._sourceNode&&(this._sourceNode.mediaStream.getTracks().forEach((function(e){e.stop()})),delete this._sourceNode);var t=new MediaStream;t.addTrack(e),this._sourceNode=this._ac.createMediaStreamSource(t),this._sourceNode.connect(this._gainNode)}},{key:"getOutputTrack",value:function(){return this._destNode.stream.getTracks()[0]}},{key:"destroy",value:function(){var e,t;null===(e=this._sourceNode)||void 0===e||e.mediaStream.getTracks().forEach((function(e){e.stop()})),13!==oU&&this._destNode.stream.getTracks().forEach((function(e){e.stop()})),null===(t=this._sourceNode)||void 0===t||t.disconnect(),this._gainNode.disconnect(),delete this._sourceNode}}]),e}(),BH=function(e){VA(r,e);var t=tw(r);function r(e,n){var i;return Bh(this,r),Jl(sA(i=t.call(this)),"sourceType",1),Jl(sA(i),"_originTrack",void 0),Jl(sA(i),"_trackId",void 0),Jl(sA(i),"_channelCount",void 0),i._trackId=n,i._originTrack=e,i._channelCount=e.getSettings().channelCount,i}return Fh(r,[{key:"getId",value:function(){return this._trackId}},{key:"channelCount",get:function(){var e;return null!==(e=this._channelCount)&&void 0!==e?e:0}},{key:"originTrack",get:function(){return this._originTrack},set:function(e){this._originTrack=e,this._channelCount=mediaTrack.getSettings().channelCount}},{key:"destroy",value:function(){this._originTrack.stop()}}]),r}(oV),jH=function(e){VA(n,e);var t,r=tw(n);function n(e,t){var i;return Bh(this,n),Jl(sA(i=r.call(this,e,t)),"_mediaTrack",void 0),Jl(sA(i),"_preProcessingTrack",void 0),Jl(sA(i),"_ap",void 0),Jl(sA(i),"_extensionManager",void 0),Jl(sA(i),"captureSessionId",""),Jl(sA(i),"handleTrackEnded",(function(){i.emit("track-ended",sA(i)),i.close()})),Jl(sA(i),"handleMute",(function(){i.emit("track-mute",sA(i))})),Jl(sA(i),"handleUnmute",(function(){i.emit("track-unmute",sA(i))})),i._initListeners(),i}return Fh(n,[{key:"withWebAudio",get:function(){return!!this._ap}},{key:"mediaTrack",get:function(){var e;return null!==(e=this._mediaTrack)&&void 0!==e?e:this._originTrack}},{key:"preprocessingTrack",get:function(){var e;return null!==(e=this._preProcessingTrack)&&void 0!==e?e:this.mediaTrack}},{key:"setTrack",value:function(e,t){this._originTrack=e,this._ap&&(this._ap.updateInputTrack(e),this._mediaTrack=this._ap.getOutputTrack()),t&&this.generatePreProcessingTrack(t)}},{key:"generatePreProcessingTrack",value:(t=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._extensionManager=t,this._preProcessingTrack=void 0,e.prev=2,e.next=5,t.getPreProcessingTrack(this);case 5:(r=e.sent)instanceof MediaStreamTrack&&(this._preProcessingTrack=r),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0);case 12:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(e){return t.apply(this,arguments)})},{key:"close",value:function(){var e,t;this._originTrack.removeEventListener("ended",this.handleTrackEnded),this._originTrack.removeEventListener("mute",this.handleMute),this._originTrack.removeEventListener("unmute",this.handleUnmute),null===(e=this._preProcessingTrack)||void 0===e||e.stop(),null===(t=this._mediaTrack)||void 0===t||t.stop(),this._ap&&this._ap.destroy(),LA(NA(n.prototype),"destroy",this).call(this)}},{key:"_initListeners",value:function(){this._originTrack instanceof MediaStreamTrack&&(this._originTrack.addEventListener("ended",this.handleTrackEnded),this._originTrack.addEventListener("mute",this.handleMute),this._originTrack.addEventListener("unmute",this.handleUnmute))}}]),n}(BH),HH=function(e){VA(r,e);var t=tw(r);function r(e,n){var i;return Bh(this,r),Jl(sA(i=t.call(this,e,n)),"_mediaTrack",void 0),Jl(sA(i),"_ap",void 0),Jl(sA(i),"player",void 0),i._originTrack=e,i}return Fh(r,[{key:"mediaTrack",get:function(){var e;return null!==(e=this._mediaTrack)&&void 0!==e?e:this._originTrack}},{key:"preprocessingTrack",get:function(){return this.mediaTrack}},{key:"withWebAudio",get:function(){return!!this._ap}},{key:"setPlayer",value:function(e){this.player=e}},{key:"close",value:function(){this._ap&&this._ap.destroy()}}]),r}(BH),GH=function(e){VA(n,e);var t,r=tw(n);function n(e,t){var i;return Bh(this,n),Jl(sA(i=r.call(this,e,t)),"mediaType","video"),Jl(sA(i),"resolution",void 0),Jl(sA(i),"dummy",!1),Jl(sA(i),"videoPlayer",void 0),i.resolution={width:0,height:0},i}return Fh(n,[{key:"updateVideoCaptureConfig",value:(t=Ng(Mg().mark((function e(t){var r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return VH.info("updateVideoEncoderConfig","update localVideoTrack: ",t),delete(r=Zl({},t)).contentHint,FL&&this.streamIndex===ch.STREAM_INDEX_MAIN&&(r.frameRate={ideal:30,max:30}),e.next=6,this.originTrack.applyConstraints(r);case 6:((n=this.originTrack.getSettings()).width&&n.width!==this.resolution.width||n.height&&n.height!==this.resolution.height)&&(this.resolution={width:n.width,height:n.height},this.emit("resolution-change",this.resolution));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"replaceTrack",value:function(e){this.setTrack(e)}},{key:"setContentHint",value:function(e){var t;"contentHint"in this.originTrack&&qy(t=["text","motion","detail"]).call(t,e)&&(this.originTrack.contentHint=e)}}]),n}(jH),zH=function(e){VA(n,e);var t,r=tw(n);function n(){var e,t;Bh(this,n);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return Jl(sA(t=r.call.apply(r,Bg(e=[this]).call(e,o))),"mediaType","audio"),Jl(sA(t),"audioCaptureConfig",void 0),Jl(sA(t),"mixedAudioTrack",void 0),Jl(sA(t),"mixType",Dh.PLAYOUT_AND_PUBLISH),Jl(sA(t),"_audioFetchMap",new uT),Jl(sA(t),"notSupportedWebAudio",!1),t}return Fh(n,[{key:"getAudioLevel",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:vh.MICROPHONE,n=r===vh.AUDIOMIXING&&this.mixType!==Dh.PLAYOUT&&null!==(e=this.mixedAudioTrack)&&void 0!==e?e:this.preprocessingTrack,i=this._audioFetchMap.get(r);i&&i.currentTrackId===n.id||(null===(t=i)||void 0===t||t.destroy(),i=new MH(n),this._audioFetchMap.set(r,i));return i.getAudioLevel()}},{key:"updateAudioCaptureConfig",value:(t=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.audioCaptureConfig){e.next=2;break}return e.abrupt("return");case 2:return VH.info("updateAudioCaptureConfig","update localAudioTrack: ",this.audioCaptureConfig),e.next=5,this.originTrack.applyConstraints(this.audioCaptureConfig);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){this._audioFetchMap.forEach((function(e){return e.destroy()})),this._audioFetchMap.clear(),LA(NA(n.prototype),"close",this).call(this)}},{key:"setVolume",value:function(e){var t=!wU("SKIP_WEB_AUDIO_IN_TRACK")&&Tj();t||(this.notSupportedWebAudio=!0);var r,n=!this.withWebAudio&&100!==e;try{t&&n&&(VH.print("Create AudioProcess"),this._ap=new FH,this._ap.updateInputTrack(this.originTrack),this._mediaTrack=this._ap.getOutputTrack(),this._extensionManager&&this.generatePreProcessingTrack(this._extensionManager))}catch(i){VH.print("WebAudio may not supported, quired return"),this.notSupportedWebAudio=!0}this.notSupportedWebAudio||(null===(r=this._ap)||void 0===r||r.setVolume(e));t&&n&&this.emit("needReplaceTrack",this)}},{key:"getVolume",value:function(){return this._ap?this._ap.getVolume():100}}]),n}(jH),KH=function(e){VA(r,e);var t=tw(r);function r(){var e,n;Bh(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return Jl(sA(n=t.call.apply(t,Bg(e=[this]).call(e,o))),"mediaType","video"),Jl(sA(n),"videoPlayer",void 0),n}return Fh(r)}(HH),WH=function(e){VA(r,e);var t=tw(r);function r(){var e,n;Bh(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return Jl(sA(n=t.call.apply(t,Bg(e=[this]).call(e,o))),"mediaType","audio"),Jl(sA(n),"_audioLevelFetcher",void 0),Jl(sA(n),"notSupportedWebAudio",!1),n}return Fh(r,[{key:"getAudioLevel",value:function(){return this._audioLevelFetcher||(this._audioLevelFetcher=new MH(this.originTrack)),this._audioLevelFetcher.getAudioLevel()}},{key:"setVolume",value:function(e){var t=!wU("SKIP_WEB_AUDIO_IN_TRACK")&&Tj();t||(this.notSupportedWebAudio=!0);var r,n,i=!this.withWebAudio&&100!==e;try{t&&i&&(VH.print("Create AudioProcess"),this._ap=new FH,this._ap.updateInputTrack(this.originTrack),this._mediaTrack=this._ap.getOutputTrack())}catch(o){VH.print("WebAudio may not supported, quite return"),this.notSupportedWebAudio=!0}this.notSupportedWebAudio||(null===(r=this._ap)||void 0===r||r.setVolume(e));t&&i&&(this.emit("needReplaceTrack",this),null===(n=this.player)||void 0===n||n.playAudio(this))}},{key:"getVolume",value:function(){return this.notSupportedWebAudio?100:this._ap?this._ap.getVolume():100}},{key:"close",value:function(){var e;null===(e=this._audioLevelFetcher)||void 0===e||e.destroy(),LA(NA(r.prototype),"close",this).call(this)}}]),r}(HH),XH=function(e){VA(r,e);var t=tw(r);function r(){var e,n;Bh(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return Jl(sA(n=t.call.apply(t,Bg(e=[this]).call(e,o))),"streamIndex",ch.STREAM_INDEX_MAIN),n}return Fh(r)}(zH),qH=function(e){VA(r,e);var t=tw(r);function r(){var e,n;Bh(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return Jl(sA(n=t.call.apply(t,Bg(e=[this]).call(e,o))),"streamIndex",ch.STREAM_INDEX_MAIN),n}return Fh(r)}(GH),YH=function(e){VA(r,e);var t=tw(r);function r(){var e,n;Bh(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return Jl(sA(n=t.call.apply(t,Bg(e=[this]).call(e,o))),"streamIndex",ch.STREAM_INDEX_MAIN),Jl(sA(n),"sourceType",0),n}return Fh(r)}(GH),JH=function(e){VA(r,e);var t=tw(r);function r(){var e,n;Bh(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return Jl(sA(n=t.call.apply(t,Bg(e=[this]).call(e,o))),"streamIndex",ch.STREAM_INDEX_MAIN),Jl(sA(n),"sourceType",0),n}return Fh(r)}(zH),QH=function(e){VA(r,e);var t=tw(r);function r(){var e,n;Bh(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return Jl(sA(n=t.call.apply(t,Bg(e=[this]).call(e,o))),"streamIndex",ch.STREAM_INDEX_SCREEN),n}return Fh(r)}(GH),ZH=function(e){VA(r,e);var t=tw(r);function r(){var e,n;Bh(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return Jl(sA(n=t.call.apply(t,Bg(e=[this]).call(e,o))),"streamIndex",ch.STREAM_INDEX_SCREEN),n}return Fh(r)}(zH),$H=function(e){VA(r,e);var t=tw(r);function r(){var e,n;Bh(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return Jl(sA(n=t.call.apply(t,Bg(e=[this]).call(e,o))),"streamIndex",ch.STREAM_INDEX_SCREEN),Jl(sA(n),"sourceType",0),n}return Fh(r)}(GH),eG=function(e){VA(r,e);var t=tw(r);function r(){var e,n;Bh(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return Jl(sA(n=t.call.apply(t,Bg(e=[this]).call(e,o))),"streamIndex",ch.STREAM_INDEX_SCREEN),Jl(sA(n),"sourceType",0),n}return Fh(r)}(zH);function tG(e,t){return rG.apply(this,arguments)}function rG(){return(rG=Ng(Mg().mark((function e(t,r){var n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new qH(t,iL())).dummy=!0,e.next=4,n.generatePreProcessingTrack(r);case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nG(e,t){return iG.apply(this,arguments)}function iG(){return(iG=Ng(Mg().mark((function e(t,r){var n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new QH(t,iL())).dummy=!0,e.next=4,n.generatePreProcessingTrack(r);case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oG(e,t){return aG.apply(this,arguments)}function aG(){return(aG=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(null===(n=t.deviceId)||void 0===n?void 0:n.exact)||"default",a=KD(r.id),s=iL(),e.prev=3,VH.info("createCameraVideoTrack","constraints:",t),null==a||a.report("rtc_video_capture_event",{event_type:"start",media_device_id:o,capture_session_id:s}),u=oL(),FL&&(t.frameRate={ideal:30,max:30}),e.next=10,RH.getUserMedia({video:t});case 10:i=e.sent,null==a||a.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:o,media_device_name:(null===(c=i.getVideoTracks()[0])||void 0===c?void 0:c.label)||"",reason:"success",elapse:oL()-u,capture_session_id:s}),e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(3),null==a||a.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:o,error_code:e.t0.code,reason:e.t0.name+e.t0.message,capture_session_id:s}),new kC(mC.GET_VIDEO_TRACK_FAILED,Bg(d="throw error from getUserMedia. [".concat(e.t0.name||"unknown name","]: ")).call(d,e.t0.message||"unknown message","."),e.t0);case 18:return l=i.getVideoTracks()[0],(h=new qH(l,iL())).captureSessionId=s,e.next=23,h.generatePreProcessingTrack(r);case 23:return e.abrupt("return",h);case 24:case"end":return e.stop()}}),e,null,[[3,14]])})))).apply(this,arguments)}function sG(e,t){return cG.apply(this,arguments)}function cG(){return(cG=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return VH.info("createMicrophoneAudioTrack","constraints:",t),o=(null===(n=t.deviceId)||void 0===n?void 0:n.exact)||"default",a=KD(r.id),s=iL(),e.prev=4,null==a||a.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_begin",media_device_id:o,event_session_id:s}),u=oL(),(d=r.getPluginByName(NH.PRE_PROCESSING,"RTCAIAnsExtension"))&&(d.isOpen()?(t.autoGainControl=!0,t.noiseSuppression=!1):t.noiseSuppression=!0),e.next=11,RH.getUserMedia({audio:t});case 11:i=e.sent,null==a||a.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_result",media_device_id:o,media_device_name:(null===(c=i.getAudioTracks()[0])||void 0===c?void 0:c.label)||"",reason:"success",elapse:oL()-u,event_session_id:s}),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(4),null==a||a.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_end",media_device_id:o,error_code:e.t0.code,reason:e.t0.name+e.t0.message,event_session_id:s}),new kC(mC.GET_AUDIO_TRACK_FAILED,Bg(l="throw error from getUserMedia. [".concat(e.t0.name||"unknown name","]: ")).call(l,e.t0.message||"unknown message","."),e.t0);case 19:return h=i.getAudioTracks()[0],(p=new XH(h,iL())).captureSessionId=s,e.next=24,p.generatePreProcessingTrack(r);case 24:return e.abrupt("return",p);case 25:case"end":return e.stop()}}),e,null,[[4,15]])})))).apply(this,arguments)}function uG(e,t,r){return dG.apply(this,arguments)}function dG(){return(dG=Ng(Mg().mark((function e(t,r,n){var i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return VH.print("createCameraAndMicrophoneTrack","audioConstraints:",t,"videoConstraints:",r),a=KD(n.id),c=(null===(i=t.deviceId)||void 0===i?void 0:i.exact)||"default",u=(null===(o=r.deviceId)||void 0===o?void 0:o.exact)||"default",d=iL(),l=iL(),iL(),iL(),e.prev=8,null==a||a.report("rtc_video_capture_event",{event_type:"start",media_device_id:u,capture_session_id:d}),null==a||a.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_begin",media_device_id:c,event_session_id:l}),v=oL(),FL&&(r.frameRate={ideal:30,max:30}),(f=n.getPluginByName(NH.PRE_PROCESSING,"RTCAIAnsExtension"))&&(f.isOpen()?(t.autoGainControl=!0,t.noiseSuppression=!1):t.noiseSuppression=!0),e.next=17,RH.getUserMedia({audio:t,video:r});case 17:s=e.sent,null==a||a.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:u,media_device_name:(null===(h=s.getVideoTracks()[0])||void 0===h?void 0:h.label)||"",reason:"success",elapse:oL()-v,capture_session_id:d}),null==a||a.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_result",media_device_id:c,media_device_name:(null===(p=s.getAudioTracks()[0])||void 0===p?void 0:p.label)||"",reason:"success",elapse:oL()-v,event_session_id:l}),e.next=27;break;case 22:throw e.prev=22,e.t0=e.catch(8),null==a||a.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:u,error_code:e.t0.code,reason:e.t0.name+e.t0.message,capture_session_id:d}),null==a||a.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_end",media_device_id:c,error_code:e.t0.code,reason:e.t0.name+e.t0.message,event_session_id:l}),new kC(mC.GET_VIDEO_TRACK_FAILED,Bg(_="throw error from getUserMedia. [".concat(e.t0.name||"unknown name","]: ")).call(_,e.t0.message||"unknown message","."),e.t0);case 27:return m=s.getVideoTracks()[0],(g=new qH(m,iL())).captureSessionId=d,e.next=32,g.generatePreProcessingTrack(n);case 32:return y=s.getAudioTracks()[0],(S=new XH(y,iL())).captureSessionId=l,e.next=37,S.generatePreProcessingTrack(n);case 37:return e.abrupt("return",{videoTrack:g,audioTrack:S});case 38:case"end":return e.stop()}}),e,null,[[8,22]])})))).apply(this,arguments)}function lG(){return hG.apply(this,arguments)}function hG(){return hG=Ng(Mg().mark((function e(){var t,r,n,i,o,a,s,c,u,d,l,h,p,v,f=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.length>0&&void 0!==f[0]&&f[0],r=f.length>1?f[1]:void 0,n=f.length>2?f[2]:void 0,VH.info("createScreenTracks","withAudio: %o, constraints: %o",t,n),o=KD(r.id),a=iL(),e.prev=6,null==o||o.report("rtc_video_capture_event",{event_type:"start",media_device_id:"screen",capture_session_id:a}),d=oL(),e.next=11,navigator.mediaDevices.getDisplayMedia({video:!(n&&(!BL||"16.1"!==sU))||n,audio:!!t&&{channelCount:2,noiseSuppression:!1,echoCancellation:!0,autoGainControl:!1}});case 11:i=e.sent,null==o||o.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:"screen",media_device_name:Bg(s="".concat((null===(c=i.getVideoTracks()[0])||void 0===c?void 0:c.label)||"",", ")).call(s,(null===(u=i.getAudioTracks()[0])||void 0===u?void 0:u.label)||""),reason:"success",elapse:oL()-d,capture_session_id:a}),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(6),null==o||o.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:"screen",error_code:e.t0.code,reason:e.t0.name+e.t0.message,capture_session_id:a}),new kC(mC.GET_SCREEN_TRACK_FAILED,"throw error from getDisplayMedia",e.t0);case 19:return l=i.getVideoTracks()[0],(h=new QH(l,iL())).captureSessionId=a,e.next=24,h.generatePreProcessingTrack(r);case 24:if(!(p=i.getAudioTracks()[0])){e.next=30;break}return v=new ZH(p,iL()),e.next=29,v.generatePreProcessingTrack(r);case 29:return e.abrupt("return",[h,v]);case 30:return e.abrupt("return",[h,void 0]);case 31:case"end":return e.stop()}}),e,null,[[6,15]])}))),hG.apply(this,arguments)}function pG(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:iL();return new WH(e,t)}function vG(e,t){return fG.apply(this,arguments)}function fG(){return(fG=Ng(Mg().mark((function e(t,r){var n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new YH(t,iL()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _G(e,t){return mG.apply(this,arguments)}function mG(){return(mG=Ng(Mg().mark((function e(t,r){var n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new JH(t,iL()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gG(e,t){return yG.apply(this,arguments)}function yG(){return(yG=Ng(Mg().mark((function e(t,r){var n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new $H(t,iL()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function SG(e,t){return bG.apply(this,arguments)}function bG(){return(bG=Ng(Mg().mark((function e(t,r){var n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new eG(t,iL()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var kG=zH,EG=WH,TG=function(e){return e[e.NONE=0]="NONE",e}(TG||{}),IG={getNalunits:function(e){if(e.length-e.position<4)return[];var t=e.position;return 1===e.getInt32(t)||0===e.getInt16(t)&&1===e.getInt8(t+2)?IG.getAnnexbNals(e):IG.getAvccNals(e)},getAnnexbNals:function(e){for(var t=[],r=IG.getHeaderPositionAnnexB(e),n=r.pos,i=n;n<e.length-4;){var o,a,s=new Uint8Array(cI(o=e.buffer).call(o,n,n+r.headerLength));r.pos===e.position&&e.skip(r.headerLength),i=(r=IG.getHeaderPositionAnnexB(e)).pos;var c={header:s,body:new Uint8Array(cI(a=e.buffer).call(a,n+s.byteLength,i)),type:-1};IG.analyseNal(c),c.type<=9&&0!==c.type&&t.push(c),e.skip(i-e.position),n=i}return t},getAvccNals:function(e){for(var t=[];e.position<e.length-4;){var r=e.getInt32(e.position);if(!(e.length-e.position>=r))break;var n,i,o=new Uint8Array(cI(n=e.buffer).call(n,e.position,e.position+4));e.skip(4);var a=new Uint8Array(cI(i=e.buffer).call(i,e.position,e.position+r));e.skip(r);var s={header:o,body:a,type:-1};IG.analyseNal(s),s.type<=9&&0!==s.type&&t.push(s)}return t},analyseNal:function(e){var t=31&e.body[0];switch(e.type=t,t){case 1:e.ndr=!0;break;case 5:e.idr=!0;break;case 6:e.sei=!0;break;case 7:e.sps=!0;break;case 8:e.pps=!0}},getHeaderPositionAnnexB:function(e){for(var t=e.position,r=0,n=e.length;3!==r&&4!==r&&t<n-4;)0===e.getInt16(t)?1===e.getInt16(t+2)?r=4:1===e.getInt8(t+2)?r=3:t++:t++;return t===n-4&&(0===e.getInt16(t)?1===e.getInt16(t+2)?r=4:t=n:(t++,0===e.getInt16(t)&&1===e.getInt8(t)?r=3:t=n)),{pos:t,headerLength:r}}},RG=function(){function e(t){Bh(this,e),Jl(this,"_position",0),Jl(this,"_dataview",void 0),this._dataview=new DataView(t)}return Fh(e,[{key:"length",get:function(){return this.buffer.byteLength}},{key:"buffer",get:function(){return this._dataview.buffer}},{key:"position",get:function(){return this._position},set:function(e){this._position=e}},{key:"back",value:function(e){this.position-=e}},{key:"getUint8",value:function(e){return this._dataview.getUint8(e)}},{key:"getInt8",value:function(e){return this._dataview.getInt8(e)}},{key:"getInt16",value:function(e){return this._dataview.getInt16(e)}},{key:"getUint16",value:function(e){return this._dataview.getUint16(e)}},{key:"getUint32",value:function(e){return this._dataview.getUint32(e)}},{key:"getInt32",value:function(e){return this._dataview.getInt32(e)}},{key:"skip",value:function(t){for(var r=Math.floor(t/4),n=t%4,i=0;i<r;i++)e.readByte(this,4);n>0&&e.readByte(this,n)}},{key:"readUint8",value:function(){return e.readByte(this,1)}},{key:"readUint16",value:function(){return e.readByte(this,2)}},{key:"readUint24",value:function(){return e.readByte(this,3)}},{key:"readUint32",value:function(){return e.readByte(this,4)}},{key:"readUint64",value:function(){return e.readByte(this,8)}},{key:"readInt8",value:function(){return e.readByte(this,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this,4,!0)}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}}],[{key:"readByte",value:function(e,t,r){var n;switch(t){case 1:n=r?e.getInt8(e.position):e.getUint8(e.position);break;case 2:n=r?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(r)throw new Error("not supported for readByte 3");n=e.getUint8(e.position)<<16,n|=e.getUint8(e.position+1)<<8,n|=e.getUint8(e.position+2);break;case 4:n=r?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(r)throw new Error("not supported for readBody 8");n=e.getUint32(e.position)<<32,n|=e.getUint32(e.position+4);break;default:n=""}return e.position+=t,n}}]),e}(),AG=function(e){return e[e.internal=0]="internal",e[e.external=1]="external",e[e.bypass=2]="bypass",e}(AG||{}),wG=new Uint8Array([109,167,53,190,103,90,72,1,170,89,63,164,194,199,19,85]),CG=new Uint8Array([109,167,53,190,103,90,72,1,170,89,63,164,194,199,19,84]);function xG(e){for(var t=[];e>=255;)e-=255,t.push(255);return t.push(e),new Uint8Array(t)}function OG(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;255===e[t]&&t<e.byteLength;)t++,r+=255;return t<e.byteLength&&(r+=e[t++]),[r,t]}var PG=function(){function e(){Bh(this,e)}return Fh(e,null,[{key:"generateSEI",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Uint8Array([0,0,0,1]),i=new Uint8Array([6]),o=new Uint8Array([5]),a=r?wG:CG,s=xG(e.byteLength+a.byteLength),c=function(e){var t,r=[],n=0,i=gy(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;n>=2&&o<=3&&(r.push(3),n=0),0===o?n++:n=0,r.push(o)}}catch(J$){i.e(J$)}finally{i.f()}return new Uint8Array(r)}(e);return new Uint8Array(Bg(t=[]).call(t,rR(n),rR(i),rR(o),rR(s),rR(a),rR(c),[128]))}},{key:"decodeSeiBody",value:function(e){var t=function(e){for(var t=[],r=0;r<e.length;r++)e[r]<=3&&0===e[r-1]&&0===e[r-2]||t.push(e[r]);return new Uint8Array(t)}(e=cI(e).call(e,0,e.length-1));if(!(t.byteLength<2)){var r=0;if(5===t[1]||100===t[1]){var n=yy(OG(t,r+=2),2),i=n[0],o=2,a=(r=n[1])+i;return t.byteLength>=CG.byteLength&&i>=CG.byteLength&&cI(t).call(t,r,r+CG.byteLength).toString()===CG.toString()?(r+=CG.byteLength,o=1):t.byteLength>=CG.byteLength&&i>=CG.byteLength&&cI(t).call(t,r,r+wG.byteLength).toString()===wG.toString()&&(r+=wG.byteLength,o=0),{type:o,payload:cI(t).call(t,r,a)}}}}},{key:"parseInternalSEI",value:function(e){var t=new uT,r=0;if(0===e.type){for(;e.payload.byteLength-r>=2;){var n=yy(OG(e.payload,r),2),i=n[0];r=n[1];var o,a=yy(OG(e.payload,r),2),s=a[0];if(r=a[1],t.get(i)||!(s<=e.payload.byteLength-r))break;t.set(i,cI(o=e.payload).call(o,r,r+s)),r+=s}return t}}},{key:"makeInternalSei",value:function(e){var t,r=[],n=gy(e);try{for(n.s();!(t=n.n()).done;){var i=yy(t.value,2),o=i[0],a=i[1],s=xG(o),c=xG(a.byteLength);r.push(s,c,a)}}catch(J$){n.e(J$)}finally{n.f()}var u=aS(r).call(r,(function(e,t){return e+t.byteLength}),0),d=new Uint8Array(u);return aS(r).call(r,(function(e,t){return d.set(t,e),e+t.byteLength}),0),d}}]),e}(),MG=function(){function e(t){Bh(this,e),Jl(this,"_timer",void 0),Jl(this,"handler",void 0),Jl(this,"_monitor",void 0),Jl(this,"logger",void 0),Jl(this,"_destroyed",!1),this._context=t,this._monitor=KD(t.id),this.logger=new lN("Stats",3,t.id)}return Fh(e,[{key:"setVar",value:function(e){this.handler=e}},{key:"stopReport",value:function(e){var t;this._timer&&(this.logger.info("stopReport","invoke"),clearTimeout(this._timer),delete this._timer,JD(this._context.id,"del_media_statistics_timer",Bg(t="reason: ".concat(e,", stack: ")).call(t,(new Error).stack),0,this._stream.streamId||""))}},{key:"filterIllegal",value:function(e){var t={};return LS(e).forEach((function(r){null===e[r]||void 0===e[r]||Number.isNaN(e[r])||(t[r]=e[r])})),t}},{key:"destroy",value:function(){this.logger.info("destroy","invoke"),JD(this._context.id,"media_statistics_destroy","".concat((new Error).stack),0,"".concat(this._stream.streamId)),this.stopReport("destroy"),this._destroyed=!0}}]),e}(),DG=function(e){VA(i,e);var t,r,n=tw(i);function i(e,t){var r;return Bh(this,i),(r=n.call(this,e))._stream=t,r}return Fh(i,[{key:"setLocalStreamStatsEvtInterval",value:function(e,t){var r,n,i,o=this;if(!this._timer){this.logger.info("setLocalStreamStatsEvtInterval","invoke"),this.setVar(t),this._destroyed=!1;var a={audio:{},video:{}},s=this._stream,c=null===(r=s.audioTrack)||void 0===r?void 0:r.preprocessingTrack,u=null===(n=s.videoTrack)||void 0===n?void 0:n.preprocessingTrack;this.getAudioStats(c,a,null===(i=s.audioTrack)||void 0===i?void 0:i.getAudioLevel()),this.getVideoStats(u,a);var d=function(){var e=Ng(Mg().mark((function e(){var t,r,n,i,c,u,d;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=null===(t=s.audioTrack)||void 0===t?void 0:t.preprocessingTrack,c=null===(r=s.videoTrack)||void 0===r?void 0:r.preprocessingTrack,e.next=4,o.getAudioStats(i,a,null===(n=s.audioTrack)||void 0===n?void 0:n.getAudioLevel());case 4:return u=e.sent,e.next=7,o.getVideoStats(c,a);case 7:return d=e.sent,e.abrupt("return",{audioStats:u,videoStats:d,isScreen:s.isScreen});case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),l=function(){var t=Ng(Mg().mark((function t(){var r;return Mg().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d();case 2:r=t.sent,e(r),o._destroyed||(o._timer=setTimeout(l,2e3));case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();this._timer=setTimeout(l,2e3)}}},{key:"getAudioStats",value:(r=Ng(Mg().mark((function e(t,r,n){var i,o,a,s,c,u,d,l,h,p,v,f,_,m;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={},s={timestamp:Date.now()},c=this._stream,u=c.streamId,d=c.audioMid,l=c.isScreen,h=c.pubAttributes,p=c.pubAudio,v=c.audioTrack,f={media_type:"audio",is_screen:!!l,direction:"up",stream_id:u,vid:d,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,capture_state:h.localaudio?"capture_state_on":"capture_state_off",mute_state:p?"mute_state_off":"mute_state_on"},v&&(f.playback_volume=v.getVolume()),t&&this.handler){e.next=7;break}return e.abrupt("return",a);case 7:return e.next=9,this.handler.getStats(t);case 9:if((_=e.sent).length){e.next=12;break}return e.abrupt("return",a);case 12:if(_.forEach((function(e){var t=e.type,r=e.packetsSent,n=e.packetsLost,i=e.bytesSent,o=e.clockRate,c=e.roundTripTime,u=e.channels,d=e.audioLevel,l=e.mimeType,h=e.availableIncomingBitrate,p=e.availableOutgoingBitrate,v=e.bytesReceived,_=e.nominated,m=e.id,g=e.currentRoundTripTime,y=e.state,S=e.writable,b=e.requestsReceived,k=e.responsesReceived,E=e.requestsSent,T=e.consentRequestsSent,I=e.responsesSent,R=e.jitter,A=e.candidateType,w=e.ip,C=e.address,x=e.networkType,O=e.port,P=e.protocol,M=e.nackCount,D=e.retransmittedBytesSent,N=e.retransmittedPacketsSent,L=e.audioInputLevel,U=e.ssrc,V=e.totalAudioEnergy,F=e.totalSamplesDuration,B=e.mediaType,j=e.fractionLost;"outbound-rtp"===t?(s.packetsSent=r,s.bytesSent=i,f.bytes=i,f.packetsSent=r,f.nackCount=M,f.ssrc=U,f.retransmitted_bytes_sent=D,f.retransmitted_packets_sent=N,s.retransmittedBytesSent=D,s.retransmittedPacketsSent=N):"remote-inbound-rtp"===t?(s.packetsLost=n,f.packetsLost=n,f.net_jitter=1e3*R,a.rtt=1e3*c,f.rtt=a.rtt,a._fractionLost=j||0):"codec"===t?(a.recordSampleRate=o,a.numChannels=u,f.codecName=l):"media-source"===t&&void 0!==d?(f.audio_level=d?-10*QC(Math.pow(d,2)):d,f.volume=255*d,f.total_audio_energy=V,f.totalInputDuration=F):"ssrc"===t&&"audio"===B?f.send_level=L:"candidate-pair"===t?(f.ice_available_incoming_bitrate=h,f.ice_available_outgoing_bitrate=p,f.ice_bytes_received=v,f.ice_bytes_sent=i,f.ice_nominated=Number(_),f.ice_pair_id=m,f.ice_pair_rtt=g,f.ice_pair_state=y,f.ice_pair_writable=S,f.recv_ping_requests=b,f.recv_ping_responses=k,f.sent_ping_requests_before_first_response=E,f.sent_ping_requests_total=E+(T||0),f.sent_ping_responses=I):"local-candidate"===t?(f.local_candidate_type=A,f.local_ip=w||C,f.local_network_type=x,f.local_port=O,f.protocol=P):"remote-candidate"===t&&(f.remote_candidate_type=A,f.remote_ip=w||C,f.remote_port=O);var H=wU("STATS_SCALLBACK_SUPPORT");Ij&&H||"media-source"===t&&(f.send_level=d)})),void 0===f.volume&&void 0!==n&&(f.volume=n,f.audio_level=n?-10*QC(Math.pow(n/255,2)):n),(m=r.audio).timestamp){e.next=18;break}return r.audio=s,e.abrupt("return",this.filterIllegal(a));case 18:return void 0!==s.packetsLost&&(a.audioLossRate=(s.packetsLost-m.packetsLost)/(s.packetsSent-m.packetsSent),a.audioLossRate=Number.isNaN(a.audioLossRate)?0:a.audioLossRate,f.fraction_lost=a.audioLossRate),a.statsInterval=s.timestamp-m.timestamp,f.stats_interval=a.statsInterval,a.sendKBitrate=(s.bytesSent-m.bytesSent||0)/a.statsInterval*8,f.mediaBitratebps=Math.round(1e3*a.sendKBitrate),f.bandwidth=Math.round(f.mediaBitratebps/1024),void 0!==s.retransmittedBytesSent&&(f.retransmitBitratebps=(s.retransmittedBytesSent-m.retransmittedBytesSent||0)/a.statsInterval),r.audio=s,f.vendor_mode=this._stream.vendorCode||0,f.pc_session_id=null===(i=this.handler)||void 0===i?void 0:i.peerConnectionId,null===(o=this._monitor)||void 0===o||o.report("rtc_media_statistics",f),a._retransmittedRate=(s.retransmittedPacketsSent-m.retransmittedPacketsSent)/(s.packetsSent-m.packetsSent),void 0===a.audioLossRate&&(a.audioLossRate=a._retransmittedRate,f.fraction_lost=a.audioLossRate),a._fractionLost=Math.max(a._fractionLost,a.audioLossRate),e.abrupt("return",this.filterIllegal(a));case 33:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"getVideoStats",value:(t=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},i={timestamp:Date.now(),simulcast:{}},o=this._stream,a=o.streamId,s=o.videoMid,c=o.isScreen,u=o.pubAttributes,d=o.enableSimulcast,l=o.pubVideo,h={media_type:"video",is_screen:!!c,direction:"up",stream_id:a,vid:s,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,capture_state:u.localvideo?"capture_state_on":"capture_state_off",mute_state:l?"mute_state_off":"mute_state_on"},t&&this.handler){e.next=6;break}return e.abrupt("return",n);case 6:return h.cap_frame_width=t.getSettings().width,h.cap_frame_height=t.getSettings().height,h.frameRateSent=t.getSettings().frameRate,n.isScreen=c,e.next=12,this.handler.getStats(t);case 12:if((p=e.sent).length){e.next=15;break}return e.abrupt("return",n);case 15:if(v=0,p.forEach((function(e){var t=e.type,o=e.framesEncoded,a=e.packetsLost,s=e.bytesSent,c=e.framesSent,u=e.retransmittedBytesSent,l=e.totalPacketSendDelay,p=e.totalEncodeTime,f=e.firCount,_=e.targetBitrate,m=e.roundTripTime,g=e.mimeType,y=e.frameWidth,S=e.frameHeight,b=e.packetsSent,k=e.googActualEncBitrate,E=e.googAvailableReceiveBandwidth,T=e.googAvailableSendBandwidth,I=e.googAvgEncodeMs,R=e.googBucketDelay,A=e.googEncodeUsagePercent,w=e.googFrameRateInput,C=e.availableIncomingBitrate,x=e.availableOutgoingBitrate,O=e.bytesReceived,P=e.nominated,M=e.id,D=e.currentRoundTripTime,N=e.state,L=e.writable,U=e.candidateType,V=e.ip,F=e.address,B=e.networkType,j=e.port,H=e.nackCount,G=e.pliCount,z=e.protocol,K=e.qpSum,W=e.requestsReceived,X=e.responsesReceived,q=e.googRetransmitBitrate,Y=e.requestsSent,J=e.consentRequestsSent,Q=e.responsesSent,Z=e.ssrc,$=e.googTargetEncBitrate,ee=e.googTransmitBitrate,te=e.retransmittedPacketsSent,re=e.encoderImplementation,ne=e.jitter,ie=e.rid,oe=e.fractionLost,ae=e.googAdaptationChanges,se=e.qualityLimitationReason,ce=e.qualityLimitationDurations,ue=e.googFirsReceived,de=e.googFrameRateSent,le=e.keyFramesEncoded,he=e.scalabilityMode,pe=e.framesPerSecond,ve=e.frames;"outbound-rtp"===t?(d&&(ie?i.simulcast[ie]=e:i.simulcast[v]=e,v++),i.framesEncoded=o||i.framesEncoded||0,h.key_frames_encoded=le||0,i.bytesSent=s||i.bytesSent||0,i.framesSent=c||i.framesSent,h.bytes=s||h.bytes||0,i.packetsSent=b||i.packetsSent||0,h.packetsSent=b||h.packetsSent||0,h.nackCount=H||h.nackCount||0,h.pli_count=G||h.pli_count||0,h.qp_sum=K||h.qp_sum||0,h.ssrc=Z||h.ssrc||0,h.retransmitted_packets_sent=te,i.retransmittedPacketsSent=te,i.retransmittedBytesSent=u,h.encoder_implementation=re,h.qualityLimitationReason=se,h.qualityLimitationDurations=ce,h.scalabilityMode=he,void 0!==y&&((!n.encodedFrameWidth||y>n.encodedFrameWidth)&&(n.encodedFrameWidth=y),(!n.encodedFrameHeight||S>n.encodedFrameHeight)&&(n.encodedFrameHeight=S),h.frame_size_height=S,h.frame_size_width=y)):"track"===t?(n.encodedFrameWidth=y,n.encodedFrameHeight=S,h.frame_size_height=S,h.frame_size_width=y):"remote-inbound-rtp"===t?(i.packetsLost=a,n.rtt=1e3*m,h.rtt=n.rtt,h.jitter=1e3*ne,h.packetsLost=a,n._fractionLost=oe||0):"codec"===t?(n.codecType=g,h.codecName=g):"candidate-pair"===t?(h.ice_available_incoming_bitrate=C,h.ice_available_outgoing_bitrate=x,h.ice_bytes_received=O,h.ice_bytes_sent=s,h.ice_nominated=Number(P),h.ice_pair_id=M,h.ice_pair_rtt=D,h.ice_pair_state=N,h.ice_pair_writable=L,h.recv_ping_requests=W,h.recv_ping_responses=X,h.sent_ping_requests_before_first_response=Y,h.sent_ping_requests_total=Y+J,h.sent_ping_responses=Q):"local-candidate"===t?(h.local_candidate_type=U,h.local_ip=V||F,h.local_network_type=B,h.local_port=j,h.protocol=z):"remote-candidate"===t?(h.remote_candidate_type=U,h.remote_ip=V||F,h.remote_port=j):"VideoBwe"===t?(h.encBitratebps=k,h.available_receive_bandwidth=E,h.available_send_bandwidth=T,h.bucket_delay=R,h.retransmitBitratebps=q,h.targetEncBitratebps=$,h.transmit_bitrate=ee,n._sendBandWidth=Number(T)):"ssrc"===t&&(h.avg_encode_ms=I,h.encodeUsage=A,h.frame_rate_input=w,h.orignal_input_Framerate=Number(w),h.ddaptationChanges=ae,h.firsReceived=ue,h.frameRateSent=de);var fe=wU("STATS_SCALLBACK_SUPPORT");if(!Ij||!fe){var _e=r.video,me=i.timestamp-_e.timestamp;if("outbound-rtp"===t){var ge=s-_e.bytesSent,ye=u-_e.retransmittedBytesSent;h.encBitratebps=Math.round(8e3*(ge-ye)/me),h.bucket_delay=l/b,h.retransmitBitratebps=Math.round(8e3*ye/me),h.targetEncBitratebps=_,h.transmit_bitrate=Math.round(1e3*(s-_e.bytesSent)*8/me),h.avg_encode_ms=1e3*p/o,h.firsReceived=f+G}else"candidate-pair"===t?(h.available_send_bandwidth=x,n._sendBandWidth=x):"media-source"===t&&(h.frame_rate_input=pe,h.orignal_input_Framerate=Number(pe),h.frame_input=ve)}})),(f=r.video).timestamp){e.next=21;break}return r.video=i,e.abrupt("return",this.filterIllegal(n));case 21:return n.statsInterval=i.timestamp-f.timestamp,h.stats_interval=n.statsInterval,_=LS(i.simulcast),d?(h.sim_enc_width=[],h.sim_enc_height=[],h.sim_enc_bps=[],h.sim_enc_framerate=[],h.sim_enc_key_frames=[],h.sim_rids=[],h.sim_enc_bandwidth=[],h.sim_sent_framerate=[],h.sim_fraction_lost=[],h.sim_keyencoded=[],h.active_sim_streams=this._context.activeSimStreams||[],h.sim_retransmittedRate=[],y=!1,Ww(_).call(_,(function(e,t){return Number(e)-Number(t)})).forEach((function(e){var t=i.simulcast[e],r=t.frameWidth,o=t.frameHeight,a=t.bytesSent,s=t.framesEncoded,c=t.framesSent,u=t.packetsLost,d=t.packetsSent,l=t.qualityLimitationReason,p=t.qualityLimitationDurations,v=t.qualityLimitationResolutionChanges,_=t.retransmittedPacketsSent,m=t.pliCount,g=t.keyFramesEncoded;void 0!==l&&(h.sim_qualityLimitationReason||(h.sim_qualityLimitationReason=[],h.sim_qualityLimitationDurations=[],h.sim_qualityLimitationResolutionChanges=[]),h.sim_qualityLimitationReason.push(l),h.sim_qualityLimitationDurations.push(p),h.sim_qualityLimitationResolutionChanges.push(v));var S=f.simulcast[e];if(h.sim_enc_width.push(r||0),h.sim_enc_height.push(o||0),h.sim_enc_key_frames.push(g||0),S){var b=(a-S.bytesSent||0)/n.statsInterval;h.sim_enc_bps.push(Math.round(8e3*b)),h.sim_enc_bandwidth.push(Math.round(8e3*b/1024));var k=1e3*(s-S.framesEncoded)/n.statsInterval;h.sim_enc_framerate.push(Math.round(k)),h.sim_rids.push(e);var E=void 0!==c?c-S.framesSent:s-S.framesEncoded,T=1e3*E/n.statsInterval;h.sim_sent_framerate.push(Math.round(T));var I=(u-S.packetsLost)/(d-S.packetsSent);n._retransmittedRate=(_-S.retransmittedPacketsSent)/(d-S.packetsSent),I=Number.isNaN(I)?0:I,h.sim_fraction_lost.push(I),h.sim_keyencoded.push(m-S.pliCount>0),h.sim_retransmittedRate.push(n._retransmittedRate),r>0&&!y&&(n.sentKBitrate=8*b,n.encoderOutputFrameRate=k,n.encodedFrameCount=E,n.sentFrameRate=T,n.videoLossRate=I,y=!0)}})),h.vendor_mode=this._stream.vendorCode||0,h.pc_session_id=null===(m=this.handler)||void 0===m?void 0:m.peerConnectionId,null===(g=this._monitor)||void 0===g||g.report("rtc_media_statistics",h)):(n.encodedFrameCount=void 0!==i.framesSent?i.framesSent-f.framesSent:i.framesEncoded-f.framesEncoded,n.sentKBitrate=(i.bytesSent-f.bytesSent||0)/n.statsInterval*8,h.bitrate=Math.round(1e3*n.sentKBitrate),h.bandwidth=Math.round(h.bitrate/1024),n.encoderOutputFrameRate=1e3*(i.framesEncoded-f.framesEncoded)/n.statsInterval,h.frame_rate_encoded=Math.round(n.encoderOutputFrameRate),n.sentFrameRate=1e3*n.encodedFrameCount/n.statsInterval,h.frame_rate_sent=Math.round(n.sentFrameRate),n.videoLossRate=(i.packetsLost-f.packetsLost)/(i.packetsSent-f.packetsSent),n.videoLossRate=Number.isNaN(n.videoLossRate)?0:n.videoLossRate,h.fraction_lost=n.videoLossRate,n._retransmittedRate=(i.retransmittedPacketsSent-f.retransmittedPacketsSent)/(i.packetsSent-f.packetsSent),h.vendor_mode=this._stream.vendorCode||0,h.pc_session_id=null===(S=this.handler)||void 0===S?void 0:S.peerConnectionId,null===(b=this._monitor)||void 0===b||b.report("rtc_media_statistics",h)),r.video=i,n._fractionLost=Math.max(n._fractionLost,n.videoLossRate),e.abrupt("return",this.filterIllegal(n));case 28:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),i}(MG),NG=function(e){VA(o,e);var t,r,n,i=tw(o);function o(e,t){var r;return Bh(this,o),(r=i.call(this,e))._stream=t,r}return Fh(o,[{key:"setRemoteStreamStatsEvtInterval",value:(n=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._timer){e.next=2;break}return e.abrupt("return");case 2:return this.logger.info("setRemoteStreamStatsEvtInterval","invoke"),this.setVar(r),a={audio:{},video:{}},this._destroyed=!1,s=this._stream,c=null===(n=s.audioTrack)||void 0===n?void 0:n.originTrack,u=null===(i=s.videoTrack)||void 0===i?void 0:i.originTrack,this.getRemoteVideoStats(u,a),e.next=12,this.getRemoteAudioStats(c,a,null===(o=this._stream.audioTrack)||void 0===o?void 0:o.getAudioLevel());case 12:d=function(){var e=Ng(Mg().mark((function e(){var r,n,i,o,c,u,h;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=null===(r=s.audioTrack)||void 0===r?void 0:r.originTrack,c=null===(n=s.videoTrack)||void 0===n?void 0:n.originTrack,e.next=4,l.getRemoteAudioStats(o,a,null===(i=l._stream.audioTrack)||void 0===i?void 0:i.getAudioLevel());case 4:return u=e.sent,e.next=7,l.getRemoteVideoStats(c,a);case 7:h=e.sent,t({audioStats:u,videoStats:h,isScreen:s.isScreen,userId:s.userId,streamId:s.streamId}),l._destroyed||(l._timer=setTimeout(d,2e3));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),this.stopReport("start a new timer."),this._timer=setTimeout(d,2e3);case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"unsubscribe",value:function(){this.logger.info("unsubscribe","invoke"),LA(NA(o.prototype),"stopReport",this).call(this,"unsubscribe"),this._stream.stopAudioStallObserve()}},{key:"getRemoteAudioStats",value:(r=Ng(Mg().mark((function e(t,r,n){var i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c={},u={},d=this._stream,l=d.streamId,h=d.userId,p=d.isScreen,v=d.audioMid,f=d.subMediaType,_=d._attributes,m=d.virtual,g=d.audioTrack,y={media_type:"audio",is_screen:!!p,direction:"down",stream_id:l,stream_user_id:h,vid:v,audio_mux:m,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,mute_state:EL(f)?"mute_state_off":"mute_state_on",remote_user_capture_state:_.localaudio?"capture_state_on":"capture_state_off",remote_user_mute_state:_.localaudio&&_.audiostream?"mute_state_off":"mute_state_on"},g&&(y.playback_volume=g.getVolume()),t&&this.handler){e.next=7;break}return e.abrupt("return",c);case 7:return e.next=9,this.handler.getStats(t);case 9:if((S=e.sent).length){e.next=12;break}return e.abrupt("return",c);case 12:if(S.forEach((function(e){var t=e.type,r=e.packetsLost,i=e.packetsReceived,o=e.bytesReceived,a=e.jitterBufferDelay,s=e.jitterBufferEmittedCount,d=e.clockRate,h=e.channels,p=e.totalSamplesReceived,v=e.concealedSamples,f=e.silentConcealedSamples,_=e.concealmentEvents,m=e.totalRoundTripTime,g=e.packetsDiscarded,S=e.state,b=e.currentRoundTripTime,k=e.audioLevel,T=e.totalAudioEnergy,I=e.totalSamplesDuration,R=e.mimeType,A=e.googDecodingNormal,w=e.googDecodingMuted,C=e.availableIncomingBitrate,x=e.availableOutgoingBitrate,O=e.bytesSent,P=e.nominated,M=e.id,D=e.writable,N=e.jitter,L=e.candidateType,U=e.ip,V=e.address,F=e.networkType,B=e.port,j=e.protocol,H=e.audioOutputLevel,G=e.requestsReceived,z=e.responsesReceived,K=e.requestsSent,W=e.consentRequestsSent,X=e.responsesSent,q=e.ssrc,Y=e.nackCount,J=e.lastPacketReceivedTimestamp,Q=e.concealmentevents,Z=e.fecPacketsReceived;if("inbound-rtp"===t)u.packetsLost=r,u.packetsReceived=i,y.packetsLost=r,y.packetsReceived=i,y.packetsDiscarded=g,y.nackCount=Y,y.lastPacketReceivedTimestamp=J,y.concealmentevents=Q,u.bytesReceived=o,void 0!==a&&(c.jitterBufferDelay=a/s*1e3,y.average_jitter_buffer_delay_ms=c.jitterBufferDelay),void 0!==p&&(u.totalSamplesReceived=p,c.concealedSamples=v,u.concealedSamples=v,u.silentConcealedSamples=f,y.concealedSamples=v,c.concealmentEvents=_,y.totalSamplesReceived=p),void 0!==Z&&(y.fec_packets_received=Z,u.fecPacketsReceived=Z),y.jitter=1e3*N,y.ssrc=q,void 0!==k&&0!==k?(y.audio_level=k?-10*QC(Math.pow(k,2)):k,y.volume=255*k):(y.volume=null!=n?n:255*k,y.audio_level=n?-10*QC(Math.pow(n/255,2)):n),void 0!==T&&(y.total_audio_energy=T),void 0!==I&&(y.totalAudioDuration=I);else if("codec"===t)c.recordSampleRate=d,h&&(c.numChannels=h),y.codecName=R;else if("candidate-pair"===t){var $,ee;y.ice_available_incoming_bitrate=C,y.ice_available_outgoing_bitrate=x,y.ice_bytes_received=o,y.ice_bytes_sent=O,y.ice_nominated=Number(P),y.ice_pair_id=M,y.ice_pair_rtt=b,y.rtt=1e3*b,y.rtt&&null!==($=E._context.streamRTT)&&void 0!==$&&null!==(ee=$[l])&&void 0!==ee&&ee.audio&&(y.total_rtt_ms=Math.round(y.rtt+E._context.streamRTT[l].audio)),y.ice_pair_state=S,y.ice_pair_writable=D,y.recv_ping_requests=G,y.recv_ping_responses=z,y.sent_ping_requests_before_first_response=K,y.sent_ping_requests_total=K+(W||0),y.sent_ping_responses=X,"succeeded"===S&&(c.rtt=1e3*b,c.total_rtt=1e3*m)}else"track"===t&&void 0!==k?(0===k&&0!==n?(y.volume=n,y.audio_level=n?-10*QC(Math.pow(n/255,2)):n):(y.audio_level=k?-10*QC(Math.pow(k,2)):k,y.volume=255*k),y.total_audio_energy=T,y.totalAudioDuration=I):"ssrc"===t?(y.decodingNormal=A,y.recvAudioLevel=H,y.decodingMuted=w):"local-candidate"===t?(y.local_candidate_type=L,y.local_ip=U||V,y.local_network_type=F,y.local_port=B,y.protocol=j):"remote-candidate"===t&&(y.remote_candidate_type=L,y.remote_ip=U||V,y.remote_port=B)})),(b=r.audio).timestamp){e.next=18;break}return u.timestamp=Date.now(),r.audio=u,e.abrupt("return",this.filterIllegal(c));case 18:if(void 0===u.concealedSamples){e.next=25;break}return y.interval_concealed_samples=u.concealedSamples-b.concealedSamples,y.interval_samples_received=u.totalSamplesReceived-b.totalSamplesReceived,y.interval_silent_concealed_samples=u.silentConcealedSamples-b.silentConcealedSamples,e.next=24,this._stream.updateAudioStallInfo(y,c,u);case 24:k=e.sent;case 25:return u.timestamp=Date.now(),c.audioLossRate=(u.packetsLost-b.packetsLost)/(u.packetsReceived-b.packetsReceived+(u.packetsLost-b.packetsLost)),c.audioLossRate=Number.isNaN(c.audioLossRate)?0:c.audioLossRate,y.fraction_lost=c.audioLossRate,c.statsInterval=u.timestamp-b.timestamp,y.stats_interval=c.statsInterval,c.receivedKBitrate=(u.bytesReceived-b.bytesReceived||0)/c.statsInterval*8,y.bandwidth=Math.round(1e3*c.receivedKBitrate/1024),void 0!==u.concealedSamples&&(c.receivedSampleRate=1e3*y.interval_samples_received/c.statsInterval),void 0!==u.fecPacketsReceived&&(y.fecBitratebps=(u.fecPacketsReceived-b.fecPacketsReceived||0)/c.statsInterval),y.average_jitter_buffer_delay_ms&&y.total_rtt_ms&&(c.e2eDelay=y.average_jitter_buffer_delay_ms+y.total_rtt_ms),null!==(i=this._context.streamRTT)&&void 0!==i&&null!==(o=i[l])&&void 0!==o&&o.audio&&(c.totalRtt=(y.rtt?y.rtt:0)+this._context.streamRTT[l].audio),r.audio=u,y.vendor_mode=this._stream.vendorCode||0,y.pc_session_id=null===(a=this.handler)||void 0===a?void 0:a.peerConnectionId,null===(s=this._monitor)||void 0===s||s.report("rtc_media_statistics",y,k),e.abrupt("return",this.filterIllegal(c));case 42:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"getRemoteVideoStats",value:(t=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s={},c={timestamp:Date.now()},u=this._stream,d=u.streamId,l=u.userId,h=u.isScreen,p=u.subMediaType,v=u._attributes,f=Zl({media_type:"video",is_screen:!!h,direction:"down",stream_id:d,stream_user_id:l,vid:this._stream.videoMid,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,mute_state:TL(p)?"mute_state_off":"mute_state_on",remote_user_capture_state:v.localvideo?"capture_state_on":"capture_state_off",remote_user_mute_state:v.localvideo&&v.videostream?"mute_state_off":"mute_state_on"},this._stream.getVideoRenderInfo()),t&&this.handler){e.next=6;break}return e.abrupt("return",s);case 6:return s.isScreen=h,e.next=9,this.handler.getStats(t);case 9:if((_=e.sent).length){e.next=12;break}return e.abrupt("return",s);case 12:if(_.forEach((function(e){var t=e.type,r=e.frameHeight,n=e.frameWidth,i=e.packetsLost,o=e.packetsReceived,a=e.bytesReceived,u=e.framesDecoded,l=e.jitterBufferDelay,h=e.jitterBufferEmittedCount,p=e.mimeType,v=e.firCount,_=e.availableIncomingBitrate,m=e.availableOutgoingBitrate,g=e.bytesSent,y=e.nominated,S=e.id,b=e.currentRoundTripTime,E=e.state,T=e.writable,I=e.candidateType,R=e.ip,A=e.address,w=e.networkType,C=e.port,x=e.nackCount,O=e.pliCount,P=e.protocol,M=e.requestsReceived,D=e.responsesReceived,N=e.requestsSent,L=e.consentRequestsSent,U=e.responsesSent,V=e.ssrc,F=e.jitter,B=e.framesReceived,j=e.keyFramesDecoded,H=e.totalDecodeTime,G=e.decoderImplementation,z=e.lastPacketReceivedTimestamp,K=e.framesDropped;if("inbound-rtp"===t)c.packetsLost=i,f.packetsLost=i,c.packetsReceived=o,f.packetsReceived=o,c.bytesReceived=a,f.bytes=a,c.framesDecoded=u,c.totalDecodeTime=H,void 0!==l&&(c.jitterBufferDelay=l/h*1e3,f.average_jitter_buffer_delay_ms=c.jitterBufferDelay),f.fir_count=v,f.nackCount=x,c.nackCount=x,f.pli_count=O,f.ssrc=V,f.framesDropped=K,f.jitter=1e3*F,f.framesReceived=B,c.framesReceived=B,f.framesDecoded=u,f.key_frames_decoded=j,f.decoder_name=G,f.last_packet_received_timestamp=z,void 0!==n&&(s.width=n,f.frame_size_width=n,s.height=r,f.frame_size_height=r);else if("track"===t&&void 0!==n)s.width=n,f.frame_size_width=n,s.height=r,f.frame_size_height=r,void 0!==B&&(f.framesReceived=B,c.framesReceived=B);else if("codec"===t)f.codecName=p;else if("candidate-pair"===t){var W,X;f.ice_available_incoming_bitrate=_,f.ice_available_outgoing_bitrate=m,f.ice_bytes_received=a,f.ice_bytes_sent=g,f.ice_nominated=Number(y),f.ice_pair_id=S,f.ice_pair_rtt=b,f.rtt=1e3*b,f.rtt&&null!==(W=k._context.streamRTT)&&void 0!==W&&null!==(X=W[d])&&void 0!==X&&X.video&&(f.total_rtt_ms=Math.round(f.rtt+(k._context.streamRTT[d].video||0))),s.rtt=f.rtt,f.ice_pair_state=E,f.ice_pair_writable=T,f.recv_ping_requests=M,f.recv_ping_responses=D,f.sent_ping_requests_before_first_response=N,f.sent_ping_requests_total=N+(L||0),f.sent_ping_responses=U}else"local-candidate"===t?(f.local_candidate_type=I,f.local_ip=R||A,f.local_network_type=w,f.local_port=C,f.protocol=P):"remote-candidate"===t&&(f.remote_candidate_type=I,f.remote_ip=R||A,f.remote_port=C)})),(m=r.video).timestamp){e.next=17;break}return r.video=c,e.abrupt("return",this.filterIllegal(s));case 17:return g=c.packetsLost-m.packetsLost,y=c.packetsReceived-m.packetsReceived,s.videoLossRate=g/(y+g),m.totalDecodeTime&&m.framesDecoded&&c.framesDecoded!==m.framesDecoded&&(S=c.totalDecodeTime-m.totalDecodeTime,b=c.framesDecoded-m.framesDecoded,f.decode_elapse_per_frame=Number((S/b*1e3).toFixed(2))),s._retransmittedRate=(c.nackCount-m.nackCount)/(y+g),s.videoLossRate=Number.isNaN(s.videoLossRate)?0:s.videoLossRate,f.fraction_lost=s.videoLossRate,s.statsInterval=c.timestamp-m.timestamp,f.stats_interval=s.statsInterval,s.receivedKBitrate=(c.bytesReceived-m.bytesReceived||0)/s.statsInterval*8,f.bitrate=Math.round(1e3*s.receivedKBitrate),f.bandwidth=Math.round(f.bitrate/1024),s.decoderOutputFrameRate=1e3*(c.framesDecoded-m.framesDecoded)/s.statsInterval,s.receivedFrameRate=1e3*(c.framesReceived-m.framesReceived)/s.statsInterval,f.frame_rate_decoded=Math.round(s.decoderOutputFrameRate),f.frame_rate_received=Math.round(s.receivedFrameRate),f.average_jitter_buffer_delay_ms&&f.total_rtt_ms&&(s.e2eDelay=f.average_jitter_buffer_delay_ms+f.total_rtt_ms),null!==(n=this._context.streamRTT)&&void 0!==n&&null!==(i=n[d])&&void 0!==i&&i.video&&(s.totalRtt=(f.rtt?f.rtt:0)+(this._context.streamRTT[d].video||0)),r.video=c,this._stream.updateVideoStallInfo(f,s),f.vendor_mode=this._stream.vendorCode||0,f.pc_session_id=null===(o=this.handler)||void 0===o?void 0:o.peerConnectionId,null===(a=this._monitor)||void 0===a||a.report("rtc_media_statistics",f),e.abrupt("return",this.filterIllegal(s));case 41:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"destroy",value:function(){LA(NA(o.prototype),"destroy",this).call(this),LA(NA(o.prototype),"stopReport",this).call(this,"destroy"),this._stream.stopAudioStallObserve()}}]),o}(MG),LG=function(){function e(t,r){Bh(this,e),Jl(this,"_removeHandler",void 0),Jl(this,"_remotePauseHandler",void 0),Jl(this,"_prePts",void 0),Jl(this,"_stallList",void 0),Jl(this,"_videoInWaiting",!1),Jl(this,"_videoInWaitingCallback",!1),Jl(this,"_videoInWaiting100ms",!1),Jl(this,"_isPaused",void 0),Jl(this,"_pauseStart",0),Jl(this,"_pauseDuration",0),Jl(this,"_requestVideoFrameCallbackTimer",void 0),Jl(this,"_logger",void 0),Jl(this,"_player",void 0),Jl(this,"_recentVideoInfo",void 0),Jl(this,"_stallTimeThreshold",void 0),Jl(this,"_openVideoStall100ms",RU.VIDEO_STALL_100MS);var n=t?1500:BL||FL?550:500;this._stallTimeThreshold={report:n,callback:Math.max(RU.VIDEO_STALL_DATA,n)},this._logger=new lN("VideoStallObserver",1,r)}return Fh(e,[{key:"start",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._logger.print("start","invoke"),this._player=e,aL&&!r)e.domElement&&(this._requestVideoFrameCallbackTimer=e.domElement.requestVideoFrameCallback(this._onVideoRefresh.bind(this)),this._removeHandler=function(){var r;t._requestVideoFrameCallbackTimer&&(null===(r=e.domElement)||void 0===r||r.cancelVideoFrameCallback(t._requestVideoFrameCallbackTimer))});else{var n=function(r){return t._onVideoTimeupdate(r,e)};e.on("playback_event",n),this._removeHandler=function(){return e.off("playback_event",n)}}var i=function(e){return t._onVideoPause(e)};e.on("playback_event",i),this._remotePauseHandler=function(){return e.off("playback_event",i)}}},{key:"getRecentRenderInfo4Report",value:function(){var e=this,t={};return this._recentVideoInfo&&LS(this._recentVideoInfo).forEach((function(r){var n,i=r.replace(/[a-z]{1}[A-Z]{1}/g,(function(e){var t;return Bg(t="".concat(e[0],"_")).call(t,e[1].toLowerCase())}));t["video_".concat(i)]=null===(n=e._recentVideoInfo)||void 0===n?void 0:n[r]})),t}},{key:"stop",value:function(){var e,t;this._logger.print("stop","invoke"),delete this._player,null===(e=this._removeHandler)||void 0===e||e.call(this),delete this._removeHandler,null===(t=this._remotePauseHandler)||void 0===t||t.call(this),delete this._remotePauseHandler,delete this._stallList,delete this._prePts,delete this._recentVideoInfo,this._videoInWaiting=!1,this._videoInWaitingCallback=!1,this._videoInWaiting100ms=!1}},{key:"destroy",value:function(){this.stop()}},{key:"getStallInfo",value:function(e){var t=this,r=e.interval,n=e.frameRateReceived,i=e.frameRateDecoded,o=e.bitrate,a={pts:0,report:{stallCount:0,stallDuration:0,list:[]},callback:{stallCount:0,stallDuration:0},pauseDuration:this._getPauseDuration()};this._stallList&&((BL||FL)&&(0===o||(i||1/0)<=1||(n||1/0)<=1)||0===this._stallList.length?(a.report.stallDuration=a.callback.stallDuration=2e3,a.report.stallCount=a.callback.stallCount=this._videoInWaiting?0:1,this._openVideoStall100ms&&(a.stall100ms={count:this._videoInWaiting100ms?0:1,duration:2e3}),this._videoInWaiting=!0,this._videoInWaitingCallback=!0,this._videoInWaiting100ms=!0):this._stallList.forEach((function(e,n){var i=e.timeUpdateInterval;0===n&&t._videoInWaiting&&(i=Math.round(e.timeUpdateInterval%r));var o=e.timeUpdateInterval>t._stallTimeThreshold.report;o&&(a.report.list.push(e.timeUpdateInterval),a.report.stallDuration+=i,t._videoInWaiting||a.report.stallCount++),t._videoInWaiting=o,e.timeUpdateInterval>t._stallTimeThreshold.callback?(a.callback.stallDuration+=i,t._videoInWaitingCallback||a.callback.stallCount++,t._videoInWaitingCallback=!0):t._videoInWaitingCallback=!1,t._openVideoStall100ms&&(a.stall100ms||(a.stall100ms={count:0,duration:0}),e.timeUpdateInterval>100?(a.stall100ms.duration+=i,t._videoInWaiting100ms||a.stall100ms.count++,t._videoInWaiting100ms=!0):t._videoInWaiting100ms=!1),a.pts=e.playTime})),this._stallList=[]);return a}},{key:"_getPauseDuration",value:function(){var e=this._pauseDuration;if(this._pauseDuration=0,this._isPaused){var t=oL(),r=t-(this._pauseStart||0);r>500&&(this._pauseStart=t,e+=r)}return e}},{key:"_onVideoPause",value:function(e){if("pause"===e.eventName)this._isPaused=!0,this._pauseStart=oL();else if("play"===e.eventName&&this._isPaused){this._isPaused=!1;var t=oL()-this._pauseStart;t>500&&(this._pauseDuration+=t)}}},{key:"_onVideoTimeupdate",value:function(e,t){if("timeupdate"===e.eventName){var r=t.domElement;if(!r||0===r.currentTime)return;if(void 0===this._prePts)return void(this._prePts=r.currentTime);if(this._stallList||(this._stallList=[]),r.currentTime>this._prePts){var n=r.currentTime-this._prePts;this._stallList.push({playTime:r.currentTime,timeUpdateInterval:Math.round(1e3*n)})}this._prePts=r.currentTime}}},{key:"_onVideoRefresh",value:function(e,t){var r,n;if(this._stallList||(this._stallList=[]),this._prePts){var i=t.presentationTime-this._prePts;this._stallList.push({playTime:t.presentationTime,timeUpdateInterval:Math.round(i)})}this._recentVideoInfo=t,this._prePts=t.presentationTime,null===(r=this._player)||void 0===r||null===(n=r.domElement)||void 0===n||n.requestVideoFrameCallback(this._onVideoRefresh.bind(this))}}]),e}(),UG=function(){function e(t){Bh(this,e),Jl(this,"_audioStallTimer",void 0),Jl(this,"_preSample",void 0),Jl(this,"_isStallInPreCallbackEnd",!1),Jl(this,"_isStallInPreReportEnd",!1),Jl(this,"_stallList",[]),this._stream=t}var t,r;return Fh(e,[{key:"start",value:function(t,r){this.stop(),RU.AUDIO_STALL&&e.interval>0&&"number"==typeof t&&"number"==typeof r&&(this._preSample={ts:oL(),concealedSamples:t,totalSamplesReceived:r},this._startStallCountInterval())}},{key:"stop",value:function(){this._stallList=[],this._audioStallTimer&&(clearTimeout(this._audioStallTimer),delete this._audioStallTimer)}},{key:"destroy",value:function(){this.stop()}},{key:"getAudioStallInfo",value:(r=Ng(Mg().mark((function t(){var r,n,i,o,a;return Mg().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={stats_count:Iy(r=this._stallList).call(r,(function(e){return!!e.get_stats_cost})).length,stall_list:rR(this._stallList)},t.prev=1,t.next=4,this._audioStallCount();case 4:t.next=8;break;case 6:t.prev=6,t.t0=t.catch(1);case 8:return i=BG(this._stallList,2,this._isStallInPreReportEnd),this._isStallInPreReportEnd=i.isStallInEnd,o=RU.AUDIO_STALL_DATA/e.interval,a=BG(this._stallList,o,this._isStallInPreCallbackEnd),this._isStallInPreCallbackEnd=a.isStallInEnd,this.stop(),this._startStallCountInterval(),t.abrupt("return",{report:{stall_count:i.stall_count,stall_duration:i.stall_duration,list:i.list},callback:{stall_count:a.stall_count,stall_duration:a.stall_duration,list:a.list},extra:n});case 16:case"end":return t.stop()}}),t,this,[[1,6]])}))),function(){return r.apply(this,arguments)})},{key:"_startStallCountInterval",value:function(){var t=this,r=function(){var n=Ng(Mg().mark((function n(){return Mg().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return clearTimeout(t._audioStallTimer),delete t._audioStallTimer,n.next=4,t._audioStallCount();case 4:t._audioStallTimer||(t._audioStallTimer=setTimeout(r,e.interval));case 5:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();this._audioStallTimer=setTimeout(r,e.interval)}},{key:"_audioStallCount",value:(t=Ng(Mg().mark((function t(){var r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I,R;return Mg().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._preSample&&!(oL()-this._preSample.ts<.5*e.interval)){t.next=2;break}return t.abrupt("return");case 2:if(r=this._stream,n=r.hasAudio,i=r.subAudio,o=r.virtual,a=r.virtualOccupy,s=r.removeTrack,c=r.audioTrack,!s&&c){t.next=7;break}return clearTimeout(this._audioStallTimer),delete this._audioStallTimer,t.abrupt("return");case 7:if((u=n&&i)&&(!o||a)){t.next=13;break}this._preSample.ts=oL(),this._stallList.push({reason:u?Bg(l="virtual: ".concat(o,", virtualOccupy: ")).call(l,a):Bg(d="hasAudio: ".concat(n,", subAudio: ")).call(d,i)}),t.next=29;break;case 13:return h=oL(),f=0,t.prev=15,t.next=18,null===(_=this._stream.audioTransceiver)||void 0===_?void 0:_.receiver.getStats();case 18:null==(m=t.sent)||m.forEach((function(e){"inbound-rtp"===e.type&&(p=e),f++})),t.next=25;break;case 22:t.prev=22,t.t0=t.catch(15),v=t.t0.message||zg(t.t0);case 25:g=oL(),y=oL(),S=y-this._preSample.ts,p?(k=(b=p).concealedSamples,E=b.totalSamplesReceived,T=k-this._preSample.concealedSamples,I=E-this._preSample.totalSamplesReceived,R=T>=0&&I>=0&&T>=e.ratio*I,this._stallList.push({concealed:T,received:I,diff:S,start:this._preSample.ts,end:y,get_stats_cost:g-h,get_stats_start:h,get_stats_end:g,is_stall:R}),this._preSample.concealedSamples=k,this._preSample.totalSamplesReceived=E,this._preSample.ts=y):this._stallList.push({diff:S,start:this._preSample.ts,end:y,get_stats_cost:g-h,get_stats_start:h,get_stats_end:g,reason:f?v||"no inbound-rtp":"no report"});case 29:case"end":return t.stop()}}),t,this,[[15,22]])}))),function(){return t.apply(this,arguments)})}],[{key:"setAudioStallConfig",value:function(t){e.interval=((null==t?void 0:t.audio_stall_interval)||200)/2,e.ratio=(null==t?void 0:t.audio_stall_ratio)||.6}}]),e}();Jl(UG,"interval",100),Jl(UG,"ratio",.6);var VG,FG,BG=function(e,t,r){for(var n,i={stall_count:0,stall_duration:0,isStallInEnd:!1,list:[]},o=0,a=0,s=0;s<e.length;s++){var c=e[s];c.is_stall&&(o++,a+=c.diff||0);var u=s===e.length-1;if(!c.is_stall||u){var d=o>=t,l=s+t-o-1;if(!d&&o>2){var h=0;cI(e).call(e,s+1,l+1).forEach((function(e){e.is_stall&&(h+=e.diff||0)})),(d=a+h>UG.interval*t*UG.ratio)&&(s=l,a+=h)}d&&(i.stall_count++,i.stall_duration+=a,i.list.push(a)),u&&(i.isStallInEnd=d),o=a=0}}return!0===(null===(n=e[0])||void 0===n?void 0:n.is_stall)&&r&&i.stall_count>0&&i.stall_count--,i},jG=function(e){VA(r,e);var t=tw(r);function r(e){var n;return Bh(this,r),Jl(sA(n=t.call(this)),"_videoPlayer",void 0),Jl(sA(n),"isScreen",!1),Jl(sA(n),"audioMid",void 0),Jl(sA(n),"videoMid",void 0),Jl(sA(n),"videoTransceiver",void 0),Jl(sA(n),"audioTransceiver",void 0),Jl(sA(n),"vendorHandler",void 0),Jl(sA(n),"vendorCode",0),Jl(sA(n),"engineId",void 0),Jl(sA(n),"_ctx",void 0),Jl(sA(n),"logger",void 0),n.engineId=e.id,n._ctx=e,n.logger=new lN("Stream",0,e.id),n}return Fh(r,[{key:"stopReport",value:function(e){this.statsReport.stopReport(e)}},{key:"destroy",value:function(){var e,t;delete this.audioMid,delete this.videoMid,this.statsReport.destroy(),null===(e=this.observer)||void 0===e||e.reset(),delete this.videoTransceiver,delete this.audioTransceiver,null===(t=this.vendorHandler)||void 0===t||t.destroy(),this.vendorCode=0,delete this.vendorHandler}}]),r}(oV),HG=function(e){return e[e.INIT=0]="INIT",e[e.SUB_ING=1]="SUB_ING",e[e.SUB_ED=2]="SUB_ED",e}(HG||{}),GG=function(e){VA(r,e);var t=tw(r);function r(e){var n;return Bh(this,r),Jl(sA(n=t.call(this,e)),"id",void 0),Jl(sA(n),"stream",void 0),Jl(sA(n),"streamId",void 0),Jl(sA(n),"seiList",[]),Jl(sA(n),"videoTrack",void 0),Jl(sA(n),"audioTrack",void 0),Jl(sA(n),"videoEncodeConfig",[PU]),Jl(sA(n),"subVideoDescriptions",[]),Jl(sA(n),"enableSimulcast",!1),Jl(sA(n),"observer",void 0),Jl(sA(n),"statsReport",void 0),Jl(sA(n),"prevBitrate",0),Jl(sA(n),"pubAudio",!1),Jl(sA(n),"pubVideo",!1),Jl(sA(n),"pubAttributes",void 0),Jl(sA(n),"pcSessionId",void 0),n.stream=new MediaStream,n.id=vx(),n.pubAttributes={localaudio:!1,localvideo:!1,videostream:!1,audiostream:!1,extvideo:!1,extaudio:!1,videoDescriptions:[]},n.statsReport=new DG(e,sA(n)),n}return Fh(r,[{key:"audioHasCapture",get:function(){return this.pubAttributes.localaudio}},{key:"audioHasPublish",get:function(){return this.pubAttributes.audiostream}},{key:"videoHasCapture",get:function(){return this.pubAttributes.localvideo}},{key:"videoHasPublish",get:function(){return this.pubAttributes.videostream}},{key:"hasPublished",get:function(){return!!this.audioMid&&!!this.videoMid}},{key:"isEmptyStream",get:function(){return!this.audioTrack&&!this.videoTrack}},{key:"initStreamId",get:function(){return this.stream.id}},{key:"startReport",value:function(e,t){this.statsReport.setLocalStreamStatsEvtInterval(e,t)}},{key:"initVideoEncodedTransform",value:function(){var e=this;if(this.videoTransceiver&&this.videoTransceiver.sender){var t=this.videoTransceiver.sender;if(this._ctx.pcKillSwitch.ctor_encodedinsetablestream_add&&Ej()){var r=t.createEncodedStreams(),n=r.readable,i=r.writable,o=new TransformStream({transform:function(t,r){var n=e.seiList[0];if(n){var i,o=PG.generateSEI(n.content),a=new Uint8Array(o.byteLength+t.data.byteLength);if(0===n.repeatCount)jI(i=e.seiList).call(i,0,1);n.repeatCount--,a.set(new Uint8Array(t.data)),a.set(o,t.data.byteLength),t.data=a.buffer,r.enqueue(t)}else r.enqueue(t)}});n.pipeThrough(o).pipeTo(i)}}else this.logger.warn("no sender found when trying to bind encodedTransform")}},{key:"initAudioEncodedTransform",value:function(){if(this.audioTransceiver&&this.audioTransceiver.sender)if(this._ctx.pcKillSwitch.ctor_encodedinsetablestream_add){var e=this.audioTransceiver.sender.createEncodedStreams(),t=e.readable,r=e.writable;t.pipeThrough(new TransformStream({transform:function(e,t){t.enqueue(e)}})).pipeTo(r)}else this.logger.warn("initAudioEncodedTransform","legacy EncodedTransform is not supported");else this.logger.warn("no sender found when trying to bind encodedTransform")}},{key:"clean",value:function(){JD(this.engineId,"localstream_clean","".concat((new Error).stack),0,this.streamId||""),LA(NA(r.prototype),"destroy",this).call(this),this.prevBitrate=0,this.subVideoDescriptions=[]}},{key:"switchTrackEnableState",value:function(e,t){var r,n;"audio"===e?n=this.audioTrack:"video"===e&&(n=this.videoTrack);var i=null===(r=n)||void 0===r?void 0:r.mediaTrack;return!(!i||(null==i?void 0:i.enabled)===t)&&(i.enabled=t,!0)}},{key:"resetStream",value:function(){this.stream=new MediaStream}}]),r}(jG),zG=function(e){VA(n,e);var t,r=tw(n);function n(e,t,i,o,a,s){var c;return Bh(this,n),Jl(sA(c=r.call(this,e)),"streamId",void 0),Jl(sA(c),"userId",void 0),Jl(sA(c),"isPublic",void 0),Jl(sA(c),"hasVideo",void 0),Jl(sA(c),"hasAudio",void 0),Jl(sA(c),"_attributes",void 0),Jl(sA(c),"streamState",void 0),Jl(sA(c),"removeTrack",!1),Jl(sA(c),"observer",void 0),Jl(sA(c),"statsReport",void 0),Jl(sA(c),"subVideo",void 0),Jl(sA(c),"subAudio",void 0),Jl(sA(c),"subMediaType",void 0),Jl(sA(c),"subLayer",void 0),Jl(sA(c),"_sequenceId",void 0),Jl(sA(c),"stream",void 0),Jl(sA(c),"videoTrack",void 0),Jl(sA(c),"audioTrack",void 0),Jl(sA(c),"recordedVideoFrames",void 0),Jl(sA(c),"stillExist",void 0),Jl(sA(c),"originalMediaType",void 0),Jl(sA(c),"priority",void 0),Jl(sA(c),"originalStreamIndex",0),Jl(sA(c),"virtual",void 0),Jl(sA(c),"pcSessionId",void 0),Jl(sA(c),"_virtualOccupy",void 0),Jl(sA(c),"_videoStallObserver",void 0),Jl(sA(c),"_audioStallObserver",void 0),Jl(sA(c),"_handler",void 0),c.virtual=!1,c._virtualOccupy=!1,c.userId=t,c.isScreen=o,c.isPublic=a,c.streamId=i,c.hasAudio=s.audiostream&&s.localaudio,c.hasVideo=s.videostream&&s.localvideo,c._attributes=s,c.vendorCode=(null==s?void 0:s.vendorCode)||0,c.subVideo=!1,c.subAudio=!1,c._sequenceId=0,c.subMediaType=TG.NONE,c.subLayer={spatialLayer:0,spatialSubLayer:-1},c.streamState=0,c.statsReport=new NG(e,sA(c)),c.enableVendorMode&&(c.pcSessionId=vx()),c}return Fh(n,[{key:"vendor",get:function(){return this._attributes.vendorCode}},{key:"audioHasCapture",get:function(){return this._attributes.localaudio}},{key:"audioHasPublish",get:function(){return this._attributes.audiostream}},{key:"videoHasCapture",get:function(){return this._attributes.localvideo}},{key:"videoHasPublish",get:function(){return this._attributes.videostream}},{key:"sequenceId",get:function(){return this._sequenceId||-1},set:function(e){"number"==typeof e&&(this._sequenceId=e)}},{key:"enableVendorMode",get:function(){return"number"==typeof this.attributes.vendorCode&&0!==this.attributes.vendorCode}},{key:"hasSubscribed",get:function(){return 2===this.streamState}},{key:"attributes",get:function(){return this._attributes},set:function(e){this.hasVideo=e.localvideo&&e.videostream,this.hasAudio=e.localaudio&&e.audiostream,this._attributes=e,this.vendorCode=e.vendorCode||0}},{key:"virtualOccupy",get:function(){return this._virtualOccupy},set:function(e){var t;if(this._virtualOccupy&&!e)null===(t=this.observer)||void 0===t||t.setPushTrack(!1);else if(!this._virtualOccupy&&e){var r;null===(r=this.observer)||void 0===r||r.setPushTrack(!0)}this._virtualOccupy=e}},{key:"startReport",value:function(e,t){this.statsReport.setRemoteStreamStatsEvtInterval(e,t),this._handler=t}},{key:"getStats",value:function(e,t){var r;return null===(r=this._handler)||void 0===r?void 0:r.getStats(e,t)}},{key:"initVideoEncodedTransform",value:function(){var e=this;if(this.videoTransceiver&&this.videoTransceiver.receiver)if(this._ctx.pcKillSwitch.ctor_encodedinsetablestream_add){var t=this.videoTransceiver.receiver.createEncodedStreams(),r=t.readable,n=t.writable;r.pipeThrough(new TransformStream({transform:function(t,r){IG.getNalunits(new RG(t.data)).forEach((function(t){if(t.sei){var r=PG.decodeSeiBody(t.body);r&&r.type!==AG.internal&&e.safeEmit("onSEIMessage",r.payload)}})),r.enqueue(t)}})).pipeTo(n)}else this.logger.warn("initAudioEncodedTransform","legacy EncodedTransform is not supported");else this.logger.warn("no receiver found when trying to bind encodedTransform")}},{key:"initAudioEncodedTransform",value:function(){var e=this;if(this.audioTransceiver&&this.audioTransceiver.receiver)if(this._ctx.pcKillSwitch.ctor_encodedinsetablestream_add){var t=this.audioTransceiver.receiver.createEncodedStreams(),r=t.readable,n=t.writable;r.pipeThrough(new TransformStream({transform:function(t,r){t.data.byteLength<=1e3?r.enqueue(t):e.logger.print("too large audio frame",t.data.byteLength)}})).pipeTo(n)}else this.logger.warn("legacy EncodedTransform is not supported");else this.logger.warn("no receiver found when trying to bind encodedTransform")}},{key:"ontrack",value:function(e){var t,r,n;try{var i;JD(this.engineId,"Stream.ontrack",zg({uid:this.userId,streamId:this.streamId,streams:aS(i=e.streams).call(i,(function(e,t){return e+gx(t)}),""),transceiver:bx(e.transceiver),track:mx(e.track)}),0,this.streamId||"")}catch(Y$){}if(this.enableVendorMode||null!==(t=e.streams)&&void 0!==t&&null!==(r=t[0])&&void 0!==r&&null!==(n=r.id)&&void 0!==n&&qy(n).call(n,this.streamId)){var o,a=e.track;"video"===(null==a?void 0:a.kind)?this._setVideoTrack(a):"audio"===(null===(o=e.track)||void 0===o?void 0:o.kind)&&this._setAudioTrack(a),this._setStream(e.streams[0])}this.safeEmit("ontrack",e)}},{key:"startVideoStallObserve",value:function(e){this.logger.info("startVideoStallObserve","invoke"),this._videoStallObserver||(this._videoStallObserver=new LG(this.isScreen,this.engineId)),this._videoStallObserver.start(e),this._videoPlayer=e}},{key:"stopVideoStallObserve",value:function(){var e;this.logger.info("stopVideoStallObserve","invoke"),null===(e=this._videoStallObserver)||void 0===e||e.stop(),delete this._videoPlayer}},{key:"updateVideoStallInfo",value:function(e,t){var r,n=null===(r=this._videoStallObserver)||void 0===r?void 0:r.getStallInfo({interval:e.stats_interval||0,bitrate:e.bitrate,frameRateDecoded:e.frame_rate_decoded,frameRateReceived:e.frame_rate_received});if(n){var i=Math.min(n.report.stallDuration,e.stats_interval||0);if(e.play_time=n.pts,e.stall_count=n.report.stallCount,e.is_screen?e.stuck_length=i:e.stall_duration=i,e.pause_duration=Math.min(i,n.pauseDuration),t.stallCount=n.callback.stallCount,t.stallDuration=n.callback.stallDuration,n.stall100ms){var o=Math.min(n.stall100ms.duration,e.stats_interval||0);e.stall_duration_100ms=o,e.stall_count_100ms=n.stall100ms.count,t.stallDuration100MS=o,t.stallCount100MS=n.stall100ms.count}0===n.report.stallCount&&0===n.report.stallDuration||this.logger.print("video_stall_report",this.userId,zg(n.report))}}},{key:"getVideoRenderInfo",value:function(){var e;return(null===(e=this._videoStallObserver)||void 0===e?void 0:e.getRecentRenderInfo4Report())||{}}},{key:"stopAudioStallObserve",value:function(){var e;this.logger.info("stopAudioStallObserve","invoke"),null===(e=this._audioStallObserver)||void 0===e||e.stop()}},{key:"updateAudioStallInfo",value:(t=Ng(Mg().mark((function e(t,r,n){var i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._audioStallObserver){e.next=6;break}this._audioStallObserver=new UG(this),this._audioStallObserver.start(n.concealedSamples,n.totalSamplesReceived),this.logger.print("startAduioObserver","start"),e.next=12;break;case 6:return e.next=8,this._audioStallObserver.getAudioStallInfo();case 8:return i=e.sent,t.concealedSamples===t.interval_concealed_samples&&t.totalSamplesReceived===t.interval_samples_received?(t.stall_count=0,t.stall_duration=0,r.stallCount=0,r.stallDuration=0):(t.stall_count=i.report.stall_count,t.stall_duration=i.report.stall_duration,r.stallCount=i.callback.stall_count,r.stallDuration=i.callback.stall_duration),0===i.report.stall_count&&0===i.report.stall_duration||this.logger.print("audio_stall_report",this.userId,zg(Zl(Zl({},i.report),{},{callbackList:i.callback.list}))),e.abrupt("return",i.extra);case 12:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"clean",value:function(){var e,t;this.logger.info("clean",Bg(e="exec stream.clean ".concat(this.streamId," ")).call(e,this.userId)),JD(this.engineId,"remotestream_clean","".concat((new Error).stack),0,this.streamId),LA(NA(n.prototype),"destroy",this).call(this),this.subAudio=!1,this.subVideo=!1,this.sequenceId=0,this.videoTrack=void 0,null===(t=this.audioTrack)||void 0===t||t.close(),this.audioTrack=void 0,this.stream=void 0,this.recordedVideoFrames=void 0,delete this.priority}},{key:"destroy",value:function(){var e,t;this.clean(),null===(e=this._audioStallObserver)||void 0===e||e.destroy(),delete this._audioStallObserver,null===(t=this._videoStallObserver)||void 0===t||t.destroy(),delete this._videoStallObserver,this.attributes={audiostream:!1,localaudio:!1,localvideo:!1,videostream:!1,extvideo:!1,extaudio:!1,videoDescriptions:[]}}},{key:"resetHasSubscribed",value:function(){this.streamState=0}},{key:"_setStream",value:function(e){var t=this;this.stream=e,e.onaddtrack=function(e){"video"===e.track.kind?t._setVideoTrack(e.track):"audio"===e.track.kind&&t._setAudioTrack(e.track)}}},{key:"_setAudioTrack",value:function(e){var t,r;(null===(t=this.audioTrack)||void 0===t||null===(r=t.preprocessingTrack)||void 0===r?void 0:r.id)!==e.id&&(this.audioTrack=pG(e),this.emit("ontrack",this.audioTrack))}},{key:"_setVideoTrack",value:function(e){var t,r;(null===(t=this.videoTrack)||void 0===t||null===(r=t.preprocessingTrack)||void 0===r?void 0:r.id)!==e.id&&(this.videoTrack=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:iL();return new KH(e,t)}(e),this.emit("ontrack",this.videoTrack))}}]),n}(jG),KG=new lN("queue",4),WG=function(e){return e[e.ADD=0]="ADD",e[e.CLOSE=1]="CLOSE",e}(WG||{}),XG=function(e){return e.publish="publish",e.unpublish="unpublish",e.subscribe="subscribe",e.unsubscribe="unsubscribe",e.pushtrack="pushtrack",e.removetrack="removetrack",e}(XG||{}),qG=(Jl(VG={},"publish","unpublish"),Jl(VG,"subscribe","unsubscribe"),Jl(VG,"pushtrack","removetrack"),VG),YG=(Jl(FG={},"publish",0),Jl(FG,"subscribe",0),Jl(FG,"pushtrack",0),Jl(FG,"unpublish",1),Jl(FG,"unsubscribe",1),Jl(FG,"removetrack",1),FG),JG=function(e){VA(r,e);var t=tw(r);function r(){var e;return Bh(this,r),Jl(sA(e=t.call(this)),"_queue",void 0),e._queue=[],e}return Fh(r,[{key:"queue",get:function(){return this._queue}},{key:"enqueue",value:function(e){var t,r=this._queue.length,n="";return this._queue=Iy(t=this._queue).call(t,(function(t){return t.streamId!==e.streamId||e.action!==qG[t.action]||(n=t.streamId,KG.info("offsetStreamId",n),!1)})),this._queue.length===r&&this._queue.push(e),this.emit("start"),n}},{key:"dequeue",value:function(){var e;if(!this._queue.length)return null;var t=this._queue.length;jL&&lU>=86&&lU<=92&&(t=Math.min(this._queue.length,5));for(var r=YG[this._queue[0].action],n=1;n<t;n++){var i;if(YG[this._queue[n].action]!==r)return{sdpStrategy:r,items:jI(i=this._queue).call(i,0,n)}}return{sdpStrategy:r,items:jI(e=this._queue).call(e,0,t)}}}]),r}(nV),QG="object"==typeof global&&global&&global.Object===Object&&global,ZG="object"==typeof self&&self&&self.Object===Object&&self,$G=QG||ZG||Function("return this")(),ez=$G.Symbol,tz=Object.prototype,rz=tz.hasOwnProperty,nz=tz.toString,iz=ez?ez.toStringTag:void 0;var oz=Object.prototype.toString;var az="[object Null]",sz="[object Undefined]",cz=ez?ez.toStringTag:void 0;function uz(e){return null==e?void 0===e?sz:az:cz&&cz in Object(e)?function(e){var t=rz.call(e,iz),r=e[iz];try{e[iz]=void 0;var n=!0}catch(o){}var i=nz.call(e);return n&&(t?e[iz]=r:delete e[iz]),i}(e):function(e){return oz.call(e)}(e)}function dz(e){return null!=e&&"object"==typeof e}var lz=Array.isArray;function hz(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function pz(e){return e}var vz="[object AsyncFunction]",fz="[object Function]",_z="[object GeneratorFunction]",mz="[object Proxy]";function gz(e){if(!hz(e))return!1;var t=uz(e);return t==fz||t==_z||t==vz||t==mz}var yz,Sz=$G["__core-js_shared__"],bz=(yz=/[^.]+$/.exec(Sz&&Sz.keys&&Sz.keys.IE_PROTO||""))?"Symbol(src)_1."+yz:"";var kz=Function.prototype.toString;function Ez(e){if(null!=e){try{return kz.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var Tz=/^\[object .+?Constructor\]$/,Iz=Function.prototype,Rz=Object.prototype,Az=Iz.toString,wz=Rz.hasOwnProperty,Cz=RegExp("^"+Az.call(wz).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function xz(e){return!(!hz(e)||(t=e,bz&&bz in t))&&(gz(e)?Cz:Tz).test(Ez(e));var t}function Oz(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return xz(r)?r:void 0}var Pz=Oz($G,"WeakMap"),Mz=Object.create,Dz=function(){function e(){}return function(t){if(!hz(t))return{};if(Mz)return Mz(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();var Nz=Date.now;var Lz,Uz,Vz,Fz=function(){try{var e=Oz(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),Bz=Fz,jz=Bz?function(e,t){return Bz(e,"toString",{configurable:!0,enumerable:!1,value:(r=t,function(){return r}),writable:!0});var r}:pz,Hz=(Lz=jz,Uz=0,Vz=0,function(){var e=Nz(),t=16-(e-Vz);if(Vz=e,t>0){if(++Uz>=800)return arguments[0]}else Uz=0;return Lz.apply(void 0,arguments)}),Gz=Hz;var zz=9007199254740991,Kz=/^(?:0|[1-9]\d*)$/;function Wz(e,t){var r=typeof e;return!!(t=null==t?zz:t)&&("number"==r||"symbol"!=r&&Kz.test(e))&&e>-1&&e%1==0&&e<t}function Xz(e,t,r){"__proto__"==t&&Bz?Bz(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function qz(e,t){return e===t||e!=e&&t!=t}var Yz=Object.prototype.hasOwnProperty;function Jz(e,t,r){var n=e[t];Yz.call(e,t)&&qz(n,r)&&(void 0!==r||t in e)||Xz(e,t,r)}function Qz(e,t,r,n){var i=!r;r||(r={});for(var o=-1,a=t.length;++o<a;){var s=t[o],c=n?n(r[s],e[s],s,r,e):void 0;void 0===c&&(c=e[s]),i?Xz(r,s,c):Jz(r,s,c)}return r}var Zz=Math.max;function $z(e,t){return Gz(function(e,t,r){return t=Zz(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,o=Zz(n.length-t,0),a=Array(o);++i<o;)a[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=r(a),function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}(e,this,s)}}(e,t,pz),e+"")}var eK=9007199254740991;function tK(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=eK}function rK(e){return null!=e&&tK(e.length)&&!gz(e)}var nK=Object.prototype;function iK(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||nK)}function oK(e){return dz(e)&&"[object Arguments]"==uz(e)}var aK=Object.prototype,sK=aK.hasOwnProperty,cK=aK.propertyIsEnumerable,uK=oK(function(){return arguments}())?oK:function(e){return dz(e)&&sK.call(e,"callee")&&!cK.call(e,"callee")},dK=uK;var lK="object"==typeof exports&&exports&&!exports.nodeType&&exports,hK=lK&&"object"==typeof module&&module&&!module.nodeType&&module,pK=hK&&hK.exports===lK?$G.Buffer:void 0,vK=(pK?pK.isBuffer:void 0)||function(){return!1},fK={};function _K(e){return function(t){return e(t)}}fK["[object Float32Array]"]=fK["[object Float64Array]"]=fK["[object Int8Array]"]=fK["[object Int16Array]"]=fK["[object Int32Array]"]=fK["[object Uint8Array]"]=fK["[object Uint8ClampedArray]"]=fK["[object Uint16Array]"]=fK["[object Uint32Array]"]=!0,fK["[object Arguments]"]=fK["[object Array]"]=fK["[object ArrayBuffer]"]=fK["[object Boolean]"]=fK["[object DataView]"]=fK["[object Date]"]=fK["[object Error]"]=fK["[object Function]"]=fK["[object Map]"]=fK["[object Number]"]=fK["[object Object]"]=fK["[object RegExp]"]=fK["[object Set]"]=fK["[object String]"]=fK["[object WeakMap]"]=!1;var mK="object"==typeof exports&&exports&&!exports.nodeType&&exports,gK=mK&&"object"==typeof module&&module&&!module.nodeType&&module,yK=gK&&gK.exports===mK&&QG.process,SK=function(){try{var e=gK&&gK.require&&gK.require("util").types;return e||yK&&yK.binding&&yK.binding("util")}catch(t){}}(),bK=SK&&SK.isTypedArray,kK=bK?_K(bK):function(e){return dz(e)&&tK(e.length)&&!!fK[uz(e)]},EK=Object.prototype.hasOwnProperty;function TK(e,t){var r=lz(e),n=!r&&dK(e),i=!r&&!n&&vK(e),o=!r&&!n&&!i&&kK(e),a=r||n||i||o,s=a?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],c=s.length;for(var u in e)!t&&!EK.call(e,u)||a&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Wz(u,c))||s.push(u);return s}function IK(e,t){return function(r){return e(t(r))}}var RK=IK(Object.keys,Object),AK=Object.prototype.hasOwnProperty;function wK(e){return rK(e)?TK(e):function(e){if(!iK(e))return RK(e);var t=[];for(var r in Object(e))AK.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}var CK=Object.prototype.hasOwnProperty;function xK(e){if(!hz(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=iK(e),r=[];for(var n in e)("constructor"!=n||!t&&CK.call(e,n))&&r.push(n);return r}function OK(e){return rK(e)?TK(e,!0):xK(e)}var PK,MK=(PK=function(e,t){Qz(t,OK(t),e)},$z((function(e,t){var r=-1,n=t.length,i=n>1?t[n-1]:void 0,o=n>2?t[2]:void 0;for(i=PK.length>3&&"function"==typeof i?(n--,i):void 0,o&&function(e,t,r){if(!hz(r))return!1;var n=typeof t;return!!("number"==n?rK(r)&&Wz(t,r.length):"string"==n&&t in r)&&qz(r[t],e)}(t[0],t[1],o)&&(i=n<3?void 0:i,n=1),e=Object(e);++r<n;){var a=t[r];a&&PK(e,a,r,i)}return e}))),DK=Oz(Object,"create");var NK=Object.prototype.hasOwnProperty;var LK=Object.prototype.hasOwnProperty;function UK(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function VK(e,t){for(var r=e.length;r--;)if(qz(e[r][0],t))return r;return-1}UK.prototype.clear=function(){this.__data__=DK?DK(null):{},this.size=0},UK.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},UK.prototype.get=function(e){var t=this.__data__;if(DK){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return NK.call(t,e)?t[e]:void 0},UK.prototype.has=function(e){var t=this.__data__;return DK?void 0!==t[e]:LK.call(t,e)},UK.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=DK&&void 0===t?"__lodash_hash_undefined__":t,this};var FK=Array.prototype.splice;function BK(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}BK.prototype.clear=function(){this.__data__=[],this.size=0},BK.prototype.delete=function(e){var t=this.__data__,r=VK(t,e);return!(r<0)&&(r==t.length-1?t.pop():FK.call(t,r,1),--this.size,!0)},BK.prototype.get=function(e){var t=this.__data__,r=VK(t,e);return r<0?void 0:t[r][1]},BK.prototype.has=function(e){return VK(this.__data__,e)>-1},BK.prototype.set=function(e,t){var r=this.__data__,n=VK(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};var jK=Oz($G,"Map");function HK(e,t){var r,n,i=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof t?"string":"hash"]:i.map}function GK(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function zK(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}GK.prototype.clear=function(){this.size=0,this.__data__={hash:new UK,map:new(jK||BK),string:new UK}},GK.prototype.delete=function(e){var t=HK(this,e).delete(e);return this.size-=t?1:0,t},GK.prototype.get=function(e){return HK(this,e).get(e)},GK.prototype.has=function(e){return HK(this,e).has(e)},GK.prototype.set=function(e,t){var r=HK(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};var KK=IK(Object.getPrototypeOf,Object);function WK(e){var t=this.__data__=new BK(e);this.size=t.size}WK.prototype.clear=function(){this.__data__=new BK,this.size=0},WK.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},WK.prototype.get=function(e){return this.__data__.get(e)},WK.prototype.has=function(e){return this.__data__.has(e)},WK.prototype.set=function(e,t){var r=this.__data__;if(r instanceof BK){var n=r.__data__;if(!jK||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new GK(n)}return r.set(e,t),this.size=r.size,this};var XK="object"==typeof exports&&exports&&!exports.nodeType&&exports,qK=XK&&"object"==typeof module&&module&&!module.nodeType&&module,YK=qK&&qK.exports===XK?$G.Buffer:void 0,JK=YK?YK.allocUnsafe:void 0;function QK(){return[]}var ZK=Object.prototype.propertyIsEnumerable,$K=Object.getOwnPropertySymbols,eW=$K?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var a=e[r];t(a,r,e)&&(o[i++]=a)}return o}($K(e),(function(t){return ZK.call(e,t)})))}:QK;var tW=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)zK(t,eW(e)),e=KK(e);return t}:QK;function rW(e,t,r){var n=t(e);return lz(e)?n:zK(n,r(e))}function nW(e){return rW(e,wK,eW)}function iW(e){return rW(e,OK,tW)}var oW=Oz($G,"DataView"),aW=Oz($G,"Promise"),sW=Oz($G,"Set"),cW="[object Map]",uW="[object Promise]",dW="[object Set]",lW="[object WeakMap]",hW="[object DataView]",pW=Ez(oW),vW=Ez(jK),fW=Ez(aW),_W=Ez(sW),mW=Ez(Pz),gW=uz;(oW&&gW(new oW(new ArrayBuffer(1)))!=hW||jK&&gW(new jK)!=cW||aW&&gW(aW.resolve())!=uW||sW&&gW(new sW)!=dW||Pz&&gW(new Pz)!=lW)&&(gW=function(e){var t=uz(e),r="[object Object]"==t?e.constructor:void 0,n=r?Ez(r):"";if(n)switch(n){case pW:return hW;case vW:return cW;case fW:return uW;case _W:return dW;case mW:return lW}return t});var yW=gW,SW=Object.prototype.hasOwnProperty;var bW=$G.Uint8Array;function kW(e){var t=new e.constructor(e.byteLength);return new bW(t).set(new bW(e)),t}var EW=/\w*$/;var TW=ez?ez.prototype:void 0,IW=TW?TW.valueOf:void 0;var RW="[object Boolean]",AW="[object Date]",wW="[object Map]",CW="[object Number]",xW="[object RegExp]",OW="[object Set]",PW="[object String]",MW="[object Symbol]",DW="[object ArrayBuffer]",NW="[object DataView]",LW="[object Float32Array]",UW="[object Float64Array]",VW="[object Int8Array]",FW="[object Int16Array]",BW="[object Int32Array]",jW="[object Uint8Array]",HW="[object Uint8ClampedArray]",GW="[object Uint16Array]",zW="[object Uint32Array]";function KW(e,t,r){var n,i,o,a=e.constructor;switch(t){case DW:return kW(e);case RW:case AW:return new a(+e);case NW:return function(e,t){var r=t?kW(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,r);case LW:case UW:case VW:case FW:case BW:case jW:case HW:case GW:case zW:return function(e,t){var r=t?kW(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}(e,r);case wW:return new a;case CW:case PW:return new a(e);case xW:return(o=new(i=e).constructor(i.source,EW.exec(i))).lastIndex=i.lastIndex,o;case OW:return new a;case MW:return n=e,IW?Object(IW.call(n)):{}}}var WW=SK&&SK.isMap,XW=WW?_K(WW):function(e){return dz(e)&&"[object Map]"==yW(e)};var qW=SK&&SK.isSet,YW=qW?_K(qW):function(e){return dz(e)&&"[object Set]"==yW(e)},JW=1,QW=2,ZW=4,$W="[object Arguments]",eX="[object Function]",tX="[object GeneratorFunction]",rX="[object Object]",nX={};function iX(e,t,r,n,i,o){var a,s=t&JW,c=t&QW,u=t&ZW;if(r&&(a=i?r(e,n,i,o):r(e)),void 0!==a)return a;if(!hz(e))return e;var d=lz(e);if(d){if(a=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&SW.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(e),!s)return function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}(e,a)}else{var l=yW(e),h=l==eX||l==tX;if(vK(e))return function(e,t){if(t)return e.slice();var r=e.length,n=JK?JK(r):new e.constructor(r);return e.copy(n),n}(e,s);if(l==rX||l==$W||h&&!i){if(a=c||h?{}:function(e){return"function"!=typeof e.constructor||iK(e)?{}:Dz(KK(e))}(e),!s)return c?function(e,t){return Qz(e,tW(e),t)}(e,function(e,t){return e&&Qz(t,OK(t),e)}(a,e)):function(e,t){return Qz(e,eW(e),t)}(e,function(e,t){return e&&Qz(t,wK(t),e)}(a,e))}else{if(!nX[l])return i?e:{};a=KW(e,l,s)}}o||(o=new WK);var p=o.get(e);if(p)return p;o.set(e,a),YW(e)?e.forEach((function(n){a.add(iX(n,t,r,n,e,o))})):XW(e)&&e.forEach((function(n,i){a.set(i,iX(n,t,r,i,e,o))}));var v=d?void 0:(u?c?iW:nW:c?OK:wK)(e);return function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););}(v||e,(function(n,i){v&&(n=e[i=n]),Jz(a,i,iX(n,t,r,i,e,o))})),a}nX[$W]=nX["[object Array]"]=nX["[object ArrayBuffer]"]=nX["[object DataView]"]=nX["[object Boolean]"]=nX["[object Date]"]=nX["[object Float32Array]"]=nX["[object Float64Array]"]=nX["[object Int8Array]"]=nX["[object Int16Array]"]=nX["[object Int32Array]"]=nX["[object Map]"]=nX["[object Number]"]=nX[rX]=nX["[object RegExp]"]=nX["[object Set]"]=nX["[object String]"]=nX["[object Symbol]"]=nX["[object Uint8Array]"]=nX["[object Uint8ClampedArray]"]=nX["[object Uint16Array]"]=nX["[object Uint32Array]"]=!0,nX["[object Error]"]=nX[eX]=nX["[object WeakMap]"]=!1;function oX(e){return iX(e,5)}function aX(e,t){return function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}(t,(function(t){return e[t]}))}function sX(e){return null==e?[]:aX(e,wK(e))}var cX=Ej(),uX=function(e){VA(u,e);var t,r,n,i,o,a,s,c=tw(u);function u(e,t){var r;return Bh(this,u),Jl(sA(r=c.call(this,e,t)),"name","chrome"),Jl(sA(r),"_queueBusy",!1),Jl(sA(r),"_sdpQueue",void 0),Jl(sA(r),"_aSendonlyOfferTpl",void 0),Jl(sA(r),"_vSendonlyOfferTpl",void 0),Jl(sA(r),"_aRecvonlyOfferTpl",void 0),Jl(sA(r),"_vRecvonlyOfferTpl",void 0),Jl(sA(r),"_mid",10),Jl(sA(r),"_inactiveMlineIndex",[]),Jl(sA(r),"_mlinesCache",{}),Jl(sA(r),"setDescription",void 0),r.logger=new lN("ChromeHandler",3,e.id),r.setDescription=t.setDescription.bind(t),r._sdpQueue=new JG,r._sdpQueue.on("start",(function(){r._queueBusy||"stable"!==r._peerConnection.signalingState||(r.logger.info("dequeue start"),r.dequeue())})),r}return Fh(u,[{key:"destroy",value:function(){LA(NA(u.prototype),"destroy",this).call(this),this._mlinesCache={}}},{key:"publish",value:(s=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I,R,A,w,C,x,O,P,M,D,N,L,U,V,F,B;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=t.stream,l=t.enableSimulcast,h=LA(NA(u.prototype),"internalPublish",this).call(this,t),p=h.videoDescriptions,v=h.subVideoDescriptions,f=h.audioTransceiverInit,_=h.videoTransceiverInit,m=sH(this._nextSsrc),this._nextSsrc=m.next,g="".concat(this._mid++),y="".concat(this._mid++),S=Zl(Zl(Zl({},this._aSendonlyOfferTpl),this.peer._offerIce),{},{mid:g,msid:Bg(r="".concat(d.id," ")).call(r,d.id,"-audio"),ssrcs:cH(d.id,"audio",m.audio,aH)}),b=Zl(Zl(Zl({},this._vSendonlyOfferTpl),this.peer._offerIce),{},{mid:y,msid:Bg(n="".concat(d.id," ")).call(n,d.id,"-video")}),l?(this.logger.info("subVideoDesc","desc: %o ",v),delete b.ssrcGroups,delete b.ssrcs,k=[],b.rids=Jg(p).call(p,(function(e){var t=e.rid;return k.unshift(t),{id:t,direction:"send"}})),b.simulcast={dir1:"send",list1:k.join(";")}):(E=uH(d.id,m,{cname:aH}),T=E.ssrcs,I=E.ssrcGroups,b.ssrcs=T,b.ssrcGroups=I),null!==(i=this._context)&&void 0!==i&&null!==(o=i.serverConfig)&&void 0!==o&&o.audioRed&&Array.isArray(S.rtp)&&(-1!==(A=tC(R=S.rtp).call(R,(function(e){return"red"===e.codec})))&&(C=jI(w=S.rtp).call(w,A,1),x=yy(C,1),O=x[0],S.rtp.unshift(O)),P=[],S.rtp.forEach((function(e){return P.push(e.payload)})),S.payloads=P.join(" ")),null!==(a=this._context)&&void 0!==a&&null!==(s=a.serverConfig)&&void 0!==s&&s.videoCodec&&gH(b,null===(M=this._context)||void 0===M||null===(D=M.serverConfig)||void 0===D?void 0:D.videoCodec),Array.isArray(b.ext)&&(wU("IOS_SAFARI_ORIENTATION")||!BL&&!ZL||(b.ext=Iy(L=b.ext).call(L,(function(e){var t;return!(null!=e&&null!==(t=e.uri)&&void 0!==t&&qy(t).call(t,"video-orientation"))}))),b.ext=Iy(N=b.ext).call(N,(function(e){var t;return!(null!=e&&null!==(t=e.uri)&&void 0!==t&&qy(t).call(t,"framemarking"))}))),(U=null==S?void 0:sI(c=S.rtp).call(c,(function(e){return"opus"===e.codec})))&&S.fmtp&&(B=sI(V=S.fmtp).call(V,(function(e){return e.payload===U.payload})))&&null!==(F=this._context)&&void 0!==F&&F.audioProfileManager&&(B.config=this._context.audioProfileManager.getOpusConfigStr(B.config)),l||BL||this.addBitrateLimit(b,t.videoEncodeConfig[0].maxKbps),this._mlinesCache[t.stream.id]=[S,b],e.abrupt("return",{partialSdp:lH(this.peer._offerSession,S,b),audioMid:g,videoMid:y,type:"incroffer",semantics:"unified-plan",videoDescriptions:p,subVideoDescriptions:v,audioTransceiverInit:f,videoTransceiverInit:_,peerConnectionMode:this.peerConnectionMode});case 17:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"subscribe",value:(a=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I,R,A,w,C,x,O,P,M,D,N,L,U;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("subscribe"),a="incroffer",s="unified-plan",this._aRecvonlyOfferTpl&&this._vRecvonlyOfferTpl){e.next=9;break}return e.next=6,this._genOfferSdp();case 6:return c=e.sent,e.next=9,this.createAVMlineOfferTpl(c);case 9:return u="",d="",l=!1,h=!1,p=void 0,v=void 0,this._mlinesCache[t.streamId]=[p,v],t.virtual?(u="".concat(this._mid++),l=!0):r.multiChatMode?(u="".concat(this._mid++),d="".concat(this._mid++),h=!0):(l=!0,h=!0,u="".concat(this._mid++),d="".concat(this._mid++)),u&&(p=Zl(Zl({},oX(this._aRecvonlyOfferTpl)),{},{mid:u})),l&&(this._mlinesCache[t.streamId][0]=p,f={track:"audio",init:{direction:"recvonly"}}),d&&(v=Zl(Zl({},oX(this._vRecvonlyOfferTpl)),{},{mid:d})),h&&(this._mlinesCache[t.streamId][1]=v,_={track:"video",init:{direction:"recvonly"}}),m=lH(this.peer._offerSession,p,v),g=void 0,y=void 0,t.enableVendorMode||r.multiChatMode||t.virtual||!this._aSendonlyAnswerTpl||!this._vSendonlyAnswerTpl||(g=sH(this._nextSsrc),this._nextSsrc=g.next,A=Zl(Zl(Zl({},this._aSendonlyAnswerTpl),this.peer._answerIce),{},{mid:u,msid:Bg(S=Bg(b="".concat(t.streamId)).call(b,null!==(k=this._context)&&void 0!==k&&k.avSync?"":"-audio"," ")).call(S,t.streamId,"-audio"),ssrcs:cH(t.streamId,"audio",g.audio)}),w=Zl(Zl(Zl({},this._vSendonlyAnswerTpl),this.peer._answerIce),{},{mid:d,msid:Bg(E=Bg(T="".concat(t.streamId)).call(T,null!==(I=this._context)&&void 0!==I&&I.avSync?"":"-video"," ")).call(E,t.streamId,"-video")},uH(t.streamId,g,{flexfec:this._enableSubFlexfec})),y={sdp:Lj.write(Zl(Zl({},this.peer._answerSession),{},{media:[A,w]})),sequenceId:t.sequenceId?++t.sequenceId:0},null===(R=g)||void 0===R||delete R.next),(C=null===(n=p)||void 0===n?void 0:sI(i=n.rtp).call(i,(function(e){return"opus"===e.codec})))&&null!==(o=p)&&void 0!==o&&o.fmtp&&(P=null===(x=p)||void 0===x?void 0:sI(O=x.fmtp).call(O,(function(e){return e.payload===C.payload})))&&this._context&&(P.config+=";stereo=1;sprop-stereo=1"),t.isPublic&&lU>=86&&null!=(L=null===(M=v)||void 0===M?void 0:Iy(D=M.rtp).call(D,(function(e){return"H264"===e.codec})))&&L.length&&null!==(N=v)&&void 0!==N&&N.fmtp&&(null===(U=v)||void 0===U||U.fmtp.forEach((function(e){sI(L).call(L,(function(t){return t.payload===e.payload}))&&(e.config+=";sps-pps-idr-in-keyframe=1")}))),e.abrupt("return",{partialSdp:m,audioMid:u,videoMid:d,type:a,semantics:s,audioTransceiverInit:f,videoTransceiverInit:_,allSsrc:g,peerConnectionMode:this.peerConnectionMode,signalingAck:y});case 29:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"handleAck",value:(o=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("handleAck()","item: %o",t),e.abrupt("return",this._sdpQueue.enqueue(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"dequeue",value:(i=Ng(Mg().mark((function e(){var t,r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._queueBusy=!0,t=this._sdpQueue.dequeue(),this.logger.info("dequeue()","ret: %o",t),t){e.next=6;break}return this._queueBusy=!1,e.abrupt("return");case 6:if(r=[],e.prev=7,n=t.items,i=t.sdpStrategy,o=[],a=[],s=[],i!==WG.ADD){e.next=16;break}return e.delegateYield(Mg().mark((function e(){var t,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:delete(t=Zl({},m.peer._answerIce)).candidates,c=!1,u=!1,e.prev=4,l=mV(n);case 6:return e.next=8,l.next();case 8:if(!(c=!(h=e.sent).done)){e.next=16;break}if(i=h.value,"break"!==function(){var e=i.audioMid,n=i.videoMid,c=i.action,u=i.audioTransceiverInit,d=i.videoTransceiverInit,l=i.signalingAck,h=i.stream,p=h instanceof zG;if(i.onSuccess&&s.push(i.onSuccess),i.onFail&&r.push(i.onFail),p&&(null==l?void 0:l.sequenceId)<h.sequenceId)return"break";var v,f={},_={},g=Lj.parse(l.sdp);Array.isArray(g.media)&&Ww(v=g.media).call(v,(function(e,t){var r;return null==e||null===(r=e.type)||void 0===r?void 0:r.localeCompare(null==t?void 0:t.type)})).forEach((function(r){"audio"===(r=Zl(Zl({},r),t)).type?(f=r).mid=e:(_=r).mid=n}));var y,S=h.streamId;if(c===XG.publish&&(S=null===(y=h.stream)||void 0===y?void 0:y.id),!m._mlinesCache[S])return"break";var b=yy(m._mlinesCache[S],2),k=b[0],E=b[1];if(u&&k){h.audioTransceiver=m._peerConnection.addTransceiver(u.track,u.init),m._reportRtcInvokeStatus("chromeHandler.addTrack",zg({audioStreamTrack:mx(u.track)}));var T=m._inactiveMlineIndex.shift();T||(T=m.peer._offerMlines.length),m.peer._offerMlines[T]=Zl({},k),m.peer._answerMlines[T]=f,cX&&h.initAudioEncodedTransform()}if(d&&E){var I,R;h.videoTransceiver=m._peerConnection.addTransceiver(d.track,d.init),m._reportRtcInvokeStatus("chromeHandler.addTrack",zg({videoStreamTrack:mx(d.track)}));var A,w,C=m._inactiveMlineIndex.shift();C||(C=m.peer._offerMlines.length),m.peer._offerMlines[C]=Zl({},E),c===XG.publish&&null!==(I=m._context)&&void 0!==I&&null!==(R=I.serverConfig)&&void 0!==R&&R.videoCodec&&gH(_,null===(A=m._context)||void 0===A||null===(w=A.serverConfig)||void 0===w?void 0:w.videoCodec),m.peer._answerMlines[C]=_,cX&&h.initVideoEncodedTransform()}o.push(h.streamId||""),a.push(p?h.userId:"local"),p&&(h.sequenceId=null==l?void 0:l.sequenceId),delete m._mlinesCache[S]}()){e.next=13;break}return e.abrupt("break",16);case 13:c=!1,e.next=6;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(4),u=!0,d=e.t0;case 22:if(e.prev=22,e.prev=23,!c||null==l.return){e.next=27;break}return e.next=27,l.return();case 27:if(e.prev=27,!u){e.next=30;break}throw d;case 30:return e.finish(27);case 31:return e.finish(22);case 32:case"end":return e.stop()}}),e,null,[[4,18,22,32],[23,,27,31]])}))(),"t0",14);case 14:e.next=21;break;case 16:_={},n.forEach((function(e){var t=e.audioMid,r=e.videoMid,n=e.action;_[t]=t,n!==XG.removetrack&&(_[r]=r),_[t]=t})),this.peer._offerMlines=Jg(p=this.peer._offerMlines).call(p,(function(e,t){return _[e.mid]&&(e=dH(e),m._inactiveMlineIndex.push(t)),e})),Ww(v=this._inactiveMlineIndex).call(v,(function(e,t){return e-t})),this.peer._answerMlines=Jg(f=this.peer._answerMlines).call(f,(function(e){return _[e.mid]&&(e=dH(e)),e}));case 21:return e.prev=21,e.next=24,this.peer.getOriginRTCPeerConnection().createOffer();case 24:return e.next=26,this.setDescription(o.length?{streamId:o.join(","),streamUserId:a.join(",")}:void 0);case 26:e.next=34;break;case 28:if(e.prev=28,e.t1=e.catch(21),"have-local-offer"!==this._peerConnection.signalingState){e.next=33;break}return e.next=33,this._peerConnection.setLocalDescription({type:"rollback"});case 33:throw e.t1;case 34:try{s.forEach((function(e){return e()}))}catch(Y$){}this.logger.info("dequeue","loop"),e.next=42;break;case 38:e.prev=38,e.t2=e.catch(7),this.logger.error("dequeue","unknown error: %o",e.t2),r.forEach((function(t){return t(e.t2)}));case 42:return e.prev=42,this.dequeue(),e.finish(42);case 45:case"end":return e.stop()}}),e,this,[[7,38,42,45],[21,28]])}))),function(){return i.apply(this,arguments)})},{key:"getDefaultSdp",value:(n=Ng(Mg().mark((function e(){var t,r,n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._genOfferSdp();case 2:return r=e.sent,this.createAVMlineOfferTpl(r),n=Lj.parse(r),i=[],n.media=Iy(t=n.media).call(t,(function(e){var t;return"recvonly"===e.direction&&(Array.isArray(e.ext)&&(e.ext=Iy(t=e.ext).call(t,(function(e){return"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"!==e.uri}))),i.push("".concat(e.mid)),!0)})),n.groups=[{mids:i.join(" "),type:"BUNDLE"}],Aj&&SH(n),e.abrupt("return",{sdp:Lj.write(n),semantics:"unified-plan",type:"incroffer"});case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"rollback",value:(r=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.msid,delete this._mlinesCache[r];case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"createAVMlineOfferTpl",value:function(e){var t=this,r=Lj.parse(e);r.media.forEach((function(e){if(e.icePwd=t.peer._offerIce.icePwd,e.iceUfrag=t.peer._offerIce.iceUfrag,"audio"===e.type)if("sendonly"===e.direction)t._aSendonlyOfferTpl=e;else{var r;if(Array.isArray(e.ext))e.ext=Iy(r=e.ext).call(r,(function(e){return"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"!==e.uri}));t._aRecvonlyOfferTpl=e}else if("video"===e.type)if("sendonly"===e.direction)t._vSendonlyOfferTpl=e;else{var n;if(Array.isArray(e.ext))e.ext=Iy(n=e.ext).call(n,(function(e){return"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"!==e.uri}));t._vRecvonlyOfferTpl=e}})),Aj&&SH(r)}},{key:"_genOfferSdp",value:(t=Ng(Mg().mark((function e(){var t,r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,SL(!0);case 3:if(t=e.sent){e.next=6;break}throw"pc.createOffer() return empty.";case 6:e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),r="Get offer Error. ".concat(e.t0.message|e.t0),new kC(mC.NOT_SUPPORTED,r);case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,null,[[0,8]])}))),function(){return t.apply(this,arguments)})}]),u}(TH),dX=function(e){VA(d,e);var t,r,n,i,o,a,s,c,u=tw(d);function d(e,t){var r;return Bh(this,d),Jl(sA(r=u.call(this,e,t)),"name","firefox"),Jl(sA(r),"_aRecvonlyOfferTpl",void 0),r.logger=new lN("FirefoxHandler",3,e.id),r}return Fh(d,[{key:"publish",value:(c=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c,u,l,h,p,v,f,_,m,g=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=LA(NA(d.prototype),"internalPublish",this).call(this,t),o=i.videoDescriptions,a=i.subVideoDescriptions,s=i.audioTransceiverInit,c=i.videoTransceiverInit,t.audioTransceiver=this._peerConnection.addTransceiver(s.track,s.init),Array.isArray(c.init.sendEncodings)&&1===c.init.sendEncodings.length&&(c.init.sendEncodings=Jg(u=c.init.sendEncodings).call(u,(function(e){return delete e.rid,e}))),t.videoTransceiver=this._peerConnection.addTransceiver(c.track,c.init),l=oL(),this._report("rtc_begin_create_offer",{direction:"up",stream_id:"",stream_user_id:"",pc_session_id:this.peerConnectionId,vendor_mode:0}),e.next=8,this._peerConnection.createOffer();case 8:return h=e.sent,this._report("rtc_create_offer",{direction:"up",error_code:0,stream_id:"",stream_user_id:"",elapse:oL()-l}),(p=Lj.parse(h.sdp)).media=null===(r=p.media)||void 0===r?void 0:Jg(r).call(r,(function(e){return Zl(Zl({},e),g.peer._offerIce)})),SH(p),e.next=15,this.setLocalDescription(Lj.write(p));case 15:return v=t.audioTransceiver.mid,f=t.videoTransceiver.mid,_=null,m=null,p.media=null===(n=p.media)||void 0===n?void 0:Jg(n).call(n,(function(e){if("".concat(e.mid)===v){var t,r,n=null===(t=_=e)||void 0===t?void 0:sI(r=t.rtp).call(r,(function(e){return"opus"===e.codec}));if(n&&_.fmtp){var i,o,a=sI(i=_.fmtp).call(i,(function(e){return e.payload===n.payload}));a&&null!==(o=g._context)&&void 0!==o&&o.audioProfileManager&&(a.config=g._context.audioProfileManager.getOpusConfigStr(a.config))}}else if("".concat(e.mid)===f){var s,c,u,d;null!==(s=g._context)&&void 0!==s&&null!==(c=s.serverConfig)&&void 0!==c&&c.videoCodec&&gH(e,null===(u=g._context)||void 0===u||null===(d=u.serverConfig)||void 0===d?void 0:d.videoCodec),m=e}return e})),this.addBitrateLimit(m,t.videoEncodeConfig[0].maxKbps),e.next=23,this.setLocalDescription(Lj.write(p));case 23:return e.abrupt("return",{partialSdp:lH(p,_,m),audioMid:v,videoMid:f,type:"incroffer",semantics:"unified-plan",videoDescriptions:o,subVideoDescriptions:a,audioTransceiverInit:s,videoTransceiverInit:c,peerConnectionMode:this.peerConnectionMode});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"subscribe",value:(s=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I,R,A,w=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("subscribe()"),c="",u="",d=!1,l=!1,h=void 0,p=void 0,t.virtual?d=!0:(r.multiChatMode||(d=!0),l=!0),d&&(t.audioTransceiver=this._peerConnection.addTransceiver("audio",{direction:"recvonly"})),l&&(t.videoTransceiver=this._peerConnection.addTransceiver("video",{direction:"recvonly"})),v=oL(),this._report("rtc_begin_create_offer",{direction:"up",stream_id:t.streamId,stream_user_id:t.userId,pc_session_id:this.peerConnectionId,vendor_mode:0}),e.next=14,this._peerConnection.createOffer();case 14:return f=e.sent,this._report("rtc_create_offer",{error_code:0,direction:"up",stream_id:t.streamId,stream_user_id:t.userId,elapse:oL()-v}),(_=Lj.parse(f.sdp)).media=null===(n=_.media)||void 0===n?void 0:Jg(n).call(n,(function(e){return Zl(Zl({},e),w.peer._offerIce)})),Jg(i=_.media).call(i,(function(e){var t,r,n,i;"video"===e.type&&(Rj?(e.ext=null===(t=e.ext)||void 0===t?void 0:Iy(t).call(t,(function(e){var t;return-1===SI(t=e.uri).call(t,"abs-send-time")})),e.rtcpFb=null===(r=e.rtcpFb)||void 0===r?void 0:Iy(r).call(r,(function(e){return"goog-remb"!==e.type}))):(e.rtcpFb=null===(n=e.rtcpFb)||void 0===n?void 0:Iy(n).call(n,(function(e){return"transport-cc"!==e.type})),e.ext=null===(i=e.ext)||void 0===i?void 0:Iy(i).call(i,(function(e){var t;return-1===SI(t=e.uri).call(t,"transport")}))))})),Aj&&SH(_),e.next=22,this.setLocalDescription(Lj.write(_),{streamId:t.streamId||"",streamUserId:t.userId});case 22:return c=null===(o=t.audioTransceiver)||void 0===o?void 0:o.mid,u=null===(a=t.videoTransceiver)||void 0===a?void 0:a.mid,null===(s=_.media)||void 0===s||s.forEach((function(e){"".concat(e.mid)===c?h=e:"".concat(e.mid)===u&&(p=e)})),c&&h||(c="audio_".concat(u),h=Zl(Zl({},this._aRecvonlyOfferTpl),{},{mid:c})),t.audioMid=c,t.videoMid=u,m=void 0,g=void 0,!r.multiChatMode&&!t.virtual&&this._aSendonlyAnswerTpl&&this._aSendonlyAnswerTpl&&(m=sH(this._nextSsrc),this._nextSsrc=m.next,R=Zl(Zl(Zl({},this._aSendonlyAnswerTpl),this.peer._answerIce),{},{mid:c,msid:Bg(y=Bg(S="".concat(t.streamId)).call(S,null!==(b=this._context)&&void 0!==b&&b.avSync?"":"-audio"," ")).call(y,t.streamId,"-audio"),ssrcs:cH(t.streamId,"audio",m.audio)}),A=Zl(Zl(Zl({},this._vSendonlyAnswerTpl),this.peer._answerIce),{},{mid:u,msid:Bg(k=Bg(E="".concat(t.streamId)).call(E,null!==(T=this._context)&&void 0!==T&&T.avSync?"":"-video"," ")).call(k,t.streamId,"-video")},uH(t.streamId,m,{flexfec:this._enableSubFlexfec})),g={sdp:Lj.write(Zl(Zl({},this.peer._answerSession),{},{media:[R,A]})),sequenceId:t.sequenceId?++t.sequenceId:0},null===(I=m)||void 0===I||delete I.next),e.abrupt("return",{partialSdp:lH(_,h,p,!1),audioMid:c,videoMid:u,type:"incroffer",semantics:"unified-plan",audioTransceiverInit:t.audioTransceiver?{track:"audio",init:{direction:"recvonly"}}:void 0,videoTransceiverInit:t.videoTransceiver?{track:"video",init:{direction:"recvonly"}}:void 0,allSsrc:m,peerConnectionMode:this.peerConnectionMode,signalingAck:g});case 32:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"handleAck",value:(a=Ng(Mg().mark((function e(t){var r,n,i,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.signalingAck,n=t.stream,(i=t.action)!==XG.removetrack){e.next=3;break}return e.abrupt("return","");case 3:if(i!==XG.unpublish&&i!==XG.unsubscribe){e.next=14;break}return e.prev=4,e.next=7,this.close(n);case 7:"function"==typeof t.onSuccess&&t.onSuccess(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),"function"==typeof t.onFail&&t.onFail(e.t0);case 13:return e.abrupt("return",n.streamId||"");case 14:return o=Lj.parse(null==r?void 0:r.sdp),e.prev=15,e.next=18,this._internalSetRemoteDescription(o.media,n);case 18:"function"==typeof t.onSuccess&&t.onSuccess(),e.next=24;break;case 21:e.prev=21,e.t1=e.catch(15),"function"==typeof t.onFail&&t.onFail(e.t1);case 24:return e.abrupt("return","");case 25:case"end":return e.stop()}}),e,this,[[4,10],[15,21]])}))),function(e){return a.apply(this,arguments)})},{key:"_internalSetRemoteDescription",value:(o=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={},(c=Lj.parse(null===(n=this._peerConnection.remoteDescription)||void 0===n?void 0:n.sdp)).media.forEach((function(e){void 0!==e.mid&&(s[e.mid]=e)})),t.forEach((function(e){if("audio"===(e=Zl(Zl({},e),l.peer._answerIce)).type&&(r.audioMid?(e.mid=r.audioMid,s[r.audioMid]=e):s[e.mid]=e),"video"===e.type){if(r instanceof GG&&aU<=87){var t,n,i,o,a={};Array.isArray(e.rtp)&&(e.rtp=Iy(t=e.rtp).call(t,(function(e){return"rtx"!==e.codec||(a[e.payload]=e.payload,!1)}))),"string"==typeof e.payloads&&(e.payloads=Iy(n=e.payloads.split(" ")).call(n,(function(e){return!a[e]})).join(" ")),Array.isArray(e.fmtp)&&(e.fmtp=Iy(i=e.fmtp).call(i,(function(e){return!a[e.payload]}))),Array.isArray(e.rtcpFb)&&(e.fmtp=Iy(o=e.fmtp).call(o,(function(e){return!a[e.payload]})))}r.videoMid?(e.mid=r.videoMid,s[r.videoMid]=e):s[e.mid]=e}})),u=Lj.parse(null===(i=this._peerConnection.localDescription)||void 0===i?void 0:i.sdp),d=Jg(o=u.media).call(o,(function(e){var t=s[e.mid];return"inactive"===e.direction?e:t})),c.groups=u.groups,c.media=d,Jg(a=c.media).call(a,(function(e){var t,r,n,i,o;"video"===e.type&&(Rj?(e.ext=null===(t=e.ext)||void 0===t?void 0:Iy(t).call(t,(function(e){var t;return-1===SI(t=e.uri).call(t,"abs-send-time")})),e.rtcpFb=null===(r=e.rtcpFb)||void 0===r?void 0:Iy(r).call(r,(function(e){return"goog-remb"!==e.type}))):(e.rtcpFb=null===(n=e.rtcpFb)||void 0===n?void 0:Iy(n).call(n,(function(e){return"transport-cc"!==e.type})),e.ext=null===(i=e.ext)||void 0===i?void 0:Iy(i).call(i,(function(e){var t;return-1===SI(t=e.uri).call(t,"transport")}))),aU>=138&&(e.ext=null===(o=e.ext)||void 0===o?void 0:Iy(o).call(o,(function(e){var t;return!qy(t=e.uri).call(t,"sdes:mid")}))))})),Aj&&SH(c),e.next=12,this.setRemoteDescription(Lj.write(c));case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getDefaultSdp",value:(i=Ng(Mg().mark((function e(){var t,r,n,i,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new RTCPeerConnection).addTransceiver("audio",{direction:"recvonly"}),r.addTransceiver("video",{direction:"recvonly"}),e.next=5,r.createOffer();case 5:return n=e.sent,i=Lj.parse(n.sdp),this.createAVMlineOfferTpl(n.sdp),o=[],i.media=Iy(t=i.media).call(t,(function(e){if("recvonly"===e.direction){var t="template_".concat(e.type);return e.mid=t,o.push(t),!0}return!1})),Aj&&SH(i),i.groups=[{mids:o.join(" "),type:"BUNDLE"}],r.close(),e.abrupt("return",{sdp:Lj.write(i),semantics:"unified-plan",type:"incroffer"});case 14:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"rollback",value:(n=Ng(Mg().mark((function e(t){var r,n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.msid,r=t.stream,n=t.audioMid,i=t.videoMid,this.logger.warn("rollback()"),e.abrupt("return",this.close(r,n,i));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"close",value:(r=Ng(Mg().mark((function e(t,r,n){var i,o,a,s,c,u,d,l,h,p,v,f=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("close()"),s=t.audioMid||r,c=t.videoMid||n,u={},t.audioTransceiver&&s&&(t.audioTransceiver.stop(),u[s]=s),t.videoTransceiver&&c&&(t.videoTransceiver.stop(),u[c]=c),d=[],e.next=9,this._peerConnection.createOffer();case 9:return l=e.sent,(h=Lj.parse(null==l?void 0:l.sdp)).media=Jg(i=h.media).call(i,(function(e){return u[e.mid]&&(e=dH(e)),"inactive"!==e.direction&&d.push(e.mid),Zl(Zl({},e),f.peer._offerIce)})),p=Lj.parse(null===(o=this._peerConnection.remoteDescription)||void 0===o?void 0:o.sdp),v={},p.media.forEach((function(e){void 0!==e.mid&&(v[e.mid]=e)})),p.media=Jg(a=h.media).call(a,(function(e){return"inactive"===e.direction?e:v[e.mid]})),h.groups&&p.groups&&(h.groups[0].mids=d.join(" "),p.groups[0].mids=d.join(" ")),e.next=19,this.setLocalDescription(Lj.write(h));case 19:return e.next=21,this.setRemoteDescription(Lj.write(p));case 21:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"setCurrentDescription",value:(t=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._peerConnection.createOffer();case 2:if(!this._peerConnection.localDescription||!this._peerConnection.remoteDescription){e.next=7;break}return e.next=5,this._peerConnection.setLocalDescription(this._peerConnection.localDescription);case 5:return e.next=7,this._peerConnection.setRemoteDescription(this._peerConnection.remoteDescription);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"createAVMlineOfferTpl",value:function(e){var t=this,r=Lj.parse(e);r.media.forEach((function(e){"audio"===e.type&&(t._aRecvonlyOfferTpl=e)})),Aj&&SH(r)}}]),d}(TH),lX=function(e){VA(d,e);var t,r,n,i,o,a,s,c,u=tw(d);function d(e,t){var r;return Bh(this,d),Jl(sA(r=u.call(this,e,t)),"name","fallback"),Jl(sA(r),"_aRecvonlyOfferTpl",void 0),r.logger=new lN("FallbackHandler",3,e.id),r.logger.warn("ctor","using fallback handler"),r._report("rtc_error",{message:"using fallback handler",error_code:-1}),r}return Fh(d,[{key:"publish",value:(c=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c,u,l,h,p,v,f,_;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=LA(NA(d.prototype),"internalPublish",this).call(this,t),i=n.videoDescriptions,o=n.subVideoDescriptions,a=n.audioTransceiverInit,s=n.videoTransceiverInit,t.audioTransceiver=this._peerConnection.addTransceiver(a.track,a.init),Array.isArray(s.init.sendEncodings)&&1===s.init.sendEncodings.length&&(s.init.sendEncodings=Jg(c=s.init.sendEncodings).call(c,(function(e){return delete e.rid,e}))),t.videoTransceiver=this._peerConnection.addTransceiver(s.track,s.init),u=oL(),this._report("rtc_begin_create_offer",{direction:"up",stream_id:"",stream_user_id:"",pc_session_id:this.peerConnectionId,vendor_mode:0}),e.next=8,this._peerConnection.createOffer();case 8:return l=e.sent,this._report("rtc_create_offer",{direction:"up",error_code:0,stream_id:"",stream_user_id:"",elapse:oL()-u}),h=Lj.parse(l.sdp),e.next=13,this.setLocalDescription(l.sdp);case 13:return p=t.audioTransceiver.mid,v=t.videoTransceiver.mid,f=null,_=null,h.media=null===(r=h.media)||void 0===r?void 0:Jg(r).call(r,(function(e){return"".concat(e.mid)===p?f=e:"".concat(e.mid)===v&&(_=e),e})),Ej()&&(t.initVideoEncodedTransform(),t.initAudioEncodedTransform()),e.abrupt("return",{partialSdp:lH(h,f,_),audioMid:p,videoMid:v,type:"incroffer",semantics:"unified-plan",videoDescriptions:i,subVideoDescriptions:o,audioTransceiverInit:a,videoTransceiverInit:s,peerConnectionMode:this.peerConnectionMode});case 20:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"subscribe",value:(s=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("subscribe()"),a="",s="",c=!1,u=!1,d=void 0,l=void 0,t.virtual?c=!0:(r.multiChatMode||(c=!0),u=!0),c&&(t.audioTransceiver=this._peerConnection.addTransceiver("audio",{direction:"recvonly"})),u&&(t.videoTransceiver=this._peerConnection.addTransceiver("video",{direction:"recvonly"})),h=oL(),this._report("rtc_begin_create_offer",{direction:"up",stream_id:t.streamId,stream_user_id:t.userId,pc_session_id:this.peerConnectionId,vendor_mode:0}),e.next=14,this._peerConnection.createOffer();case 14:return p=e.sent,this._report("rtc_create_offer",{error_code:0,direction:"up",stream_id:t.streamId,stream_user_id:t.userId,elapse:oL()-h}),v=Lj.parse(p.sdp),e.next=19,this.setLocalDescription(p.sdp,{streamId:t.streamId||"",streamUserId:t.userId});case 19:return a=null===(n=t.audioTransceiver)||void 0===n?void 0:n.mid,s=null===(i=t.videoTransceiver)||void 0===i?void 0:i.mid,null===(o=v.media)||void 0===o||o.forEach((function(e){"".concat(e.mid)===a?d=e:"".concat(e.mid)===s&&(l=e)})),a&&d||(a="audio_".concat(s),d=Zl(Zl({},this._aRecvonlyOfferTpl),{},{mid:a})),t.audioMid=a,t.videoMid=s,f=void 0,_=void 0,!r.multiChatMode&&!t.virtual&&this._aSendonlyAnswerTpl&&this._aSendonlyAnswerTpl&&(f=sH(this._nextSsrc),this._nextSsrc=f.next,T=Zl(Zl(Zl({},this._aSendonlyAnswerTpl),this.peer._answerIce),{},{mid:a,msid:Bg(m=Bg(g="".concat(t.streamId)).call(g,null!==(y=this._context)&&void 0!==y&&y.avSync?"":"-audio"," ")).call(m,t.streamId,"-audio"),ssrcs:cH(t.streamId,"audio",f.audio)}),I=Zl(Zl(Zl({},this._vSendonlyAnswerTpl),this.peer._answerIce),{},{mid:s,msid:Bg(S=Bg(b="".concat(t.streamId)).call(b,null!==(k=this._context)&&void 0!==k&&k.avSync?"":"-video"," ")).call(S,t.streamId,"-video")},uH(t.streamId,f,{flexfec:this._enableSubFlexfec})),_={sdp:Lj.write(Zl(Zl({},this.peer._answerSession),{},{media:[T,I]})),sequenceId:t.sequenceId?++t.sequenceId:0},null===(E=f)||void 0===E||delete E.next),Ej()&&(t.initVideoEncodedTransform(),t.initAudioEncodedTransform()),e.abrupt("return",{partialSdp:lH(v,d,l,!1),audioMid:a,videoMid:s,type:"incroffer",semantics:"unified-plan",audioTransceiverInit:t.audioTransceiver?{track:"audio",init:{direction:"recvonly"}}:void 0,videoTransceiverInit:t.videoTransceiver?{track:"video",init:{direction:"recvonly"}}:void 0,allSsrc:f,peerConnectionMode:this.peerConnectionMode,signalingAck:_});case 30:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"handleAck",value:(a=Ng(Mg().mark((function e(t){var r,n,i,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.signalingAck,n=t.stream,(i=t.action)!==XG.removetrack){e.next=3;break}return e.abrupt("return","");case 3:if(i!==XG.unpublish&&i!==XG.unsubscribe){e.next=14;break}return e.prev=4,e.next=7,this.close(n);case 7:"function"==typeof t.onSuccess&&t.onSuccess(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),"function"==typeof t.onFail&&t.onFail(e.t0);case 13:return e.abrupt("return",n.streamId||"");case 14:return o=Lj.parse(null==r?void 0:r.sdp),e.prev=15,e.next=18,this._internalSetRemoteDescription(o.media,n);case 18:"function"==typeof t.onSuccess&&t.onSuccess(),e.next=24;break;case 21:e.prev=21,e.t1=e.catch(15),"function"==typeof t.onFail&&t.onFail(e.t1);case 24:return e.abrupt("return","");case 25:case"end":return e.stop()}}),e,this,[[4,10],[15,21]])}))),function(e){return a.apply(this,arguments)})},{key:"_internalSetRemoteDescription",value:(o=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={},(c=Lj.parse(null===(n=this._peerConnection.remoteDescription)||void 0===n?void 0:n.sdp)).media.forEach((function(e){void 0!==e.mid&&(s[e.mid]=e)})),t.forEach((function(e){"audio"===(e=Zl(Zl({},e),l.peer._answerIce)).type&&(r.audioMid?(e.mid=r.audioMid,s[r.audioMid]=e):s[e.mid]=e),"video"===e.type&&(r.videoMid?(e.mid=r.videoMid,s[r.videoMid]=e):s[e.mid]=e)})),u=Lj.parse(null===(i=this._peerConnection.localDescription)||void 0===i?void 0:i.sdp),d=Jg(o=u.media).call(o,(function(e){var t=s[e.mid];return"inactive"===e.direction?e:t})),c.groups=u.groups,c.media=d,Jg(a=c.media).call(a,(function(e){var t,r,n,i;"video"===e.type&&(Rj?(e.ext=null===(t=e.ext)||void 0===t?void 0:Iy(t).call(t,(function(e){var t;return-1===SI(t=e.uri).call(t,"abs-send-time")})),e.rtcpFb=null===(r=e.rtcpFb)||void 0===r?void 0:Iy(r).call(r,(function(e){return"goog-remb"!==e.type}))):(e.rtcpFb=null===(n=e.rtcpFb)||void 0===n?void 0:Iy(n).call(n,(function(e){return"transport-cc"!==e.type})),e.ext=null===(i=e.ext)||void 0===i?void 0:Iy(i).call(i,(function(e){var t;return-1===SI(t=e.uri).call(t,"transport")}))))})),e.next=11,this.setRemoteDescription(Lj.write(c));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getDefaultSdp",value:(i=Ng(Mg().mark((function e(){var t,r,n,i,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new RTCPeerConnection).addTransceiver("audio",{direction:"recvonly"}),r.addTransceiver("video",{direction:"recvonly"}),e.next=5,r.createOffer();case 5:return n=e.sent,i=Lj.parse(n.sdp),this.createAVMlineOfferTpl(n.sdp),o=[],i.media=Iy(t=i.media).call(t,(function(e){if("recvonly"===e.direction){var t="template_".concat(e.type);return e.mid=t,o.push(t),!0}return!1})),i.groups=[{mids:o.join(" "),type:"BUNDLE"}],r.close(),e.abrupt("return",{sdp:Lj.write(i),semantics:"unified-plan",type:"incroffer"});case 13:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"rollback",value:(n=Ng(Mg().mark((function e(t){var r,n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.msid,r=t.stream,n=t.audioMid,i=t.videoMid,this.logger.warn("rollback()"),e.abrupt("return",this.close(r,n,i));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"close",value:(r=Ng(Mg().mark((function e(t,r,n){var i,o,a,s,c,u,d,l,h,p,v,f=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("close()"),s=t.audioMid||r,c=t.videoMid||n,u={},t.audioTransceiver&&s&&(t.audioTransceiver.stop(),u[s]=s),t.videoTransceiver&&c&&(t.videoTransceiver.stop(),u[c]=c),d=[],e.next=9,this._peerConnection.createOffer();case 9:return l=e.sent,(h=Lj.parse(null==l?void 0:l.sdp)).media=Jg(i=h.media).call(i,(function(e){return u[e.mid]&&(e=dH(e)),"inactive"!==e.direction&&d.push(e.mid),Zl(Zl({},e),f.peer._offerIce)})),p=Lj.parse(null===(o=this._peerConnection.remoteDescription)||void 0===o?void 0:o.sdp),v={},p.media.forEach((function(e){void 0!==e.mid&&(v[e.mid]=e)})),p.media=Jg(a=h.media).call(a,(function(e){return"inactive"===e.direction?e:v[e.mid]})),h.groups&&p.groups&&(h.groups[0].mids=d.join(" "),p.groups[0].mids=d.join(" ")),e.next=19,this.setLocalDescription(null==l?void 0:l.sdp);case 19:return e.next=21,this.setRemoteDescription(Lj.write(p));case 21:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"setCurrentDescription",value:(t=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._peerConnection.createOffer();case 2:if(!this._peerConnection.localDescription||!this._peerConnection.remoteDescription){e.next=7;break}return e.next=5,this._peerConnection.setLocalDescription(this._peerConnection.localDescription);case 5:return e.next=7,this._peerConnection.setRemoteDescription(this._peerConnection.remoteDescription);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"createAVMlineOfferTpl",value:function(e){var t=this;Lj.parse(e).media.forEach((function(e){"audio"===e.type&&(t._aRecvonlyOfferTpl=e)}))}}]),d}(TH);var hX=dT,pX=GI,vX=function(e,t,r,n){for(var i,o=n>1?void 0:n?pX(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&hX(t,r,o),o},fX=function(){function e(t){Bh(this,e),Jl(this,"_queue",[]),Jl(this,"_runningTask",[]),Jl(this,"executor",void 0),Jl(this,"busy",!1),this.executor=t}var t;return Fh(e,[{key:"add",value:function(e){var t=yX(),r=t.promise,n=t.resolve,i=t.reject;return this._queue.push({item:e,resolve:n,reject:i}),this.busy||this._emit(),r}},{key:"destroy",value:function(){var e;Bg(e=[]).call(e,rR(this._queue),rR(this._runningTask)).forEach((function(e){(0,e.reject)(new kC(mC.OPERATION_CANCEL,"queue close"))})),this.busy=!1,this._queue=[]}},{key:"_emit",value:(t=Ng(Mg().mark((function e(){var t,r,n,i,o,a=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._queue,this._runningTask=t,this._queue=[],0!==t.length){e.next=6;break}return this.busy=!1,e.abrupt("return");case 6:return r=Jg(t).call(t,(function(e){return e.item})),n=Jg(t).call(t,(function(e){return e.resolve})),i=Jg(t).call(t,(function(e){return e.reject})),e.prev=9,this.busy=!0,e.next=13,this.executor(r);case 13:o=e.sent,n.forEach((function(e){return e(o)})),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(9),i.forEach((function(t){return t(e.t0)}));case 20:return this._runningTask=[],setTimeout((function(){a._emit()})),e.abrupt("return");case 23:case"end":return e.stop()}}),e,this,[[9,17]])}))),function(){return t.apply(this,arguments)})}]),e}(),_X=function(e){VA(h,e);var t,r,n,i,o,a,s,c,u,d,l=tw(h);function h(e,t){var r;return Bh(this,h),Jl(sA(r=l.call(this,e,t)),"name","standard"),Jl(sA(r),"_applyQueue",new fX(r.apply.bind(sA(r)))),Jl(sA(r),"_createQueue",new fX(r.create.bind(sA(r)))),Jl(sA(r),"_pqueue",new gX),Jl(sA(r),"_midMap",new uT),Jl(sA(r),"_aRecvonlyOfferTpl",void 0),r.logger=new lN("StandardHandler",3,e.id),r.logger.warn("ctor","using standard handler"),r}return Fh(h,[{key:"publish",value:(d=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c,u,d,l,p,v,f,_;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("publish()","streamId: ".concat(t.streamId)),n=LA(NA(h.prototype),"internalPublish",this).call(this,t),i=n.videoDescriptions,o=n.subVideoDescriptions,a=n.audioTransceiverInit,s=n.videoTransceiverInit,t.audioTransceiver=this._peerConnection.addTransceiver(a.track,Zl(Zl({},a.init),{},{direction:"sendonly"})),Array.isArray(s.init.sendEncodings)&&1===s.init.sendEncodings.length&&(s.init.sendEncodings=Jg(c=s.init.sendEncodings).call(c,(function(e){return delete e.rid,e}))),t.videoTransceiver=this._peerConnection.addTransceiver(s.track,Zl(Zl({},s.init),{},{direction:"sendonly"})),u=oL(),this._report("rtc_begin_create_offer",{direction:"up",stream_id:"",stream_user_id:"",pc_session_id:this.peerConnectionId,vendor_mode:0}),e.next=9,this._createQueue.add();case 9:return d=e.sent,this._report("rtc_create_offer",{direction:"up",error_code:0,stream_id:"",stream_user_id:"",elapse:oL()-u}),l=t.audioTransceiver.mid,p=t.videoTransceiver.mid,t.audioMid=l,t.videoMid=p,v=null,f=null,(_=Lj.parse(d)).media=null===(r=_.media)||void 0===r?void 0:Jg(r).call(r,(function(e){return"".concat(e.mid)===l?v=e:"".concat(e.mid)===p&&(f=e),e})),Ej()&&(t.initVideoEncodedTransform(),t.initAudioEncodedTransform()),e.abrupt("return",{partialSdp:lH(_,v,f),audioMid:l,videoMid:p,type:"incroffer",semantics:"unified-plan",videoDescriptions:i,subVideoDescriptions:o,audioTransceiverInit:a,videoTransceiverInit:s,peerConnectionMode:this.peerConnectionMode});case 22:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"subscribe",value:(u=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I,R,A;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("subscribe()","streamId: ".concat(t.streamId)),c=!1,u=!1,d=void 0,l=void 0,t.virtual?c=!0:(r.multiChatMode||(c=!0),u=!0),c&&(t.audioTransceiver=this._peerConnection.addTransceiver("audio",{direction:"recvonly"})),u&&(t.videoTransceiver=this._peerConnection.addTransceiver("video",{direction:"recvonly"})),h=oL(),this._report("rtc_begin_create_offer",{direction:"up",stream_id:t.streamId,stream_user_id:t.userId,pc_session_id:this.peerConnectionId,vendor_mode:0}),e.next=12,this._createQueue.add();case 12:return p=e.sent,this._report("rtc_create_offer",{error_code:0,direction:"up",stream_id:t.streamId,stream_user_id:t.userId,elapse:oL()-h}),v=null!==(n=null===(i=t.audioTransceiver)||void 0===i?void 0:i.mid)&&void 0!==n?n:void 0,f=null!==(o=null===(a=t.videoTransceiver)||void 0===a?void 0:a.mid)&&void 0!==o?o:void 0,_=Lj.parse(p),null===(s=_.media)||void 0===s||s.forEach((function(e){"".concat(e.mid)===v?d=e:"".concat(e.mid)===f&&(l=e)})),v&&d||(v="audio_".concat(f),d=Zl(Zl({},this._aRecvonlyOfferTpl),{},{mid:v})),t.audioMid=v,t.videoMid=f,m=void 0,g=void 0,!r.multiChatMode&&!t.virtual&&this._aSendonlyAnswerTpl&&this._aSendonlyAnswerTpl&&(m=this._generateAllSsrc(),R=Zl(Zl(Zl({},this._aSendonlyAnswerTpl),this.peer._answerIce),{},{mid:v,msid:Bg(y=Bg(S="".concat(t.streamId)).call(S,null!==(b=this._context)&&void 0!==b&&b.avSync?"":"-audio"," ")).call(y,t.streamId,"-audio"),ssrcs:cH(t.streamId,"audio",m.audio)}),A=Zl(Zl(Zl({},this._vSendonlyAnswerTpl),this.peer._answerIce),{},{mid:f,msid:Bg(k=Bg(E="".concat(t.streamId)).call(E,null!==(T=this._context)&&void 0!==T&&T.avSync?"":"-video"," ")).call(k,t.streamId,"-video")},uH(t.streamId,m,{flexfec:this._enableSubFlexfec})),g={sdp:Lj.write(Zl(Zl({},this.peer._answerSession),{},{media:[R,A]})),sequenceId:t.sequenceId?++t.sequenceId:0},null===(I=m)||void 0===I||delete I.next),Ej()&&(t.initVideoEncodedTransform(),t.initAudioEncodedTransform()),e.abrupt("return",{partialSdp:lH(_,d,l,!1),audioMid:v,videoMid:f||"",type:"incroffer",semantics:"unified-plan",audioTransceiverInit:t.audioTransceiver?{track:"audio",init:{direction:"recvonly"}}:void 0,videoTransceiverInit:t.videoTransceiver?{track:"video",init:{direction:"recvonly"}}:void 0,allSsrc:m,peerConnectionMode:this.peerConnectionMode,signalingAck:g});case 26:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"handleAck",value:(c=Ng(Mg().mark((function e(t){var r,n,i,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.signalingAck,n=t.stream,(i=t.action)!==XG.removetrack){e.next=3;break}return e.abrupt("return","");case 3:if(i!==XG.unpublish&&i!==XG.unsubscribe){e.next=14;break}return e.prev=4,e.next=7,this.close(n);case 7:"function"==typeof t.onSuccess&&t.onSuccess(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),"function"==typeof t.onFail&&t.onFail(e.t0);case 13:return e.abrupt("return",n.streamId||"");case 14:return o=Lj.parse(null==r?void 0:r.sdp),e.prev=15,e.next=18,this._internalSetRemoteDescription(o.media,n);case 18:"function"==typeof t.onSuccess&&t.onSuccess(),e.next=24;break;case 21:e.prev=21,e.t1=e.catch(15),"function"==typeof t.onFail&&t.onFail(e.t1);case 24:return e.abrupt("return","");case 25:case"end":return e.stop()}}),e,this,[[4,10],[15,21]])}))),function(e){return c.apply(this,arguments)})},{key:"_internalSetRemoteDescription",value:(s=Ng(Mg().mark((function e(t,r){var n=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.forEach((function(e){"audio"===(e=Zl(Zl({},e),n.peer._answerIce)).type&&(r.audioMid?(e.mid=r.audioMid,n._midMap.set(r.audioMid,e)):n._midMap.set(e.mid,e)),"video"===e.type&&(r.videoMid?(e.mid=r.videoMid,n._midMap.set(r.videoMid,e)):n._midMap.set(e.mid,e))})),r instanceof GG?this.handlePublishAction({stream:r}):this.handleSubscribeAction({stream:r}),e.next=7,this._applyQueue.add();case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"handlePublishAction",value:function(e){var t,r,n,i,o,a,s,c,u=e.stream,d=u.audioMid?this._midMap.get(u.audioMid):void 0,l=u.videoMid?this._midMap.get(u.videoMid):void 0;null!==(t=this._context)&&void 0!==t&&t.pcKillSwitch.sld_rtcpfb_rrtr_add&&Aj&&(mX.addRRTR(d),mX.addRRTR(l));var h,p=null!==(r=this._context)&&void 0!==r&&null!==(n=r.serverConfig)&&void 0!==n&&n.audioRed?"RED":"OPUS";("OPUS"!==p&&d&&function(e,t){if(Array.isArray(e.fmtp)&&Array.isArray(e.rtp)){for(var r=0;r<e.rtp.length;r++)if(e.rtp[r].codec.toUpperCase()===t.toUpperCase()){var n;e.rtp.unshift(jI(n=e.rtp).call(n,r,1)[0]);break}var i=[];e.rtp.forEach((function(e){return i.push(e.payload)})),e.payloads=i.join(" ")}}(d,p),null!==(i=this._context)&&void 0!==i&&i.pcKillSwitch.sld_fmtp_opus_add)&&mX.decorateOpusConfig(d,null===(h=this._context)||void 0===h?void 0:h.audioProfileManager);FL&&aU<=87&&mX.removeRtxInMLine(l);var v=null===(o=this._context)||void 0===o||null===(a=o.serverConfig)||void 0===a?void 0:a.videoCodec;v&&l&&gH(l,v),null!==(s=this._context)&&void 0!==s&&s.pcKillSwitch.sld_ext_sdesmid_remove&&FL&&aU>=138&&mX.removeExtSdesMid(l),null!==(c=this._context)&&void 0!==c&&c.pcKillSwitch.sld_fmtp_bitrate_add&&(u.enableSimulcast||BL||!l||this.addBitrateLimit(l,u.videoEncodeConfig[0].maxKbps)),FL&&mX.selectCC(l,Rj?"tcc":"remb"),u.audioMid&&d&&this._midMap.set(u.audioMid,d),u.videoMid&&l&&this._midMap.set(u.videoMid,l)}},{key:"handleSubscribeAction",value:function(e){var t,r,n,i=e.stream,o=i.audioMid?this._midMap.get(i.audioMid):void 0,a=i.videoMid?this._midMap.get(i.videoMid):void 0;FL||(mX.removeRtpStreamId(o),mX.removeRtpStreamId(a)),null!==(t=this._context)&&void 0!==t&&t.pcKillSwitch.sld_rtcpfb_rrtr_add&&Aj&&(mX.addRRTR(o),mX.addRRTR(a)),null!==(r=this._context)&&void 0!==r&&r.pcKillSwitch.sld_fmtp_opus_add&&mX.decorateOpusConfig(o,this._context.audioProfileManager),wU("IOS_SAFARI_ORIENTATION")||!BL&&!ZL||mX.removeExtVideoOrientation(a),null!==(n=this._context)&&void 0!==n&&n.pcKillSwitch.sld_fmtp_sps_add&&i.isPublic&&jL&&lU>=86&&mX.decorateSpsPpsIdrInKeyframe(a),i.audioMid&&o&&this._midMap.set(i.audioMid,o),i.videoMid&&a&&this._midMap.set(i.videoMid,a)}},{key:"getDefaultSdp",value:(a=Ng(Mg().mark((function e(){var t,r,n,i,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new RTCPeerConnection).addTransceiver("audio",{direction:"recvonly"}),r.addTransceiver("video",{direction:"recvonly"}),e.next=5,r.createOffer();case 5:return n=e.sent,i=Lj.parse(n.sdp),this.createAVMlineOfferTpl(n.sdp),o=[],i.media=Iy(t=i.media).call(t,(function(e){if("recvonly"===e.direction){var t="template_".concat(e.type);return e.mid=t,o.push(t),!0}return!1})),Aj&&SH(i),i.groups=[{mids:o.join(" "),type:"BUNDLE"}],r.close(),e.abrupt("return",{sdp:Lj.write(i),semantics:"unified-plan",type:"incroffer"});case 14:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"rollback",value:(o=Ng(Mg().mark((function e(t){var r,n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.msid,r=t.stream,n=t.audioMid,i=t.videoMid,this.logger.warn("rollback()"),e.abrupt("return",this.close(r,n,i));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"close",value:(i=Ng(Mg().mark((function e(t,r,n){var i,o,a,s;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("close()"),i=t.audioMid||r,o=t.videoMid||n,t.audioTransceiver&&i)try{t.audioTransceiver.stop(),delete t.audioTransceiver}catch(c){}if(t.videoTransceiver&&o)try{t.videoTransceiver.stop(),delete t.videoTransceiver}catch(u){}return a=i?this._midMap.get(i):void 0,s=o?this._midMap.get(o):void 0,a&&dH(a),s&&dH(s),i&&a&&this._midMap.set(i,a),o&&s&&this._midMap.set(o,s),e.next=13,this._applyQueue.add();case 13:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return i.apply(this,arguments)})},{key:"setCurrentDescription",value:(n=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._applyQueue.add();case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"createAVMlineOfferTpl",value:function(e){var t=this;Lj.parse(e).media.forEach((function(e){"audio"===e.type&&(t._aRecvonlyOfferTpl=e)}))}},{key:"_generateAllSsrc",value:function(){var e=sH(this._nextSsrc);return this._nextSsrc=e.next,e}},{key:"create",value:(r=Ng(Mg().mark((function e(){var t,r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("RTCPeerConnection create"),e.next=3,this._peerConnection.createOffer();case 3:return t=e.sent,r=t.sdp,e.next=8,this.peer.setLocalDescription(r);case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"apply",value:(t=Ng(Mg().mark((function e(){var t,r,n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("RTCPeerConnection apply"),e.next=3,this._peerConnection.createOffer();case 3:return t=e.sent,r=t.sdp,n=Lj.parse(r),r=this.generateOffer(n,r),i=this.generateAnswer(n),e.next=11,this.setLocalDescription(r);case 11:return e.next=13,this.setRemoteDescription(i);case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"generateOffer",value:function(e,t){var r,n,i,o=this,a=!1;"v1"===this.peer.getIceVersion()&&FL&&(e.media=Jg(n=e.media).call(n,(function(e){return Zl(Zl({},e),o.peer._offerIce)})),a=!0);null!==(r=this._context)&&void 0!==r&&r.pcKillSwitch.sld_rtcpfb_rrtr_add&&(e.media=Jg(i=e.media).call(i,(function(e){return mX.addRRTR(e),e})),a=!0);return a?Lj.write(e):t}},{key:"generateAnswer",value:function(e){var t=this,r=[];return e.media.forEach((function(e){if("application"===e.type){e.mid;var n=t._midMap.get(e.mid);return n||(n=t.generateDCAnswer(e),t._midMap.set(e.mid,n)),void r.push(Zl({},n))}var i="".concat(e.mid),o=t._midMap.get(i);o||(t.logger.info("generateInactiveAnswerMLine","mid: %o, mLine: %o",e.mid,e),o=t.generateInactiveAnswerMLine(e)),r.push(o)})),this.peer.createAnswerSdp(r,e.groups)}},{key:"generateInactiveAnswerMLine",value:function(e){return Zl(Zl(Zl({},e),this.peer._answerIce),{},{direction:"inactive"})}},{key:"generateDCAnswer",value:function(e){var t=Zl(Zl(Zl({},e),this.peer._answerIce),{},{sctpmap:{sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144}});return FL&&(delete t.bundleOnly,t.port=9),t}},{key:"destroy",value:function(){LA(NA(h.prototype),"destroy",this).call(this),this._pqueue.destroy(),this._applyQueue.destroy(),this._createQueue.destroy()}}]),h}(TH);vX([function(e,t,r){var n=r.value;return r.value=Ng(Mg().mark((function e(){var r,i,o,a,s,c=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.logger).info("SDP Lock","pending task %o",t),e.next=4,this._pqueue.enqueue(0);case 4:for(i=e.sent,r.info("SDP Lock","running task %o",t),e.prev=6,o=c.length,a=new Array(o),s=0;s<o;s++)a[s]=c[s];return e.next=10,null==n?void 0:n.apply(this,a);case 10:return e.abrupt("return",e.sent);case 11:return e.prev=11,r.info("SDP Lock","unlocking by task %o",t),i(),e.finish(11);case 15:case"end":return e.stop()}}),e,this,[[6,,11,15]])}))),r}],_X.prototype,"create",1),vX([function(e,t,r){var n=r.value;return r.value=Ng(Mg().mark((function e(){var r,i,o,a,s,c=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.logger).info("SDP Lock","pending task %o",t),e.next=4,this._pqueue.enqueue(1);case 4:for(i=e.sent,r.info("SDP Lock","running task %o",t),e.prev=6,o=c.length,a=new Array(o),s=0;s<o;s++)a[s]=c[s];return e.next=10,null==n?void 0:n.apply(this,a);case 10:return e.abrupt("return",e.sent);case 11:return e.prev=11,r.info("SDP Lock","unlocking by task %o",t),i(),e.finish(11);case 15:case"end":return e.stop()}}),e,this,[[6,,11,15]])}))),r}],_X.prototype,"apply",1);var mX={decorateOpusConfig:function(e,t){var r;if(e){var n=null==e?void 0:sI(r=e.rtp).call(r,(function(e){return"opus"===e.codec}));if(n&&e.fmtp){var i,o=sI(i=e.fmtp).call(i,(function(e){return e.payload===n.payload}));o&&t&&(o.config=t.getOpusConfigStr(o.config))}}},removeRtxInMLine:function(e){var t,r,n,i;if(e){var o=[];e.rtp=Iy(t=e.rtp).call(t,(function(e){return"rtx"===e.codec&&o.push(e.payload),"rtx"!==e.codec})),e.fmtp=Iy(r=e.fmtp).call(r,(function(e){return qy(o).call(o,e.payload)})),e.payloads=null===(n=e.payloads)||void 0===n?void 0:Iy(i=n.split(" ")).call(i,(function(e){return!qy(o).call(o,_b(e))})).join(" ")}},removeExtSdesMid:function(e){var t;e&&(e.ext=null===(t=e.ext)||void 0===t?void 0:Iy(t).call(t,(function(e){var t;return!qy(t=e.uri).call(t,"sdes:mid")})))},selectCC:function(e,t){var r,n;if(e)if("tcc"===t)e.ext=null===(r=e.ext)||void 0===r?void 0:Iy(r).call(r,(function(e){var t;return-1===SI(t=e.uri).call(t,"abs-send-time")})),e.rtcpFb=null===(n=e.rtcpFb)||void 0===n?void 0:Iy(n).call(n,(function(e){return"goog-remb"!==e.type}));else if("remb"===t){var i,o;e.rtcpFb=null===(i=e.rtcpFb)||void 0===i?void 0:Iy(i).call(i,(function(e){return"transport-cc"!==e.type})),e.ext=null===(o=e.ext)||void 0===o?void 0:Iy(o).call(o,(function(e){var t;return-1===SI(t=e.uri).call(t,"transport")}))}},addRRTR:function(e){e&&e.rtp.forEach((function(t){var r;e.rtcpFb||(e.rtcpFb=[]),sI(r=e.rtcpFb).call(r,(function(e){return e.payload===t.payload&&"rrtr"===e.type}))||e.rtcpFb.push({payload:t.payload,type:"rrtr"})}))},removeRtpStreamId:function(e){var t;e&&(Array.isArray(e.ext)&&(e.ext=Iy(t=e.ext).call(t,(function(e){return"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"!==e.uri}))))},decorateSpsPpsIdrInKeyframe:function(e){var t;if(e){var r=Iy(t=e.rtp).call(t,(function(e){return"H264"===e.codec}));r.length&&e.fmtp&&e.fmtp.forEach((function(e){sI(r).call(r,(function(t){return t.payload===e.payload}))&&(e.config+=";sps-pps-idr-in-keyframe=1")}))}},removeExtVideoOrientation:function(e){var t;e&&(Array.isArray(e.ext)&&(e.ext=Iy(t=e.ext).call(t,(function(e){var t;return!qy(t=e.uri).call(t,"video-orientation")}))))},removeExtFramemarking:function(e){var t;e&&(Array.isArray(e.ext)&&(e.ext=Iy(t=e.ext).call(t,(function(e){var t;return!qy(t=e.uri).call(t,"framemarking")}))))}},gX=function(){function e(){Bh(this,e),Jl(this,"queue",[]),Jl(this,"processing",!1)}var t;return Fh(e,[{key:"enqueue",value:(t=Ng(Mg().mark((function e(){var t,r,n,i,o,a,s,c,u=this,d=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=d.length>0&&void 0!==d[0]?d[0]:0,n=yX(),i=n.promise,o=n.resolve,a={priority:r,resolve:o},-1===(s=tC(t=this.queue).call(t,(function(e){return e.priority>r})))?this.queue.push(a):jI(c=this.queue).call(c,s,0,a),this.tryProcess(),e.next=8,i;case 8:return this.processing=!0,e.abrupt("return",(function(){u.processing=!1,u.tryProcess()}));case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){this.queue.forEach((function(e){(0,e.resolve)()})),this.queue=[],this.processing=!1}},{key:"tryProcess",value:function(){if(!this.processing){var e=this.queue.shift();e&&e.resolve()}}}]),e}();function yX(){var e=void 0,t=void 0,r=new HI((function(r,n){e=r,t=n}));if(!e||!t)throw Error("Broken Implement of Promise");return{promise:r,resolve:e,reject:t}}var SX,bX,kX=function(e,t){return e.enableFallbackHandler?new lX(e,t):e.enableStandardHandler?new _X(e,t):FL?new dX(e,t):new uX(e,t)},EX=function(e){return e.streamRemovedBySchedule308="stream removed",e.clientRePublish="client republish",e.publishStreamFaied="publish failed",e.clientUnPublish="client unpublished",e.clientDisconnected="client disconnected",e.videoMuted="video muted",e}(EX||{}),TX=function(e){return e.PushLimitWarn="PushLimitWarn",e}(TX||{}),IX=function(e){return e.ON_ADD_STREAM="onAddStream",e.ON_ADD_STREAM_LIST="onAddStreamList",e.ON_REMOVE_STREAM="onRemoveStream",e.ON_REMOVE_STREAM_LIST="onRemoveStreamList",e.USER_DISCONNECTION="userDisconnection",e.USER_DISCONNECTION_LIST="userDisconnectionList",e.USER_CONNECTION="userConnection",e.USER_CONNECTION_LIST="userConnectionList",e.ON_UPDATE_STREAM_ATTRIBUTES="onUpdateStreamAttributes",e.ON_UPDATE_ROOM_ATTRIBUTES="onUpdateRoomAttributes",e.ON_UPDATE_USER_ATTRIBUTES="onUpdateUserAttributes",e.ON_PUSH_TRACK="onPushTrack",e.ON_REMOVE_TRACK="onRemoveTrack",e.ON_CUSTOM_MESSAGE="onCustomMessage",e.NODE_CHANGE="nodeChange",e.USER_MESSAGE_RECEIVED="userMessageReceived",e.USER_BINARY_MESSAGE_RECEIVED="userBinaryMessageReceived",e.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM="userMessageReceivedOutsideRoom",e.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM="userBinaryMessageReceivedOutsideRoom",e.POST_PROCESSING_MESSAGE="postProcessingMessage",e.ON_USER_TOKEN_WILL_EXPIRE="onUserTokenWillExpire",e.STREAM_CONTROL_MESSAGE="streamControlMessage",e.ON_SPEAKER_CHANGE="onSpeakerChange",e.ON_STREAM_FAILED="streamFailed",e.ON_NOTIFY_RECONNECT="notifyReconnect",e.ON_FORWARD_DST_ROOM_USER_KICK="onForwardDstRoomUserKick",e}(IX||{}),RX=function(e){return e.RSCP="RSCP",e.RTT="RTT",e.SSC="SSC",e}(RX||{}),AX=function(e){return e.ON_CONNECTION_STATE_CHANGE="onConnectionStateChange",e.ON_VENDOR_CONNECTION_STATE_CHANGE="onVendorConnectionStateChange",e.ABNORMAL_DISCONNECTION="normalConnection",e}(AX||{}),wX=function(e){return e.userLeave="userLeave",e.connectionLost="connectionLost",e.userDuplicateLogin="userDuplicateLogin",e.kickedByAdmin="kickedByAdmin",e.roleChanged="roleChanged",e.onUserTokenDidExpire="onUserTokenDidExpire",e}(wX||{}),CX=function(e){return e[e.roomDismissByAdmin=2]="roomDismissByAdmin",e}(CX||{}),xX=new lN("Locker",2),OX=1,PX=function(){function e(t){var r;Bh(this,e),Jl(this,"lockingPromise",HI.resolve()),Jl(this,"locks",0),Jl(this,"name",""),Jl(this,"lockId",void 0),this.lockId=OX++,t&&(this.name=t),xX.info(Bg(r="[lock-".concat(this.name,"-")).call(r,this.lockId,"] is created."))}return Fh(e,[{key:"isLocked",get:function(){return this.locks>0}},{key:"lock",value:function(){var e,t,r,n=this;this.locks+=1,xX.info(Bg(e=Bg(t="[lock-".concat(this.name,"-")).call(t,this.lockId,"] locked, current queue ")).call(e,this.locks,"."));var i=new HI((function(e){r=function(){var t,r;n.locks-=1,xX.info(Bg(t=Bg(r="[lock-".concat(n.name,"-")).call(r,n.lockId,"] unlocked, current queue ")).call(t,n.locks,".")),e()}})),o=this.lockingPromise.then((function(){return r}));return this.lockingPromise=this.lockingPromise.then((function(){return i})),o}}]),e}(),MX=function(e){return e.RESUBSCRIBE="resubscribe",e.STREAM_FAILED="stream_failed",e.SUBSCRIBE_PUSH_TRACK="subscribe_push_track",e.REMOVE_PUSH_TRACK="remove_push_track",e.VIDEO_FIRST_FRAME="video_first_frame",e.ON_USER_PUBLISH_STATE_CHANGE="on_user_publish_state_change",e.ON_USER_START_AUDIO_CAPTURE="on_user_start_audio_capture",e.ON_USER_STOP_AUDIO_CAPTURE="on_user_stop_audio_capture",e.ON_USER_START_VIDEO_CAPTURE="on_user_start_video_capture",e.ON_USER_STOP_VIDEO_CAPTURE="on_user_stop_video_capture",e.ON_SEI_MESSAGED_RECEIVED="on_sei_messaged_received",e.ON_PUBLISH_RESULT="on_publish_result",e.ON_SUBSCRIBE_RESULT="ON_SUBSCRIBE_RESULT",e.ON_UPDATE_TOKEN_SUCCESS="on_update_token_success",e.ON_REMOTE_STREAM_STATS="ON_REMOTE_STREAM_STATS",e.ON_LOCAL_STREAM_STATS="ON_LOCAL_STREAM_STATS",e.ON_USER_LEAVE="on_user_leave",e.ON_ROOM_ERROR="on_room_error",e.ON_NETWORK_QUALITY="on_network_quality",e.ON_SIMULCAST_SUBSCRIBE_FALLBACK="on_simulcast_subscribe_fallback",e.ON_REMOTE_VIDEO_SIZE_CHANGED="on_remote_video_size_changed",e.RECONNECT_FAILED="reconnect_failed",e.ON_SUBTITLE_STATE_CHANGED="ON_SUBTITLE_STATE_CHANGED",e.ON_SUBTITLE_MESSAGE_RECEIVED="ON_SUBTITLE_MESSAGE_RECEIVED",e.ON_VIDEO_STREAM_BANNED="ON_VIDEO_STREAM_BANNED",e.ON_AUDIO_STREAM_BANNED="ON_AUDIO_STREAM_BANNED",e.ON_FORWARD_STREAM_ERROR="ON_FORWARD_STREAM_ERROR",e.ON_REJOIN_WITH_TCP="ON_REJOIN_WITH_TCP",e.ON_ICE_CONNECT_WITH_TCP="ON_ICE_CONNECT_WITH_TCP",e.PUB_RETRY="PUB_RETRY",e.SUB_RETRY="SUB_RETRY",e}(MX||{}),DX=function(e){return e[e.START=1]="START",e[e.START_SUCCESS=2]="START_SUCCESS",e[e.START_FAILED=3]="START_FAILED",e[e.UPDATE=4]="UPDATE",e[e.UPDATE_SUCCESS=5]="UPDATE_SUCCESS",e[e.UPDATE_FAILED=6]="UPDATE_FAILED",e[e.STOP=7]="STOP",e[e.STOP_SUCCESS=8]="STOP_SUCCESS",e[e.STOP_FAILED=9]="STOP_FAILED",e}(DX||{}),NX=function(e){return e[e.PUB=0]="PUB",e[e.UNPUB=1]="UNPUB",e}(NX||{}),LX=(Jl(SX={},Eh.communication,[0]),Jl(SX,Eh.chat,[0]),Jl(SX,Eh.chatRoom,[1,"IES_chatroom"]),Jl(SX,Eh.coHost,[1,"IES_PK"]),Jl(SX,Eh.meeting,[16]),Jl(SX,Eh.classRoom,[0]),SX),UX=Ej(),VX=function(e){VA(s,e);var t,r,n,i,o,a=tw(s);function s(e,t){var r;return Bh(this,s),Jl(sA(r=a.call(this,e,t)),"_peerConnectionId",iL()),Jl(sA(r),"peerConnectionMode",1),Jl(sA(r),"name","vendor"),Jl(sA(r),"direction","up"),Jl(sA(r),"stream",void 0),t.on("ice_state",(function(e){r._report("rtc_ice_state",{pc_session_id:r.peerConnectionId,direction:r.direction,error_code:0,ice_state:e.toUpperCase(),message:"",peer_connection_id:r.peerConnectionId,stream_id:"",stream_user_id:""})})),t.on("disconnect",(function(){r.emit("disconnect")})),r}return Fh(s,[{key:"publish",value:(o=Ng(Mg().mark((function e(t){var r,n,i,o,a,c,u,d,l,h,p=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.enableSimulcast=!1,this.stream=t,r=LA(NA(s.prototype),"internalPublish",this).call(this,t),n=r.videoDescriptions,i=r.subVideoDescriptions,o=r.audioTransceiverInit,a=r.videoTransceiverInit,t.audioTransceiver=this._peerConnection.addTransceiver(o.track,o.init),t.videoTransceiver=this._peerConnection.addTransceiver(a.track,a.init),UX&&(t.initAudioEncodedTransform(),t.initVideoEncodedTransform()),this._report("rtc_begin_create_offer",{direction:"up",stream_id:"",stream_user_id:"",pc_session_id:this.peerConnectionId,vendor_mode:(null==t?void 0:t.vendorCode)||0}),e.next=9,this._peerConnection.createOffer();case 9:return c=e.sent,u=oL(),d=Lj.parse(c.sdp),Array.isArray(d.media)&&(d.media=Jg(l=d.media).call(l,(function(e){var r,n,i,o,a;if("video"===e.type)null!==(r=p._context)&&void 0!==r&&null!==(n=r.serverConfig)&&void 0!==n&&n.videoCodec&&gH(e,null===(i=p._context)||void 0===i||null===(o=i.serverConfig)||void 0===o?void 0:o.videoCodec),(BL||ZL)&&Array.isArray(e.ext)&&(e.ext=Iy(a=e.ext).call(a,(function(e){var t;return!(null!=e&&null!==(t=e.uri)&&void 0!==t&&qy(t).call(t,"video-orientation"))}))),BL||p.addBitrateLimit(e,t.videoEncodeConfig[0].maxKbps);else if("audio"===e.type){var s,c=null==e?void 0:sI(s=e.rtp).call(s,(function(e){return"opus"===e.codec}));if(c&&e.fmtp){var u,d,l=sI(u=e.fmtp).call(u,(function(e){return e.payload===c.payload}));l&&null!==(d=p._context)&&void 0!==d&&d.audioProfileManager&&(l.config=p._context.audioProfileManager.getOpusConfigStr(l.config))}}return e}))),h=new RTCSessionDescription({type:"offer",sdp:Lj.write(d)}),e.prev=14,e.next=17,this._peerConnection.setLocalDescription(h);case 17:this._report("rtc_set_description",{error_code:0,message:h.sdp||"",is_local:"1",direction:"up",stream_id:"",stream_user_id:"",elapse:oL()-u},{type:"offer"}),e.next=24;break;case 20:throw e.prev=20,e.t0=e.catch(14),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+h.sdp,is_local:"1",direction:"up",stream_id:"",stream_user_id:"",elapse:oL()-u},{type:"offer"}),e.t0;case 24:return e.abrupt("return",{partialSdp:h.sdp||"",audioMid:"0",videoMid:"1",type:"offer",semantics:"unified-plan",videoDescriptions:n,subVideoDescriptions:i,audioTransceiverInit:o,videoTransceiverInit:a,peerConnectionMode:this.peerConnectionMode,peerConnectionId:this.peerConnectionId});case 25:case"end":return e.stop()}}),e,this,[[14,20]])}))),function(e){return o.apply(this,arguments)})},{key:"subscribe",value:(i=Ng(Mg().mark((function e(t){var r,n,i,o,a,s=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stream=t,this.direction="down",t.audioTransceiver=this._peerConnection.addTransceiver("audio",{direction:"recvonly"}),t.videoTransceiver=this._peerConnection.addTransceiver("video",{direction:"recvonly"}),UX&&(t.initAudioEncodedTransform(),t.initVideoEncodedTransform()),this._report("rtc_begin_create_offer",{direction:"down",stream_id:t.streamId,stream_user_id:t.userId,pc_session_id:this.peerConnectionId,vendor_mode:t.vendorCode||0}),e.next=8,this._peerConnection.createOffer();case 8:return r=e.sent,n=oL(),i=Lj.parse(r.sdp),Array.isArray(i.media)&&(i.media=Jg(o=i.media).call(o,(function(e){if("audio"===e.type){var t,r=null==e?void 0:sI(t=e.rtp).call(t,(function(e){return"opus"===e.codec}));if(r&&null!=e&&e.fmtp){var n,i=null==e?void 0:sI(n=e.fmtp).call(n,(function(e){return e.payload===r.payload}));i&&s._context&&(i.config+=";stereo=1;sprop-stereo=1")}}return e}))),a=new RTCSessionDescription({type:"offer",sdp:Lj.write(i)}),e.prev=13,e.next=16,this._peerConnection.setLocalDescription(a);case 16:this._report("rtc_set_description",{error_code:0,message:a.sdp||"",is_local:"1",direction:"down",stream_id:t.streamId,stream_user_id:t.userId,elapse:oL()-n},{type:"offer"}),e.next=23;break;case 19:throw e.prev=19,e.t0=e.catch(13),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+a.sdp,is_local:"1",direction:"down",stream_id:t.streamId,stream_user_id:t.userId,elapse:oL()-n},{type:"offer"}),e.t0;case 23:return e.abrupt("return",{partialSdp:a.sdp||"",audioMid:"0",videoMid:"1",type:"offer",semantics:"unified-plan",peerConnectionMode:this.peerConnectionMode,peerConnectionId:this.peerConnectionId});case 24:case"end":return e.stop()}}),e,this,[[13,19]])}))),function(e){return i.apply(this,arguments)})},{key:"handleAck",value:(n=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.action!==XG.publish&&t.action!==XG.subscribe){e.next=16;break}return n=new RTCSessionDescription({sdp:null===(r=t.signalingAck)||void 0===r?void 0:r.sdp,type:"answer"}),i=oL(),e.prev=3,e.next=6,this._peerConnection.setRemoteDescription(n);case 6:this._report("rtc_set_description",{error_code:0,message:n.sdp||"",is_local:"1",direction:"down",stream_id:null===(o=t.stream)||void 0===o?void 0:o.userId,stream_user_id:(null===(a=t.stream)||void 0===a?void 0:a.streamId)||"",elapse:oL()-i},{type:"answer"}),e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(3),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+n.sdp,is_local:"1",direction:"down",stream_id:null===(s=t.stream)||void 0===s?void 0:s.userId,stream_user_id:(null===(c=t.stream)||void 0===c?void 0:c.streamId)||"",elapse:oL()-i},{type:"offer"}),e.t0;case 13:"function"==typeof t.onSuccess&&t.onSuccess(),e.next=17;break;case 16:t.action!==XG.unpublish&&t.action!==XG.unsubscribe||this.destroy();case 17:return e.abrupt("return","");case 18:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e){return n.apply(this,arguments)})},{key:"destroy",value:function(){this.peer.destroy(),LA(NA(s.prototype),"destroy",this).call(this)}},{key:"getDefaultSdp",value:(r=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{sdp:"",type:"offer",semantics:""});case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"connect",value:function(){throw new Error("Method not implemented.")}},{key:"rollback",value:(t=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{this._peerConnection.close()}catch(t){}case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"peerConnectionId",get:function(){return this._peerConnectionId},set:function(e){this._peerConnectionId=e}}]),s}(TH),FX=function(e){return e[e.AUTOPLAY_FAILED=-1e3]="AUTOPLAY_FAILED",e[e.TRACK_ERROR=-1001]="TRACK_ERROR",e[e.Fetch_MODIFY=-1002]="Fetch_MODIFY",e[e.BLACK_BROWSER=-1003]="BLACK_BROWSER",e[e.DC_SEND_ERROR=-1004]="DC_SEND_ERROR",e}(FX||{}),BX={start_interval:100,multiplier:2,max_interval:3e4},jX=function(){function e(){Bh(this,e),Jl(this,"_times",0),Jl(this,"_config",BX),Jl(this,"initTs",oL())}return Fh(e,[{key:"getRetryDelay",value:function(){return Math.min(this._config.max_interval,Math.pow(this._config.multiplier,this._times++)*this._config.start_interval)}},{key:"setConfig",value:function(e){this._config=e}},{key:"reset",value:function(){this._times=0}}]),e}(),HX=function(){function e(t){Bh(this,e),Jl(this,"_reconnectTimer",void 0),Jl(this,"_abortControllers",[]),Jl(this,"_monitor",void 0),Jl(this,"logger",void 0),Jl(this,"_groupConfigId",iL()),Jl(this,"_retryLimiter",new jX),Jl(this,"_timer",void 0),this._ctx=t,this._monitor=KD(t.id),this.logger=new lN("ICERequest",4,t.id)}var t,r,n,i,o;return Fh(e,[{key:"getICENode",value:(o=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("getICENode","invoke"),e.prev=1,e.next=4,this._getAccessWithRetry(t);case 4:if(0!==(r=e.sent).length){e.next=7;break}throw new Error("server return empty nodes.");case 7:e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),this._reportRtcInvokeStatus("es.join.getNodeFailed",e.t0),new kC(mC.ICE_SERVER_WRONG,"get ICE config failed: ".concat(e.t0.message),e.t0);case 13:return this.logger.success("getICENode","success"),this._reportRtcInvokeStatus("es.join.getNodeSuccess",r),e.abrupt("return",r);case 16:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return o.apply(this,arguments)})},{key:"_getAccessWithRetry",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return 0!==r&&this.logger.info("_getAccessWithRetry()","invoke feedbackInfo: %o, 201count: %o",e,r),new HI((function(n,i){t._getAccessNode(e).then((function(e){t._retryLimiter.reset(),n(e)})).catch((function(o){if(Array.isArray(o)&&o.length>0){if(tC(o).call(o,(function(e){return 400<=e.code&&e.code<500}))>-1)return t._retryLimiter.reset(),i(new Error("HTTP request failed(4xx)"));if(o.every((function(e){var t;return 201===e.code||201===(null===(t=e.error)||void 0===t?void 0:t.code)}))&&r++,3===r)return t._retryLimiter.reset(),i(new Error("HTTP request failed(201)"))}var a=t._retryLimiter.getRetryDelay();t.logger.warn("_getAccessWithRetry()","_getAccessWithRetry error, will retry after ".concat(a,"ms"),o),t._reconnectTimer=self.setTimeout((function(){t._getAccessWithRetry(e,r).then(n).catch(i)}),a)}))}))}},{key:"_getAccessNode",value:(i=Ng(Mg().mark((function e(t){var r=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new HI((function(e,n){var i=yU.getAccessNode(r._ctx.appId);i?(r.logger.info("getAccessNode","use cache node."),e(Array.isArray(i)?i:[i]),r._timer=window.setTimeout((function(){r._getAccessNodeFromServer(t),r._reportRtcInvokeStatus("es.R.node.cache",i),delete r._timer}),0)):r._getAccessNodeFromServer(t).then(e).catch(n)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"_getAccessNodeFromServer",value:(n=Ng(Mg().mark((function e(t){var r,n,i,o=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._getAccessUrls(),n=r.urls,i=r.needFallback,e.abrupt("return",this.getICEConfigFromServer(n,t).then((function(e){var t=e.nodes;return!o._ctx.useCloudProxy&&yU.setAccessNode(o._ctx.appId,t,e.ttl||11200),e.dispatchDomains&&!o._ctx.useCloudProxy&&yU.setAccessUrls(e.dispatchDomains),t})).catch((function(e){if(i)return o._reportRtcInvokeStatus("es.R.req.fallback",""),yU.clearAccessUrls(),o._getAccessNodeFromServer(t);throw e})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_getAccessUrls",value:function(){var e=yU.getAccessUrls()||[],t=!0;return this._reportRtcInvokeStatus("es.R.req.cache.urls",e),0===e.length&&(e=RU.ICE_CONFIG_REQUEST_URLS,t=!1,this._reportRtcInvokeStatus("es.R.req.external.urls",e)),0===e.length&&(e=RU.ICE_CONFIG_REQUEST_URLS_INTERNAL,t=!1,this._reportRtcInvokeStatus("es.R.req.internal.urls",e)),{urls:e,needFallback:t}}},{key:"getICEConfigFromServer",value:(r=Ng(Mg().mark((function e(t,r){var n,i,o,a,s=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={appID:this._ctx.appId,deviceID:yU.getDeviceId(),os:"web",sdkVersion:RU.VERSION,isOversea:RU.OVERSEA,expectedAddr:wU("EXPECTED_ADDR"),productPlatform:"VolcEngine",enableCloudProxy:this._ctx.useCloudProxy,expectedIDC:this._ctx.expectedIDC,accessParams:zg({requireICEUfragV2:!0}),userAgent:navigator.userAgent},r&&(n.feedbackInfo=r,"ICE_FAILED"!==(null===(i=r[0])||void 0===i||null===(o=i.feedbackReason)||void 0===o?void 0:o.type)&&delete n.expectedAddr),a=Jg(t).call(t,(function(e){return s._httpRequest(e,n)})),e.abrupt("return",bL(a));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"_httpRequest",value:(t=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=iL(),r.connectSessionID=i,o=Date.now(),null===(n=this._monitor)||void 0===n||n.report("rtc_get_access",{error_code:0,message:zg(r),elapse:0,type:"request",host:t,config_id:i,group_config_id:this._groupConfigId}),a=new AbortController,this._abortControllers.push(a),e.prev=6,e.prev=7,e.next=10,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:zg(r),signal:a.signal});case 10:s=e.sent,e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(7),_x(fetch)||null===(d=this._monitor)||void 0===d||d.report("rtc_error",{error_code:FX.Fetch_MODIFY,message:"get access failed, possibly due to modifying the browser's Fetch API."},{origin_error:e.t0}),e.t0;case 17:if(this._abortControllers=Iy(c=this._abortControllers).call(c,(function(e){return e!==a})),200===s.status){e.next=20;break}throw{message:s.statusText,code:s.status};case 20:return e.next=22,s.json();case 22:if(200===(l=e.sent).code){e.next=25;break}throw l;case 25:return null===(u=this._monitor)||void 0===u||u.report("rtc_get_access",{error_code:200,message:zg(l),elapse:Date.now()-o,type:"response",host:t,config_id:i,group_config_id:this._groupConfigId}),e.abrupt("return",l);case 29:throw e.prev=29,e.t1=e.catch(6),null===(h=this._monitor)||void 0===h||h.report("rtc_get_access",{error_code:Number((null===e.t1||void 0===e.t1?void 0:e.t1.code)||(null===e.t1||void 0===e.t1?void 0:e.t1.server_code)),message:null===e.t1||void 0===e.t1?void 0:e.t1.message,elapse:Date.now()-o,type:"response",host:t,config_id:i,group_config_id:this._groupConfigId},{error:zg(e.t1)}),e.t1;case 33:case"end":return e.stop()}}),e,this,[[6,29],[7,13]])}))),function(e,r){return t.apply(this,arguments)})},{key:"destroy",value:function(){this._abortControllers.forEach((function(e){return e.abort()})),this._reconnectTimer&&(window.clearTimeout(this._reconnectTimer),delete this._reconnectTimer),this._timer&&(window.clearTimeout(this._timer),delete this._timer)}},{key:"_reportRtcInvokeStatus",value:function(e,t){var r;null===(r=this._monitor)||void 0===r||r.report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:0,stream_id:"",elapse:0,group_config_id:this._groupConfigId})}}]),e}(),GX=Ej(),zX={iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},KX=function(e){return e[e.DC_ERROR=0]="DC_ERROR",e[e.DC_CLOSE=1]="DC_CLOSE",e[e.ICE_FAILED=2]="ICE_FAILED",e[e.DESTROY=3]="DESTROY",e[e.TIMEOUT=4]="TIMEOUT",e}(KX||{}),WX=0,XX=function(e){VA(c,e);var t,r,n,i,o,a,s=tw(c);function c(e,t){var r;return Bh(this,c),Jl(sA(r=s.call(this)),"uuid",(WX++).toString()),Jl(sA(r),"_peerConnectionId",""),Jl(sA(r),"audioTrack4ff",void 0),Jl(sA(r),"_pc",void 0),Jl(sA(r),"_dc",void 0),Jl(sA(r),"_iceNode",void 0),Jl(sA(r),"_initSctpEvents",!1),Jl(sA(r),"_monitor",void 0),Jl(sA(r),"_offerIce",{}),Jl(sA(r),"_answerIce",{}),Jl(sA(r),"_offerSession",void 0),Jl(sA(r),"_answerSession",void 0),Jl(sA(r),"_offerMlines",[]),Jl(sA(r),"_answerMlines",[]),Jl(sA(r),"_connectReject",void 0),Jl(sA(r),"_logger",void 0),Jl(sA(r),"_peerConfig",void 0),r._ctx=e,r._groupConnectionId=t,r._monitor=KD(e.id),r._logger=new lN("PeerConnection_".concat(r.uuid),4,e.id),r._ctx.enableFallbackHandler&&r._logger.warn("ctor","PeerConnection running in fallback mode"),r._peerConfig=qX(e),r._pc=new RTCPeerConnection(r._peerConfig),r._pc.ontrack=function(e){var t,n,i,o,a=null===(t=e.streams)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.id;r._print("pc.ontrack",Bg(i=Bg(o="".concat(e.track.kind," ")).call(o,e.track.id," ")).call(i,a)),"ff-stream"===a&&(r.audioTrack4ff=e.track),r.emit("ontrack",e)},r._pc.onconnectionstatechange=function(){var e;r._print("onconnectionstatechange",Bg(e="".concat(r._pc.connectionState,". ice -> ")).call(e,r._pc.iceConnectionState)),"failed"!==r._pc.iceConnectionState&&"closed"!==r._pc.iceConnectionState&&"failed"!==r._pc.connectionState||r.emit("disconnect","ice failed")},r._pc.oniceconnectionstatechange=function(){var e=r._pc.iceConnectionState;r._report("rtc_pre_ice_state",{message:e,ice_state:e.toUpperCase()}),r.emit("ice_state",e)},r}return Fh(c,[{key:"getOriginRTCPeerConnection",value:function(){return this._pc}},{key:"getOriginRTCDataChannel",value:function(){return this._dc}},{key:"getConnectionId",value:function(){return this._peerConnectionId}},{key:"getGroupConnectionId",value:function(){return this._groupConnectionId}},{key:"connect",value:(a=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._ctx.enableStandardHandler){e.next=2;break}return e.abrupt("return",this.startIceConnectStandard(t));case 2:return this._print("connect","invoke. %o",t),this._iceNode=t,(r=this._pc.createDataChannel("signaling",{negotiated:!0,id:100})).binaryType="arraybuffer",this._dc=r,e.next=9,this._genIceInfo(t);case 9:return n=e.sent,i=n.offerIce,o=n.answerIce,this._offerIce=i,this._answerIce=o,FL&&aU<138&&(this._pc.addTransceiver("audio",{direction:"recvonly"}),this._pc.addTransceiver("video",{direction:"recvonly"})),e.next=17,this._pc.createOffer();case 17:if((a=e.sent).sdp){e.next=20;break}throw new kC(mC.NOT_SUPPORTED,"create offer sdp failed.");case 20:if(s=Lj.parse(a.sdp),this._peerConnectionId=o.iceUfrag||"",(c=!i.iceUfrag&&!i.icePwd)&&((h="renomination"===(null===(u=s.media[0])||void 0===u?void 0:u.iceOptions))||(delete i.iceOptions,delete o.iceOptions),delete i.iceUfrag,delete i.icePwd,p=mH({serverUfrag:t.iceParams.serverIceUfrag,serverPwd:t.iceParams.serverIcePwd,clientPwd:null===(d=s.media[0])||void 0===d?void 0:d.icePwd,options:(l={},Jl(l,_H.kICEConfigTypeSrtpDtlsType,!0),Jl(l,_H.kICEConfigTypeRenominationType,h),l)}),v=yy(p,2),f=v[0],_=v[1],this._peerConnectionId=_,o.iceUfrag=f,this._logger.info("use serverUfrag v2",zg({dtls:!0,renomination:h}))),m=yy(s.media,1),g=m[0],this._offerIce.fingerprint=s.fingerprint||g.fingerprint,!FL&&!this._ctx.enableFallbackHandler){e.next=44;break}if(s.media=Jg(y=s.media).call(y,(function(e){var t,r,n,i,o=Zl(Zl({},e),k._offerIce);return"video"===o.type&&(Rj?(o.ext=null===(t=o.ext)||void 0===t?void 0:Iy(t).call(t,(function(e){var t;return-1===SI(t=e.uri).call(t,"abs-send-time")})),o.rtcpFb=null===(r=o.rtcpFb)||void 0===r?void 0:Iy(r).call(r,(function(e){return"goog-remb"!==e.type}))):(o.rtcpFb=null===(n=o.rtcpFb)||void 0===n?void 0:Iy(n).call(n,(function(e){return"transport-cc"!==e.type})),o.ext=null===(i=o.ext)||void 0===i?void 0:Iy(i).call(i,(function(e){var t;return-1===SI(t=e.uri).call(t,"transport")})))),o})),Aj&&SH(s),(b=Zl({},s)).fingerprint=this._answerIce.fingerprint,b.media=Jg(S=b.media).call(S,(function(e){return delete(e=Zl(Zl({},e),k._answerIce)).bundleOnly,e.port=9,"application"===e.type?e.sctpmap={sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144}:("audio"===e.type&&(e.msid="ff-stream ff-stream-audio"),e.direction="sendonly"),e})),Aj&&SH(b),!this._ctx.enableFallbackHandler){e.next=38;break}return e.next=36,this.setLocalDescription(a.sdp);case 36:e.next=40;break;case 38:return e.next=40,this.setLocalDescription(Lj.write(s));case 40:return e.next=42,this.setRemoteDescription(Lj.write(b));case 42:e.next=53;break;case 44:delete s.media,this._offerSession=Zl({},s),this._answerSession=Zl({},s),this._answerSession.fingerprint&&(this._answerSession.fingerprint=this._answerIce.fingerprint),c&&(this._offerIce.iceUfrag=g.iceUfrag,this._offerIce.icePwd=g.icePwd),this._offerMlines=[Zl(Zl(Zl({},g),this._offerIce),{},{mid:"".concat(0)})],this._answerMlines=[Zl(Zl(Zl({},g),this._answerIce),{},{sctpmap:{sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144},mid:"".concat(0)})],this.setDescription();case 53:return e.next=55,new HI((function(e,t){k._connectReject=t,r.onopen=function(){k._print("connect","dataChannel open"),k._reportRtcInvokeStatus("es.dc.open",""),e(""),delete k._connectReject},r.onerror=function(e){var t,r,n,i;k._report("rtc_signaling_msg_error",{error_code:null==e||null===(t=e.error)||void 0===t?void 0:t.sdpLineNumber,message:null==e||null===(r=e.error)||void 0===r?void 0:r.errorDetail,reason:"invalid data"}),k._reportRtcInvokeStatus("es.dc.error",""),null===(n=k._connectReject)||void 0===n||n.call(k,{message:"dc.onerror, ".concat(null===(i=e.error)||void 0===i?void 0:i.errorDetail),code:0}),k.emit("disconnect","dc onerror"),delete k._connectReject},r.onclose=function(){var e;k._reportRtcInvokeStatus("es.dc.close",""),null===(e=k._connectReject)||void 0===e||e.call(k,{message:"dc.onclose",code:1}),k.emit("disconnect","dc onclose"),delete k._connectReject},k._pc.addEventListener("connectionstatechange",(function(){var e,t;"failed"!==k._pc.iceConnectionState&&"closed"!==k._pc.iceConnectionState&&"failed"!==k._pc.connectionState||(null===(e=k._connectReject)||void 0===e||e.call(k,{message:Bg(t="pc.connectionstatechange -> ".concat(k._pc.connectionState,", ice -> ")).call(t,k._pc.iceConnectionState),code:2}),delete k._connectReject)})),setTimeout((function(){var e;null===(e=k._connectReject)||void 0===e||e.call(k,{code:4,message:"connect timeout"}),delete k._connectReject}),8e3)}));case 55:return this._print("connect","dataChannel establish success"),e.abrupt("return",r);case 57:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"startIceConnectStandard",value:(o=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._print("connect","standard invoke. %o",t),this._iceNode=t,(i=this._pc.createDataChannel("signaling",{negotiated:!0,id:100})).binaryType="arraybuffer",this._dc=i,e.next=7,this._genIceInfo(t);case 7:return o=e.sent,a=o.offerIce,s=o.answerIce,this._offerIce=a,this._answerIce=s,FL&&aU<138&&(this._pc.addTransceiver("audio",{direction:"recvonly"}),this._pc.addTransceiver("video",{direction:"recvonly"})),e.next=15,this._pc.createOffer();case 15:if(c=e.sent,u=c.sdp){e.next=19;break}throw new kC(mC.NOT_SUPPORTED,"create offer sdp failed.");case 19:if(d=Lj.parse(u),this._answerSession=Zl({},d),l=sI(r=d.media).call(r,(function(e){return"application"===e.type})),this._peerConnectionId=s.iceUfrag||"",!a.iceUfrag&&!a.icePwd&&((p="renomination"===(null==l?void 0:l.iceOptions))||(delete a.iceOptions,delete s.iceOptions),delete a.iceUfrag,delete a.icePwd,v=mH({serverUfrag:t.iceParams.serverIceUfrag,serverPwd:t.iceParams.serverIcePwd,clientPwd:null==l?void 0:l.icePwd,options:(h={},Jl(h,_H.kICEConfigTypeSrtpDtlsType,!0),Jl(h,_H.kICEConfigTypeRenominationType,p),h)}),f=yy(v,2),_=f[0],m=f[1],this._peerConnectionId=m,s.iceUfrag=_,this._logger.info("use serverUfrag v2",zg({dtls:!0,renomination:p}))),this._offerIce.fingerprint=d.fingerprint||l.fingerprint,(g=Zl({},d)).fingerprint=this._answerIce.fingerprint,g.media=Jg(n=g.media).call(n,(function(e){if("application"===(e=Zl(Zl({},e),S._answerIce)).type&&(e.sctpmap={sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144}),FL)if(delete e.bundleOnly,e.port=9,"audio"===e.type)e.msid="ff-stream ff-stream-audio",e.direction="sendonly";else if("video"===e.type){var t,r,n,i;Rj?(e.ext=null===(t=e.ext)||void 0===t?void 0:Iy(t).call(t,(function(e){var t;return-1===SI(t=e.uri).call(t,"abs-send-time")})),e.rtcpFb=null===(r=e.rtcpFb)||void 0===r?void 0:Iy(r).call(r,(function(e){return"goog-remb"!==e.type}))):(e.rtcpFb=null===(n=e.rtcpFb)||void 0===n?void 0:Iy(n).call(n,(function(e){return"transport-cc"!==e.type})),e.ext=null===(i=e.ext)||void 0===i?void 0:Iy(i).call(i,(function(e){var t;return-1===SI(t=e.uri).call(t,"transport")}))),e.direction="sendonly"}return e})),"v1"!==this.getIceVersion()){e.next=35;break}return d.media=Jg(y=d.media).call(y,(function(e){return e=Zl(Zl({},e),S._offerIce)})),e.next=33,this.setLocalDescription(Lj.write(d));case 33:e.next=37;break;case 35:return e.next=37,this.setLocalDescription(u);case 37:return e.next=39,this.setRemoteDescription(Lj.write(g));case 39:return e.next=41,new HI((function(e,t){S._connectReject=t,i.onopen=function(){S._print("connect","dataChannel open"),S._reportRtcInvokeStatus("es.dc.open",""),e(""),delete S._connectReject},i.onerror=function(e){var t,r,n,i;S._report("rtc_signaling_msg_error",{error_code:null==e||null===(t=e.error)||void 0===t?void 0:t.sdpLineNumber,message:null==e||null===(r=e.error)||void 0===r?void 0:r.errorDetail,reason:"invalid data"}),S._reportRtcInvokeStatus("es.dc.error",""),null===(n=S._connectReject)||void 0===n||n.call(S,{message:"dc.onerror, ".concat(null===(i=e.error)||void 0===i?void 0:i.errorDetail),code:0}),S.emit("disconnect","dc onerror"),delete S._connectReject},i.onclose=function(){var e;S._reportRtcInvokeStatus("es.dc.close",""),null===(e=S._connectReject)||void 0===e||e.call(S,{message:"dc.onclose",code:1}),S.emit("disconnect","dc onclose"),delete S._connectReject},S._pc.addEventListener("connectionstatechange",(function(){var e,t;"failed"!==S._pc.iceConnectionState&&"closed"!==S._pc.iceConnectionState&&"failed"!==S._pc.connectionState||(null===(e=S._connectReject)||void 0===e||e.call(S,{message:Bg(t="pc.connectionstatechange -> ".concat(S._pc.connectionState,", ice -> ")).call(t,S._pc.iceConnectionState),code:2}),delete S._connectReject)})),setTimeout((function(){var e;null===(e=S._connectReject)||void 0===e||e.call(S,{code:4,message:"connect timeout"}),delete S._connectReject}),8e3)}));case 41:return this._print("connect","dataChannel establish success"),e.abrupt("return",i);case 43:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"setDescription",value:(i=Ng(Mg().mark((function e(t){var r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._print("setDescription","invoke."),this._offerSession.media=this._offerMlines,this._answerSession.media=this._answerMlines,r=[],this._offerMlines.forEach((function(e){"inactive"!==e.direction&&e.mid&&r.push(e.mid)})),this._offerSession.groups&&this._answerSession.groups&&(this._offerSession.groups[0].mids=r.join(" "),this._answerSession.groups[0].mids=r.join(" ")),n=oL(),t&&this._report("rtc_begin_create_offer",{direction:"local"===t.streamUserId?"up":"down",stream_id:t.streamId,stream_user_id:t.streamUserId,pc_session_id:this._peerConnectionId,vendor_mode:0}),t&&this._report("rtc_create_offer",{error_code:0,direction:"local"===t.streamUserId?"up":"down",stream_id:t.streamId,stream_user_id:t.streamUserId,elapse:oL()-n}),e.next=11,this.setLocalDescription(Lj.write(this._offerSession),t);case 11:return e.next=13,this.setRemoteDescription(Lj.write(this._answerSession),t);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setLocalDescription",value:(n=Ng(Mg().mark((function e(t,r){var n,i,o,a=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=oL(),e.prev=1,e.next=4,this._pc.setLocalDescription({type:"offer",sdp:t});case 4:this._report("rtc_set_description",{error_code:0,message:t,is_local:"1",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:(null==r?void 0:r.streamId)||"",stream_user_id:(null==r?void 0:r.streamUserId)||"",elapse:oL()-n},{type:"offer"}),this._initSctpEvents||(this._initSctpEvents=!0,(o=null===(i=this._pc)||void 0===i?void 0:i.sctp)&&(o.onstatechange=function(){a._reportRtcInvokeStatus("sctp","sctp state change TO: ".concat(o.state))},o.transport&&(o.transport.onstatechange=function(){var e;a._reportRtcInvokeStatus("dtls","dtls state change TO: ".concat(null==o||null===(e=o.transport)||void 0===e?void 0:e.state))}))),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.error("setLocal",e.t0),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+t,is_local:"1",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:"",stream_user_id:"",elapse:oL()-n},{type:"offer"});case 12:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e,t){return n.apply(this,arguments)})},{key:"setRemoteDescription",value:(r=Ng(Mg().mark((function e(t,r){var n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=oL(),e.prev=1,e.next=4,this._pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:t}));case 4:this._report("rtc_set_description",{error_code:0,message:t,is_local:"0",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:(null==r?void 0:r.streamId)||"",stream_user_id:(null==r?void 0:r.streamUserId)||"",elapse:oL()-n},{type:"answer"}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.error("setRemote",e.t0),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+t,is_local:"0",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:(null==r?void 0:r.streamId)||"",stream_user_id:(null==r?void 0:r.streamUserId)||"",elapse:oL()-n},{type:"answer"});case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,t){return r.apply(this,arguments)})},{key:"disconnect",value:function(){var e,t;null===(e=this._connectReject)||void 0===e||e.call(this,{code:3,message:"invoke destroy()"}),delete this._connectReject,this._pc.close(),null===(t=this._dc)||void 0===t||t.close(),this._pc.ontrack=null}},{key:"getIceVersion",value:function(){var e,t;return null!==(e=this._iceNode)&&void 0!==e&&e.iceParams.clientIceUfrag||null!==(t=this._iceNode)&&void 0!==t&&t.iceParams.clientIcePwd?"v1":"v2"}},{key:"createAnswerSdp",value:function(e,t){this._answerSession;var r=Zl({},this._answerSession);return r.media=e,r.groups=t,Lj.write(r)}},{key:"destroy",value:function(){this._print("destroy",this._peerConnectionId),LA(NA(c.prototype),"removeAllListeners",this).call(this),this.disconnect()}},{key:"_genIceInfo",value:(t=Ng(Mg().mark((function e(t){var r,n,i,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={iceUfrag:null===(r=t.iceParams)||void 0===r?void 0:r.clientIceUfrag,icePwd:null===(n=t.iceParams)||void 0===n?void 0:n.clientIcePwd,iceOptions:"renomination"},e.next=3,hH(t);case 3:return o=e.sent,e.abrupt("return",{offerIce:i,answerIce:o});case 5:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"_print",value:function(e){for(var t,r,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(t=this._logger).info.apply(t,Bg(r=["".concat(e)]).call(r,i))}},{key:"_report",value:function(e,t,r){var n,i,o,a;null===(n=this._monitor)||void 0===n||n.report(e,Zl(Zl({},t),{},{connection_id:this._peerConnectionId,group_connection_id:this._groupConnectionId}),Zl(Zl({},r),{},{tcp_only:null===(i=this._iceNode)||void 0===i?void 0:i.iceConfig.tcpOnly,ms_addr:zg((null===(o=this._iceNode)||void 0===o?void 0:Jg(a=o.publicIPs).call(a,(function(e){return{ip:e.ip,tcp:e.tcpPorts,udp:e.udpPorts}})))||[])}))}},{key:"_reportRtcInvokeStatus",value:function(e,t){this._report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:0,stream_id:"",elapse:0})}}],[{key:"checkSupported",value:function(){if(!RTCPeerConnection)throw new kC(mC.NOT_SUPPORTED,"missing RTCPeerConnection API.");["addTransceiver","createDataChannel","createOffer","setLocalDescription","setRemoteDescription"].forEach((function(e){var t,r;if(null===(t=RTCPeerConnection)||void 0===t||null===(r=t.prototype)||void 0===r||!r[e])throw new kC(mC.NOT_SUPPORTED,"missing peer.".concat(e," API."))}))}}]),c}(oV),qX=function(e){var t=Zl({},zX);return e.pcKillSwitch.ctor_sdpsemantics_add&&(t.sdpSemantics="unified-plan"),e.pcKillSwitch.ctor_encodedinsetablestream_add&&GX&&(t.encodedInsertableStreams=!0),t},YX=function(e){return e[e.SEND=0]="SEND",e[e.FEEDBACK=1]="FEEDBACK",e}(YX||{}),JX=function(e){return e[e.P2P=0]="P2P",e[e.SIGNAL=1]="SIGNAL",e[e.BROADCAST=2]="BROADCAST",e[e.BUSINESS_SERVER=3]="BUSINESS_SERVER",e}(JX||{}),QX=function(e){return e[e.SUCCESS=0]="SUCCESS",e[e.TIMEOUT=1]="TIMEOUT",e[e.BROKEN=2]="BROKEN",e[e.NO_RECEIVER=3]="NO_RECEIVER",e[e.NO_RELAYPATH=4]="NO_RELAYPATH",e[e.EXCEED_QPS=5]="EXCEED_QPS",e[e.SEND_TO_SERVER_ERROR=17]="SEND_TO_SERVER_ERROR",e[e.SERVER_RESPONSE_ERROR=18]="SERVER_RESPONSE_ERROR",e[e.NOT_JOIN=100]="NOT_JOIN",e[e.NOT_LOGIN=105]="NOT_LOGIN",e[e.SERVER_PARAMS_NOTSET=106]="SERVER_PARAMS_NOTSET",e[e.UNKNOWN=1e3]="UNKNOWN",e}(QX||{}),ZX=(Jl(bX={},0,[0,"success"]),Jl(bX,1,[mC.USER_MESSAGE_TIMEOUT,"timeout, failed to send."]),Jl(bX,2,[mC.USER_MESSAGE_BROKEN,"dataChannel broken, failed to send."]),Jl(bX,3,[mC.USER_MESSAGE_NO_RECEIVER,"cannot find the receiver."]),Jl(bX,4,[mC.USER_MESSAGE_NO_RECEIVER,"cannot find relay path."]),Jl(bX,5,[mC.USER_MESSAGE_EXCEED_QPS,"cannot find relay path."]),Jl(bX,17,[mC.USER_MESSAGE_SEND_TO_SERVER_ERROR,"failed to send to business server."]),Jl(bX,18,[mC.USER_MESSAGE_SERVER_RESPONSE_ERROR,"business server response error."]),Jl(bX,100,[mC.USER_MESSAGE_NOT_JOIN,"not join room"]),Jl(bX,105,[mC.USER_MESSAGE_NOT_LOGIN,"not login."]),Jl(bX,106,[mC.USER_MESSAGE_SERVER_PARAMS_NOTSET,"server param is not set."]),Jl(bX,1e3,[mC.USER_MESSAGE_UNKNOWN,"unknown."]),bX),$X=["msg"],eq=[],tq=function(e){return e[e.C2S=0]="C2S",e[e.C2C=1]="C2C",e[e.C2GW=2]="C2GW",e[e.C2CDirect=3]="C2CDirect",e[e.C2RTM=4]="C2RTM",e}(tq||{}),rq=function(e){VA(a,e);var t,r,n,i,o=tw(a);function a(e,t){var r;return Bh(this,a),Jl(sA(r=o.call(this)),"_singlingCache",new uT),Jl(sA(r),"_p2pCache",new uT),Jl(sA(r),"_rttIds",{}),Jl(sA(r),"_p2pMessageId",1),Jl(sA(r),"_clearDataChannelListener",void 0),Jl(sA(r),"_monitor",void 0),Jl(sA(r),"logger",void 0),r.id=e,r._dataChannel=t,r._clearDataChannelListener=r._handleHandler(),r._monitor=KD(e),r.logger=new lN("DataChannelSignaling",3,e),r}return Fh(a,[{key:"destroy",value:function(){var e=this;this._dataChannel&&(this._clearDataChannelListener(),this._dataChannel.close()),this._singlingCache.forEach((function(t,r){t.error(new kC(mC.OPERATION_CANCEL,"disconnect")),e._singlingCache.delete(r)})),this._singlingCache.clear(),this._p2pCache.clear(),this._p2pMessageId=1,this._rttIds={}}},{key:"sendSignaling",value:function(e,t,r){var n,i=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6e4;return null===(n=this._monitor)||void 0===n||n.report("rtc_signaling",{error_code:0,message:zg(t),signaling_event:"call-".concat(e),signaling_type:"Send",stream_id:t.streamId,stream_user_id:t.streamUserId,direction:"up"}),new HI((function(n,a){var s,c=i._genHeader(r);c.id=uL();var u=c.id.join("-"),d="customMessage"===e;d&&ND.samplingOne2ManyMsg(i.id,Number(c.id.join("")),t);var l=setTimeout((function(){i._singlingCache.delete(u),a(new kC(mC.TIME_OUT,"".concat(e," message time out"))),d&&ND.updateOne2ManyMsgAck(i.id,t,999)}),o);i._singlingCache.set(u,{signalingType:e,success:function(e){clearTimeout(l),n(e),d&&ND.updateOne2ManyMsgAck(i.id,t,0)},error:function(e){clearTimeout(l),a(e),d&&ND.updateOne2ManyMsgAck(i.id,t,e.code)}}),i.logger.info("Signal",Bg(s=">>>>>> [".concat(e,"][")).call(s,u,"]"),t),i._sendMessage(e,c,t)}))}},{key:"sendPingSignaling",value:function(){return this.sendSignaling("CheckConnectivity",{ts:Date.now()},{functionType:2})}},{key:"sendP2PMessage",value:(i=Ng(Mg().mark((function e(t,r){var n,i,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.msg,i=SD(t,$X),o=n instanceof ArrayBuffer,e.t0=this,e.t1=ND,e.t2=this.id,e.t3=Zl,e.t4=Zl({ver:1,id:this._p2pMessageId++,time:Date.now(),dir:YX.SEND,type:JX.P2P,err:QX.SUCCESS},i),e.t5={},e.t6=o,!o){e.next=15;break}return e.next=12,cL.ab2b64str(n);case 12:e.t7=e.sent,e.next=16;break;case 15:e.t7=n;case 16:return e.t8=e.t7,e.t9={binary:e.t6,msg:e.t8},e.t10=(0,e.t3)(e.t4,e.t5,e.t9),e.t11=e.t1.samplingP2PMsg.call(e.t1,e.t2,e.t10),e.t12=r,e.abrupt("return",e.t0._sendP2PMessage.call(e.t0,e.t11,e.t12));case 22:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"_sendP2PMessage",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return lL(e.msg)?this._rttIds[e.id]=e.id:e.dir===YX.SEND&&this.logger.info("_sendP2PMessage [DC Signaling p2p >>]",zg(e)),new HI((function(n,i){var o=t._genHeader(Zl(Zl({needAck:!0,functionType:1},r),{},{id:uL()}));if(e.dir===YX.SEND){var a=setTimeout((function(){t._p2pCache.delete(e.id),i(new kC(mC.USER_MESSAGE_TIMEOUT,"P2P message timeout")),ND.updateP2PMsgAck(t.id,e,999)}),12e3);t._p2pCache.set(e.id,{success:function(r,i){clearTimeout(a),n(i),ND.updateP2PMsgAck(t.id,e,0)},error:function(r){var n;clearTimeout(a),ND.updateP2PMsgAck(t.id,e,r.err);var o=yy(ZX[r.err]||[mC.USER_MESSAGE_UNKNOWN,Bg(n="err: ".concat(r.err,", msg: ")).call(n,r.msg)],2),s=o[0],c=o[1];i({err:r.err,code:s,message:r.msg||c})}})}try{t._sendMessage("p2p",o,e)}catch(s){throw s.code===mC.NOT_CONNECTED_YET&&(s.code=mC.USER_MESSAGE_BROKEN),s}}))}},{key:"_sendMessage",value:function(e,t,r){var n;if(!this._dataChannel||"open"!==this._dataChannel.readyState)throw new kC(mC.NOT_CONNECTED_YET,"DataChannel not open");var i=wU("SIGNAL_COMPRESSION")||t.zip,o=t.version+(Number(i)<<4)+(Number(t.encrypt)<<5),a=Number(t.needAck)+(Number(t.direction)<<1)+(Number(t.functionType)<<2)+(Number(t.binary)<<6),s=cL.str2ab(zg([e,r])),c=sL(Uint8Array,Bg(n=[o,a]).call(n,rR(t.id||[])),i||t.zip?vD.deflate(new Uint8Array(s)):new Uint8Array(s));try{this._dataChannel.send(c.buffer)}catch(d){var u;throw null===(u=this._monitor)||void 0===u||u.report("rtc_error",{message:"datachannel send error: ".concat(d.message),error_code:FX.DC_SEND_ERROR}),d}"p2p"===e?ND.updateP2PMsgReq(this.id,r,c.buffer.byteLength):"customMessage"===e&&ND.updateOne2ManyMsgReq(this.id,r,c.buffer.byteLength)}},{key:"_dispartData",value:function(e){var t=new Uint8Array(e),r=0,n=t[r++],i=t[r++],o={version:15&n,zip:16==(16&n),encrypt:32==(32&n),needAck:1==(1&i),direction:(2&i)>>1,functionType:(60&i)>>2,binary:64==(64&i)};if(o.needAck||1===o.direction){for(;r<=6;r++)if(128!=(128&t[r])){r++;break}o.id=WC(cI(t).call(t,2,r))}return{header:o,data:cI(t).call(t,r)}}},{key:"_feedbackSignaling",value:function(e,t,r){var n,i,o=this._genHeader({needAck:!0,direction:1,id:Jg(n=e.split("-")).call(n,(function(e){return Number(e)}))});qy(eq).call(eq,t)||this.logger.info("Signal",Bg(i=">>>>>> [".concat(t,"-res][")).call(i,e,"]"));this._sendMessage("".concat(t,"-res"),o,r)}},{key:"_handleMessage",value:(n=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c,u,d;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Date.now(),n=t.byteLength,i=this._dispartData(t),o=i.data,(a=i.header).zip&&((s=new vD.Inflate).push(o,!0),o=s.result),c=cL.ab2str(o),u=[],e.prev=8,u=JSON.parse(c),e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(8),e.t0 instanceof Error&&(null===(d=this._monitor)||void 0===d||d.report("rtc_signaling_msg_error",{error_code:-1,message:e.t0.message,reason:"message parse failed"})),e.abrupt("return");case 16:e.t1=a.functionType,e.next=0===e.t1?19:1===e.t1?21:2===e.t1?23:25;break;case 19:return this.C2S(a,u,c,n,r),e.abrupt("break",26);case 21:return this.C2C(u,n,r),e.abrupt("break",26);case 23:return this.C2GW(a,u,c),e.abrupt("break",26);case 25:return e.abrupt("break",26);case 26:case"end":return e.stop()}}),e,this,[[8,12]])}))),function(e){return n.apply(this,arguments)})},{key:"C2S",value:(r=Ng(Mg().mark((function e(t,r,n,i,o){var a,s,c,u,d;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=(null===(a=t.id)||void 0===a?void 0:a.join("-"))||"",1!==t.direction){e.next=5;break}this._handleAckMessage(s,r[0]||{},n),e.next=18;break;case 5:if(!Array.isArray(r)){e.next=18;break}if(u=r[0],r=r[1],qy(eq).call(eq,u)||this.logger.info("Signal","<<<<<< ".concat(u),r,s),this._feedbackSignaling(s,u,u===IX.ON_CUSTOM_MESSAGE?Zl(Zl({},r),{},{message:""}):""),!r.binary||"string"!=typeof r.message){e.next=14;break}return e.next=13,cL.b64str2ab(r.message,this._monitor);case 13:r.message=e.sent;case 14:d=Date.now(),this.emit(u,Zl({},r)),u===IX.ON_CUSTOM_MESSAGE&&ND.reportOne2ManyMsgRecv(this.id,r,{msg_size:i,recv_msg_ts:o,fwd_msg_ts:d}),null===(c=this._monitor)||void 0===c||c.report("rtc_signaling",{error_code:0,message:n,signaling_event:"on-".concat(u),signaling_type:"Recv",stream_id:r.streamId,stream_user_id:r.clientId,direction:"down"});case 18:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i,o){return r.apply(this,arguments)})},{key:"C2C",value:(t=Ng(Mg().mark((function e(t,r,n){var i,o,a,s,c,u,d,l,h,p,v,f,_;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Array.isArray(t)&&(t=t[1]),c=null===(i=t)||void 0===i?void 0:i.id,this._rttIds[c]||(null===(o=t)||void 0===o?void 0:o.dir)===YX.FEEDBACK||lL(null===(a=t)||void 0===a?void 0:a.msg)?delete this._rttIds[c]:this.logger.info("Signal","<<<<<< p2p response",t),e.t0=t.dir,e.next=e.t0===YX.SEND?6:e.t0===YX.FEEDBACK?46:48;break;case 6:if(u=Date.now(),lL(null===(s=t)||void 0===s?void 0:s.msg)){e.next=43;break}if(l=(d=t).binary,h=d.msg,p=d.room,v=d.to,f=d.from,_=""===p?l?IX.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM:IX.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM:l?IX.USER_BINARY_MESSAGE_RECEIVED:IX.USER_MESSAGE_RECEIVED,v){e.next=27;break}if(e.t1=this,e.t2=IX.ON_CUSTOM_MESSAGE,e.t3=f,e.t4=l,!l){e.next=21;break}return e.next=18,cL.b64str2ab(h,this._monitor);case 18:e.t5=e.sent,e.next=22;break;case 21:e.t5=h;case 22:e.t6=e.t5,e.t7={clientId:e.t3,binary:e.t4,message:e.t6},e.t1.emit.call(e.t1,e.t2,e.t7),e.next=43;break;case 27:if(e.t8=this,e.t9=_,e.t10=Zl,e.t11=Zl({},t),e.t12={},!l){e.next=38;break}return e.next=35,cL.b64str2ab(h,this._monitor);case 35:e.t13=e.sent,e.next=39;break;case 38:e.t13=h;case 39:e.t14=e.t13,e.t15={msg:e.t14},e.t16=(0,e.t10)(e.t11,e.t12,e.t15),e.t8.emit.call(e.t8,e.t9,e.t16);case 43:return this._sendP2PMessage(Zl(Zl({},t),{},{dir:YX.FEEDBACK,msg:""})),ND.reportP2PMsgRecv(this.id,t,{msg_size:r,recv_msg_ts:n,fwd_msg_ts:u}),e.abrupt("break",49);case 46:return this._handleP2PMsgFeedback(t),e.abrupt("break",49);case 48:return e.abrupt("break",49);case 49:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"C2GW",value:function(e,t,r){if(1===e.direction){var n,i=(null===(n=e.id)||void 0===n?void 0:n.join("-"))||"";this._handleAckMessage(i,t[0]||{},r)}else{var o=yy(t,2),a=o[0],s=o[1],c=void 0===s?{}:s;if("RXMediaMsg"===a){var u,d=c.type,l=c.data;switch(null===(u=this._monitor)||void 0===u||u.report("rtc_signaling",{error_code:0,message:r,signaling_event:"on-".concat(d),signaling_type:"Recv",stream_id:"",stream_user_id:"",direction:"down"}),d){case"RSCP":try{var h=JSON.parse(l);Array.isArray(h)&&this.emit(d,h)}catch(f){}break;case"RTT":try{var p=JSON.parse(l);p.length&&this.emit(d,p[0])}catch(f){}break;case"SSC":try{var v=JSON.parse(l);v.length&&this.emit(d,v[0])}catch(f){}}}}}},{key:"_handleHandler",value:function(){var e=this,t=function(t){e.logger.warn("_handleHandler","dataChannel close",t)},r=function(t){e.logger.error("_handleHandler","dataChannel error",t)},n=function(t){e._handleMessage(t.data)};return this._dataChannel.addEventListener("close",t),this._dataChannel.addEventListener("error",r),this._dataChannel.addEventListener("message",n),function(){e._dataChannel.removeEventListener("close",t),e._dataChannel.removeEventListener("error",r),e._dataChannel.removeEventListener("message",n)}}},{key:"_genHeader",value:function(){return Zl({version:2,zip:!1,encrypt:!1,needAck:!0,direction:0,functionType:0,binary:!1},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"_handleAckMessage",value:function(e,t,r){var n,i,o=this._singlingCache.get(e);o&&(this._singlingCache.delete(e),200===t.code?o.success(t):o.error(t),this.logger.info("Signal",Bg(i="<<<<<< [".concat(o.signalingType,"-ack] ")).call(i,e),t));null===(n=this._monitor)||void 0===n||n.report("rtc_signaling",{error_code:0,message:r,signaling_event:null==o?void 0:o.signalingType,signaling_type:"Ack",stream_id:"",stream_user_id:"",direction:"down"})}},{key:"_handleP2PMsgFeedback",value:function(e){var t=this._p2pCache.get(e.id);t&&(this._p2pCache.delete(e.id),e.err===QX.SUCCESS?t.success(e.id,e):t.error(e))}}]),a}(rV.EventEmitter),nq=function(e){VA(o,e);var t,r,n,i=tw(o);function o(e){var t;return Bh(this,o),Jl(sA(t=i.call(this)),"id",void 0),Jl(sA(t),"_monitor",void 0),Jl(sA(t),"logger",void 0),Jl(sA(t),"_getAccessManager",void 0),Jl(sA(t),"_connectionPool",new uT),Jl(sA(t),"_curConnection",void 0),Jl(sA(t),"_hasReportBrowerWarning",!1),Jl(sA(t),"_reconnectTimer",void 0),Jl(sA(t),"_connecting",!1),Jl(sA(t),"_isFirstTimeConnected",!0),Jl(sA(t),"_feedbackNodes",[]),Jl(sA(t),"_preIceStartTime",-1),Jl(sA(t),"_tcpOnlyTimer",void 0),Jl(sA(t),"_destroyed",!1),t._ctx=e,t.id=e.id,t._monitor=KD(t.id),t.logger=new lN("ConnectionManager",3,t.id),t.logger.info("constructor","invoke"),t._getAccessManager=new HX(e),t}return Fh(o,[{key:"connect",value:function(){var e=this;this.logger.info("connect","invoke");try{XX.checkSupported()}catch(t){this.safeEmit("disconnected",t)}this._connecting||(this._onConnectStart("init"),HI.resolve().then((function(){return e.emit("__onGetIceConfigHook")})),this._getAccess())}},{key:"reconnectByNodeChange",value:(n=Ng(Mg().mark((function e(t){var r,n,i,o,a,s;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.info("reconnectByNodeChange","invoke %o",t),o=t.nodes,a=t.reason,null===(r=this._monitor)||void 0===r||r.report("rtc_node_change",{error_code:0,message:zg(t),reason:zg(a)}),yU.clearAccessNode(this._ctx.appId),s=(null===(n=this._curConnection)||void 0===n||null===(i=n.node.publicIPs[0])||void 0===i?void 0:i.ip)||"",this._closeCurrentConnection(),this._clearConnectionPool(),this._clearReconnectTimer(),this._onConnectStart("node change"),Array.isArray(o)&&o.length>0?this._startIceConnect(o):this._getAccess([{feedbackIP:s,feedbackReason:{type:"NODE_CHANGED",reason:a}}]);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"reconnect",value:(r=Ng(Mg().mark((function e(t){var r,n=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.length>1&&void 0!==n[1]&&n[1],this.logger.info("reconnect","invoke. ".concat(r?"ICE over TCP":"")),this._closeCurrentConnection(),this._clearConnectionPool(),this._clearReconnectTimer(),this._onConnectStart(t),this._getAccess(void 0,r);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"destroy",value:function(){this.logger.info("destroy","invoke"),this._destroyed=!0,this.safeEmit("disconnected",new kC(mC.OPERATION_CANCEL,"destroy")),LA(NA(o.prototype),"removeAllListeners",this).call(this),this._clearReconnectTimer(),this._clearConnectionPool(),this._getAccessManager.destroy(),this._closeCurrentConnection()}},{key:"_getAccess",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._getAccessManager.getICENode(e).then((function(e){t.emit("__onGetIceSuccessHook",e),t._startIceConnect(e,r)})).catch((function(e){t.safeEmit("disconnected",e)})).finally((function(){t._feedbackNodes=[]}))}},{key:"_startIceConnect",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._destroyed){this.logger.info("_startIceConnect","invoke");var n=vx();this._preIceStartTime=oL();var i=this._ctx.joinRoomConfig.useTcpJoin,o=this._ctx.joinRoomConfig.useTcpJoinDelay,a=function(){var e=Ng(Mg().mark((function e(i){var o,a,s,c;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r&&((i=oX(i)).iceConfig.tcpOnly=!0),o={node:i},e.prev=2,a=new XX(t._ctx,n),o.pc=a,t._connectionPool.set(a.uuid,o),e.next=8,a.connect(i);case 8:return s=e.sent,c=new rq(t.id,s),o.signaling=c,e.next=13,c.sendPingSignaling();case 13:t._onConnectSuccess({node:i,pc:a,signaling:c,dc:s}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),t._onConnectionFailed(o,e.t0);case 19:case"end":return e.stop()}}),e,null,[[2,16]])})));return function(t){return e.apply(this,arguments)}}();this.emit("__onIceConnectStartHook"),e.forEach(a),i&&!r&&(this.logger.info("_startIceConnect","tcp-only will try after ".concat(o,"ms")),this._tcpOnlyTimer=window.setTimeout((function(){t.emit("connectWidthTcp"),e.forEach((function(e){(e=oX(e)).iceConfig.tcpOnly=!0,a(e)})),delete t._tcpOnlyTimer}),o))}}},{key:"_onConnectSuccess",value:function(e){var t,r,n,i=this;(this.logger.info("connect","peer_%s connect success.",e.pc.uuid),this.emit("__onIceConnectSuccessHook",e),this._curConnection)?(e.pc.destroy(),null===(t=e.signaling)||void 0===t||t.destroy(),this._connectionPool.delete(e.pc.uuid)):(this._curConnection=e,this._addConnectionHandler(e.pc),null===(r=this._monitor)||void 0===r||r.set({connection_id:e.pc.getConnectionId(),rtc_vid:(null===(n=e.node.iceConfig)||void 0===n?void 0:n._abtest_vid)||""}),this._connectionPool.delete(e.pc.uuid),this._feedbackNodes.forEach((function(e){return i._feedbackBySignaling(e)})),this._feedbackNodes=[],this._onConnectEnded(e))}},{key:"_onConnectionFailed",value:function(e,t){var r,n,i=this;(this.logger.info("connect","peer_%s connect failed. %s",(null===(r=e.pc)||void 0===r?void 0:r.uuid)||"",t.message),this.emit("__onIceConnectFailedHook",e),t.code!==KX.DESTROY&&t.code!==mC.OPERATION_CANCEL)&&(this._curConnection?this._feedbackBySignaling(e.node):this._feedbackNodes.push(e.node),this.logger.info("connect","remove cache node"),yU.deleteAccessNode(this._ctx.appId,e.node),e.pc&&(this._connectionPool.delete(e.pc.uuid),e.pc.destroy()),null===(n=e.signaling)||void 0===n||n.destroy());0!==this._connectionPool.size||this._curConnection||this._destroyed||(this.logger.error("connect","establish peerConnection failed"),this._checkBrowserUA(),oL()-this._preIceStartTime<1e3?(this._clearReconnectTimer(),this._reconnectTimer=window.setTimeout((function(){delete i._reconnectTimer,i._reconnectWithIceFailed(i._feedbackNodes)}),1e3)):this._reconnectWithIceFailed(this._feedbackNodes))}},{key:"_feedbackBySignaling",value:function(e){var t;null===(t=this._curConnection)||void 0===t||t.signaling.sendSignaling("scheduleMessage",{type:"feedback",body:{feedbackIP:e.publicIPs[0].ip,feedbackReason:{type:"ICE_FAILED",reason:{}}}})}},{key:"_reconnectWithIceFailed",value:(t=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._onConnectStart("ice failed"),this.logger.warn("reconnect","because of ice failed"),this._getAccess(Jg(t).call(t,(function(e){return{feedbackIP:e.publicIPs[0].ip,feedbackReason:{type:"ICE_FAILED",reason:{}}}})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_checkBrowserUA",value:function(){var e;!this._hasReportBrowerWarning&&this._ctx.joinRoomConfig.isBlackBrower()&&(this._hasReportBrowerWarning=!0,null===(e=this._monitor)||void 0===e||e.report("rtc_error",{error_code:FX.BLACK_BROWSER,message:"failed to establish data-channel, and the current browser is on the browser blacklist."}))}},{key:"_onConnectStart",value:function(e){var t;this.logger.info("_onConnectStart","invoke, reason: ".concat(e)),this._connecting=!0,this.safeEmit(this._isFirstTimeConnected?"connecting":"reconnecting");var r,n=vx();(null===(t=this._monitor)||void 0===t||t.set({connect_session_id:n}),this._isFirstTimeConnected)||(null===(r=this._monitor)||void 0===r||r.report("rtc_reconnect",{error_code:1002,message:"peerconnection reconnecting",reconnect_id:n,reconnect_type:"peerconnection"},{reason:e}))}},{key:"_onConnectEnded",value:function(e){var t;(this.logger.info("_onConnectEnded","invoke"),this._connecting=!1,this._isFirstTimeConnected)||(null===(t=this._monitor)||void 0===t||t.report("rtc_reconnected",{message:"peerconnection reconnected",reconnect_type:"peerconnection"}));this._isFirstTimeConnected=!1,this.safeEmit("connected",e),e.node.iceConfig.tcpOnly&&(this.logger.info("_onConnectEnded","use tcp only"),JD(this._ctx.id,"connected_with_tcp_only",zg(e.node))),this._tcpOnlyTimer&&(window.clearTimeout(this._tcpOnlyTimer),delete this._tcpOnlyTimer),this._clearConnectionPool()}},{key:"_addConnectionHandler",value:function(e){var t=this;e.on("disconnect",(function(e){t._closeCurrentConnection(),t._clearReconnectTimer(),navigator.onLine?t.reconnect(e):t._reconnectTimer=window.setTimeout((function(){return t.reconnect(e)}),3e3)}))}},{key:"_closeCurrentConnection",value:function(){var e,t;null===(e=this._curConnection)||void 0===e||e.pc.destroy(),null===(t=this._curConnection)||void 0===t||t.signaling.destroy(),delete this._curConnection}},{key:"_clearConnectionPool",value:function(){var e=this;this._connectionPool.forEach((function(t,r){var n,i;null===(n=t.pc)||void 0===n||n.destroy(),null===(i=t.signaling)||void 0===i||i.destroy(),e._connectionPool.delete(r)}))}},{key:"_clearReconnectTimer",value:function(){this._reconnectTimer&&(window.clearTimeout(this._reconnectTimer),delete this._reconnectTimer)}}]),o}(oV),iq=dT,oq=GI,aq=function(e,t,r,n){for(var i,o=n>1?void 0:n?oq(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&iq(t,r,o),o},sq=6e4,cq=function(e){return e.DISCONNECTED="disconnected",e.DISCONNECTING="disconnecting",e.CONNECTED="connected",e.CONNECTING="connecting",e}(cq||{}),uq=function(e,t,r){r.info(e,"userId: %o, subAudio: %o, subVideo: %o, audioMid: %o, videoMid: %o, sequenceId: %o",t.userId,t.subAudio,t.subVideo,t.audioMid,t.videoMid,t.sequenceId)},dq=function(e){VA(A,e);var t,r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I,R=tw(A);function A(e){var t;return Bh(this,A),Jl(sA(t=R.call(this)),"id",void 0),Jl(sA(t),"publicStream",!1),Jl(sA(t),"_token",void 0),Jl(sA(t),"_roomId",void 0),Jl(sA(t),"_roomAttributes",void 0),Jl(sA(t),"_vendorConfig",{enableMultiVendor:!1,vendorCode:0}),Jl(sA(t),"_clientId",void 0),Jl(sA(t),"_businessId",void 0),Jl(sA(t),"_userInfo",void 0),Jl(sA(t),"_authorization",void 0),Jl(sA(t),"_sessionId",""),Jl(sA(t),"_liveControlMessage",void 0),Jl(sA(t),"isReconnecting",!1),Jl(sA(t),"_ontrackCallbackMap",new uT),Jl(sA(t),"_subResolves",{}),Jl(sA(t),"supportConcurrent",!1),Jl(sA(t),"_handler",void 0),Jl(sA(t),"_pubSubLock",void 0),Jl(sA(t),"_joinLeaveLock",void 0),Jl(sA(t),"_state",void 0),Jl(sA(t),"_dataChannelSignal",void 0),Jl(sA(t),"_joinRoomStartTs",void 0),Jl(sA(t),"_monitor",void 0),Jl(sA(t),"logger",void 0),Jl(sA(t),"_roomProfile",Eh.communication),Jl(sA(t),"_context",void 0),Jl(sA(t),"_connectionManager",void 0),Jl(sA(t),"_joinRoom5xxTimer",void 0),Jl(sA(t),"_joinResolve",void 0),Jl(sA(t),"_joinReject",void 0),Jl(sA(t),"_pubSubBackOff",{}),t.id=e.id,t._monitor=KD(t.id),t.logger=new lN("MediaServerClient",2,t.id),t.logger.info("constructor","invoke"),t._pubSubLock=new PX("pubSubLock"),t._joinLeaveLock=new PX("joinLeaveLock"),t._state="disconnected",t._roomAttributes={multiChatMode:!1,bigRoomMode:!1},t._pubSubBackOff={},t._context=e,t._connectionManager=new nq(e),t._addConnectHandler(),t}return Fh(A,[{key:"_addSignalEventHandler",value:function(){var e,t,r=this;[IX.ON_ADD_STREAM,IX.ON_ADD_STREAM_LIST,IX.ON_REMOVE_STREAM,IX.ON_REMOVE_STREAM_LIST,IX.USER_CONNECTION,IX.USER_CONNECTION_LIST,IX.USER_DISCONNECTION,IX.USER_DISCONNECTION_LIST,IX.ON_UPDATE_STREAM_ATTRIBUTES,IX.ON_UPDATE_ROOM_ATTRIBUTES,IX.ON_PUSH_TRACK,IX.ON_REMOVE_TRACK,IX.ON_CUSTOM_MESSAGE,IX.USER_MESSAGE_RECEIVED,IX.USER_BINARY_MESSAGE_RECEIVED,IX.POST_PROCESSING_MESSAGE,IX.ON_USER_TOKEN_WILL_EXPIRE,IX.STREAM_CONTROL_MESSAGE,IX.ON_UPDATE_USER_ATTRIBUTES,IX.ON_SPEAKER_CHANGE,RX.RSCP,RX.RTT,IX.ON_STREAM_FAILED,IX.ON_NOTIFY_RECONNECT,RX.SSC,IX.ON_FORWARD_DST_ROOM_USER_KICK].forEach((function(e){var t;null===(t=r._dataChannelSignal)||void 0===t||t.on(e,(function(t){r.safeEmit(e,t)}))})),null===(e=this._dataChannelSignal)||void 0===e||e.on(IX.NODE_CHANGE,(function(e){r._connectionManager.reconnectByNodeChange(e)})),null===(t=this._dataChannelSignal)||void 0===t||t.on(IX.ON_NOTIFY_RECONNECT,(function(){r._connectionManager.reconnect("recv notifyReconnect signaling")}))}},{key:"_removeSignalEventHandler",value:function(){var e,t;null===(e=this._dataChannelSignal)||void 0===e||e.removeAllListeners(),null===(t=this._handler)||void 0===t||t.removeAllListeners()}},{key:"connectionState",get:function(){return this._state},set:function(e){this._state!==e&&(this.safeEmit(AX.ON_CONNECTION_STATE_CHANGE,{prev:this._state,next:e}),this._state=e)}},{key:"businessId",set:function(e){this._businessId=e}},{key:"setLiveControlMessage",value:function(e){this._liveControlMessage=e}},{key:"connect",value:function(){var e=this;return new HI((function(t,r){e._connectionManager.once("connected",(function(){return t()})),e._connectionManager.once("disconnected",r),e._connectionManager.connect()}))}},{key:"join",value:(I=Ng(Mg().mark((function e(t){var r,n=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("join()","info: %o",t),this._token=t.token,this._roomId=t.roomId,this._clientId=t.userInfo.userId,this._businessId=t.userInfo.businessId,this._userInfo=t.userInfo,this._roomProfile=t.roomProfile,this._reportJoinRoomStart(),e.next=10,new HI((function(e,t){n._joinResolve=e,n._joinReject=t,(n._handler?HI.resolve():n.connect()).then((function(){n._callJoinRoom()})).catch((function(e){var t=Array.isArray(e)&&e.length>0?e[0]:e;n._joinRoomFailed(t.message)}))}));case 10:return r=e.sent,e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"_callJoinRoom",value:(T=Ng(Mg().mark((function e(){var t,r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T=this,I=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=I.length>0&&void 0!==I[0]&&I[0],this.logger.info("_callJoinRoom","invoke"),e.t0=cL.token2auth(this._context.appId,this._roomId,this._clientId,this._token),e.t1=this._sessionId,e.t2=Date.now(),e.t3=this._liveControlMessage,e.t4={extra_info:this._userInfo.extraInfo,role:this._userInfo.role},e.next=9,null===(t=this._handler)||void 0===t?void 0:t.getDefaultSdp();case 9:return e.t5=e.sent,e.next=12,hj();case 12:if(e.t6=e.sent,e.t7=window.navigator.userAgent,e.t8=RU.VERSION,e.t9=yU.getDeviceId(),e.t10=this._context.appId,e.t11=this._roomId,e.t12=this._clientId,e.t13=this._businessId,e.t14=this._context.useCloudProxy,e.t15=LX[this._roomProfile]?"".concat(LX[this._roomProfile][0]):"0",e.t16={supportedCodecs:e.t6,deviceType:"web",userAgent:e.t7,sdkVersion:e.t8,deviceId:e.t9,appId:e.t10,roomId:e.t11,userId:e.t12,businessId:e.t13,enableCloudProxy:e.t14,channelProfile:e.t15},e.t17={supportTokenExpireCallBack:!0,enableSceneConfigV2:!0,enableUnBundleMode:!0,enableAudioMux:!0,enableBigRoomMode:!0,needNegotiateSDP:!0,supportMultiVendor:!0},e.t18=zg({requireICEUfragV2:!0}),i={Authorization:e.t0,sessionId:e.t1,timestamp:e.t2,controlMessage:e.t3,userAttributes:e.t4,sdpInfo:e.t5,params:e.t16,options:e.t17,accessParams:e.t18},this._context.joinRoomParams)for(o=0,a=NS(this._context.joinRoomParams);o<a.length;o++)s=yy(a[o],2),c=s[0],u=s[1],i.params[c]=u;return wU("SIGNAL_CROP_JOINROOM")&&null!==(r=i.sdpInfo)&&void 0!==r&&r.sdp&&(i.sdpInfo.sdp=yH(i.sdpInfo.sdp)),HI.resolve().then((function(){return T.emit("onSendingJoinMessageHook")})),e.prev=30,l=n?"reconnected":"joinRoom",e.next=34,this._joinRoomWithRetry(l,i);case 34:h=e.sent,this.logger.success("join","send join message success"),p=h.config||{},v=p.engine_WEB,this.connectionState="connected",this._authorization=i.Authorization,yU.setEngineWebConfig(this._context.appId,this._roomId,v),this._context&&(this._context.serverConfig={videoCodec:(null==v?void 0:v.video_codec)||"H264",audioRed:!(null==v||!v.pub_audio_red),muteReplaceUnsub:!(null===(f=h.config)||void 0===f||!f.mute_replace_unsub),simulcastOnDemand:!(!1===(null===(_=h.config)||void 0===_||null===(m=_.engine_VPM)||void 0===m||null===(g=m.ondemand)||void 0===g?void 0:g.enable)),forceUniHandler:1===(null==h||null===(y=h.config)||void 0===y||null===(S=y.vendor_param)||void 0===S?void 0:S.vendor_stream_sub_mode)},"boolean"==typeof(null==v?void 0:v.av_sync)&&(this._context.avSync=v.av_sync)),h.vendorConfig&&(this._vendorConfig=h.vendorConfig),UG.setAudioStallConfig(v),null!=h&&null!==(d=h.relayMessage)&&void 0!==d&&d.sdp&&(null===(b=this._handler)||void 0===b||b.createAVMlineAnswerTpl(h.relayMessage.sdp)),this.emit("joinSuccess",{joinRes:h,reconnect:n}),this._joinRoomSuccess(h),e.next=52;break;case 48:e.prev=48,e.t19=e.catch(30),k={461:mC.ROOM_FORBIDDEN,462:mC.USER_FORBIDDEN},(null===e.t19||void 0===e.t19?void 0:e.t19.code)>=700&&(null===e.t19||void 0===e.t19?void 0:e.t19.code)<800?this._joinRoomFailed("token_error",mC.INVALID_TOKEN):k[null===e.t19||void 0===e.t19?void 0:e.t19.code]?this._joinRoomFailed((null===e.t19||void 0===e.t19?void 0:e.t19.message)||k[null===e.t19||void 0===e.t19?void 0:e.t19.code],k[null===e.t19||void 0===e.t19?void 0:e.t19.code]):(null===e.t19||void 0===e.t19?void 0:e.t19.code)===mC.TIME_OUT&&this._context.joinRoomConfig.useTcpAfterJoinTimeout?(E="joinRoom timeout, retry with tcp only",this.logger.error("join",E),this.safeEmit(MX.ON_REJOIN_WITH_TCP),this._connectionManager.reconnect(E,!0)):e.t19.code===mC.OPERATION_CANCEL&&"connecting"===this.connectionState||this._joinRoomFailed((null===e.t19||void 0===e.t19?void 0:e.t19.message)||"signaling_error");case 52:case"end":return e.stop()}}),e,this,[[30,48]])}))),function(){return T.apply(this,arguments)})},{key:"_getVendorPubSdpInfo",value:(E=Ng(Mg().mark((function e(t){var r,n,i,o=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new XX(this._context,""),t.vendorHandler=new VX(this._context,r),t.pcSessionId&&(t.vendorHandler.peerConnectionId=t.pcSessionId),e.next=5,t.vendorHandler.publish(t);case 5:return n=e.sent,(i=t.vendorHandler).on("ice_state",(function(e){o.emit(AX.ON_VENDOR_CONNECTION_STATE_CHANGE,{state:{checking:lh.CONNECTION_STATE_CONNECTING,connected:lh.CONNECTION_STATE_CONNECTED,disconnected:lh.CONNECTION_STATE_RECONNECTING}[e],userId:o._clientId})})),i.once("disconnect",Ng(Mg().mark((function e(){var r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.removeAllListeners(),"connected"===(null===(r=o._handler)||void 0===r||null===(n=r.pc)||void 0===n?void 0:n.iceConnectionState)){e.next=4;break}return o.logger.info("vendor ice failed",t.streamId),e.abrupt("return");case 4:return e.next=6,o.unpublish(t);case 6:return e.next=8,o.publish(t);case 8:t.vendorHandler&&t.statsReport.setVar(t.vendorHandler);case 9:case"end":return e.stop()}}),e)})))),e.abrupt("return",[i,n]);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"publish",value:(k=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._publish(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"_publish",value:(b=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I,R,A,w,C,x,O,P,M,D,N,L,U,V=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("publish()","localStream: %o",t),g=t.videoTrack,y=t.audioTrack,S=oL(),b="",k="",E=this._handler,"H264"!==(null===(r=this._context)||void 0===r||null===(n=r.serverConfig)||void 0===n?void 0:n.videoCodec)){e.next=17;break}return e.next=10,yj();case 10:if(e.sent){e.next=17;break}if("VP8"!==wU("FALLBACK_ENCODE_CODEC")){e.next=16;break}this._context.serverConfig.videoCodec="VP8",e.next=17;break;case 16:throw new kC(mC.PUBLISH_FAILED,"h264 is not supported");case 17:if(!this._vendorConfig.enableMultiVendor){e.next=26;break}return e.next=20,this._getVendorPubSdpInfo(t);case 20:I=e.sent,R=yy(I,2),E=R[0],T=R[1],e.next=29;break;case 26:return e.next=28,this._handler.publish(t);case 28:T=e.sent;case 29:return null===(i=t.observer)||void 0===i||i.setHandler(E),this.emit("_test_pub_sdpInfo_",T),b=T.audioMid,k=T.videoMid,t.pubAttributes={localaudio:!!y,localvideo:!!g,videostream:t.pubVideo,audiostream:t.pubAudio,extvideo:!!(g instanceof YH),extaudio:!!(y instanceof JH),videoDescriptions:T.videoDescriptions},A={attributes:Zl({},t.pubAttributes),audio:!0,video:!0,screen:t.isScreen,audioMid:b,videoMid:k,sdpInfo:{msid:t.stream.id,type:T.type,sdp:T.partialSdp,semantics:T.semantics},peerConnectionMode:null===(o=T)||void 0===o?void 0:o.peerConnectionMode,supportMultiVendor:!0},(w=!this._vendorConfig.enableMultiVendor&&t.enableSimulcast&&(null===(a=this._context)||void 0===a||null===(s=a.serverConfig)||void 0===s?void 0:s.simulcastOnDemand)&&(null===(c=T.subVideoDescriptions)||void 0===c?void 0:c.length))&&(A.attributes.subVideoDescriptions=T.subVideoDescriptions),null!==(u=T)&&void 0!==u&&u.peerConnectionId&&(A.peerConnectionId=T.peerConnectionId),e.prev=38,this.emit("_test_pub_body_",A),e.next=42,null===(x=this._dataChannelSignal)||void 0===x?void 0:x.sendSignaling("publish",A);case 42:C=e.sent,e.next=67;break;case 45:return e.prev=45,e.t0=e.catch(38),e.t0 instanceof Error?null===(P=this._monitor)||void 0===P||P.report("rtc_publish_stat",{result:"fail",is_screen:"0",start:S,message:Bg(M="".concat(e.t0.name,": ")).call(M,e.t0.message)}):e.t0 instanceof kC&&(null===(D=this._monitor)||void 0===D||D.report("rtc_publish_stat",{result:"fail",is_screen:"0",start:S,message:Bg(N="".concat(e.t0.code,": ")).call(N,e.t0.message)})),e.next=50,null===(O=E)||void 0===O?void 0:O.rollback({msid:t.stream.id,stream:t,audioMid:b,videoMid:k});case 50:if(!(e.t0.code>=500&&e.t0.code<600)){e.next=66;break}if(this.emit("_test_pub_5xx_"),!((L=this.getPubSubBackOff(t.id)).retryDuration<6e4)){e.next=64;break}return this.logger.info("pubRetry",t.id,L.retryDuration),e.next=57,new HI((function(e){return setTimeout(e,L.interval)}));case 57:return L.retryDuration+=L.interval,L.interval=L.interval>4e3?8e3:2*L.interval,t.resetStream(),this.emit(MX.PUB_RETRY,{screen:t.isScreen}),e.abrupt("return",this._publish(t));case 64:this.logger.info("pubRetry","end"),delete this._pubSubBackOff[t.id];case 66:throw e.t0;case 67:if(null===(d=this._monitor)||void 0===d||d.report("rtc_recv_answer",{error_code:0,answer_type:null===(l=C)||void 0===l?void 0:l.relayMessage.type,sequence_id:(null===(h=C)||void 0===h||null===(p=h.relayMessage)||void 0===p?void 0:p.sequenceId)||0,message:null===(v=C)||void 0===v||null===(f=v.relayMessage)||void 0===f?void 0:f.sdp,direction:"up",stream_id:"",stream_user_id:"",pc_session_id:(null===(_=E)||void 0===_?void 0:_.peerConnectionId)||""}),U=new HI((function(e,r){var n,i,o,a,s,c,u,d;null===(n=E)||void 0===n||n.handleAck({action:XG.publish,streamId:C.streamId,audioMid:b,videoMid:k,audioTransceiverInit:null===(i=T)||void 0===i?void 0:i.audioTransceiverInit,videoTransceiverInit:null===(o=T)||void 0===o?void 0:o.videoTransceiverInit,signalingAck:{sdp:null===(a=C)||void 0===a||null===(s=a.relayMessage)||void 0===s?void 0:s.sdp,sequenceId:null===(c=C)||void 0===c||null===(u=c.relayMessage)||void 0===u?void 0:u.sequenceId},sdp:null===(d=T)||void 0===d?void 0:d.sdp,stream:t,onSuccess:function(){V.logger.info("publish()","publish success"),e(0)},onFail:function(e){V.logger.info("publish()","publish fail"),r(e)}})})),e.t1=!FL,!e.t1){e.next=73;break}return e.next=73,U;case 73:this.emit("___afterHandleAckInPub"),w&&this.emit(RX.RSCP,[{StreamIds:[t.stream.id],Metadata:{VideoIndex:0}}],!0),t.streamId=C.streamId,t.videoMid=k,t.audioMid=b,t.subVideoDescriptions=T.subVideoDescriptions,null===(m=this._monitor)||void 0===m||m.report("rtc_publish_stat",{result:"success",is_screen:"0",start:S,message:"unknown"});case 80:case"end":return e.stop()}}),e,this,[[38,45]])}))),function(e){return b.apply(this,arguments)})},{key:"updatePubTrack",value:(S=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I,R,A,w,C,x;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updatePubTrack()","localStream: %o",t),n=t.videoTrack,i=t.audioTrack,o=t.pubAudio,a=t.pubVideo,s=t.vendorHandler||this.handler,c=null==i?void 0:i.preprocessingTrack,u=null==n?void 0:n.preprocessingTrack,!a||!u){e.next=11;break}return e.next=8,null===(d=t.videoTransceiver)||void 0===d?void 0:d.sender.replaceTrack(u);case 8:this.updateVideoDescriptions(t),e.next=13;break;case 11:return e.next=13,null===(l=t.videoTransceiver)||void 0===l?void 0:l.sender.replaceTrack(null);case 13:if(null==s||s.updateMaxBitrate(t),!o||!c){e.next=21;break}return p=i.mixType,(v=i.mixedAudioTrack)&&p!==Dh.PLAYOUT&&c.enabled&&(c=v),e.next=19,null===(h=t.audioTransceiver)||void 0===h?void 0:h.sender.replaceTrack(c);case 19:e.next=24;break;case 21:return e.next=23,null===(f=t.audioTransceiver)||void 0===f?void 0:f.sender.replaceTrack(null);case 23:JD(this.id,"MediaClient.updatePubTrack(audio)","null");case 24:this.emit("___onAfterReplaceTrack");try{JD(this.id,"MediaClient.updatePubTrack",zg({audioStreamTrack:mx(c),videoStreamTrack:mx(u)}))}catch(Y$){}for(m={},g=0,y=NS(_={localaudio:!!i,localvideo:!!n,videostream:a,audiostream:o,extvideo:!!(n instanceof YH),extaudio:!!(i instanceof JH)});g<y.length;g++)S=yy(y[g],2),b=S[0],(k=S[1])!==aV(t.pubAttributes,b)&&fV(m,b,k);if(LS(m).length){e.next=31;break}return e.abrupt("return");case 31:return t.observer&&(E=t.observer,T=m.audiostream,I=m.videostream,R=m.localaudio,A=m.localvideo,w=m.extaudio,C=m.extvideo,void 0!==A?void 0!==C?E.setPushVideo(C):E.setEnableVideo(A):void 0!==I&&E.setUnmuteVideo(I),void 0!==R?void 0!==w?E.setPushAudio(w):E.setEnableAudio(R):void 0!==T&&E.setUnmuteAudio(T)),t.pubAttributes=Zl(Zl({},t.pubAttributes),_),x={roomId:this._roomId,streamId:t.streamId,attributes:m},e.next=36,null===(r=this._dataChannelSignal)||void 0===r?void 0:r.sendSignaling("updateStreamAttributes",x);case 36:if(this.emit("___onAfterUpdateSignaling"),!FL){e.next=40;break}return e.next=40,null==s?void 0:s.setCurrentDescription();case 40:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"updateToken",value:(y=Ng(Mg().mark((function e(t){var r,n,i,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updateToken()","newToken: %o",t),this._token=t,this._context.appId&&null!==(r=this._userInfo)&&void 0!==r&&r.userId&&this._roomId){e.next=4;break}return e.abrupt("return");case 4:return i={roomId:this._roomId,userId:null===(n=this._userInfo)||void 0===n?void 0:n.userId,appId:this._context.appId,token:"Bearer ".concat(t)},e.prev=5,e.next=8,null===(o=this._dataChannelSignal)||void 0===o?void 0:o.sendSignaling("updateToken",i);case 8:e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(5),new kC(mC.UPDATE_TOKEN_WITH_INVALID_TOKEN,"invoke updateToken with an invalid token");case 13:case"end":return e.stop()}}),e,this,[[5,10]])}))),function(e){return y.apply(this,arguments)})},{key:"updateVideoDescriptions",value:(g=Ng(Mg().mark((function e(t){var r,n,i,o,a;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1===t.pubAttributes.videoDescriptions.length){e.next=2;break}return e.abrupt("return");case 2:if(null!=(o=null===(r=t.videoTrack)||void 0===r||null===(n=r.preprocessingTrack)||void 0===n?void 0:n.getSettings())&&o.width&&null!=o&&o.height&&null!=o&&o.frameRate){e.next=5;break}return e.abrupt("return");case 5:if(a=t.pubAttributes.videoDescriptions[0],o.width!==a.width||o.height!==a.height||o.frameRate!==a.framerate){e.next=8;break}return e.abrupt("return");case 8:a.width=o.width,a.height=o.height,a.framerate=o.frameRate,a.maxkbps=t.videoEncodeConfig[0].maxKbps||a.maxkbps,null===(i=this._dataChannelSignal)||void 0===i||i.sendSignaling("updateStreamAttributes",{roomId:this._roomId,streamId:t.streamId,attributes:{videoDescriptions:[a]}});case 13:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"unpublish",value:(m=Ng(Mg().mark((function e(t){var r,n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("unpublish()","localStream: %o",t),n={roomId:this._roomId,initStreamId:t.initStreamId,streamId:t.streamId},null===(r=this._dataChannelSignal)||void 0===r||r.sendSignaling("unpublish",n),i=t.vendorHandler||this._handler,e.next=6,null==i?void 0:i.handleAck({action:XG.unpublish,audioMid:t.audioMid,videoMid:t.videoMid,stream:t,streamId:t.streamId});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"_getVendorSubSdpInfo",value:(_=Ng(Mg().mark((function e(t,r){var n,i,o,a=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new XX(this._context,""),t.vendorHandler=new VX(this._context,n),t.pcSessionId&&(t.vendorHandler.peerConnectionId=t.pcSessionId),(i=t.vendorHandler).on("ontrack",r),e.next=7,t.vendorHandler.subscribe(t);case 7:return o=e.sent,i.on("ice_state",(function(e){a.emit(AX.ON_VENDOR_CONNECTION_STATE_CHANGE,{state:{checking:lh.CONNECTION_STATE_CONNECTING,connected:lh.CONNECTION_STATE_CONNECTED,disconnected:lh.CONNECTION_STATE_RECONNECTING}[e],userId:t.userId})})),i.once("disconnect",Ng(Mg().mark((function e(){var r,n,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==i||i.removeAllListeners(),"connected"===(null===(r=a._handler)||void 0===r||null===(n=r.pc)||void 0===n?void 0:n.iceConnectionState)){e.next=4;break}return a.logger.info("vendor ice failed",t.streamId),e.abrupt("return");case 4:return o=t.subMediaType,e.next=7,a.unsubscribe(t);case 7:return e.next=9,a.subscribe(t,o);case 9:t.vendorHandler&&t.statsReport.setVar(t.vendorHandler),a.emit(MX.RESUBSCRIBE,{stream:t});case 11:case"end":return e.stop()}}),e)})))),e.abrupt("return",[i,o]);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return _.apply(this,arguments)})},{key:"subscribe",value:(f=Ng(Mg().mark((function e(t,r,n){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._subscribe(t,r,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return f.apply(this,arguments)})},{key:"_subscribe",value:(v=Ng(Mg().mark((function e(t,r,n){var i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I,R,A,w,C,x,O,P,M,D,N,L,U,V,F,B,j,H,G,z,K,W,X,q,Y,J,Q,Z,$,ee,te,re,ne,ie,oe=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("subscribe()","mediaType: %o",r),uq("subscribe()",t,this.logger),t.streamState=HG.SUB_ING,R=!1,A=!1,EL(r)&&(A=!0),TL(r)&&(R=!0),R||!this.multiChatMode()){e.next=9;break}return t.streamState=HG.INIT,e.abrupt("return");case 9:if(w=oL(),C=t.subVideo,x=[],this._subResolves[t.streamId]||(this._subResolves[t.streamId]=[]),x.push(new HI((function(e,r){oe._subResolves[t.streamId].push(e);var n=setTimeout((function(){return r(new kC(mC.TIME_OUT,"wait video timeout for userId: ".concat(t.userId)))}),sq);t.on("ontrack",(function r(i){"video"===i.mediaType&&(oe.logger.info("remoteStream ".concat(t.userId," received video track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),this.multiChatMode()||x.push(new HI((function(e,r){oe._subResolves[t.streamId].push(e);var n=setTimeout((function(){return r(new kC(mC.TIME_OUT,"wait audio timeout for userId: ".concat(t.userId)))}),sq);t.on("ontrack",(function r(i){"audio"===i.mediaType&&(oe.logger.info("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),O=function(e){t.ontrack(e)},null===(i=this._handler)||void 0===i||i.on("ontrack",O),this._ontrackCallbackMap.set(t,O),P=this._handler,null!==(o=this._context.serverConfig)&&void 0!==o&&o.forceUniHandler||!t.enableVendorMode){e.next=28;break}return e.next=22,this._getVendorSubSdpInfo(t,O);case 22:D=e.sent,N=yy(D,2),P=N[0],M=N[1],e.next=31;break;case 28:return e.next=30,this._handler.subscribe(t,{multiChatMode:this.multiChatMode()});case 30:M=e.sent;case 31:if(null===(a=t.observer)||void 0===a||a.setHandler(P),U=(L=M).audioMid,V=L.videoMid,t.subVideo=R,F={spatialLayer:(null==n?void 0:n.spatialLayer)||0,temporalLayer:0,spatialSubLayer:(null==n?void 0:n.spatialSubLayer)||-1},B={audio:!this.multiChatMode(),video:!0,data:!0,screen:t.isScreen,browser:"chrome-stable",videoMid:V,audioMid:U,sdpInfo:{sdp:null===(s=M)||void 0===s?void 0:s.partialSdp,semantics:null===(c=M)||void 0===c?void 0:c.semantics,type:null===(u=M)||void 0===u?void 0:u.type},streamUserId:t.userId,streamId:t.streamId,config:{enableMediaType:{audio:!!this.multiChatMode()||A,video:R},qualityLayer:F},extra:{enableSendRTT:!0},peerConnectionMode:null===(d=M)||void 0===d?void 0:d.peerConnectionMode,supportMultiVendor:!0},null!==(l=M)&&void 0!==l&&l.peerConnectionId&&(B.peerConnectionId=M.peerConnectionId),j=this._context||{},H=j.subscribeFallbackOption,G=j.userPriority,"number"==typeof H&&(B.config.fallbackOption=H),G.has(t.userId)&&(B.config.priority=G.get(t.userId)),null!==(h=M)&&void 0!==h&&h.allSsrc&&(B.extra.subscribeSSRC=M.allSsrc),null===(p=M)||void 0===p||!p.signalingAck){e.next=44;break}return e.next=44,new HI((function(e,r){var n,i,o,a;null===(n=P)||void 0===n||n.handleAck({action:XG.subscribe,streamId:t.streamId,audioMid:U,videoMid:V,audioTransceiverInit:null===(i=M)||void 0===i?void 0:i.audioTransceiverInit,videoTransceiverInit:null===(o=M)||void 0===o?void 0:o.videoTransceiverInit,signalingAck:null===(a=M)||void 0===a?void 0:a.signalingAck,stream:t,sdp:M.sdp,onSuccess:function(){oe.logger.info("ssrc","success"),e(0)},onFail:function(e){oe.logger.info("ssrc","fail",e),r(e)}})}));case 44:return e.prev=44,this.emit("_test_sub_body_",B),e.next=48,null===(K=this._dataChannelSignal)||void 0===K?void 0:K.sendSignaling("subscribe",B);case 48:z=e.sent,e.next=78;break;case 51:if(e.prev=51,e.t0=e.catch(44),t.streamState=HG.INIT,e.t0 instanceof Error&&(null===(q=this._monitor)||void 0===q||q.report("rtc_subscribe_stat",{result:"fail",start:w,message:e.t0.message,stream_user_id:t.userId})),!(e.t0.code>=500&&e.t0.code<600)){e.next=70;break}if(this.emit("_test_sub_5xx_"),!((Y=this.getPubSubBackOff(t.streamId)).retryDuration<6e4)){e.next=68;break}return this.logger.info("subRetry",t.streamId,Y.retryDuration),e.next=62,new HI((function(e){return setTimeout(e,Y.interval)}));case 62:return Y.retryDuration+=Y.interval,Y.interval=Y.interval>4e3?8e3:2*Y.interval,this.emit(MX.SUB_RETRY,{screen:t.isScreen,userId:t.userId}),e.abrupt("return",this._subscribe(t,r,n));case 68:this.logger.info("subRetry","end",t.streamId),delete this._pubSubBackOff[t.streamId];case 70:return t.subVideo=C,e.next=73,null===(W=P)||void 0===W?void 0:W.rollback({msid:t.streamId,stream:t});case 73:return J={roomId:this._roomId,streamId:t.streamId,userId:t.userId},e.next=76,null===(X=this._dataChannelSignal)||void 0===X?void 0:X.sendSignaling("unsubscribe",J).catch((function(){}));case 76:throw t.streamState=HG.INIT,e.t0;case 78:if(z.relayMessage){e.next=81;break}throw null===(Q=this._monitor)||void 0===Q||Q.report("rtc_error",{error_code:-1009,message:"relayMessage is null"}),new kC(mC.UNEXPECTED_ERROR,"unable to subscribe");case 81:if(Z=null!==(v=null===(f=z)||void 0===f?void 0:f.relayMessage)&&void 0!==v?v:{},$=Z.audioMid,ee=Z.videoMid,Jl(_={},U,$),Jl(_,V,ee),te=_,this.logger.info("sub midmap",t.userId,te),t.videoMid=V,t.audioMid=U,t.subMediaType=r,t.streamState=HG.SUB_ED,t.subLayer=F,null===(m=this._monitor)||void 0===m||m.report("rtc_recv_answer",{error_code:0,answer_type:null===(g=z)||void 0===g||null===(y=g.relayMessage)||void 0===y?void 0:y.type,sequence_id:(null===(S=z)||void 0===S||null===(b=S.relayMessage)||void 0===b?void 0:b.sequenceId)||0,message:null===(k=z)||void 0===k||null===(E=k.relayMessage)||void 0===E?void 0:E.sdp,direction:"down",stream_id:t.streamId,stream_user_id:t.userId,pc_session_id:(null===(T=P)||void 0===T?void 0:T.peerConnectionId)||""}),e.prev=90,null!==(re=M)&&void 0!==re&&re.signalingAck){e.next=94;break}return e.next=94,new HI((function(e,r){var n,i,o,a,s,c,u;null===(n=P)||void 0===n||n.handleAck({action:XG.subscribe,streamId:t.streamId,audioMid:U,videoMid:V,audioTransceiverInit:null===(i=M)||void 0===i?void 0:i.audioTransceiverInit,videoTransceiverInit:null===(o=M)||void 0===o?void 0:o.videoTransceiverInit,signalingAck:{sdp:null===(a=z)||void 0===a||null===(s=a.relayMessage)||void 0===s?void 0:s.sdp,sequenceId:null===(c=z)||void 0===c||null===(u=c.relayMessage)||void 0===u?void 0:u.sequenceId},stream:t,sdp:M.sdp,onSuccess:function(){oe.logger.info("sub ack","success"),e(0)},onFail:function(e){oe.logger.info("sub ack","fail",e),r(e)}})}));case 94:return e.next=96,HI.all(x);case 96:e.next=106;break;case 98:return e.prev=98,e.t1=e.catch(90),e.t1 instanceof Error&&(null===(ie=this._monitor)||void 0===ie||ie.report("rtc_subscribe_stat",{result:"fail",start:w,message:e.t1.message,stream_user_id:t.userId})),J={roomId:this._roomId,streamId:t.streamId,userId:t.userId},e.next=104,null===(ne=this._dataChannelSignal)||void 0===ne?void 0:ne.sendSignaling("unsubscribe",J).catch((function(){}));case 104:throw t.streamState=HG.INIT,e.t1;case 106:this.multiChatMode()||(t.subAudio=A),null===(I=this._monitor)||void 0===I||I.report("rtc_subscribe_stat",{result:"success",start:w,message:"unknown",stream_user_id:t.userId}),this._context&&t.startReport((function(e){return oe.emit("onRemoteStreamStats",e)}),P);case 109:case"end":return e.stop()}}),e,this,[[44,51],[90,98]])}))),function(e,t,r){return v.apply(this,arguments)})},{key:"controlMessage",value:(p=Ng(Mg().mark((function e(t){var r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("controlMessage()","params: %o",t),n=t,"transcode"===t.type&&(n.roomId=this._roomId),e.next=5,null===(r=this._dataChannelSignal)||void 0===r?void 0:r.sendSignaling("controlMessage",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"updateUserAttributes",value:(h=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("updateUserAttributes()","attributes: %o",t),e.next=3,null===(r=this._dataChannelSignal)||void 0===r?void 0:r.sendSignaling("updateUserAttributes",{roomId:this._roomId,sessionId:this._sessionId,attributes:t});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"updateSubTrackLayer",value:(l=Ng(Mg().mark((function e(t,r){var n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updateSubTrack()","subLayer: %o",r),t.subLayer.spatialLayer!==r.spatialLayer||t.subLayer.spatialSubLayer!==r.spatialSubLayer){e.next=4;break}return this.logger.warn("updateSubTrack()","subLayer no change"),e.abrupt("return");case 4:return i={roomId:this._roomId,streamList:[t.streamId],streamId:t.streamId,streamUserId:t.userId,config:{qualityLayer:r}},e.next=7,null===(n=this._dataChannelSignal)||void 0===n?void 0:n.sendSignaling("updateSubscribe",i);case 7:return this.emit("___afterUpdateSubscribeSend"),t.subLayer=r,e.abrupt("return",t);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"updateSubPriority",value:(d=Ng(Mg().mark((function e(t,r){var n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updateSubPriority()","priority: %o",r),t.priority!==r){e.next=4;break}return this.logger.warn("updateSubPriority()","priority no change"),e.abrupt("return",t);case 4:return i={roomId:this._roomId,streamList:[t.streamId],streamId:t.streamId,streamUserId:t.userId,config:{priority:r}},e.next=7,null===(n=this._dataChannelSignal)||void 0===n?void 0:n.sendSignaling("updateSubscribe",i);case 7:return t.priority=r,e.abrupt("return",t);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"updateSubMediaType",value:(u=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=!1,a=!1,EL(r)&&(a=!0),TL(r)&&(o=!0),s={roomId:this._roomId,streamList:[t.streamId],config:{enableMediaType:{video:o,audio:!!this.multiChatMode()||a}}},e.next=6,null===(n=this._dataChannelSignal)||void 0===n?void 0:n.sendSignaling("updateSubscribe",s);case 6:return this.multiChatMode()||(null===(c=t.observer)||void 0===c||c.setUnmuteAudio(a),t.subAudio=a),null===(i=t.observer)||void 0===i||i.setUnmuteVideo(o),t.subVideo=o,t.subMediaType=r,e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"subscribe4pushTrack",value:(c=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("subscribe4pushTrack()","streamInfo: %o",r),uq("subscribe4pushTrack()",t,this.logger),t.subAudio=!0,e.next=5,null===(n=this._handler)||void 0===n?void 0:n.subscribe(t,{multiChatMode:this.multiChatMode()});case 5:if(a=e.sent){e.next=8;break}throw new kC(mC.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 8:return s=a.audioMid,c=a.videoMid,(u=[]).push(new HI((function(e,r){var n=setTimeout((function(){return r(new kC(mC.TIME_OUT,"wait audio timeout for userId: ".concat(t.userId)))}),sq);t.on("ontrack",(function r(i){"audio"===i.mediaType&&(l.logger.success("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),d=function(e){t.ontrack(e)},null===(i=this._handler)||void 0===i||i.on("ontrack",d),this._ontrackCallbackMap.set(t,d),e.next=17,null===(o=this._handler)||void 0===o?void 0:o.handleAck({action:XG.pushtrack,streamId:t.streamId,audioMid:s,videoMid:c,stream:t,audioTransceiverInit:null==a?void 0:a.audioTransceiverInit,videoTransceiverInit:null==a?void 0:a.videoTransceiverInit,signalingAck:null==r?void 0:r.message,sdp:a.sdp});case 17:return e.next=19,HI.all(u);case 19:this._context&&t.startReport((function(e){return l.emit("onRemoteStreamStats",e)}),this._handler);case 20:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"unsubscribe4removeTrack",value:(s=Ng(Mg().mark((function e(t,r,n){var i,o,a,s,c,u,d;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(uq("unsubscribe4removeTrack()",t,this.logger),this.logger.info("unsubscribe4removeTrack()","sequenceId: ",r.sequenceId,"trackType: ",n),!(r.sequenceId<t.sequenceId)){e.next=5;break}return this.logger.warn("unsubscribe4removeTrack()","sequenceId return"),e.abrupt("return");case 5:return u=!!((c=n+1)&uh.AUDIO),d=!!(c&uh.VIDEO),e.next=10,null===(i=this._handler)||void 0===i?void 0:i.handleAck({action:XG.removetrack,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 10:null===(o=t.observer)||void 0===o||o.setPushTrack(!1),null===(a=t.observer)||void 0===a||a.setUnmuteAudio(!u),t.subAudio=!u,null===(s=t.observer)||void 0===s||s.setUnmuteVideo(!d),t.subVideo=!d,t.subMediaType=t.subMediaType-(t.subMediaType&c),t.virtual&&(t.clean(),t.resetHasSubscribed(),t.statsReport.unsubscribe());case 17:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return s.apply(this,arguments)})},{key:"unsubscribe",value:(a=Ng(Mg().mark((function e(t){var r,n,i,o,a,s;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return uq("unsubscribe()",t,this.logger),o={roomId:this._roomId,streamId:t.streamId,userId:t.userId},a=t.vendorHandler||this.handler,null===(r=this._dataChannelSignal)||void 0===r||r.sendSignaling("unsubscribe",o).catch((function(){})),t.streamState=HG.INIT,t.subVideo=!1,null===(n=t.observer)||void 0===n||n.setSubscribeVideo(!1),!this.multiChatMode()&&(null===(i=t.observer)||void 0===i||i.setSubscribeAudio(!1)),e.next=10,null==a?void 0:a.handleAck({action:XG.unsubscribe,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 10:s=e.sent,this._subResolves[s]&&this._subResolves[s].forEach((function(e){return e(0)})),this.logger.info("unsubscribe","clean unsub ".concat(t.userId)),t.clean(),t.subMediaType=TG.NONE,this.removeOnTrackListener(t),t.statsReport.unsubscribe();case 17:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"removeOnTrackListener",value:function(e){var t=this._ontrackCallbackMap.get(e);if(t){var r=e.vendorHandler||this._handler;null==r||r.off("ontrack",t),this._ontrackCallbackMap.delete(e)}}},{key:"handleRemoveStream",value:(o=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(uq("handleRemoveStream()",t,this.logger),t.subVideo=!1,t.streamState!==HG.INIT){e.next=4;break}return e.abrupt("return");case 4:this.unsubscribe(t);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"leave",value:(i=Ng(Mg().mark((function e(){var t,r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("leave()"),this._stopJoinRoom5xxRetry(),this._joinRoomFailed("leave_room"),"connected"!==this.connectionState){e.next=20;break}return t={Authorization:this._authorization,roomId:this._roomId,sessionId:this._sessionId},e.next=7,this._joinLeaveLock.lock();case 7:return r=e.sent,e.prev=8,e.next=11,null===(n=this._dataChannelSignal)||void 0===n?void 0:n.sendSignaling("leaveRoom",t);case 11:r(),e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(8),r(),e.t0;case 18:e.next=21;break;case 20:return e.abrupt("return",HI.reject(new kC(mC.NOT_CONNECTED_YET,"server not connected")));case 21:case"end":return e.stop()}}),e,this,[[8,14]])}))),function(){return i.apply(this,arguments)})},{key:"subscribePublicStream",value:(n=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(r=this._handler)||void 0===r?void 0:r.subscribe(t,{multiChatMode:!1});case 2:if(s=e.sent){e.next=5;break}throw new kC(mC.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 5:return c=oL(),u=s.audioMid,d=s.videoMid,e.t0=this._context.appId,e.t1=t.streamId,e.t2=u,e.t3=d,e.t4={sdp:null==s?void 0:s.partialSdp,semantics:null==s?void 0:s.semantics,type:null==s?void 0:s.type},e.next=15,hj();case 15:return e.t5=e.sent,e.t6=window.navigator.userAgent,e.t7=RU.VERSION,e.t8=yU.getDeviceId(),e.t9=this._context.appId,e.t10=this._businessId,e.t11=this._context.useCloudProxy,e.t12={supportedCodecs:e.t5,deviceType:"web",userAgent:e.t6,sdkVersion:e.t7,deviceId:e.t8,appId:e.t9,businessId:e.t10,enableCloudProxy:e.t11},e.t13={enableMediaType:{audio:!0,video:!0},qualityLayer:{spatialLayer:0,temporalLayer:0}},l={appId:e.t0,streamId:e.t1,audio:!0,video:!0,data:!0,audioMid:e.t2,videoMid:e.t3,sdpInfo:e.t4,params:e.t12,config:e.t13},e.next=27,null===(n=this._dataChannelSignal)||void 0===n?void 0:n.sendSignaling("startPullStream",l);case 27:return h=e.sent,p=[],this._subResolves[t.streamId]=[],p.push(new HI((function(e,r){g._subResolves[t.streamId].push(e);var n=setTimeout((function(){return r(new kC(mC.TIME_OUT,"wait video timeout for streamId: ".concat(t.streamId)))}),sq);t.on("ontrack",(function r(i){"video"===i.mediaType&&(g.logger.success("remoteStream ".concat(t.userId," received video track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),p.push(new HI((function(e,r){g._subResolves[t.streamId].push(e);var n=setTimeout((function(){return r(new kC(mC.TIME_OUT,"wait audio timeout for streamId: ".concat(t.streamId)))}),sq);t.on("ontrack",(function r(i){"audio"===i.mediaType&&(g.logger.success("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),v=function(e){t.ontrack(e)},null===(i=this._handler)||void 0===i||i.on("ontrack",v),this._ontrackCallbackMap.set(t,v),f=null==h?void 0:h.relayMessage,_=f.sequenceId,m=f.sdp,t.videoMid=d,t.audioMid=u,t.sequenceId=_,t.streamState=HG.SUB_ED,t.subAudio=!0,t.subVideo=!0,e.next=44,null===(o=this._handler)||void 0===o?void 0:o.handleAck({action:XG.subscribe,streamId:t.streamId,audioMid:u,videoMid:d,audioTransceiverInit:null==s?void 0:s.audioTransceiverInit,videoTransceiverInit:null==s?void 0:s.videoTransceiverInit,signalingAck:{sdp:m,sequenceId:_},stream:t});case 44:return e.next=46,HI.all(p);case 46:null===(a=this._monitor)||void 0===a||a.report("rtc_subscribe_stat",{result:"success",start:c,message:"unknown",stream_user_id:t.userId}),this._context&&t.startReport((function(e){return g.emit("onRemoteStreamStats",e)}),this._handler);case 48:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"unsubscribePublicStream",value:(r=Ng(Mg().mark((function e(t){var r,n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return uq("unsubscribePublicStream()",t,this.logger),n={appId:this._context.appId,streamId:t.streamId},e.prev=2,e.next=5,null===(i=this._dataChannelSignal)||void 0===i?void 0:i.sendSignaling("stopPullStream",n);case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:return t.streamState=HG.INIT,t.subVideo=!1,t.subAudio=!1,e.next=14,null===(r=this._handler)||void 0===r?void 0:r.handleAck({action:XG.unsubscribe,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 14:t.clean(),t.subMediaType=TG.NONE,this.removeOnTrackListener(t),t.statsReport.unsubscribe();case 18:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(e){return r.apply(this,arguments)})},{key:"destroy",value:function(){var e,t,r;this.logger.info("destroy()"),this._joinRoomFailed("leave_room"),this._token=void 0,this._roomId=void 0,this._clientId=void 0,this._authorization=void 0,this._sessionId="",this._pubSubBackOff={},this._stopJoinRoom5xxRetry(),null===(e=this._handler)||void 0===e||e.destroy(),this._handler=void 0,null===(t=this._dataChannelSignal)||void 0===t||t.destroy(),this._dataChannelSignal=void 0,this._connectionManager.destroy(),null===(r=this._monitor)||void 0===r||r.set({connection_id:""}),this._removeSignalEventHandler(),this.removeAllListeners(),this.connectionState="disconnected"}},{key:"sendUserMessage",value:function(e,t){var r;return null===(r=this._dataChannelSignal)||void 0===r?void 0:r.sendP2PMessage({to:e,from:this._userInfo.userId,room:this._roomId,app:this._context.appId,msg:t})}},{key:"sendRoomMessage",value:function(e){var t;return null===(t=this._dataChannelSignal)||void 0===t?void 0:t.sendSignaling("customMessage",e)}},{key:"_joinRoomWithRetry",value:function(e,t,r){var n=this;return new HI((function(i,o){n._dataChannelSignal.sendSignaling(e,t,void 0,1e4).then((function(e){n.emit("onJoinRoomAck",e),i(e)})).catch((function(a){if(r=r||new jX,a.code>=500&&a.code<600&&oL()-r.initTs<6e4){var s,c=r.getRetryDelay();return n.logger.warn("_joinRoomWithRetry",Bg(s="joinRoom failed(code: ".concat(a.code,"), will retry after ")).call(s,c,"ms")),void(n._joinRoom5xxTimer=window.setTimeout((function(){delete n._joinRoom5xxTimer,n._joinRoomWithRetry(e,t,r).then(i).catch(o)}),c))}o(a)}))}))}},{key:"_stopJoinRoom5xxRetry",value:function(){this._joinRoom5xxTimer&&(clearTimeout(this._joinRoom5xxTimer),delete this._joinRoom5xxTimer)}},{key:"_addConnectHandler",value:function(){var e=this;this._connectionManager.on("connected",(function(t){var r,n,i;e.logger.info("connectStateChange","connected"),null===(r=e._dataChannelSignal)||void 0===r||r.destroy(),null===(n=e._handler)||void 0===n||n.destroy(),e._handler=kX(e._context,t.pc),e._dataChannelSignal=t.signaling,e.supportConcurrent="chrome"===(null===(i=e._handler)||void 0===i?void 0:i.name),e._addSignalEventHandler(),e.isReconnecting&&(e.publicStream?e.emit("connectSuccess",{reconnect:!0}):(e._reportJoinRoomStart(),e._callJoinRoom(!0)))})),this._connectionManager.on("disconnected",(function(t){e.connectionState="disconnected",e.logger.error("connectStateChange","disconnected. %o",t),e.isReconnecting&&e.safeEmit(MX.RECONNECT_FAILED)})),this._connectionManager.on("connecting",(function(){var t;e.isReconnecting=!1,null===(t=e._handler)||void 0===t||t.destroy(),delete e._handler,e.connectionState="connecting",e.logger.info("connectStateChange","connecting")})),this._connectionManager.on("reconnecting",(function(){var t;e.connectionState="disconnected",e.isReconnecting=!0,null===(t=e._handler)||void 0===t||t.destroy(),delete e._handler,e.connectionState="connecting",e.logger.warn("connectStateChange","reconnecting"),e.safeEmit("reconnecting")})),this._connectionManager.on("connectWidthTcp",(function(){e.safeEmit(MX.ON_ICE_CONNECT_WITH_TCP)})),["__onGetIceConfigHook","__onIceConnectSuccessHook"].forEach((function(t){e._connectionManager.on(t,(function(){return e.emit(t)}))}))}},{key:"_reportJoinRoomStart",value:function(){var e;this._joinRoomStartTs=oL(),this.emit("__joinRoomStartReport"),null===(e=this._monitor)||void 0===e||e.report("join_room",{type:"begin",start:this._joinRoomStartTs,result:!1,reason:""},{enable_cloud_proxy:this._context.useCloudProxy,expectedIDC:this._context.expectedIDC})}},{key:"getPubSubBackOff",value:function(e){return this._pubSubBackOff[e]||(this._pubSubBackOff[e]={interval:1e3,retryDuration:0}),this._pubSubBackOff[e]}},{key:"_joinRoomSuccess",value:function(e){var t,r;(this._joinReject&&this._joinResolve&&(this._joinResolve(e),delete this._joinReject,delete this._joinResolve),this._joinRoomStartTs)&&(this.emit("__joinRoomSuccessReport"),null===(t=this._monitor)||void 0===t||t.report("join_room",{type:"end",start:this._joinRoomStartTs,result:!0,reason:""},{enable_cloud_proxy:this._context.useCloudProxy,expectedIDC:this._context.expectedIDC}),null===(r=this._monitor)||void 0===r||r.report("rtc_join_room",{error_code:0,deviceModel:"web",deviceManufacturer:"web",elapse:oL()-this._joinRoomStartTs}),delete this._joinRoomStartTs)}},{key:"_joinRoomFailed",value:function(e,t){var r;(this._joinReject&&this._joinResolve&&(this._joinReject(new kC(t||mC.JOIN_ROOM_FAILED,e)),delete this._joinReject,delete this._joinResolve),this._joinRoomStartTs)&&(this.emit("__joinRoomFailedReport"),null===(r=this._monitor)||void 0===r||r.report("join_room",{type:"end",start:this._joinRoomStartTs,result:!1,reason:e},{enable_cloud_proxy:this._context.useCloudProxy,expectedIDC:this._context.expectedIDC}),delete this._joinRoomStartTs)}},{key:"multiChatMode",value:function(){var e;return null===(e=this._roomAttributes)||void 0===e?void 0:e.multiChatMode}},{key:"sendForwardStreamSignal",value:(t=Ng(Mg().mark((function e(t,r,n){var i,o,a=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={forwardStreamType:t,roomId:r},("start"===t||"update"===t)&&(o.dstRoomInfos=null==n?void 0:Jg(n).call(n,(function(e){return{dstRoomId:e.roomId,dstToken:cL.token2auth(a._context.appId,e.roomId,a._clientId,e.token)}}))),e.abrupt("return",null===(i=this._dataChannelSignal)||void 0===i?void 0:i.sendSignaling("forwardStream",o));case 4:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"handler",get:function(){return this._handler}},{key:"roomAttributes",get:function(){return this._roomAttributes},set:function(e){this._roomAttributes=e}},{key:"vendorConfig",get:function(){return this._vendorConfig}}]),A}(oV);function lq(e,t,r){var n=r.value;return r.value=Ng(Mg().mark((function e(){var r,i,o,a=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._handler||"connected"!==this._state){e.next=6;break}for(r=a.length,i=new Array(r),o=0;o<r;o++)i[o]=a[o];return e.next=4,n.apply(this,i);case 4:e.next=7;break;case 6:throw new kC(mC.NOT_CONNECTED_YET,"error in ".concat(t,": try again after joined"));case 7:case"end":return e.stop()}}),e,this)}))),r}function hq(e,t,r){var n=r.value;return r.value=Ng(Mg().mark((function e(){var t,r,i,o,a=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._pubSubLock.lock();case 2:for(t=e.sent,this.supportConcurrent&&t(),e.prev=4,r=a.length,i=new Array(r),o=0;o<r;o++)i[o]=a[o];return e.next=8,n.apply(this,i);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,this.supportConcurrent||t(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),r}aq([function(e,t,r){var n=r.value;return r.value=Ng(Mg().mark((function e(){var t,r,i,o,a=this,s=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=s.length,r=new Array(t),i=0;i<t;i++)r[i]=s[i];return o=!1,e.abrupt("return",new HI(function(){var e=Ng(Mg().mark((function e(t,i){var s;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.on("INTERRUPT",(function(){o=!0,i(new kC(mC.OPERATION_CANCEL,"operation not finish when leave"))})),e.prev=1,e.next=4,n.apply(a,r);case 4:s=e.sent,t(s),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),o||i(e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e)}))),r}],dq.prototype,"join",1),aq([hq,lq],dq.prototype,"publish",1),aq([hq,lq],dq.prototype,"updatePubTrack",1),aq([lq],dq.prototype,"updateVideoDescriptions",1),aq([hq,lq],dq.prototype,"unpublish",1),aq([hq,lq],dq.prototype,"subscribe",1),aq([lq],dq.prototype,"controlMessage",1),aq([lq],dq.prototype,"updateUserAttributes",1),aq([lq],dq.prototype,"updateSubTrackLayer",1),aq([lq],dq.prototype,"updateSubPriority",1),aq([hq,lq],dq.prototype,"subscribe4pushTrack",1),aq([hq,lq],dq.prototype,"unsubscribe4removeTrack",1),aq([hq,lq],dq.prototype,"unsubscribe",1),aq([lq],dq.prototype,"handleRemoveStream",1),aq([hq],dq.prototype,"subscribePublicStream",1),aq([hq],dq.prototype,"unsubscribePublicStream",1);var pq,vq=function(){var e=Ng(Mg().mark((function e(t,r,n,i){var o,a,s,c,u,d,l,h,p,v,f,_,m,g;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u="",d=-1,l="video"===t?null==n||null===(o=n.videoTrack)||void 0===o?void 0:o.originTrack:null==n||null===(a=n.audioTrack)||void 0===a?void 0:a.originTrack,h="video"===t?null==n||null===(s=n.videoTransceiver)||void 0===s?void 0:s.receiver:null==n||null===(c=n.audioTransceiver)||void 0===c?void 0:c.receiver,e.prev=5,e.t0=null==r?void 0:r.pc,!e.t0){e.next=11;break}return e.next=10,Mj(null==r?void 0:r.pc,l);case 10:e.t0=e.sent;case 11:return v=e.t0,f=sI(p=v||[]).call(p,(function(e){return"inbound-rtp"===e.type})),e.next=15,null==h?void 0:h.getStats();case 15:if(_=e.sent,m=[],null==_||_.forEach((function(e){return m.push(e.type)})),null==r||!r.pc||0!==(null==v?void 0:v.length)||0===m.length){e.next=22;break}return e.next=21,Mj(r.pc);case 21:g=e.sent;case 22:u=zg({type:t,reports:Jg(v).call(v,(function(e){return e.type})),reports2:m,pc:(null==r?void 0:r.pc)||null,track:(null==l?void 0:l.id)||null,bytes:null==f?void 0:f.bytesReceived,framesReceived:null==f?void 0:f.framesReceived,packetsReceived:null==f?void 0:f.packetsReceived,allReports:g}),e.next=29;break;case 25:e.prev=25,e.t1=e.catch(5),d=-999,u=e.t1.mseeage||zg(e.t1);case 29:null==i||i.report("rtc_invoke_status",{sdk_api_name:"first_frame_recv_timeout",error_code:d,message:u,stream_id:(null==n?void 0:n.streamId)||"",stream_user_id:null==n?void 0:n.userId,elapse:0}),e.next=34;break;case 32:e.prev=32,e.t2=e.catch(0);case 34:case"end":return e.stop()}}),e,null,[[0,32],[5,25]])})));return function(t,r,n,i){return e.apply(this,arguments)}}(),fq=function(){var e=Ng(Mg().mark((function e(t,r,n,i){var o,a,s,c,u,d,l,h,p,v,f,_,m,g;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u="",d=-1,l="video"===t?null==n||null===(o=n.videoTrack)||void 0===o?void 0:o.preprocessingTrack:null==n||null===(a=n.audioTrack)||void 0===a?void 0:a.preprocessingTrack,h="video"===t?null==n||null===(s=n.videoTransceiver)||void 0===s?void 0:s.sender:null==n||null===(c=n.audioTransceiver)||void 0===c?void 0:c.sender,e.prev=5,e.t0=null==r?void 0:r.pc,!e.t0){e.next=11;break}return e.next=10,Mj(null==r?void 0:r.pc,l);case 10:e.t0=e.sent;case 11:return v=e.t0,f=sI(p=v||[]).call(p,(function(e){return"outbound-rtp"===e.type})),e.next=15,null==h?void 0:h.getStats();case 15:if(_=e.sent,m=[],null==_||_.forEach((function(e){return m.push(e.type)})),null==r||!r.pc||0!==v.length||0===m.length){e.next=22;break}return e.next=21,Mj(r.pc);case 21:g=e.sent;case 22:u=zg({type:t,reports:Jg(v).call(v,(function(e){return e.type})),reports2:m,pc:(null==r?void 0:r.pc)||null,track:(null==l?void 0:l.id)||null,bytes:null==f?void 0:f.bytesSent,framesSent:null==f?void 0:f.framesSent,packetsSent:null==f?void 0:f.packetsSent,allReports:g}),e.next=29;break;case 25:e.prev=25,e.t1=e.catch(5),d=-999,u=e.t1.mseeage||zg(e.t1);case 29:null==i||i.report("rtc_invoke_status",{sdk_api_name:"first_frame_send_timeout",error_code:d,message:u,stream_id:(null==n?void 0:n.streamId)||"",stream_user_id:null==n?void 0:n.userId,elapse:0}),e.next=34;break;case 32:e.prev=32,e.t2=e.catch(0);case 34:case"end":return e.stop()}}),e,null,[[0,32],[5,25]])})));return function(t,r,n,i){return e.apply(this,arguments)}}(),_q=function(e){VA(a,e);var t,r,n,i,o=tw(a);function a(e,t){var r;return Bh(this,a),Jl(sA(r=o.call(this)),"_audioEventSessionId",dL()),Jl(sA(r),"_videoEventSessionId",dL()),Jl(sA(r),"_handler",void 0),Jl(sA(r),"_stream",void 0),Jl(sA(r),"_firstAudioFrameTimer",void 0),Jl(sA(r),"_firstVideoFrameTimer",void 0),Jl(sA(r),"_transportDelayInterval",void 0),Jl(sA(r),"_transportDelay",void 0),Jl(sA(r),"_firstVideoFrameInterval",void 0),Jl(sA(r),"_firstAudioFrameInterval",void 0),Jl(sA(r),"_isScreen",!1),Jl(sA(r),"_audioFirstFrameState",0),Jl(sA(r),"_videoFirstFrameState",0),Jl(sA(r),"_timeout",1e4),Jl(sA(r),"_currentAudioRecv",{startTime:0,eventSessionId:0,type:"login"}),Jl(sA(r),"_currentVideoRecv",{startTime:0,eventSessionId:0,type:"login"}),Jl(sA(r),"_login",!1),Jl(sA(r),"_unMuteAudio",!1),Jl(sA(r),"_enableAudio",!1),Jl(sA(r),"_unMuteVideo",!1),Jl(sA(r),"_enableVideo",!1),Jl(sA(r),"_remoteUnmuteAudio",!1),Jl(sA(r),"_remoteUnmuteVideo",!1),Jl(sA(r),"_audioExternal",!1),Jl(sA(r),"_pushAudio",!1),Jl(sA(r),"_videoExternal",!1),Jl(sA(r),"_pushVideo",!1),Jl(sA(r),"_autoSubscribeVideo",!1),Jl(sA(r),"_autoSubscribeAudio",!1),Jl(sA(r),"_autoSubscribe",!1),Jl(sA(r),"_publishVideo",!1),Jl(sA(r),"_publishAudio",!1),Jl(sA(r),"_subscribeAudio",!1),Jl(sA(r),"_subscribeVideo",!1),Jl(sA(r),"_subscribe",!1),Jl(sA(r),"_pushTrack",!1),Jl(sA(r),"_multiChatMode",!1),Jl(sA(r),"_monitor",void 0),Jl(sA(r),"logger",void 0),r._stream=e,r._handler=t,r.getTransportDelay(),r._monitor=KD(e.engineId),r.logger=new lN("RecvFrameObserver",0,e.engineId),r}return Fh(a,[{key:"beginRecvFrame",value:(i=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelay();case 2:i=this._transportDelay,o=!0,SI(n=["login","unmute","subscribe","push_track"]).call(n,r)>=0&&(i=0,o=!1),"audio"===t?(o||this._audioEventSessionId++,this._currentAudioRecv={startTime:Date.now(),eventSessionId:this._audioEventSessionId,type:r},p={media_type:t,event_type:"begin_recv",type:r,is_screen:!(null===(a=this._stream)||void 0===a||!a.isScreen),start:null===(s=this._currentAudioRecv)||void 0===s?void 0:s.startTime,event_session_id:this._audioEventSessionId,stream_user_id:null===(c=this._stream)||void 0===c?void 0:c.userId,transport_delay:i,vendor_mode:(null===(u=this._stream)||void 0===u?void 0:u.vendorCode)||0,pc_session_id:(null===(d=this._stream)||void 0===d?void 0:d.pcSessionId)||(null===(l=this._handler)||void 0===l?void 0:l.peerConnectionId)},this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstAudioFrameTimer=window.setTimeout((function(){vq("audio",k._handler,k._stream,k._monitor),k.stopRecvFrame("audio","timeout"),k._firstAudioFrameInterval&&window.clearInterval(k._firstAudioFrameInterval)}),this._timeout),this.logger.info("rtcFirstFrameRecv",zg(p)),null===(h=this._monitor)||void 0===h||h.report("rtc_first_frame",p),this._watchForFirstAudioFrameRecv(),this._audioFirstFrameState=1,this._login=!0,this._unMuteAudio=!0,this._enableAudio=!0,this._remoteUnmuteAudio=!0):"video"===t&&(o||this._videoEventSessionId++,this._currentVideoRecv={startTime:Date.now(),eventSessionId:this._videoEventSessionId,type:r},b={media_type:t,event_type:"begin_recv",type:r,is_screen:!(null===(v=this._stream)||void 0===v||!v.isScreen),start:null===(f=this._currentVideoRecv)||void 0===f?void 0:f.startTime,event_session_id:this._videoEventSessionId,stream_user_id:null===(_=this._stream)||void 0===_?void 0:_.userId,transport_delay:i,vendor_mode:(null===(m=this._stream)||void 0===m?void 0:m.vendorCode)||0,pc_session_id:(null===(g=this._stream)||void 0===g?void 0:g.pcSessionId)||(null===(y=this._handler)||void 0===y?void 0:y.peerConnectionId)},this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstVideoFrameTimer=window.setTimeout((function(){vq("video",k._handler,k._stream,k._monitor),k.stopRecvFrame("video","timeout"),k._firstVideoFrameInterval&&window.clearInterval(k._firstVideoFrameInterval)}),this._timeout),this._watchForFirstVideoFrameRecv(),this.logger.info("rtcFirstFrameRecv",zg(b)),null===(S=this._monitor)||void 0===S||S.report("rtc_first_frame",b),this._videoFirstFrameState=1,this._login=!0,this._unMuteVideo=!0,this._enableVideo=!0,this._remoteUnmuteVideo=!0);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"stopRecvFrame",value:function(e,t){if("audio"===e){var r,n,i,o,a,s,c,u;if(1!==this._audioFirstFrameState)return;var d={event_type:"recv_end",media_type:e,is_screen:!(null===(r=this._stream)||void 0===r||!r.isScreen),start:null===(n=this._currentAudioRecv)||void 0===n?void 0:n.startTime,reason:t,result:!1,stream_user_id:null===(i=this._stream)||void 0===i?void 0:i.userId,event_session_id:this._audioEventSessionId,type:null===(o=this._currentAudioRecv)||void 0===o?void 0:o.type,vendor_mode:(null===(a=this._stream)||void 0===a?void 0:a.vendorCode)||0,pc_session_id:(null===(s=this._stream)||void 0===s?void 0:s.pcSessionId)||(null===(c=this._handler)||void 0===c?void 0:c.peerConnectionId)};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),delete this._currentAudioRecv,this.logger.info("rtcFirstFrameRecv",zg(d)),null===(u=this._monitor)||void 0===u||u.report("rtc_first_frame",d),this._audioFirstFrameState=2}else if("video"===e){var l,h,p,v,f,_,m,g;if(1!==this._videoFirstFrameState)return;var y={event_type:"recv_end",media_type:e,is_screen:!(null===(l=this._stream)||void 0===l||!l.isScreen),start:null===(h=this._currentVideoRecv)||void 0===h?void 0:h.startTime,reason:t,result:!1,stream_user_id:null===(p=this._stream)||void 0===p?void 0:p.userId,event_session_id:this._videoEventSessionId,type:null===(v=this._currentVideoRecv)||void 0===v?void 0:v.type,vendor_mode:(null===(f=this._stream)||void 0===f?void 0:f.vendorCode)||0,pc_session_id:(null===(_=this._stream)||void 0===_?void 0:_.pcSessionId)||(null===(m=this._handler)||void 0===m?void 0:m.peerConnectionId)};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),delete this._currentVideoRecv,this.logger.info("rtcFirstFrameRecv",zg(y)),null===(g=this._monitor)||void 0===g||g.report("rtc_first_frame",y),this._videoFirstFrameState=2}}},{key:"recvFrameFinish",value:(n=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelay();case 2:if(r=this._transportDelay,"audio"!==t){e.next=19;break}if(1===this._audioFirstFrameState){e.next=6;break}return e.abrupt("return");case 6:if(this._currentAudioRecv){e.next=8;break}return e.abrupt("return");case 8:d=this._currentAudioRecv,l=d.type,h=d.startTime,SI(n=["login","unmute","subscribe","push_track"]).call(n,l)>=0&&(r=0),p={event_type:"recv_end",media_type:t,start:h,result:!0,is_screen:!(null===(i=this._stream)||void 0===i||!i.isScreen),stream_user_id:null===(o=this._stream)||void 0===o?void 0:o.userId,event_session_id:this._audioEventSessionId,type:l,transport_delay:r,vendor_mode:(null===(a=this._stream)||void 0===a?void 0:a.vendorCode)||0,pc_session_id:(null===(s=this._stream)||void 0===s?void 0:s.pcSessionId)||(null===(c=this._handler)||void 0===c?void 0:c.peerConnectionId)},delete this._currentAudioRecv,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this.logger.info("rtcFirstFrameRecv",zg(p)),null===(u=this._monitor)||void 0===u||u.report("rtc_first_frame",p),this.emit("recvAudioFirstFrame"),this._audioFirstFrameState=3,e.next=33;break;case 19:if("video"!==t){e.next=33;break}if(1===this._videoFirstFrameState){e.next=22;break}return e.abrupt("return");case 22:if(this._currentVideoRecv){e.next=24;break}return e.abrupt("return");case 24:b=this._currentVideoRecv,k=b.type,E=b.startTime,SI(v=["login","unmute","subscribe","push_track"]).call(v,k)>=0&&(r=0),T={event_type:"recv_end",media_type:t,is_screen:!(null===(f=this._stream)||void 0===f||!f.isScreen),start:E,result:!0,stream_user_id:null===(_=this._stream)||void 0===_?void 0:_.userId,event_session_id:this._videoEventSessionId,type:k,transport_delay:r,vendor_mode:(null===(m=this._stream)||void 0===m?void 0:m.vendorCode)||0,pc_session_id:(null===(g=this._stream)||void 0===g?void 0:g.pcSessionId)||(null===(y=this._handler)||void 0===y?void 0:y.peerConnectionId)},delete this._currentVideoRecv,this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this.logger.info("rtcFirstFrameRecv",zg(T)),null===(S=this._monitor)||void 0===S||S.report("rtc_first_frame",T),this.emit("recvVideoFirstFrame"),this._videoFirstFrameState=3;case 33:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"setLogin",value:function(e){var t,r,n,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{audio:!0,video:!0};this._login!==e&&(this._login=e,e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&o.audio&&this.beginRecvFrame("audio","login"),e&&null!==(r=this._stream)&&void 0!==r&&r.hasVideo&&o.video&&this.beginRecvFrame("video","login"),!e&&null!==(n=this._stream)&&void 0!==n&&n.hasAudio&&this.stopRecvFrame("audio","leave_room"),!e&&null!==(i=this._stream)&&void 0!==i&&i.hasVideo&&this.stopRecvFrame("video","leave_room"))}},{key:"setUnmuteAudio",value:function(e){var t,r,n;if(this._unMuteAudio!==e){this._unMuteAudio=e;var i=!(null===(t=this._stream)||void 0===t||!t.hasAudio);null!==(r=this._stream)&&void 0!==r&&r.audioHasCapture&&null!==(n=this._stream)&&void 0!==n&&n.audioHasPublish&&(this._unMuteAudio&&i?this.beginRecvFrame("audio","unmute"):i&&this.stopRecvFrame("audio","mute"))}}},{key:"setRemoteUnmuteAudio",value:function(e){this._remoteUnmuteAudio!==e&&(this._remoteUnmuteAudio=e,this._remoteUnmuteAudio?this.beginRecvFrame("audio","remote_unmute"):this.stopRecvFrame("audio","remote_mute"))}},{key:"setEnableAudio",value:function(e){this._enableAudio!==e&&(this._enableAudio=e,this._enableAudio?this.beginRecvFrame("audio","enable"):this.stopRecvFrame("audio","disable"))}},{key:"setUnmuteVideo",value:function(e){var t,r,n;if(this._unMuteVideo!==e){this._unMuteVideo=e;var i=!(null===(t=this._stream)||void 0===t||!t.hasVideo);null!==(r=this._stream)&&void 0!==r&&r.videoHasCapture&&null!==(n=this._stream)&&void 0!==n&&n.videoHasPublish&&(this._unMuteVideo&&i?this.beginRecvFrame("video","unmute"):i&&this.stopRecvFrame("video","mute"))}}},{key:"setHandler",value:function(e){this._handler=e}},{key:"setRemoteUnmuteVideo",value:function(e){this._remoteUnmuteVideo!==e&&(this._remoteUnmuteVideo=e,this._remoteUnmuteVideo?this.beginRecvFrame("video","remote_unmute"):this.stopRecvFrame("video","remote_mute"))}},{key:"setEnableVideo",value:function(e){this._enableVideo!==e&&(this._enableVideo=e,this._enableVideo?this.beginRecvFrame("video","enable"):this.stopRecvFrame("video","disable"))}},{key:"setExternalAudioSource",value:function(e){this._audioExternal=e}},{key:"setPushAudio",value:function(e){var t;this._audioExternal&&this._pushAudio!==e&&(this._pushAudio=e),this._pushAudio&&this.beginRecvFrame("audio","push"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame("audio","stop_push")}},{key:"setExternalVideoSource",value:function(e){this._videoExternal=e}},{key:"setPushVideo",value:function(e){var t;this._videoExternal&&this._pushVideo!==e&&(this._pushVideo=e),this._pushVideo&&this.beginRecvFrame("video","push"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasVideo&&this.stopRecvFrame("video","stop_push")}},{key:"setPublishVideo",value:function(e){var t;this._publishVideo!==e&&(this._publishVideo=e),this._publishVideo&&this.beginRecvFrame("video","publish"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasVideo&&this.stopRecvFrame("video","unpublish")}},{key:"setPublishAudio",value:function(e){var t;this._publishAudio!==e&&(this._publishAudio=e),this._publishAudio&&this.beginRecvFrame("audio","publish"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame("audio","unpublish")}},{key:"setAutoSubscribe",value:function(e){this._autoSubscribe=e}},{key:"setAutoSubscribeVideo",value:function(e){this._autoSubscribeVideo=e}},{key:"setAutoSubscribeAudio",value:function(e){this._autoSubscribeAudio=e}},{key:"setSubscribeAudio",value:function(e){var t,r;this._autoSubscribeAudio||this._subscribeAudio===e||(this._subscribe=e,e&&null!==(r=this._stream)&&void 0!==r&&r.hasAudio&&this.beginRecvFrame("audio","subscribe"));!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame("audio","unsubscribe")}},{key:"setSubscribeVideo",value:function(e){var t,r;this._autoSubscribeVideo||this._subscribeVideo===e||(this._subscribeVideo=e,e&&null!==(r=this._stream)&&void 0!==r&&r.hasVideo&&this.beginRecvFrame("video","subscribe"));!e&&null!==(t=this._stream)&&void 0!==t&&t.hasVideo&&this.stopRecvFrame("video","unsubscribe")}},{key:"setPushTrack",value:function(e){var t;this._pushTrack!==e&&(this._pushTrack=e,e&&!this._isScreen&&this.beginRecvFrame("audio","push_track"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame("audio","remove_track"))}},{key:"setMultiChatMode",value:function(e){this._multiChatMode=e}},{key:"setTimeout",value:function(e){this._timeout=e}},{key:"_watchForFirstVideoFrameRecv",value:function(){var e=this,t=-1,r=-1;this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._firstVideoFrameInterval=window.setInterval(Ng(Mg().mark((function n(){var i,o,a,s,c,u,d,l;return Mg().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null===(i=e._handler)||void 0===i||!i.pc||null===(o=e._stream)||void 0===o||null===(a=o.videoTrack)||void 0===a||!a.preprocessingTrack){n.next=12;break}return n.next=3,Mj(null===(s=e._handler)||void 0===s?void 0:s.pc,null===(c=e._stream)||void 0===c||null===(u=c.videoTrack)||void 0===u?void 0:u.preprocessingTrack);case 3:if(d=n.sent,!(l=sI(d).call(d,(function(e){return"inbound-rtp"===e.type})))||!(l.framesReceived>t||l.packetsReceived>r)){n.next=12;break}if(-1!==t||-1!==r){n.next=10;break}return t=l.framesReceived,r=l.packetsReceived,n.abrupt("return");case 10:e.recvFrameFinish("video"),window.clearInterval(e._firstVideoFrameInterval);case 12:case"end":return n.stop()}}),n)}))),200)}},{key:"_watchForFirstAudioFrameRecv",value:function(){var e=this,t=-1,r=-1;this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstAudioFrameInterval=window.setInterval(Ng(Mg().mark((function n(){var i,o,a,s,c,u,d,l;return Mg().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null===(i=e._handler)||void 0===i||!i.pc||null===(o=e._stream)||void 0===o||null===(a=o.audioTrack)||void 0===a||!a.originTrack){n.next=12;break}return n.next=3,Mj(null===(s=e._handler)||void 0===s?void 0:s.pc,null===(c=e._stream)||void 0===c||null===(u=c.audioTrack)||void 0===u?void 0:u.originTrack);case 3:if(d=n.sent,!(l=sI(d).call(d,(function(e){return"inbound-rtp"===e.type})))||!(l.totalSamplesReceived>t||l.packetsReceived>r)){n.next=12;break}if(-1!==t||-1!==r){n.next=10;break}return t=l.totalSamplesReceived,r=l.packetsReceived,n.abrupt("return");case 10:e.recvFrameFinish("audio"),window.clearInterval(e._firstAudioFrameInterval);case 12:case"end":return n.stop()}}),n)}))),200)}},{key:"getTransportDelay",value:(r=Ng(Mg().mark((function e(){var t=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelayIntl();case 2:window.clearInterval(this._transportDelayInterval),this._transportDelayInterval=window.setInterval(Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getTransportDelayIntl();case 2:case"end":return e.stop()}}),e)}))),2e3);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getTransportDelayIntl",value:(t=Ng(Mg().mark((function e(){var t,r,n,i,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this._handler)||void 0===t||!t.pc){e.next=7;break}return e.next=3,Mj(null===(r=this._handler)||void 0===r?void 0:r.pc);case 3:n=e.sent,i=sI(n).call(n,(function(e){return"transport"===e.type&&"connected"===e.dtlsState})),(o=sI(n).call(n,(function(e){return"candidate-pair"===e.type&&"succeeded"===e.state&&e.id===(null==i?void 0:i.selectedCandidatePairId)})))&&(this._transportDelay=Math.round(1e3*o.currentRoundTripTime/2));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setDisconnect",value:function(){this.stopRecvFrame("audio","connection_lost"),this.stopRecvFrame("video","connection_lost"),this.reset()}},{key:"reset",value:function(){this._currentAudioRecv={startTime:0,eventSessionId:0,type:"login"},this._currentVideoRecv={startTime:0,eventSessionId:0,type:"login"},this._login=!1,this._unMuteAudio=!1,this._enableAudio=!1,this._unMuteVideo=!1,this._remoteUnmuteAudio=!1,this._remoteUnmuteVideo=!1,this._enableVideo=!1,this._audioExternal=!1,this._pushAudio=!1,this._videoExternal=!1,this._pushVideo=!1,this._autoSubscribeVideo=!1,this._autoSubscribeAudio=!1,this._autoSubscribe=!1,this._subscribeAudio=!1,this._subscribeVideo=!1,this._subscribe=!1,this._pushTrack=!1,this._multiChatMode=!1,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._transportDelayInterval&&window.clearInterval(this._transportDelayInterval)}},{key:"audioFirstFrameReceived",get:function(){return 3===this._audioFirstFrameState}},{key:"FirstFrameReceived",get:function(){return 3===this._audioFirstFrameState}}]),a}(rV.EventEmitter),mq=function(){function e(t,r){Bh(this,e),Jl(this,"_audioEventSessionId",dL()),Jl(this,"_videoEventSessionId",dL()),Jl(this,"_pcSessionId",void 0),Jl(this,"_handler",void 0),Jl(this,"_firstAudioFrameTimer",void 0),Jl(this,"_firstVideoFrameTimer",void 0),Jl(this,"_stream",void 0),Jl(this,"_firstVideoFrameInterval",void 0),Jl(this,"_firstAudioFrameInterval",void 0),Jl(this,"_currentAudioSend",{startTime:0,eventSessionId:0,type:"login"}),Jl(this,"_currentVideoSend",{startTime:0,eventSessionId:0,type:"login"}),Jl(this,"_login",!1),Jl(this,"_publisher",!1),Jl(this,"_unMuteAudio",!1),Jl(this,"_enableAudio",!1),Jl(this,"_unMuteVideo",!1),Jl(this,"_enableVideo",!1),Jl(this,"_audioExternal",!1),Jl(this,"_pushAudio",!1),Jl(this,"_videoExternal",!1),Jl(this,"_pushVideo",!1),Jl(this,"_autoPublish",!1),Jl(this,"_publish",!1),Jl(this,"_timeout",1e4),Jl(this,"_audioFirstFrameState",0),Jl(this,"_videoFirstFrameState",0),Jl(this,"_monitor",void 0),Jl(this,"logger",void 0),this._stream=t,this._handler=r,this._monitor=KD(t.engineId),this.logger=new lN("SendFrameObserver",0,t.engineId)}var t,r;return Fh(e,[{key:"beginSendFrame",value:function(e,t){var r=this;if("audio"===e){var n,i,o,a,s,c,u;this._audioEventSessionId++,this._currentAudioSend={startTime:Date.now(),eventSessionId:this._audioEventSessionId,type:t};var d={event_type:"begin_send",media_type:e,is_screen:!(null===(n=this._stream)||void 0===n||!n.isScreen),type:t,start:this._currentAudioSend.startTime,event_session_id:this._audioEventSessionId,vendor_mode:(null===(i=this._stream)||void 0===i?void 0:i.vendorCode)||0,pc_session_id:(null===(o=this._stream)||void 0===o?void 0:o.pcSessionId)||(null===(a=this._handler)||void 0===a?void 0:a.peerConnectionId),capture_session_id:null===(s=this._stream)||void 0===s||null===(c=s.audioTrack)||void 0===c?void 0:c.captureSessionId};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstAudioFrameTimer=window.setTimeout((function(){fq("audio",r._handler,r._stream,r._monitor),r.stopSendFrame("audio","timeout"),r._firstAudioFrameInterval&&window.clearInterval(r._firstAudioFrameInterval)}),this._timeout),this.logger.info("rtcFirstFrameSend",zg(d)),null===(u=this._monitor)||void 0===u||u.report("rtc_first_frame",d),this._watchForFirstAudioFrameSend(),this._audioFirstFrameState=1,this._login=!0,this._publisher=!0,this._publish=!0,this._unMuteAudio=!0,this._pushAudio||(this._enableAudio=!0)}else if("video"===e){var l,h,p,v,f,_,m;this._videoEventSessionId++,this._currentVideoSend={startTime:Date.now(),eventSessionId:this._videoEventSessionId,type:t};var g={event_type:"begin_send",media_type:e,is_screen:!(null===(l=this._stream)||void 0===l||!l.isScreen),type:t,start:this._currentVideoSend.startTime,event_session_id:this._videoEventSessionId,vendor_mode:(null===(h=this._stream)||void 0===h?void 0:h.vendorCode)||0,pc_session_id:(null===(p=this._stream)||void 0===p?void 0:p.pcSessionId)||(null===(v=this._handler)||void 0===v?void 0:v.peerConnectionId),capture_session_id:null===(f=this._stream)||void 0===f||null===(_=f.videoTrack)||void 0===_?void 0:_.captureSessionId};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstVideoFrameTimer=window.setTimeout((function(){fq("video",r._handler,r._stream,r._monitor),r.stopSendFrame("video","timeout"),r._firstVideoFrameInterval&&window.clearInterval(r._firstVideoFrameInterval)}),this._timeout),this._watchForFirstVideoFrameSend(),this.logger.info("rtcFirstFrameSend",zg(g)),null===(m=this._monitor)||void 0===m||m.report("rtc_first_frame",g),this._videoFirstFrameState=1,this._login=!0,this._publisher=!0,this._publish=!0,this._unMuteVideo=!0,this._pushVideo||(this._enableVideo=!0)}}},{key:"stopSendFrame",value:function(e,t){if("audio"===e){var r,n,i,o,a,s,c,u,d;if(1!==this._audioFirstFrameState)return;var l={event_type:"sent_end",media_type:e,is_screen:!(null===(r=this._stream)||void 0===r||!r.isScreen),start:null===(n=this._currentAudioSend)||void 0===n?void 0:n.startTime,reason:t,result:!1,event_session_id:this._audioEventSessionId,type:null===(i=this._currentAudioSend)||void 0===i?void 0:i.type,vendor_mode:(null===(o=this._stream)||void 0===o?void 0:o.vendorCode)||0,pc_session_id:(null===(a=this._stream)||void 0===a?void 0:a.pcSessionId)||(null===(s=this._handler)||void 0===s?void 0:s.peerConnectionId),capture_session_id:null===(c=this._stream)||void 0===c||null===(u=c.audioTrack)||void 0===u?void 0:u.captureSessionId};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),delete this._currentAudioSend,this.logger.info("rtcFirstFrameSend",zg(l)),null===(d=this._monitor)||void 0===d||d.report("rtc_first_frame",l),this._audioFirstFrameState=2}else if("video"===e){var h,p,v,f,_,m,g,y,S;if(1!==this._videoFirstFrameState)return;var b={event_type:"sent_end",media_type:e,start:null===(h=this._currentVideoSend)||void 0===h?void 0:h.startTime,is_screen:!(null===(p=this._stream)||void 0===p||!p.isScreen),reason:t,result:!1,event_session_id:this._videoEventSessionId,type:null===(v=this._currentVideoSend)||void 0===v?void 0:v.type,vendor_mode:(null===(f=this._stream)||void 0===f?void 0:f.vendorCode)||0,pc_session_id:(null===(_=this._stream)||void 0===_?void 0:_.pcSessionId)||(null===(m=this._handler)||void 0===m?void 0:m.peerConnectionId),capture_session_id:null===(g=this._stream)||void 0===g||null===(y=g.videoTrack)||void 0===y?void 0:y.captureSessionId};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),delete this._currentVideoSend,this.logger.info("rtcFirstFrameSend",zg(b)),null===(S=this._monitor)||void 0===S||S.report("rtc_first_frame",b),this._videoFirstFrameState=2}}},{key:"sendFrameFinish",value:function(e){if("audio"===e){var t,r,n,i,o,a,s;if(1!==this._audioFirstFrameState)return;if(!this._currentAudioSend)return;var c=this._currentAudioSend,u=c.type,d=c.startTime,l={event_type:"sent_end",media_type:e,is_screen:!(null===(t=this._stream)||void 0===t||!t.isScreen),start:d,result:!0,event_session_id:this._audioEventSessionId,type:u,vendor_mode:(null===(r=this._stream)||void 0===r?void 0:r.vendorCode)||0,pc_session_id:(null===(n=this._stream)||void 0===n?void 0:n.pcSessionId)||(null===(i=this._handler)||void 0===i?void 0:i.peerConnectionId),capture_session_id:null===(o=this._stream)||void 0===o||null===(a=o.audioTrack)||void 0===a?void 0:a.captureSessionId};delete this._currentAudioSend,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this.logger.info("rtcFirstFrameSend",zg(l)),null===(s=this._monitor)||void 0===s||s.report("rtc_first_frame",l),this._audioFirstFrameState=3}else if("video"===e){var h,p,v,f,_,m,g;if(1!==this._videoFirstFrameState)return;if(!this._currentVideoSend)return;var y=this._currentVideoSend,S=y.type,b=y.startTime,k={event_type:"sent_end",media_type:e,is_screen:!(null===(h=this._stream)||void 0===h||!h.isScreen),start:b,result:!0,event_session_id:this._videoEventSessionId,type:S,vendor_mode:(null===(p=this._stream)||void 0===p?void 0:p.vendorCode)||0,pc_session_id:(null===(v=this._stream)||void 0===v?void 0:v.pcSessionId)||(null===(f=this._handler)||void 0===f?void 0:f.peerConnectionId),capture_session_id:null===(_=this._stream)||void 0===_||null===(m=_.videoTrack)||void 0===m?void 0:m.captureSessionId};delete this._currentVideoSend,this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this.logger.info("rtcFirstFrameSend",zg(k)),null===(g=this._monitor)||void 0===g||g.report("rtc_first_frame",k),this._videoFirstFrameState=3}}},{key:"setLogin",value:function(e){if(this._login!==e){var t,r;if(this._login=e,e)null!==(t=this._stream)&&void 0!==t&&t.videoTrack&&this._stream.pubVideo&&this.beginSendFrame("video","login"),null!==(r=this._stream)&&void 0!==r&&r.audioTrack&&this._stream.pubAudio&&this.beginSendFrame("audio","login");!e&&this._audioSending&&this.stopSendFrame("audio","leave_room"),!e&&this._videoSending&&this.stopSendFrame("video","leave_room")}}},{key:"setPublish",value:function(e){if(this._publish!==e){var t,r;if(this._publish=e,e)(null===(t=this._stream)||void 0===t?void 0:t.videoTrack)&&this._stream.pubVideo&&this.beginSendFrame("video","publish"),(null===(r=this._stream)||void 0===r?void 0:r.audioTrack)&&this._stream.pubAudio&&this.beginSendFrame("audio","publish");!e&&this._audioSending&&this.stopSendFrame("audio","unpublish"),!e&&this._videoSending&&this.stopSendFrame("video","unpublish")}}},{key:"setUnmuteAudio",value:function(e){var t;this._unMuteAudio!==e&&(this._unMuteAudio=e,null!==(t=this._stream)&&void 0!==t&&t.audioHasCapture&&(e&&this.beginSendFrame("audio","unmute"),!e&&this._audioSending&&this.stopSendFrame("audio","mute")))}},{key:"setEnableAudio",value:function(e){var t;this._enableAudio!==e&&null!==(t=this._stream)&&void 0!==t&&t.pubAudio&&(this._enableAudio=e,e&&this.beginSendFrame("audio","enable"),!e&&this._audioSending&&this.stopSendFrame("audio","disable"))}},{key:"setUnmuteVideo",value:function(e){var t;this._unMuteVideo!==e&&(this._unMuteVideo=e,null!==(t=this._stream)&&void 0!==t&&t.videoHasCapture&&(e&&this.beginSendFrame("video","unmute"),!e&&this._videoSending&&this.stopSendFrame("video","mute")))}},{key:"setEnableVideo",value:function(e){var t;this._enableVideo!==e&&null!==(t=this._stream)&&void 0!==t&&t.pubVideo&&(this._enableVideo=e,e&&this.beginSendFrame("video","enable"),!e&&this._videoSending&&this.stopSendFrame("video","disable"))}},{key:"setPushAudio",value:function(e){this._pushAudio!==e&&(this._pushAudio=e,e&&this.beginSendFrame("audio","push"),!e&&this._audioSending&&this.stopSendFrame("audio","stop_push"))}},{key:"setPushVideo",value:function(e){this._pushVideo!==e&&(this._pushVideo=e,e&&this.beginSendFrame("video","push"),!e&&this._videoSending&&this.stopSendFrame("video","stop_push"))}},{key:"setAutoPublish",value:function(e){this._autoPublish=e}},{key:"setPublisher",value:function(e){this._publisher!==e&&(this._publisher=e,!e&&this._audioSending&&this.stopSendFrame("audio","audience"),!e&&this._videoSending&&this.stopSendFrame("video","audience"))}},{key:"setDisconnect",value:function(){this._audioSending&&this.stopSendFrame("audio","connection_lost"),this._videoSending&&this.stopSendFrame("video","connection_lost"),this.reset()}},{key:"setTimeout",value:function(e){this._timeout=e}},{key:"setPCSessionId",value:function(e){this._pcSessionId=e}},{key:"setHandler",value:function(e){this._handler=e}},{key:"_getFirstVideoFrameStats",value:(r=Ng(Mg().mark((function e(){var t,r,n,i,o,a,s;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this._handler)||void 0===t||!t.pc||null===(r=this._stream)||void 0===r||null===(n=r.videoTrack)||void 0===n||!n.preprocessingTrack){e.next=6;break}return e.next=3,Mj(null===(i=this._handler)||void 0===i?void 0:i.pc,null===(o=this._stream)||void 0===o?void 0:o.videoTrack.preprocessingTrack);case 3:return a=e.sent,s=Iy(a).call(a,(function(e){return"outbound-rtp"===e.type})),e.abrupt("return",s);case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_getFirstAudioFrameStats",value:(t=Ng(Mg().mark((function e(){var t,r,n,i,o,a;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this._handler)||void 0===t||!t.pc||null===(r=this._stream)||void 0===r||null===(n=r.audioTrack)||void 0===n||!n.preprocessingTrack){e.next=5;break}return e.next=3,Mj(null===(i=this._handler)||void 0===i?void 0:i.pc,null===(o=this._stream)||void 0===o?void 0:o.audioTrack.preprocessingTrack);case 3:return a=e.sent,e.abrupt("return",sI(a).call(a,(function(e){return"outbound-rtp"===e.type})));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_watchForFirstVideoFrameSend",value:function(){var e=this,t=-1,r=-1;this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._firstVideoFrameInterval=window.setInterval(Ng(Mg().mark((function n(){var i,o,a;return Mg().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e._getFirstVideoFrameStats();case 2:if(i=n.sent,o=0,a=0,null==i||Jg(i).call(i,(function(e){o+=e.framesSent,a+=e.packetsSent})),!(i&&i.length>0&&(o>t||a>r))){n.next=12;break}if(-1!==t||-1!==r){n.next=10;break}return t=o,r=a,n.abrupt("return");case 10:e.sendFrameFinish("video"),window.clearInterval(e._firstVideoFrameInterval);case 12:case"end":return n.stop()}}),n)}))),100)}},{key:"_watchForFirstAudioFrameSend",value:function(){var e=this,t=-1;this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstAudioFrameInterval=window.setInterval(Ng(Mg().mark((function r(){var n;return Mg().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e._getFirstAudioFrameStats();case 2:if(!((n=r.sent)&&n.packetsSent>t)){r.next=9;break}if(-1!==t){r.next=7;break}return t=n.packetsSent,r.abrupt("return");case 7:e.sendFrameFinish("audio"),window.clearInterval(e._firstAudioFrameInterval);case 9:case"end":return r.stop()}}),r)}))),100)}},{key:"reset",value:function(){this._login=!1,this._publisher=!1,this._unMuteAudio=!1,this._enableAudio=!1,this._unMuteVideo=!1,this._enableVideo=!1,this._audioExternal=!1,this._pushAudio=!1,this._videoExternal=!1,this._pushVideo=!1,this._autoPublish=!1,this._publish=!1,this._audioFirstFrameState=0,this._videoFirstFrameState=0,this._currentAudioSend={startTime:0,eventSessionId:0,type:"login"},this._currentVideoSend={startTime:0,eventSessionId:0,type:"login"},window.clearTimeout(this._firstAudioFrameTimer),window.clearTimeout(this._firstVideoFrameTimer),window.clearInterval(this._firstAudioFrameInterval),window.clearInterval(this._firstVideoFrameInterval)}},{key:"destroy",value:function(){this.reset(),delete this._stream,delete this._handler}},{key:"_audioSending",get:function(){return 1===this._audioFirstFrameState}},{key:"_videoSending",get:function(){return 1===this._videoFirstFrameState}}]),e}(),gq=(Jl(pq={},"audio",{delay:1200,stallRadio:.3}),Jl(pq,"video",{delay:1200,stallRadio:.6}),Jl(pq,"screen_audio",{delay:1600,stallRadio:.8}),Jl(pq,"screen_video",{delay:1600,stallRadio:.8}),pq),yq=function(){function e(){Bh(this,e),Jl(this,"_preUplinkStats",new uT),Jl(this,"_preDownlinkStats",new uT),Jl(this,"_timer",void 0),Jl(this,"_delayTimer",void 0),Jl(this,"_msc",void 0),Jl(this,"reportor",void 0)}return Fh(e,[{key:"updateUplinkStats",value:function(e){var t=e.audioStats,r=e.videoStats,n=e.isScreen;if(t.sendKBitrate>0&&t.rtt){var i,o,a=n?"screen_audio":"audio",s=t.rtt,c=t._fractionLost,u=t._retransmittedRate,d=this._getQosLevel(s,c||0,u||0),l=this._preUplinkStats.get(a)||[d];this._preUplinkStats.set(a,cI(i=Bg(o=[]).call(o,rR(l),[d])).call(i,-2))}if(r.sentKBitrate>0&&r.rtt){var h,p,v=n?"screen_video":"video",f=r._fractionLost,_=r.rtt,m=r._sendBandWidth,g=r._retransmittedRate;0===m&&(f=Math.max(.65,f));var y=this._getQosLevel(_,f||0,g||0),S=this._preUplinkStats.get(v)||[y];this._preUplinkStats.set(v,cI(h=Bg(p=[]).call(p,rR(S),[y])).call(h,-2))}this._startNetworkQualityReport()}},{key:"updateDownlinkStats",value:function(e,t){var r;if(t){var n,i,o=this._getStreamActiveState(t),a=o.audioActive,s=o.videoActive,c=e.audioStats,u=e.videoStats,d=e.isScreen,l=e.userId,h=!0,p=!0;if(a)if(0===c.receivedKBitrate)h=!1;else{var v=c.rtt,f=c.audioLossRate,_=c.stallDuration,m=c.statsInterval,g=c.e2eDelay,y=_/m,S=d?"screen_audio":"audio",b=this._getQosLevel(v,f||0,u._retransmittedRate||0),k=this._getDownlinkQoE(S,y,g);n=this._getNetworkQuality(b,k)}if(s)if(0===u.receivedKBitrate||0===u.rtt)p=!1;else{var E=u.rtt,T=u.videoLossRate,I=u.stallDuration,R=u.statsInterval,A=u.e2eDelay,w=u._retransmittedRate,C=I/R,x=d?"screen_video":"video",O=this._getQosLevel(E,T||0,w||0),P=this._getDownlinkQoE(x,C,A);i=this._getNetworkQuality(O,P)}var M=Bg(r="".concat(l)).call(r,d?"_screen":"");if(h||p){var D=n&&i?Math.ceil((n+i)/2):n||i;if(D){var N,L,U=this._preDownlinkStats.get(M)||[D];this._preDownlinkStats.set(M,cI(N=Bg(L=[]).call(L,rR(U),[D])).call(N,-2)),this._startNetworkQualityReport()}}else this._preDownlinkStats.delete(M)}}},{key:"setMSC",value:function(e){this._msc=e}},{key:"destroy",value:function(){this._timer&&(window.clearInterval(this._timer),delete this._timer),this._delayTimer&&(window.clearTimeout(this._delayTimer),delete this._delayTimer),this._preUplinkStats.clear(),this._preDownlinkStats.clear()}},{key:"_startNetworkQualityReport",value:function(){var e=this;this._delayTimer||this._timer||(this._preUplinkStats.size>0||this._preDownlinkStats.size>0)&&(this._delayTimer=window.setTimeout((function(){delete e._delayTimer,e._reportNetworkQuality(),e._timer=window.setInterval((function(){e._reportNetworkQuality()}),2e3)}),300))}},{key:"_reportNetworkQuality",value:function(){var e,t,r,n,i,o=this;if(qy(e=["connected","connecting"]).call(e,null===(t=this._msc)||void 0===t||null===(r=t.handler)||void 0===r?void 0:r.getConnectionState())){var a,s,c,u=this._getBetterQualityAndRemoveOldest("audio","up"),d=this._getBetterQualityAndRemoveOldest("video","up");n=u&&d?Math.ceil((u+d)/2):u||d||this._getBetterQualityAndRemoveOldest("screen_video","up")||this._getBetterQualityAndRemoveOldest("screen_audio","up")||bh.EXCELLENT;var l=Iy(a=Jg(s=WC(ox(c=this._preDownlinkStats).call(c))).call(s,(function(e){return o._getBetterQualityAndRemoveOldest(e,"down")}))).call(a,(function(e){return e}));i=Math.ceil(aS(l).call(l,(function(e,t){return t+e}),0)/l.length)||bh.UNKNOWN}else n=i=bh.DOWN;navigator.onLine||(n=bh.DOWN,i=bh.DOWN),"function"==typeof this.reportor&&this.reportor(n,i)}},{key:"_getNetworkQuality",value:function(e,t){return 1===t?Math.max(e-2,1):2===t?e:Math.min(e+1,5)}},{key:"_getQosLevel",value:function(e,t,r){var n;return n=(!e||e<=250)&&t<=.15?1:(!e||e<=500)&&t<=.3?2:(!e||e<=750)&&t<=.45?3:(!e||e<=1e3)&&t<=.6?4:5,r>.5?n=Math.max(n,4):r>.35?n=Math.max(n,3):r>.15&&(n=Math.max(n,2)),n}},{key:"_getUplinkQoE",value:function(e,t){var r=0;switch(e){case"audio":case"video":r=t<.05?1:t<.1?2:3;break;case"screen_video":case"screen_audio":r=t<.04?1:t<.08?2:3}return r}},{key:"_getDownlinkQoE",value:function(e,t,r){var n=gq[e];return t>n.stallRadio||r>n.delay||t>n.stallRadio/2&&r>n.delay/2?3:(t>n.stallRadio/2||n.delay,2)}},{key:"_getBetterQualityAndRemoveOldest",value:function(e,t){var r=bh.UNKNOWN,n="up"===t?this._preUplinkStats:this._preDownlinkStats,i=n.get(e);if(i){var o=Iy(i).call(i,(function(e){return e}));o.length>0&&(r=Math.min.apply(Math,rR(o))),i.shift(),0===i.length&&n.delete(e)}return r}},{key:"_getStreamActiveState",value:function(e){var t=e.subMediaType,r=e._attributes,n=e.subVideo;return{audioActive:e.subAudio&&EL(t)&&r.localaudio&&r.audiostream,videoActive:n&&TL(t)&&r.localvideo&&r.videostream}}}]),e}(),Sq=function(){function e(t){Bh(this,e),Jl(this,"_timer",void 0),Jl(this,"_remoteVideoSizeCache",{}),Jl(this,"_remoteScreenSizeCache",{}),Jl(this,"onchange",void 0),this._room=t,this._start()}return Fh(e,[{key:"destroy",value:function(){this._timer&&(window.clearInterval(this._timer),delete this._timer),this._remoteVideoSizeCache={},this._remoteScreenSizeCache={}}},{key:"_start",value:function(){var e=this;this._timer||(this._timer=window.setInterval((function(){var t={},r={};e._room.remoteStreams.forEach((function(n,i){n.forEach((function(n){var o,a=null===(o=n.videoTrack)||void 0===o?void 0:o.preprocessingTrack;if(a){var s=n.isScreen?e._remoteScreenSizeCache:e._remoteVideoSizeCache,c=s[i]||{},u=c.width,d=void 0===u?0:u,l=c.height,h=void 0===l?0:l,p=0,v=0;if(FL){var f,_,m=null==n||null===(f=n.videoTrack)||void 0===f||null===(_=f.videoPlayer)||void 0===_?void 0:_.domElement;m&&(p=m.videoWidth,v=m.videoHeight)}else{var g=a.getSettings();p=g.width||0,v=g.height||0}h===v&&d===p||"function"==typeof e.onchange&&e.onchange(i,n.isScreen,p,v),delete s[i],(n.isScreen?r:t)[i]={width:p,height:v}}}))})),LS(e._remoteVideoSizeCache).forEach((function(t){"function"==typeof e.onchange&&e.onchange(t,!1,0,0)})),LS(e._remoteScreenSizeCache).forEach((function(t){"function"==typeof e.onchange&&e.onchange(t,!0,0,0)})),e._remoteVideoSizeCache=t,e._remoteScreenSizeCache=r}),1e3))}}]),e}(),bq=WC((new TextEncoder).encode("subt")),kq={1:mC.SUBTITLE_ERR_POSTPROCESS,2:mC.SUBTITLE_ERR_CONNECTION_ERROR,3:mC.SUBTITLE_ERR_PROCESS_ERROR},Eq=new lN("SubtitleTool",1),Tq=function(e){if(e.extraInfo)try{var t,r=JSON.parse(e.extraInfo);r.source_language&&SI(t=["zh","en","ja"]).call(t,r.source_language)}catch(a){}else{var n,i,o=(null===(n=navigator.language)||void 0===n?void 0:n.substring(0,2))||"";SI(i=["zh","en","ja"]).call(i,o)>-1&&(e.extraInfo=zg({source_language:o}))}},Iq=function(){function e(t){var r,n,i;Bh(this,e),Jl(this,"_taskId",void 0),Jl(this,"_appId",void 0),Jl(this,"_roomId",void 0),Jl(this,"_userId",void 0),Jl(this,"onEvent",void 0),Jl(this,"onMessage",void 0),Jl(this,"_preConfig",void 0),Jl(this,"_timer",void 0),this._room=t,this._appId=null===(r=this._room._roomInfo)||void 0===r?void 0:r.appId,this._roomId=null===(n=this._room._roomInfo)||void 0===n?void 0:n.roomId,this._userId=null===(i=this._room._roomInfo)||void 0===i?void 0:i.userInfo.userId}var t,r,n;return Fh(e,[{key:"start",value:(n=Ng(Mg().mark((function e(t){var r=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Eq.info("start","Invoke config: %o",t),UU(t.mode,"mode",[wh.ASR_ONLY,wh.ASR_AND_TRANSLATION]),t.mode!==wh.ASR_AND_TRANSLATION||-1!==SI(Aq).call(Aq,t.targetLanguage||"")){e.next=4;break}throw new kC(mC.INVALID_PARAMS,"Invalid targetLanguage.");case 4:if(!this._taskId){e.next=6;break}throw new kC(mC.SUBTITLE_ALREADY_ON,"Already turned on subtitle");case 6:return this._preConfig=t,this._taskId=(Date.now().toString()+this._roomId+this._userId).substring(0,20),e.next=10,this._room.subtitleControlMessage(this._genSubtitleSignaling("started",t,this._taskId));case 10:this._preConfig=t,this._timer=self.setTimeout((function(){var e;null===(e=r.onEvent)||void 0===e||e.call(r,{event:Ch.ERROR,errorCode:mC.TIME_OUT,errorMessage:"start subtitle timeout."}),delete r._timer,r.stop()}),3e4);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"update",value:(r=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(UU(t.mode,"mode",[wh.ASR_ONLY,wh.ASR_AND_TRANSLATION]),t.mode!==wh.ASR_AND_TRANSLATION||-1!==SI(Aq).call(Aq,t.targetLanguage||"")){e.next=3;break}throw new kC(mC.INVALID_PARAMS,"Invalid targetLanguage.");case 3:if(!this._taskId){e.next=5;break}throw new kC(mC.SUBTITLE_ALREADY_ON,"Already started subtitle");case 5:if(this._taskId){e.next=7;break}throw new kC(mC.SUBTITLE_NOT_TURNED_ON,"Start subtitle first.");case 7:if((null===(r=this._preConfig)||void 0===r?void 0:r.mode)===t.mode&&this._preConfig.targetLanguage===t.targetLanguage){e.next=11;break}return this._preConfig=t,e.next=11,this._room.subtitleControlMessage(this._genSubtitleSignaling("update",t,this._taskId));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"stop",value:function(){var e=this;Eq.info("stop","Invoke"),this._taskId&&this._room.subtitleControlMessage({type:"subtitle",action:"stopped",appId:this._appId,roomId:this._roomId,userId:this._userId,taskId:this._taskId}).finally((function(){var t;delete e._taskId,null===(t=e.onEvent)||void 0===t||t.call(e,{event:Ch.STOPPED}),e._clearTimer()}))}},{key:"reconnect",value:(t=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._taskId||!this._preConfig){e.next=5;break}return e.next=3,this._room.subtitleControlMessage({type:"subtitle",action:"stopped",appId:this._appId,roomId:this._roomId,userId:this._userId,taskId:this._taskId});case 3:delete this._taskId,this.start(this._preConfig);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return this._preConfig}},{key:"destroy",value:function(){Eq.info("destroy","Invoke"),this.stop(),delete this._preConfig,delete this._taskId}},{key:"onResult",value:function(e){var t=e.body,r=t.error,n=t.errorMessage,i=t.eventType;if(0!==r){var o,a=new kC(kq[r]||mC.SUBTITLE_ERR_UNKNOWN,n||"");null===(o=this.onEvent)||void 0===o||o.call(this,{event:Ch.ERROR,errorCode:a.code,errorMessage:a.message}),this._clearTimer()}else if("SubtitleStarted"===i){var s;null===(s=this.onEvent)||void 0===s||s.call(this,{event:Ch.STARTED}),this._clearTimer()}}},{key:"onMessageRecv",value:function(e){if(this._taskId&&this._preConfig){var t=Rq(e);if(t&&t.length>0){var r,n=this._preConfig,i=n.mode,o=n.targetLanguage,a=[];if(t.forEach((function(e){i===wh.ASR_ONLY?e.mode===i&&a.push(e):i===wh.ASR_AND_TRANSLATION&&(e.language!==o&&e.mode!==wh.ASR_ONLY||a.push(e),e.mode===wh.ASR_ONLY&&e.language===o&&a.push(Zl(Zl({},e),{},{mode:wh.ASR_AND_TRANSLATION})))})),a.length>0)null===(r=this.onMessage)||void 0===r||r.call(this,a)}return!!t}return!1}},{key:"_genSubtitleSignaling",value:function(e,t,r){return{taskId:r,type:"subtitle",action:e,roomId:this._roomId,appId:this._appId,userId:this._userId,subtitleMeta:{subtitleConfig:{mode:t.mode,usersConfig:[{userId:this._userId,targetLanguages:[t.targetLanguage||""]}]},vendorConfig:{type:0}}}}},{key:"_clearTimer",value:function(){this._timer&&(self.clearTimeout(this._timer),delete this._timer)}}]),e}(),Rq=function(e){var t=e.message;if(t instanceof ArrayBuffer&&t.byteLength>8)try{var r=new DataView(t,0),n=0;if(bq.every((function(e){return r.getUint8(n++)===e}))){var i=r.getUint32(n);if(n+=4,i===r.byteLength-8){var o=cL.ab2str(cI(t).call(t,8)),a=JSON.parse(o),s=a.data;if("subtitle"===a.type)return s}}}catch(c){}return!1},Aq=["zh","zh-Hant","tn","vi","iu","it","id","hi","en","ho","he","es","el","uk","ur","tk","tr","ti","ty","tl","to","th","ta","te","sl","sk","ss","eo","sm","sg","st","sv","ja","tw","qu","pt","pa","no","nb","nr","my","bn","mn","mh","mk","ml","mr","ms","lu","ro","lt","lv","lo","kj","hr","kn","ki","cs","ca","nl","ko","ht","gu","ka","kl","km","lg","kg","fi","fj","fr","ru","ng","de","tt","da","ts","cv","fa","bs","pl","bi","nd","ba","bg","az","ar","af","sq","ab","os","ee","et","ay","lzh","am","ckb","cy","gl","ha","hy","ig","kmr","ln","nso","ny","om","sn","so","sr","sw","xh","yo","zu"],wq=dT,Cq=GI,xq=function(e,t,r,n){for(var i,o=n>1?void 0:n?Cq(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&wq(t,r,o),o},Oq=function(){function e(t){Bh(this,e),Jl(this,"_forwardDstRooms",new uT),Jl(this,"forwardStreamState","stopped"),Jl(this,"_monitor",void 0),this._room=t,this._monitor=KD(this._room.id)}var t,r,n,i,o,a;return Fh(e,[{key:"startForwardStream2Rooms",value:(a=Ng(Mg().mark((function e(t){var r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("running"!==this.forwardStreamState&&"paused"!==this.forwardStreamState){e.next=2;break}throw new kC(mC.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke startForwardStreamToRooms in state: ".concat(this.forwardStreamState));case 2:return e.next=4,this._sendForwardStreamSignaling("start",this._room.roomInfo.roomId,t);case 4:return r=e.sent,this._updateDstRooms(t,r),n=this._transformForwardStreamResult(r),this.forwardStreamState="running",e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"updateForwardStream2Rooms",value:(o=Ng(Mg().mark((function e(t){var r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stopped"!==this.forwardStreamState){e.next=2;break}throw new kC(mC.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke updateForwardStreamToRooms in state: ".concat(this.forwardStreamState));case 2:if(r=this._mockForwardStreamResult(t),"running"!==this.forwardStreamState){e.next=7;break}return e.next=6,this._sendForwardStreamSignaling("update",this._room._roomInfo.roomId,t);case 6:r=e.sent;case 7:return this._updateDstRooms(t,r),n=this._transformForwardStreamResult(r),e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"stopForwardStream2Rooms",value:(i=Ng(Mg().mark((function e(){var t,r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stopped"!==this.forwardStreamState){e.next=2;break}throw new kC(mC.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke stopForwardStreamToRooms in state: ".concat(this.forwardStreamState));case 2:if(r=this._mockForwardStreamResult([]),"running"!==this.forwardStreamState){e.next=7;break}return e.next=6,this._sendForwardStreamSignaling("stop",this._room._roomInfo.roomId);case 6:r=e.sent;case 7:if(this._updateDstRooms([],r),!(rR(ox(t=this._forwardDstRooms).call(t)).length>0)){e.next=10;break}throw new kC(mC.UNEXPECTED_ERROR,"stopforwardstream failed: ".concat(zg(r)));case 10:return n=this._transformForwardStreamResult(r),this.forwardStreamState="stopped",e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"pauseForwardStream2AllRooms",value:(n=Ng(Mg().mark((function e(){var t,r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("paused"!==this.forwardStreamState&&"stopped"!==this.forwardStreamState){e.next=2;break}throw new kC(mC.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke pauseForwardStreamToAllRooms in state: ".concat(this.forwardStreamState));case 2:return e.next=4,this._sendForwardStreamSignaling("stop",this._room._roomInfo.roomId);case 4:return t=e.sent,r=this._transformForwardStreamResult(t),this.forwardStreamState="paused",e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"resumeForwardStream2AllRooms",value:(r=Ng(Mg().mark((function e(){var t,r,n,i,o=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.length>0&&void 0!==o[0]&&o[0]||!qy(t=["running","stopped"]).call(t,this.forwardStreamState)){e.next=3;break}throw new kC(mC.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke resumeForwardStreamToAllRooms in state: ".concat(this.forwardStreamState));case 3:return r=this._getDstRooms(),e.next=6,this._sendForwardStreamSignaling("start",this._room._roomInfo.roomId,r);case 6:return n=e.sent,this._updateDstRooms(r,n),i=this._transformForwardStreamResult(n),this.forwardStreamState="running",e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"resumeFromReconnect",value:function(){var e=this;"running"===this.forwardStreamState&&this.resumeForwardStream2AllRooms(!0).then((function(t){t.forEach((function(t){t.state===xh.FORWARD_STREAM_STATE_FAILURE&&e._room.safeEmit(MX.ON_FORWARD_STREAM_ERROR,t)}))}))}},{key:"onForwardDstRoomUserKick",value:function(e){var t=[{dstRoomId:e.dstRoomId,code:200,forwardStreamType:"stop"}];this._updateDstRooms([],t),this._room.safeEmit(MX.ON_FORWARD_STREAM_ERROR,{roomId:e.dstRoomId,state:xh.FORWARD_STREAM_STATE_FAILURE,error:Oh.FORWARD_STREAM_ERROR_REMOTE_KICKED})}},{key:"clear",value:function(){this._forwardDstRooms.clear(),this.forwardStreamState="stopped"}},{key:"_mockForwardStreamResult",value:function(e){var t=this,r=[];return this._forwardDstRooms.forEach((function(e,t){r.push({dstRoomId:t,forwardStreamType:"stop",code:200})})),e.forEach((function(e){var n,i=tC(r).call(r,(function(t){return t.dstRoomId===e.roomId}));-1===i?r.push({dstRoomId:e.roomId,forwardStreamType:"start",code:e.roomId===(null===(n=t._room.roomInfo)||void 0===n?void 0:n.roomId)?400:200}):r[i].forwardStreamType="update"})),r}},{key:"_transformForwardStreamResult",value:function(e){e||(e=[]);var t,r=[],n=gy(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,o=i.dstRoomId,a=i.code,s={roomId:o,state:xh.FORWARD_STREAM_STATE_SUCCESS,error:Oh.FORWARD_STREAM_ERROR_OK};200===a||(400===a?(s.state=xh.FORWARD_STREAM_STATE_FAILURE,s.error=Oh.FORWARD_STREAM_ERROR_REMOTE_KICKED):a>=700&&a<800?(s.state=xh.FORWARD_STREAM_STATE_FAILURE,s.error=Oh.FORWARD_STREAM_ERROR_INVALID_TOKEN):(s.state=xh.FORWARD_STREAM_STATE_FAILURE,s.error=Oh.FORWARD_STREAM_ERROR_RESPONSE)),r.push(s)}}catch(J$){n.e(J$)}finally{n.f()}return r}},{key:"_updateDstRooms",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];0===(null==r?void 0:r.length)&&this._forwardDstRooms.clear(),r.forEach((function(r){var n=r.dstRoomId,i=r.code,o=r.forwardStreamType;if(200===i)if("stop"===o)t._forwardDstRooms.delete(n);else{var a,s=sI(e).call(e,(function(e){return e.roomId===n}));if(!s&&!t._forwardDstRooms.has(n))throw new kC(mC.UNEXPECTED_ERROR,"unknow roomid ".concat(n," in signaling return"));var c=null!==(a=t._forwardDstRooms.get(n))&&void 0!==a?a:{token:void 0};c=IT(c,s),t._forwardDstRooms.set(n,c)}else t._forwardDstRooms.has(n)&&t._forwardDstRooms.delete(n)}))}},{key:"_getDstRooms",value:function(){var e=[];return this._forwardDstRooms.forEach((function(t,r){e.push({roomId:r,token:t.token})})),e}},{key:"_sendForwardStreamSignaling",value:(t=Ng(Mg().mark((function e(t,r,n){var i,o,a,s,c,u,d,l,h;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(dL()),"stop"!==t&&(a=Jg(n).call(n,(function(e){return e.roomId})),null===(o=this._monitor)||void 0===o||o.report("rtc_forward_stream",{type:"begin",dst_rooms:"{ ".concat(Jg(a).call(a,(function(e){return'"'.concat(e,'"')})).join(",")," }"),event_session_id:i})),e.next=4,this._room._mediaServerClient.sendForwardStreamSignal(t,r,n);case 4:if(s=e.sent,c=[],200===(null==s?void 0:s.code)){e.next=9;break}throw"stop"!==t&&(null==n||n.forEach((function(e){c.push({dst_room_id:e.roomId,result:"server error ".concat(null==s?void 0:s.code)})})),null===(u=this._monitor)||void 0===u||u.report("rtc_forward_stream",{type:"end",dst_rooms:zg(c),event_session_id:i})),new kC(mC.UNEXPECTED_ERROR,"server side internal error, error code: ".concat(s));case 9:return"stop"!==t&&(null===(d=s.forwardStreamResults)||void 0===d||d.forEach((function(e){c.push({dst_room_id:e.dstRoomId,result:"dst room lost"})})),null===(l=s.forwardStreamResults)||void 0===l||l.forEach((function(e){var t=sI(c).call(c,(function(t){return t.dst_room_id===e.dstRoomId}));t&&(200===e.code?"update"===e.forwardStreamType?t.result="update":t.result="success":t.result="server error ".concat(e.code))})),null===(h=this._monitor)||void 0===h||h.report("rtc_forward_stream",{type:"end",dst_rooms:zg(c),event_session_id:i})),e.abrupt("return",s.forwardStreamResults);case 11:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})}]),e}();function Pq(e,t,r){var n=r.value;return r.value=Ng(Mg().mark((function e(){var r,i,o,a,s=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(r=this._room._roomInfo)||void 0===r||!r.roomId){e.next=7;break}for(i=s.length,o=new Array(i),a=0;a<i;a++)o[a]=s[a];return e.next=4,n.apply(this,o);case 4:return e.abrupt("return",e.sent);case 7:throw new kC(mC.NOT_CONNECTED_YET,"error in ".concat(t,": try again after joined"));case 8:case"end":return e.stop()}}),e,this)}))),r}xq([Pq],Oq.prototype,"startForwardStream2Rooms",1),xq([Pq],Oq.prototype,"updateForwardStream2Rooms",1),xq([Pq],Oq.prototype,"stopForwardStream2Rooms",1),xq([Pq],Oq.prototype,"pauseForwardStream2AllRooms",1),xq([Pq],Oq.prototype,"resumeForwardStream2AllRooms",1);var Mq={audiostream:!0,extaudio:!1,extvideo:!1,localaudio:!0,localvideo:!1,videoDescriptions:[],videostream:!1,publishTime:0},Dq=function(e){VA(x,e);var t,r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I,R,A,w,C=tw(x);function x(e,t){var r;return Bh(this,x),Jl(sA(r=C.call(this)),"id",void 0),Jl(sA(r),"_mediaServerClient",void 0),Jl(sA(r),"_localStream",void 0),Jl(sA(r),"_localScreenStream",void 0),Jl(sA(r),"_remoteUsers",new uT),Jl(sA(r),"_remoteStreams",new uT),Jl(sA(r),"_remoteStreamStreamIdUserIdMap",{}),Jl(sA(r),"_virtualStreams",[]),Jl(sA(r),"_context",void 0),Jl(sA(r),"_sessionId",void 0),Jl(sA(r),"_connectionLostTimer",void 0),Jl(sA(r),"_serverConfig",void 0),Jl(sA(r),"_roomConfig",void 0),Jl(sA(r),"_roomInfo",void 0),Jl(sA(r),"_userDuplicateLoginTimerMap",new uT),Jl(sA(r),"_networkQualityManager",void 0),Jl(sA(r),"_videoSizeObserver",void 0),Jl(sA(r),"_hasPublished",!1),Jl(sA(r),"_subtitleTool",void 0),Jl(sA(r),"_csrcUserIdMap",void 0),Jl(sA(r),"_publishOnDemandItem",void 0),Jl(sA(r),"_onceTriggerBySignal",!1),Jl(sA(r),"_pubTransceiverReady",!1),Jl(sA(r),"_publishOnDemandBusy",!1),Jl(sA(r),"_monitor",void 0),Jl(sA(r),"logger",void 0),Jl(sA(r),"_forwardStreamManager",void 0),r.id=t.id,r.logger=new lN("Room",1,t.id),r.logger.info("constructor","invoke"),r._roomConfig=e,r._mediaServerClient=new dq(t),r._networkQualityManager=new yq,r._networkQualityManager.reportor=r._reportNetworkQuality.bind(sA(r)),r._videoSizeObserver=new Sq(sA(r)),r._videoSizeObserver.onchange=r._emitVideoSizeChange.bind(sA(r)),r._context=t,r._csrcUserIdMap={},r._monitor=KD(r.id),r._forwardStreamManager=new Oq(sA(r)),r._addHandlerEventHandler(),r}return Fh(x,[{key:"hasScreenPublished",get:function(){var e;return null===(e=this._localScreenStream)||void 0===e?void 0:e.hasPublished}},{key:"hasPublished",get:function(){var e;return null===(e=this._localStream)||void 0===e?void 0:e.hasPublished}},{key:"connectionState",get:function(){return this._mediaServerClient.connectionState}},{key:"remoteUsers",get:function(){return this._remoteUsers}},{key:"remoteStreams",get:function(){return this._remoteStreams}},{key:"localStream",get:function(){return this._localStream}},{key:"localScreenStream",get:function(){return this._localScreenStream}},{key:"roomInfo",get:function(){return this._roomInfo}},{key:"roomConfig",set:function(e){this._roomConfig=e}},{key:"_addHandlerEventHandler",value:function(){var e,t,r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I,R,A,w,C,x,O,P,M,D,N=this;null===(e=this._mediaServerClient)||void 0===e||e.on(IX.ON_ADD_STREAM,this._onAddStream.bind(this)),null===(t=this._mediaServerClient)||void 0===t||t.on(IX.ON_ADD_STREAM_LIST,(function(e){Array.isArray(null==e?void 0:e.streamList)&&e.streamList.forEach((function(e){return N._onAddStream(e)}))})),null===(r=this._mediaServerClient)||void 0===r||r.on(IX.ON_REMOVE_STREAM,this._onRemoveStream.bind(this)),null===(n=this._mediaServerClient)||void 0===n||n.on(IX.ON_REMOVE_STREAM_LIST,(function(e){Array.isArray(null==e?void 0:e.streamList)&&e.streamList.forEach((function(e){return N._onRemoveStream(e)}))})),null===(i=this._mediaServerClient)||void 0===i||i.on(IX.USER_CONNECTION,this._onUserConnection.bind(this)),null===(o=this._mediaServerClient)||void 0===o||o.on(IX.USER_CONNECTION_LIST,(function(e){Array.isArray(null==e?void 0:e.userList)&&e.userList.forEach((function(e){return N._onUserConnection(e)}))})),null===(a=this._mediaServerClient)||void 0===a||a.on(IX.USER_DISCONNECTION,this._onUserDisconnection.bind(this)),null===(s=this._mediaServerClient)||void 0===s||s.on(IX.USER_DISCONNECTION_LIST,(function(e){Array.isArray(null==e?void 0:e.userList)&&e.userList.forEach((function(e){return N._onUserDisconnection(e)}))})),null===(c=this._mediaServerClient)||void 0===c||c.on(IX.ON_UPDATE_ROOM_ATTRIBUTES,this._onUpdateRoomAttributes.bind(this)),null===(u=this._mediaServerClient)||void 0===u||u.on(IX.ON_UPDATE_USER_ATTRIBUTES,this._onUpdateUserAttributes.bind(this)),null===(d=this._mediaServerClient)||void 0===d||d.on(IX.ON_UPDATE_STREAM_ATTRIBUTES,this._onUpdateStreamAttributes.bind(this)),null===(l=this._mediaServerClient)||void 0===l||l.on(IX.ON_PUSH_TRACK,this._onPushTrack.bind(this)),null===(h=this._mediaServerClient)||void 0===h||h.on(IX.ON_REMOVE_TRACK,this._onRemoveTrack.bind(this)),null===(p=this._mediaServerClient)||void 0===p||p.on(IX.ON_CUSTOM_MESSAGE,this._onCustomMessage.bind(this)),null===(v=this._mediaServerClient)||void 0===v||v.on(IX.USER_MESSAGE_RECEIVED,this._onUserMessageReceived.bind(this)),null===(f=this._mediaServerClient)||void 0===f||f.on(IX.USER_BINARY_MESSAGE_RECEIVED,this._onUserBinaryMessageReceived.bind(this)),null===(_=this._mediaServerClient)||void 0===_||_.on(IX.POST_PROCESSING_MESSAGE,this._onPostProcessingMessage.bind(this)),null===(m=this._mediaServerClient)||void 0===m||m.on(IX.ON_USER_TOKEN_WILL_EXPIRE,this._onUserTokenWillExpire.bind(this)),null===(g=this._mediaServerClient)||void 0===g||g.on(IX.STREAM_CONTROL_MESSAGE,this._onStreamControlMessage.bind(this)),null===(y=this._mediaServerClient)||void 0===y||y.on(IX.ON_STREAM_FAILED,this._onStreamFailed.bind(this)),null===(S=this._mediaServerClient)||void 0===S||S.on(RX.RSCP,(function(e,t){!!sI(e).call(e,(function(e){var t,r,n;return null==e||null===(t=e.StreamIds)||void 0===t?void 0:qy(t).call(t,null===(r=N._localStream)||void 0===r||null===(n=r.stream)||void 0===n?void 0:n.id)}))&&(t?N._pubTransceiverReady=!0:N._onceTriggerBySignal=!0,t&&N._onceTriggerBySignal||(N._publishOnDemandItem=e),N._pubTransceiverReady&&N._onPublishOnDemand())})),null===(b=this._mediaServerClient)||void 0===b||b.on(RX.RTT,this._onRTT.bind(this)),null===(k=this._mediaServerClient)||void 0===k||k.on(RX.SSC,this._onSSC.bind(this)),null===(E=this._mediaServerClient)||void 0===E||E.on(AX.ON_CONNECTION_STATE_CHANGE,this._onConnectionStateChange.bind(this)),null===(T=this._mediaServerClient)||void 0===T||T.on(AX.ON_VENDOR_CONNECTION_STATE_CHANGE,(function(e){return N.emit(AX.ON_VENDOR_CONNECTION_STATE_CHANGE,e)})),null===(I=this._mediaServerClient)||void 0===I||I.on(IX.ON_SPEAKER_CHANGE,this._onMeetingSpeakerChange.bind(this)),null===(R=this._mediaServerClient)||void 0===R||R.on("onRemoteStreamStats",(function(e){N._networkQualityManager.updateDownlinkStats(e,N._findRemoteStreamByScreen(e.userId,e.isScreen)),N.emit(MX.ON_REMOTE_STREAM_STATS,IL(e))})),null===(A=this._mediaServerClient)||void 0===A||A.on(MX.RESUBSCRIBE,(function(e){N.emit(MX.RESUBSCRIBE,e)})),null===(w=this._mediaServerClient)||void 0===w||w.on(MX.RECONNECT_FAILED,(function(){N.emit(MX.RECONNECT_FAILED)})),null===(C=this._mediaServerClient)||void 0===C||C.on("joinSuccess",this._onJoinSucc.bind(this)),null===(x=this._mediaServerClient)||void 0===x||x.on(IX.ON_FORWARD_DST_ROOM_USER_KICK,this._forwardStreamManager.onForwardDstRoomUserKick.bind(this._forwardStreamManager)),null===(O=this._mediaServerClient)||void 0===O||O.on(MX.ON_REJOIN_WITH_TCP,(function(){N.emit(MX.ON_REJOIN_WITH_TCP)})),null===(P=this._mediaServerClient)||void 0===P||P.on(MX.ON_ICE_CONNECT_WITH_TCP,(function(){N.emit(MX.ON_ICE_CONNECT_WITH_TCP)})),null===(M=this._mediaServerClient)||void 0===M||M.on(MX.PUB_RETRY,(function(e){N.emit(MX.PUB_RETRY,e)})),null===(D=this._mediaServerClient)||void 0===D||D.on(MX.SUB_RETRY,(function(e){N.emit(MX.SUB_RETRY,e)}))}},{key:"_onLocalStreamStats",value:function(e){this._networkQualityManager.updateUplinkStats(e),this.emit(MX.ON_LOCAL_STREAM_STATS,IL(e))}},{key:"_removeHandlerEventHandler",value:function(){var e;null===(e=this._mediaServerClient)||void 0===e||e.removeAllListeners()}},{key:"connect",value:(w=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setSessionId(),e.next=3,this._mediaServerClient.connect();case 3:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"join",value:(A=Ng(Mg().mark((function e(t,r,n,i,o){var a,s,c;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(a=this._monitor)||void 0===a||a.set({rtc_app_id:t,room_id:r,user_id:i.userId}),this.logger.info("join()"),this._mediaServerClient.setLiveControlMessage(o),this._roomInfo={appId:t,roomId:r,token:n,userInfo:i,roomProfile:this._roomConfig.roomProfileType},this.setSessionId(),e.prev=5,e.next=8,this._mediaServerClient.join(this._roomInfo);case 8:return c=e.sent,null!==(s=c.roomAttributes)&&void 0!==s&&s.multiChatMode&&this._handleFFAudioTrack(),this._initSubtitleTool(),e.abrupt("return",{users:c.clients,streams:c.streams});case 14:if(e.prev=14,e.t0=e.catch(5),e.t0.code===mC.OPERATION_CANCEL){e.next=18;break}throw e.t0;case 18:case"end":return e.stop()}}),e,this,[[5,14]])}))),function(e,t,r,n,i){return A.apply(this,arguments)})},{key:"publishScreen",value:(R=Ng(Mg().mark((function e(t,r,n,i,o){var a,s,c,u,d,l,h,p,v,f,_,m;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("publishScreen()"),this._localScreenStream||(this._localScreenStream=new GG(this._context),null!==(a=this._mediaServerClient)&&void 0!==a&&null!==(s=a.vendorConfig)&&void 0!==s&&s.enableMultiVendor&&(this._localScreenStream.pcSessionId=vx()),this._localScreenStream.isScreen=!0,this._mediaServerClient.handler&&(this._localScreenStream.observer=new mq(this._localScreenStream,this._mediaServerClient.handler))),c=!1,u=!1,d=!1,l=!1,!this._localScreenStream.videoTrack&&r?(r instanceof YH&&(u=!0),c=!0):this._localScreenStream.videoTrack&&!r&&(c=!1),!this._localScreenStream.audioTrack&&n?(n instanceof JH&&(l=!0),d=!0):this._localScreenStream.audioTrack&&!n&&(d=!1),this._localScreenStream.videoTrack=r,this._localScreenStream.audioTrack=n,this._localScreenStream.videoEncodeConfig=t,i&&(EL(i)&&(this._localScreenStream.pubAudio=o===NX.PUB),TL(i)&&(this._localScreenStream.pubVideo=o===NX.PUB),this.logger.info("publishScreen mediaType","pubAudio: %o, pubVideo: %o",this._localScreenStream.pubAudio,this._localScreenStream.pubVideo)),this._localScreenStream.pubAudio||this._localScreenStream.pubVideo){e.next=18;break}if(null===(h=this._localScreenStream)||void 0===h||!h.hasPublished){e.next=17;break}return e.abrupt("return",this.unpublishScreen());case 17:return e.abrupt("return");case 18:if(this._localScreenStream.hasPublished){e.next=24;break}return null===(p=this._localScreenStream.observer)||void 0===p||p.setPublish(!0),e.next=22,this._mediaServerClient.publish(this._localScreenStream);case 22:e.next=28;break;case 24:return u?null===(v=this._localScreenStream.observer)||void 0===v||v.setPushVideo(c):null===(f=this._localScreenStream.observer)||void 0===f||f.setEnableVideo(c),l?null===(_=this._localScreenStream.observer)||void 0===_||_.setPushAudio(d):null===(m=this._localScreenStream.observer)||void 0===m||m.setEnableAudio(d),e.next=28,this.updatePubScreenTrack();case 28:this._localScreenStream.pubAudio||this._localScreenStream.pubVideo?this._mediaServerClient.handler&&this._localScreenStream.startReport(this._onLocalStreamStats.bind(this),this._localScreenStream.vendorHandler||this._mediaServerClient.handler):this._localScreenStream.stopReport("unpublish screen");case 29:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n,i){return R.apply(this,arguments)})},{key:"updatePubScreenTrack",value:(I=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updatePubScreenTrack","Invoke updatePubScreenTrack"),!this._localScreenStream){e.next=4;break}return e.next=4,this._mediaServerClient.updatePubTrack(this._localScreenStream);case 4:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"unpublishScreen",value:(T=Ng(Mg().mark((function e(){var t;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("unpublish","Invoke unpublishScreen"),!this._localScreenStream){e.next=8;break}return null===(t=this._localScreenStream.observer)||void 0===t||t.setPublish(!1),e.next=5,this._mediaServerClient.unpublish(this._localScreenStream);case 5:this._localScreenStream.stopReport("unpublish screen"),this._localScreenStream.clean(),this._localScreenStream=void 0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)})},{key:"liveControlMessage",value:(E=Ng(Mg().mark((function e(t){var r,n=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("controlMessage","Invoke controlMessage"),null===(r=t.transcodeMeta)||void 0===r||r.layout.regions.forEach((function(e){n.roomInfo&&(e.roomID=n.roomInfo.roomId)})),e.next=4,this._mediaServerClient.controlMessage(t);case 4:this._mediaServerClient.setLiveControlMessage("stopped"===t.action?void 0:t);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"publicStreamControlMessage",value:(k=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"stopped"===t.action&&delete t.publicStreamMeta,e.next=3,this._mediaServerClient.controlMessage(t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"subtitleControlMessage",value:(b=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._mediaServerClient.controlMessage(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"updateUserAttributes",value:(S=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("updateUserAttributes","Invoke updateUserAttributes"),t.role&&this._roomInfo&&(this._roomInfo.userInfo.role=t.role),e.next=4,this._mediaServerClient.updateUserAttributes(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"publish",value:(y=Ng(Mg().mark((function e(t,r,n,i,o,a){var s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=I.length>6&&void 0!==I[6]&&I[6],this.logger.info("publish","Invoke publish"),c=!1,this._localStream||(this._localStream=new GG(this._context),null!==(u=this._mediaServerClient)&&void 0!==u&&null!==(d=u.vendorConfig)&&void 0!==d&&d.enableMultiVendor&&(this._localStream.pcSessionId=vx()),this._mediaServerClient.handler&&(this._localStream.observer=new mq(this._localStream,this._mediaServerClient.handler)),c=!0,this._localStream.vendorCode=(null===(l=this._mediaServerClient.vendorConfig)||void 0===l?void 0:l.vendorCode)||0),this._localStream.videoTrack=n,this._localStream.audioTrack=i,this._localStream.videoEncodeConfig=t,this._localStream.enableSimulcast=r,h=this._localStream,p=h.pubAudio,v=h.pubVideo,o&&(EL(o)&&(this._localStream.pubAudio=a===NX.PUB),TL(o)&&(this._localStream.pubVideo=a===NX.PUB),this.logger.info("publish mediaType","pubAudio: %o, pubVideo: %o",this._localStream.pubAudio,this._localStream.pubVideo)),this._localStream.hasPublished){e.next=29;break}if(this._localStream.pubAudio||this._localStream.pubVideo){e.next=13;break}return e.abrupt("return");case 13:return e.prev=13,s?null===(f=this._localStream.observer)||void 0===f||f.setLogin(!0):c&&(_=!!this._localStream.videoTrack,m=!!this._localStream.audioTrack,g=this._localStream.videoTrack instanceof YH,y=this._localStream.audioTrack instanceof JH,this._roomConfig.isAutoPublish&&!this._hasPublished?(_&&(g?null===(S=this._localStream.observer)||void 0===S||S.setPushVideo(!0):null===(b=this._localStream.observer)||void 0===b||b.setEnableVideo(!0)),m&&(y?null===(k=this._localStream.observer)||void 0===k||k.setPushAudio(!0):null===(E=this._localStream.observer)||void 0===E||E.setEnableAudio(!0))):null===(T=this._localStream.observer)||void 0===T||T.setPublish(!0)),this.emit("___onMediaServerClientPublish"),e.next=18,this._mediaServerClient.publish(this._localStream);case 18:this._hasPublished=!0,this.emit(MX.ON_PUBLISH_RESULT,{isScreen:!1,state:oh.PUBLISH_SUCC}),e.next=27;break;case 22:throw e.prev=22,e.t0=e.catch(13),this.emit(MX.ON_PUBLISH_RESULT,{isScreen:!1,state:oh.PUBLISH_FAIL}),delete this._localStream,e.t0;case 27:e.next=40;break;case 29:return e.prev=29,this.emit("___onMediaServerClientPublish"),e.next=33,this.updatePubTrack();case 33:e.next=40;break;case 35:throw e.prev=35,e.t1=e.catch(29),this._localStream.pubAudio=p,this._localStream.pubVideo=v,e.t1;case 40:this._localStream.pubAudio||this._localStream.pubVideo?this._mediaServerClient.handler&&this._localStream.startReport(this._onLocalStreamStats.bind(this),this._localStream.vendorHandler||this._mediaServerClient.handler):this._localStream.stopReport("unpublish");case 41:case"end":return e.stop()}}),e,this,[[13,22],[29,35]])}))),function(e,t,r,n,i,o){return y.apply(this,arguments)})},{key:"updatePubTrack",value:(g=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updatePubTrack","Invoke updatePubTrack"),!this._localStream){e.next=4;break}return e.next=4,this._mediaServerClient.updatePubTrack(this._localStream);case 4:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"unpublish",value:(m=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("unpublish","Invoke unpublish"),!this._localStream){e.next=7;break}return e.next=4,this._mediaServerClient.unpublish(this._localStream);case 4:this._localStream.stopReport("unpublish"),this._localStream.clean(),this._localStream=void 0;case 7:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"subscribe",value:(_=Ng(Mg().mark((function e(t,r,n){var i,o,a;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("subscribe","remoteStream %o",t),!t.hasSubscribed){e.next=8;break}if((i=t.subMediaType|r)===t.subMediaType){e.next=7;break}return e.next=6,null===(o=this._mediaServerClient)||void 0===o?void 0:o.updateSubMediaType(t,i);case 6:return e.abrupt("return",e.sent);case 7:return e.abrupt("return");case 8:return a=void 0,n&&(a=this._getSubLayer(n,t)),e.next=12,this._mediaServerClient.subscribe(t,r,a);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return _.apply(this,arguments)})},{key:"updateSubVideoConfig",value:(f=Ng(Mg().mark((function e(t,r){var n,i,o,a,s;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=this._findRemoteStreamByScreen(t,!1))&&a.hasSubscribed&&!((null==a||null===(n=a.attributes)||void 0===n||null===(i=n.videoDescriptions)||void 0===i?void 0:i.length)<=1)){e.next=3;break}return e.abrupt("return");case 3:return s=this._getSubLayer(r,a),a.originalStreamIndex=s.spatialLayer,e.abrupt("return",null===(o=this._mediaServerClient)||void 0===o?void 0:o.updateSubTrackLayer(a,s));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"_getSubLayer",value:function(e,t){for(var r,n,i,o,a,s=null==t?void 0:t.attributes,c=s.videoDescriptions,u=s.subVideoDescriptions,d=Array.isArray(u)?u:c,l=-1,h=e.width*e.height,p=0;p<(null==d?void 0:d.length);p++){var v,f;if(h>=(null===(v=d[p])||void 0===v?void 0:v.width)*(null===(f=d[p])||void 0===f?void 0:f.height)){l=p;break}}var _=d[0];if(-1===l)_=d[l=d.length-1];else if(0!==l){var m=d[l-1].width*d[l-1].height,g=(m-h)/(m-d[l].width*d[l].height);_=g<.1?d[l-1]:d[l],l=g<.1?l-1:l}return a=null!==(r=null===(n=_)||void 0===n?void 0:n.sub_index)&&void 0!==r?r:-1,{spatialLayer:null!==(i=null===(o=_)||void 0===o?void 0:o.video_index)&&void 0!==i?i:l,spatialSubLayer:a}}},{key:"unsubscribe",value:(v=Ng(Mg().mark((function e(t,r){var n,i,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("unsubscribe","Invoke unsubscribe"),t.hasSubscribed){e.next=3;break}return e.abrupt("return");case 3:if(o=t.subMediaType-(t.subMediaType&r),null!==(n=this._context.serverConfig)&&void 0!==n&&n.muteReplaceUnsub||!(o===TG.NONE||this.multiChatMode&&o===uh.AUDIO)){e.next=8;break}return e.next=7,this._mediaServerClient.unsubscribe(t);case 7:return e.abrupt("return",e.sent);case 8:return e.next=10,null===(i=this._mediaServerClient)||void 0===i?void 0:i.updateSubMediaType(t,o);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"startSubtitle",value:(p=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._subtitleTool){e.next=5;break}return e.next=3,this._subtitleTool.start(t);case 3:e.next=6;break;case 5:throw new kC(mC.INVOKED_BEFORE_JOIN_ROOM,"join first");case 6:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"stopSubtitle",value:(h=Ng(Mg().mark((function e(){var t;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null===(t=this._subtitleTool)||void 0===t||t.stop();case 1:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"startForwardStream2Rooms",value:(l=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.startForwardStream2Rooms(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"updateForwardStream2Rooms",value:(d=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.updateForwardStream2Rooms(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"stopForwardStream2Rooms",value:(u=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.stopForwardStream2Rooms());case 1:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"pauseForwardStream2AllRooms",value:(c=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.pauseForwardStream2AllRooms());case 1:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"resumeForwardStream2AllRooms",value:(s=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.resumeForwardStream2AllRooms());case 1:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"leave",value:(a=Ng(Mg().mark((function e(){var t,r,n,i,o,a,s,c,u,d,l,h=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=h.length>0&&void 0!==h[0]&&h[0],this.logger.info("leave","Invoke leave"),n=oL(),null===(t=this._subtitleTool)||void 0===t||t.destroy(),delete this._subtitleTool,delete this._sessionId,e.prev=6,s=gy(uw(a=this._remoteStreams).call(a));try{for(s.s();!(c=s.n()).done;)u=c.value,Array.isArray(u)&&u.forEach((function(e){var t;null===(t=e.observer)||void 0===t||t.setLogin(!1)}))}catch(J$){s.e(J$)}finally{s.f()}return this._localStream&&(null===(d=this._localStream.observer)||void 0===d||d.setLogin(!1)),e.next=12,this._mediaServerClient.leave().catch((function(){}));case 12:this.destroy(),null===(i=this._monitor)||void 0===i||i.report("rtc_leave_room",{error_code:0,message:"",elapse:oL()-n}),null===(o=this._monitor)||void 0===o||o.set({room_id:"",user_id:"",rtc_session_id:"",rtc_vid:""}),e.next=25;break;case 17:if(e.prev=17,e.t0=e.catch(6),!r){e.next=23;break}throw e.t0;case 23:this.destroy();case 24:e.t0 instanceof Error&&(null===(l=this._monitor)||void 0===l||l.report("rtc_leave_room",{error_code:-1,message:e.t0.message,elapse:oL()-n}));case 25:case"end":return e.stop()}}),e,this,[[6,17]])}))),function(){return a.apply(this,arguments)})},{key:"updateRemoteUserPriority",value:function(e){var t,r=this;null===(t=this.remoteStreams.get(e))||void 0===t||t.forEach((function(t){var n=(r._context||{}).userPriority;t.hasSubscribed&&n.has(e)&&r._mediaServerClient.updateSubPriority(t,n.get(e))}))}},{key:"destroy",value:function(){var e;this.logger.info("destroy","Invoke destroy"),JD(this.id,"room_destroy","".concat((new Error).stack)),null===(e=this._subtitleTool)||void 0===e||e.destroy(),delete this._subtitleTool,this._mediaServerClient.destroy(),this._removeHandlerEventHandler(),this._roomInfo=void 0,this._remoteUsers=new uT;var t,r,n,i=gy(this._remoteStreams);try{for(i.s();!(t=i.n()).done;){var o=yy(t.value,2)[1];Array.isArray(o)&&o.forEach((function(e){e&&e.destroy()}))}}catch(J$){i.e(J$)}finally{i.f()}(this._virtualStreams.forEach((function(e){null==e||e.clean()})),this._remoteStreams=new uT,this._localStream)&&(null===(r=this._localStream)||void 0===r||r.clean(),this._localStream=void 0);this._localScreenStream&&(null===(n=this._localScreenStream)||void 0===n||n.clean(),this._localScreenStream=void 0);this._removeHandlerEventHandler(),clearTimeout(this._connectionLostTimer),this._userDuplicateLoginTimerMap.forEach((function(e){clearTimeout(e)})),this._userDuplicateLoginTimerMap.clear(),this._networkQualityManager.destroy(),this._videoSizeObserver.destroy(),this._csrcUserIdMap={},this._virtualStreams=[],this._remoteStreamStreamIdUserIdMap={},this._forwardStreamManager.clear()}},{key:"updateToken",value:(o=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("updateToken","Invoke updateToken"),this._roomInfo&&(this._roomInfo.token=t),e.prev=2,e.next=5,this._mediaServerClient.updateToken(t);case 5:e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(2),this.safeEmit(MX.ON_ROOM_ERROR,{errorCode:mC.UPDATE_TOKEN_WITH_INVALID_TOKEN}),e.t0;case 11:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(e){return o.apply(this,arguments)})},{key:"sendUserMessage",value:function(e,t){var r;return null===(r=this._mediaServerClient)||void 0===r?void 0:r.sendUserMessage(e,t)}},{key:"setSessionId",value:function(){var e;this._sessionId||(this._sessionId=SN(),this._mediaServerClient._sessionId=this._sessionId,null===(e=this._monitor)||void 0===e||e.set({rtc_session_id:this._sessionId}))}},{key:"sendRoomMessage",value:(i=Ng(Mg().mark((function e(t){var r,n,i,o,a,s=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=s.length>1&&void 0!==s[1]&&s[1],a={clientId:null===(r=this._roomInfo)||void 0===r?void 0:r.userInfo.userId,binary:o,message:"",roomId:null===(n=this._roomInfo)||void 0===n?void 0:n.roomId},!o){e.next=8;break}return e.next=5,cL.ab2b64str(t);case 5:a.message=e.sent,e.next=9;break;case 8:a.message=t;case 9:return e.abrupt("return",null===(i=this._mediaServerClient)||void 0===i?void 0:i.sendRoomMessage(a));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_onJoinSucc",value:function(e){var t,r,n,i=this,o=e.joinRes,a=e.reconnect;this.logger.info("_onJoinSucc()","invoke. ".concat(a?"[reconnect]":"")),this._serverConfig=o.config,this._mediaServerClient.roomAttributes=o.roomAttributes;var s=[],c=[],u=[],d=[],l=[];null===(t=o.clientsDetail)||void 0===t||t.forEach((function(e){if(e.attributes&&(e.attributes.serverMuteVideo&&i.safeEmit(MX.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteVideo}),e.attributes.serverMuteAudio&&i.safeEmit(MX.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteAudio})),e.clientId!==o.clientId){var t=i._remoteUsers.get(e.clientId);t?t._stillExist=!0:s.push(e)}}));var h,p=gy(uw(r=this._remoteUsers).call(r));try{for(p.s();!(h=p.n()).done;){var v=h.value;v._stillExist||c.push({clientId:v.userId}),delete v._stillExist}}catch(J$){p.e(J$)}finally{p.f()}o.streams.forEach((function(e){var t=i._findRemoteStreamByScreen(e.clientId,e.screen);t?(t.stillExist=!0,t.streamId=e.streamId,l.push(e)):d.push(e)}));var f,_=gy(uw(n=this._remoteStreams).call(n));try{for(_.s();!(f=_.n()).done;){var m=f.value;Array.isArray(m)&&m.forEach((function(e){e.stillExist?delete e.stillExist:u.push({clientId:e.userId,streamId:e.streamId,message:EX.clientDisconnected})}))}}catch(J$){_.e(J$)}finally{_.f()}c.forEach((function(e){return i._onUserDisconnection(e)})),s.forEach((function(e){return i._onUserConnection(e)})),u.forEach((function(e){return i._onRemoveStream(e)})),d.forEach((function(e){return i._onAddStream(e,{fromSignal:!1})})),l.forEach((function(e){return i._onUpdateStreamAttributes(e)})),a&&this._handleSendOrRecvStreamAfterReconnect()}},{key:"_handleSendOrRecvStreamAfterReconnect",value:function(){var e,t,r,n,i,o=this;this._localStream&&(this._localStream.clean(),this._localStream.vendorCode=(null===(r=this._mediaServerClient.vendorConfig)||void 0===r?void 0:r.vendorCode)||0,null===(n=this._localStream.observer)||void 0===n||n.setLogin(!0),this._mediaServerClient.publish(this._localStream).then((function(){var e;o._mediaServerClient.handler&&(null===(e=o._localStream)||void 0===e||e.startReport(o._onLocalStreamStats.bind(o),o._localStream.vendorHandler||o._mediaServerClient.handler)),o.emit(MX.ON_PUBLISH_RESULT,{isScreen:!1,state:oh.PUBLISH_SUCC,retry:!0})})).catch((function(e){o.logger.error("failed repub error:".concat(e)),o.emit(MX.ON_PUBLISH_RESULT,{isScreen:!1,state:oh.PUBLISH_FAIL,errorCode:e.code,retry:!0})})));this._localScreenStream&&(this._localScreenStream.clean(),null===(i=this._localScreenStream.observer)||void 0===i||i.setLogin(!0),this._mediaServerClient.publish(this._localScreenStream).then((function(){var e;o._mediaServerClient.handler&&(null===(e=o._localScreenStream)||void 0===e||e.startReport(o._onLocalStreamStats.bind(o),o._localScreenStream.vendorHandler||o._mediaServerClient.handler)),o.emit(MX.ON_PUBLISH_RESULT,{isScreen:!0,state:oh.PUBLISH_SUCC,retry:!0})})).catch((function(e){o.logger.error("failed repub screen stream error:".concat(e)),o.emit(MX.ON_PUBLISH_RESULT,{isScreen:!0,state:oh.PUBLISH_FAIL,errorCode:e.code,retry:!0})})));var a,s=gy(uw(t=this._remoteStreams).call(t));try{for(s.s();!(a=s.n()).done;){var c=a.value;Array.isArray(c)&&c.forEach(function(){var e=Ng(Mg().mark((function e(t){var r,n,i,a,s,c;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.hasSubscribed){e.next=22;break}return t.resetHasSubscribed(),e.prev=2,o.logger.info(Bg(r="start resubscribe ".concat(t.userId," with ")).call(r,t.subMediaType)),TL(t.subMediaType)&&(null===(n=t.observer)||void 0===n||n.setSubscribeVideo(!0)),EL(t.subMediaType)&&(null===(i=t.observer)||void 0===i||i.setSubscribeAudio(!0)),e.next=8,o._mediaServerClient.subscribe(t,t.subMediaType);case 8:o.logger.info(Bg(a="success resubscribe ".concat(t.userId," with ")).call(a,t.subMediaType)),o.safeEmit(MX.RESUBSCRIBE,{stream:t}),o.emit(MX.ON_SUBSCRIBE_RESULT,{userId:t.userId,isScreen:t.isScreen,retry:!0}),e.next=22;break;case 13:if(e.prev=13,e.t0=e.catch(2),o.emit(MX.ON_SUBSCRIBE_RESULT,{userId:t.userId,isScreen:t.isScreen,errorCode:e.t0.code,retry:!0}),o.logger.error(Bg(s=Bg(c="failed resubscribe ".concat(t.userId," with ")).call(c,t.subMediaType,", error:")).call(s,e.t0)),e.t0.code!==mC.NOT_CONNECTED_YET){e.next=20;break}return t.streamState=HG.SUB_ED,e.abrupt("return");case 20:t.clean(),null==t||t.resetHasSubscribed();case 22:case"end":return e.stop()}}),e,null,[[2,13]])})));return function(t){return e.apply(this,arguments)}}())}}catch(J$){s.e(J$)}finally{s.f()}null===(e=this._subtitleTool)||void 0===e||e.reconnect(),this._forwardStreamManager.resumeFromReconnect()}},{key:"_handleFFAudioTrack",value:function(){var e,t,r,n,i=null===(e=this._mediaServerClient)||void 0===e||null===(t=e.handler)||void 0===t?void 0:t.audioTrack4ff,o=null===(r=this._mediaServerClient)||void 0===r||null===(n=r.handler)||void 0===n?void 0:n.getTransceivers();if(i&&Array.isArray(o)){var a=sI(o).call(o,(function(e){var t;return(null==e||null===(t=e.receiver)||void 0===t?void 0:t.track)===i}));if(a){var s=new zG(this._context,"ff-stream","ff-stream",!1,!1,Mq);s.virtual=!0,s.audioTransceiver=a,s.audioMid="0",s.audioTrack=pG(i),this._virtualStreams.push(s),this.safeEmit(MX.SUBSCRIBE_PUSH_TRACK,{stream:s})}}}},{key:"_findRemoteStream",value:function(e,t){var r=this._remoteStreams.get(e);return Array.isArray(r)?sI(r).call(r,(function(e){return e.streamId===t})):null}},{key:"_findRemoteStreamByScreen",value:function(e,t){var r=this._remoteStreams.get(e);return Array.isArray(r)?sI(r).call(r,(function(e){return e.isScreen===t})):null}},{key:"_onAddStream",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.needEmit,i=void 0===n||n,o=r.fromSignal,a=void 0===o||o,s=r.virtual,c=void 0!==s&&s;if(e.clientId!==(null===(t=this._roomInfo)||void 0===t?void 0:t.userInfo.userId)){var u=this._roomConfig,d=u.isAutoSubscribeAudio,l=u.isAutoSubscribeVideo,h=this._findRemoteStreamByScreen(e.clientId,e.screen);if(h&&h.streamId!==e.streamId){var p,v=null===(p=this._remoteStreams.get(e.clientId))||void 0===p?void 0:Iy(p).call(p,(function(e){return e.streamId!==h.streamId}));h.clean(),this._remoteStreams.set(e.clientId,v||[])}var f=this._findRemoteStream(e.clientId,e.streamId);if(this._remoteStreamStreamIdUserIdMap[e.streamId]=e.clientId,f)f.attributes=e.attributes;else if((f=new zG(this._context,e.clientId,e.streamId,e.screen,!1,e.attributes)).virtual=c,this._initStreamListeners(f),!c){var _=this._remoteStreams.get(e.clientId);_?_.push(f):this._remoteStreams.set(e.clientId,[f])}if(this._mediaServerClient.handler&&(f.observer=new _q(f,this._mediaServerClient.handler)),!f.isScreen&&l){var m,g,y,S,b,k,E,T;if(a&&f.hasVideo)if(f.attributes.extvideo)null===(m=f.observer)||void 0===m||m.setExternalVideoSource(!0),null===(g=f.observer)||void 0===g||g.setPushVideo(!0);else null===(y=f.observer)||void 0===y||y.setExternalVideoSource(!1),null===(S=f.observer)||void 0===S||S.setPublishVideo(!0);if(a&&f.hasAudio&&d&&!this._mediaServerClient.roomAttributes.multiChatMode)if(f.attributes.extaudio)null===(b=f.observer)||void 0===b||b.setExternalAudioSource(!0),null===(k=f.observer)||void 0===k||k.setPushAudio(!0);else null===(E=f.observer)||void 0===E||E.setExternalAudioSource(!1),null===(T=f.observer)||void 0===T||T.setPublishAudio(!0);if(i&&!a){var I,R=this._roomConfig,A=R.isAutoSubscribeAudio,w=R.isAutoSubscribeVideo;null===(I=f.observer)||void 0===I||I.setLogin(!0,{audio:!!A&&!this.multiChatMode,video:!!w})}}return i&&this.safeEmit(IX.ON_ADD_STREAM,{stream:f}),f}}},{key:"_onUserConnection",value:function(e){var t;if(e.clientId!==(null===(t=this._roomInfo)||void 0===t?void 0:t.userInfo.userId)){var r=this._userDuplicateLoginTimerMap.get(e.clientId);if("number"==typeof r)return this._userDuplicateLoginTimerMap.delete(e.clientId),void self.clearTimeout(r);var n={userId:e.clientId,extraInfo:e.attributes.extra_info};this._remoteUsers.set(e.clientId,Zl({},n)),this.safeEmit(IX.USER_CONNECTION,{userInfo:n}),e.attributes&&(e.attributes.serverMuteVideo&&this.safeEmit(MX.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteVideo}),e.attributes.serverMuteAudio&&this.safeEmit(MX.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteAudio}))}}},{key:"_onUserDisconnection",value:function(e){var t,r=this,n=e.clientId,i=e.tag,o=e.code,a=e.forbiddenTime;if(n)if(n===(null===(t=this.roomInfo)||void 0===t?void 0:t.userInfo.userId)){var s=null;i===wX.kickedByAdmin?s=mC.KICKED_OUT:i===wX.onUserTokenDidExpire?s=mC.TOKEN_EXPIRED:i===wX.userDuplicateLogin&&(s=mC.DUPLICATE_LOGIN),o===CX.roomDismissByAdmin&&(s=mC.ROOM_DISMISS),s&&this.safeEmit(MX.ON_ROOM_ERROR,{errorCode:s,forbiddenTime:a})}else{var c=th.DROPPED;i===wX.userLeave?c=th.QUIT:i===wX.kickedByAdmin?c=th.KICKED_BY_ADMIN:i===wX.roleChanged&&(c=th.SWITCH_TO_INVISIBLE);var u=function(){var e;r._remoteUsers.delete(n),null===(e=r._remoteStreams.get(n))||void 0===e||e.forEach((function(e){r._onRemoveStream({clientId:e.userId,streamId:e.streamId,message:EX.clientDisconnected})})),r._remoteStreams.delete(n),r.safeEmit(MX.ON_USER_LEAVE,{userInfo:{userId:n},reason:c})};if(i===wX.userDuplicateLogin){var d=this._userDuplicateLoginTimerMap.get(n);d&&self.clearTimeout(d);var l=self.setTimeout(u,5e3);this._userDuplicateLoginTimerMap.set(n,l)}else u()}}},{key:"_onRemoveStream",value:function(e){var t,r=this;if(e.clientId!==(null===(t=this._roomInfo)||void 0===t?void 0:t.userInfo.userId)){var n=this._remoteStreams.get(e.clientId);if(n){var i=sI(n).call(n,(function(t){return t.streamId===e.streamId}));if(i){var o,a,s;if(null===(o=this._mediaServerClient)||void 0===o||o.handleRemoveStream(i).then((function(){var t=r._remoteStreams.get(e.clientId);t&&(t=Iy(t).call(t,(function(t){return t.streamId!==e.streamId||(t.clean(),!1)})),r._remoteStreams.set(e.clientId,t))})).finally((function(){r.safeEmit(IX.ON_REMOVE_STREAM,{stream:i,reason:e.message,callback:function(){return i.destroy()}})})),i.hasVideo)null===(a=i.observer)||void 0===a||a.setPublishVideo(!1);if(i.hasAudio&&!this._mediaServerClient.roomAttributes.multiChatMode)null===(s=i.observer)||void 0===s||s.setPublishAudio(!1)}}}}},{key:"_onUpdateUserAttributes",value:function(e){e.attributes&&(e.attributes.serverMuteVideo&&this.safeEmit(MX.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteVideo}),e.attributes.serverMuteAudio&&this.safeEmit(MX.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteAudio}))}},{key:"_onUpdateRoomAttributes",value:function(e){var t;e.roomAttributes&&(this._mediaServerClient.roomAttributes=Zl(Zl({},this._mediaServerClient.roomAttributes),e.roomAttributes)),null!==(t=e.roomAttributes)&&void 0!==t&&t.multiChatMode&&this._handleFFAudioTrack()}},{key:"_onUpdateStreamAttributes",value:function(e){var t=this._roomConfig,r=t.isAutoSubscribeAudio,n=t.isAutoSubscribeVideo,i=e.clientId,o=e.streamId,a=e.attributes,s=this._findRemoteStream(i,o);if(s){var c,u,d=s.attributes,l=Zl(Zl({},d),a),h=!1,p=l.localaudio!==d.localaudio,v=!1,f=!1,_=l.localvideo!==d.localvideo,m=!1,g=TG.NONE,y=TG.NONE;if(l.audiostream!==d.audiostream&&(h=l.localaudio,v=!!l.audiostream,l.audiostream?g|=uh.AUDIO:y|=uh.AUDIO),l.videostream!==d.videostream&&(f=l.localvideo,m=!!l.videostream,l.videostream?g|=uh.VIDEO:y|=uh.VIDEO),g&&this.safeEmit(MX.ON_USER_PUBLISH_STATE_CHANGE,{userId:i,mediaType:g,isScreen:s.isScreen,pubState:NX.PUB,remoteStream:s}),y&&this.safeEmit(MX.ON_USER_PUBLISH_STATE_CHANGE,{userId:i,mediaType:y,isScreen:s.isScreen,pubState:NX.UNPUB,remoteStream:s}),s.attributes=l,l.localaudio!==d.localaudio)if(l.localaudio){var S,b,k,E;if(r&&l.audiostream)if(l.extaudio)null===(S=s.observer)||void 0===S||S.setExternalAudioSource(!0),null===(b=s.observer)||void 0===b||b.setPushAudio(!0);else null===(k=s.observer)||void 0===k||k.setExternalAudioSource(!1),null===(E=s.observer)||void 0===E||E.setEnableAudio(!0);this.safeEmit(MX.ON_USER_START_AUDIO_CAPTURE,{userId:i},s)}else{var T,I,R,A;if(l.extaudio)null===(T=s.observer)||void 0===T||T.setExternalAudioSource(!0),null===(I=s.observer)||void 0===I||I.setPushAudio(!1);else null===(R=s.observer)||void 0===R||R.setExternalAudioSource(!1),null===(A=s.observer)||void 0===A||A.setEnableAudio(!1);!s.isScreen&&this.safeEmit(MX.ON_USER_STOP_AUDIO_CAPTURE,{userId:i})}if(l.localvideo!==d.localvideo)if(l.localvideo){var w,C,x,O;if(n&&l.videostream)if(l.extvideo)null===(w=s.observer)||void 0===w||w.setExternalVideoSource(!0),null===(C=s.observer)||void 0===C||C.setPushVideo(!0);else null===(x=s.observer)||void 0===x||x.setExternalVideoSource(!1),null===(O=s.observer)||void 0===O||O.setEnableVideo(!0);this.safeEmit(MX.ON_USER_START_VIDEO_CAPTURE,{userId:i})}else{var P,M,D,N;if(l.extvideo)null===(P=s.observer)||void 0===P||P.setExternalVideoSource(!0),null===(M=s.observer)||void 0===M||M.setPushVideo(!1);else null===(D=s.observer)||void 0===D||D.setExternalVideoSource(!1),null===(N=s.observer)||void 0===N||N.setEnableVideo(!1);!s.isScreen&&this.safeEmit(MX.ON_USER_STOP_VIDEO_CAPTURE,{userId:i})}if(h&&!p&&r)null===(c=s.observer)||void 0===c||c.setRemoteUnmuteAudio(v);if(f&&!_&&n)null===(u=s.observer)||void 0===u||u.setRemoteUnmuteVideo(m)}}},{key:"_onPushTrack",value:function(e){var t,r=this;if(null!==(t=e.streamId)&&void 0!==t&&_C(t).call(t,"audio_mux")){var n=this._onAddStream(Zl(Zl({},e),{},{attributes:Mq}),{needEmit:!1,fromSignal:!1,virtual:!0});n&&this._mediaServerClient.subscribe4pushTrack(n,e).then((function(){r.safeEmit(MX.SUBSCRIBE_PUSH_TRACK,{stream:n}),r._virtualStreams.push(n)})).catch((function(e){r.logger.error("subscribe","push track failed %o",e)}))}else{var i,o;null===(i=this._monitor)||void 0===i||i.report("rtc_error",{message:Bg(o="onPushTrack, userId: ".concat(e.clientId,", ")).call(o,e.streamId),error_code:FX.TRACK_ERROR})}}},{key:"_onRemoveTrack",value:function(e){var t,r=e.clientId,n=e.streamId,i=e.message,o=e.trackType;this.logger.info("_onRemoveTrack","remove track: %o",r);var a=this._findRemoteStream(r,n);a&&(a.removeTrack=!0,null===(t=this._mediaServerClient)||void 0===t||t.unsubscribe4removeTrack(a,i,o),this.emit(MX.REMOVE_PUSH_TRACK,{stream:a,mediaType:o+1}))}},{key:"_onMeetingSpeakerChange",value:function(e){if(Array.isArray(null==e?void 0:e.speakerCsrcInfo)){var t={};null==e||e.speakerCsrcInfo.forEach((function(e){var r=e.csrc,n=e.userId;e.isScreen||(t[r]=n)})),this._csrcUserIdMap=t}Array.isArray(e.muxStreamInUse)&&this._virtualStreams.forEach((function(t){var r;null!==(r=e.muxStreamInUse)&&void 0!==r&&qy(r).call(r,t.streamId)?t.virtualOccupy=!0:t.virtualOccupy=!1}))}},{key:"getActiveSpeakerInMultiChatMode",value:function(){var e=this,t=[];return this._virtualStreams.forEach((function(r){var n,i=null===(n=r.audioTransceiver)||void 0===n?void 0:n.receiver;if(i){var o=yy(i.getContributingSources()||[],1)[0];if(o){var a=o.audioLevel,s=o.source;e._csrcUserIdMap[s]&&t.push({userId:e._csrcUserIdMap[s],audioLevel:a})}}})),t.length&&Ww(t).call(t,(function(e,t){return e.audioLevel-t.audioLevel})),t}},{key:"_onReconnecting",value:function(){var e,t,r,n,i,o,a,s=this;if(this._roomInfo){var c,u=gy(uw(a=this._remoteStreams).call(a));try{for(u.s();!(c=u.n()).done;){var d=c.value;Array.isArray(d)&&d.forEach((function(e){var t;null===(t=e.observer)||void 0===t||t.setDisconnect(),e.clean()}))}}catch(J$){u.e(J$)}finally{u.f()}this._virtualStreams.forEach((function(e){var t;s.emit(MX.REMOVE_PUSH_TRACK,{stream:e,mediaType:uh.AUDIO}),null===(t=e.observer)||void 0===t||t.setDisconnect(),e.clean()})),this._virtualStreams=[],null===(e=this.localStream)||void 0===e||null===(t=e.observer)||void 0===t||t.setDisconnect(),null===(r=this.localStream)||void 0===r||r.clean(),null===(n=this.localScreenStream)||void 0===n||null===(i=n.observer)||void 0===i||i.setDisconnect(),null===(o=this.localScreenStream)||void 0===o||o.clean()}}},{key:"_onConnectionStateChange",value:function(e){var t,r=this;if(e.next===cq.DISCONNECTED)t=lh.CONNECTION_STATE_DISCONNECTED;else if(e.next===cq.CONNECTED)clearTimeout(this._connectionLostTimer),t=this._mediaServerClient.isReconnecting?lh.CONNECTION_STATE_RECONNECTED:lh.CONNECTION_STATE_CONNECTED;else{if(e.next!==cq.CONNECTING)return;this._mediaServerClient.isReconnecting?(t=lh.CONNECTION_STATE_RECONNECTING,this._onReconnecting()):t=lh.CONNECTION_STATE_CONNECTING}e.prev===cq.CONNECTED&&e.next===cq.DISCONNECTED&&(this._connectionLostTimer=window.setTimeout((function(){r.safeEmit(AX.ON_CONNECTION_STATE_CHANGE,{state:lh.CONNECTION_STATE_LOST})}),1e4)),this._networkQualityManager.setMSC(this._mediaServerClient),this.safeEmit(AX.ON_CONNECTION_STATE_CHANGE,{state:t})}},{key:"_initStreamListeners",value:function(e){var t=this;e.on("ontrack",(function(e){e.track})),e.on("onSEIMessage",(function(r){var n;t.emit(MX.ON_SEI_MESSAGED_RECEIVED,{sei:r,remoteStreamKey:{userId:e.userId,roomId:null===(n=t._roomInfo)||void 0===n?void 0:n.roomId,streamIndex:e.isScreen?ch.STREAM_INDEX_SCREEN:ch.STREAM_INDEX_MAIN}})}))}},{key:"_onCustomMessage",value:function(e){this.safeEmit(IX.ON_CUSTOM_MESSAGE,e)}},{key:"_onUserMessageReceived",value:function(e){this.safeEmit(IX.USER_MESSAGE_RECEIVED,{userId:e.from,message:e.msg})}},{key:"_onUserBinaryMessageReceived",value:function(e){var t,r={userId:e.from,message:e.msg};null!==(t=this._subtitleTool)&&void 0!==t&&t.onMessageRecv(r)||this.safeEmit(IX.USER_BINARY_MESSAGE_RECEIVED,r)}},{key:"_initSubtitleTool",value:function(){var e=this;this._subtitleTool=new Iq(this),this._subtitleTool.onEvent=function(t){e.emit(MX.ON_SUBTITLE_STATE_CHANGED,t)},this._subtitleTool.onMessage=function(t){e.emit(MX.ON_SUBTITLE_MESSAGE_RECEIVED,t)}}},{key:"_onPostProcessingMessage",value:function(e){if(e.body)if("subtitleCallback"!==e.type){var t=e.body,r=t.error||0,n=DX.START,i=["success","parameter error","subscription timeout","ffmpeg error","cdn error","publish error"];if("2.0"===t.protocol){switch(t.eventType){case"TranscodeStarted":0!==t.error&&(n=DX.START_FAILED);break;case"TranscodeStateChanged":n=0!==t.error?DX.START_FAILED:DX.START_SUCCESS;break;case"TranscodeStopped":n=0!==t.error?DX.STOP_FAILED:DX.STOP_SUCCESS;break;case"TranscodeUpdated":n=0!==t.error?DX.UPDATE_FAILED:DX.UPDATE_SUCCESS}this.safeEmit(IX.POST_PROCESSING_MESSAGE,{code:r,protocol:t.protocol,error:t.error,eventType:n,message:i[r]})}this.safeEmit(IX.POST_PROCESSING_MESSAGE,{code:r,message:i[r],type:e.type})}else{var o;null===(o=this._subtitleTool)||void 0===o||o.onResult(e)}}},{key:"_onUserTokenWillExpire",value:function(){this.safeEmit(IX.ON_USER_TOKEN_WILL_EXPIRE,null)}},{key:"_onStreamFailed",value:(n=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c,u,d,l,h,p;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("publish"!==t.type){e.next=11;break}if(s=void 0,(null===(r=this.localStream)||void 0===r?void 0:r.streamId)===t.streamId?s=this.localStream:(null===(n=this.localScreenStream)||void 0===n?void 0:n.streamId)===t.streamId&&(s=this.localScreenStream),s){e.next=5;break}return e.abrupt("return");case 5:return null===(i=s)||void 0===i||i.clean(),e.next=8,null===(o=this._mediaServerClient)||void 0===o?void 0:o.unpublish(s).catch((function(){}));case 8:null===(a=this._mediaServerClient)||void 0===a||a.publish(s).catch((function(){})),e.next=22;break;case 11:if("subscribe"!==t.type){e.next=22;break}if(c=this._remoteStreamStreamIdUserIdMap[t.streamId],!(u=this._findRemoteStream(c,t.streamId))){e.next=22;break}return h=u.subMediaType,p=u.subLayer,e.next=19,null===(d=this._mediaServerClient)||void 0===d?void 0:d.unsubscribe(u);case 19:return e.next=21,null===(l=this._mediaServerClient)||void 0===l?void 0:l.subscribe(u,h,p);case 21:this.safeEmit(MX.RESUBSCRIBE,{stream:u});case 22:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_onStreamControlMessage",value:function(e){var t,r;e.type===TX.PushLimitWarn&&(null!==(t=this._localStream)&&void 0!==t&&t.pubAudio||null!==(r=this._localStream)&&void 0!==r&&r.pubVideo||this.unpublish())}},{key:"_onPublishOnDemand",value:(r=Ng(Mg().mark((function e(){var t,r,n,i,o,a,s,c,u,d,l,h,p,v,f;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._publishOnDemandItem&&!this._publishOnDemandBusy&&!1!==(null===(t=this._serverConfig)||void 0===t||null===(r=t.engine_VPM)||void 0===r||null===(n=r.ondemand)||void 0===n?void 0:n.enable)){e.next=2;break}return e.abrupt("return");case 2:if(null===(i=this._localStream)||void 0===i||!i.enableSimulcast||null===(o=this._localStream)||void 0===o||!o.videoTransceiver){e.next=16;break}return this._publishOnDemandBusy=!0,u=this._publishOnDemandItem,this._publishOnDemandItem=void 0,d=[],l=null===(s=this._localStream)||void 0===s?void 0:s.stream.id,h=null===(c=this._localStream)||void 0===c?void 0:c.videoTransceiver.sender,p=h.getParameters(),Array.isArray(p.encodings)&&Array.isArray(u)&&(f={},this.logger.info("_onPublishOnDemand exec","usedDescriptions: %o",u),u.forEach((function(e){var t;if(null!=e&&null!==(t=e.StreamIds)&&void 0!==t&&qy(t).call(t,l)){var r=null==e?void 0:e.Metadata.VideoIndex;f[r]=!0}})),p.encodings=Jg(v=p.encodings).call(v,(function(e){if(e.rid){f[e.rid]?e.active=!0:e.active=!1;var t=Number(e.rid);d[t]=e.active}return e})),this._context&&(this._context.activeSimStreams=d)),e.next=13,h.setParameters(p);case 13:this._publishOnDemandBusy=!1,e.next=18;break;case 16:if(null!==(a=this._localStream)&&void 0!==a&&a.videoTransceiver){e.next=18;break}return e.abrupt("return");case 18:this._onPublishOnDemand();case 19:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_onRTT",value:function(e){var t=e.StreamIds,r=e.Metadata;if(t.length&&r){var n,i=t[0];null!==(n=this._context)&&void 0!==n&&n.streamRTT&&(this._context.streamRTT[i]={audio:r.audio_rtt,video:r.video_rtt})}}},{key:"_onSSC",value:function(e){var t=e.StreamIds,r=e.Metadata,n=t[0],i=this._remoteStreamStreamIdUserIdMap[n],o=this._findRemoteStream(i,n),a={userId:i,isScreen:!!o&&o.isScreen,beforeVideoIndex:r.ssc_items[0].prev_layer_id,afterVideoIndex:r.ssc_items[0].cur_layer_id,beforeEnable:0!==r.ssc_items[0].prev_video_open,afterEnable:0!==r.ssc_items[0].cur_video_open,reason:r.ssc_items[0].change_reason};this.emit(MX.ON_SIMULCAST_SUBSCRIBE_FALLBACK,a)}},{key:"_reportNetworkQuality",value:function(e,t){this.emit(MX.ON_NETWORK_QUALITY,e,t)}},{key:"_emitVideoSizeChange",value:function(e,t,r,n){var i;this.emit(MX.ON_REMOTE_VIDEO_SIZE_CHANGED,{roomId:null===(i=this.roomInfo)||void 0===i?void 0:i.roomId,userId:e,streamIndex:t?ch.STREAM_INDEX_SCREEN:ch.STREAM_INDEX_MAIN},{width:r,height:n})}},{key:"multiChatMode",get:function(){var e;return null===(e=this._mediaServerClient)||void 0===e?void 0:e.multiChatMode()}},{key:"setAudioEncodeMaxBitrate",value:(t=Ng(Mg().mark((function e(t,r){var n,i,o,a;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(n=t===ch.STREAM_INDEX_MAIN?this.localStream:this.localScreenStream)||!n.pubAudio){e.next=7;break}if(null==(o=null===(i=n.audioTransceiver)||void 0===i?void 0:i.sender.getParameters())||!o.encodings.length){e.next=7;break}return o.encodings[0].maxBitrate=1e3*r,e.next=7,null===(a=n.audioTransceiver)||void 0===a?void 0:a.sender.setParameters(o);case 7:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),x}(oV),Nq=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=document.createElement(e);return t.id&&(r.id=t.id),t.classList&&t.classList.forEach((function(e){r.classList.add(e)})),t.style&&IT(r.style,t.style),t.attributes&&NS(t.attributes).forEach((function(e){var t=yy(e,2),n=t[0],i=t[1];"muted"===n?r.muted=!0:r.setAttribute(n,i)})),r},Lq=["play","playing","pause","ended","error","seeking","seeked","waiting","canplay","canplaythrough","durationchange","volumechange","loadedmetadata","loadeddata","loadstart","timeupdate"],Uq={playsinline:"","webkit-playsinline":""},Vq={playsinline:"","webkit-playsinline":"","x5-playsinline":"","x5-video-player-type":"h5","x-webkit-airplay":"allow",preload:"",muted:""},Fq=function(e){VA(n,e);var t,r=tw(n);function n(e,t){var i;Bh(this,n),Jl(sA(i=r.call(this)),"_containerDom",void 0),Jl(sA(i),"_videoDom",void 0),Jl(sA(i),"userId",void 0),Jl(sA(i),"renderMode",void 0),Jl(sA(i),"mirrorType",hh.MIRROR_TYPE_NONE),Jl(sA(i),"isScreen",void 0),Jl(sA(i),"isLocal",void 0),Jl(sA(i),"played",!1),Jl(sA(i),"_needLoad",!1),Jl(sA(i),"_emitPlayFailed",!1),Jl(sA(i),"_videoContainer",void 0),Jl(sA(i),"_safari15VideoTimer",void 0),Jl(sA(i),"_monitor",void 0),Jl(sA(i),"logger",void 0),Jl(sA(i),"_onLocalTrackMute",void 0),Jl(sA(i),"_onInterruptionEnd",void 0),Jl(sA(i),"_needResume",!1),Jl(sA(i),"_rotate",0),Jl(sA(i),"_rotateDom",void 0),Jl(sA(i),"_resizeObserver",void 0),Jl(sA(i),"_hasManuallyPaused",!1),Jl(sA(i),"_stream",void 0),Jl(sA(i),"emitVideoEvent",(function(e){var t,r,n={type:"video",rawEvent:e,readyState:(null===(t=i._videoDom)||void 0===t?void 0:t.readyState)||0,userId:i.userId,eventName:e.type,currentTime:(null===(r=i._videoDom)||void 0===r?void 0:r.currentTime)||0,isScreen:i.isScreen};switch(i.emit("playback_event",n),e.type){case"canplay":i.refreshRenderSize("the video started playing."),i._internalPlay();break;case"loadeddata":i._internalPlay();break;case"playing":i.logger.info("VideoPlayerPlaying","[userId-".concat(i.userId,"] video element playing"));break;case"pause":i.logger.info("VideoPlayerPause","[userId-".concat(i.userId,"] video element pause")),i._needResume&&(i.logger.info("VideoPlayerPause","[userId-".concat(i.userId,"] video element resume")),i._internalPlay(),i._needResume=!1)}})),Jl(sA(i),"_internalPlay",(function(){var e,t;if(JD(i.engineId,"video _internalPlay",{paused:null===(e=i._videoDom)||void 0===e?void 0:e.paused,hasManuallyPaused:i._hasManuallyPaused}),!i._hasManuallyPaused&&null!==(t=i._videoDom)&&void 0!==t&&t.paused){var r=i._videoDom.play();null!=r&&r.then&&r.then((function(){var e;i.isLocal&&HL&&!i._needLoad&&(null===(e=i._videoDom)||void 0===e||e.load(),i._needLoad=!0)})).catch((function(e){var t,r,n,o,a,s;i._emitPlayFailed||("AbortError"!==e.name?(i._emitPlayFailed=!0,null===(t=i._monitor)||void 0===t||t.report("rtc_error",{message:Bg(r="video autoplay failed, userId: ".concat(i.userId,", ")).call(r,e.name),error_code:FX.AUTOPLAY_FAILED}),i.emit("playback_event",{type:"video",rawEvent:e,readyState:(null===(n=i._videoDom)||void 0===n?void 0:n.readyState)||0,userId:i.userId,eventName:"autoplay-error",currentTime:(null===(o=i._videoDom)||void 0===o?void 0:o.currentTime)||0,isScreen:i.isScreen})):null===(a=i._monitor)||void 0===a||a.report("rtc_error",{message:Bg(s="video autoplay failed, userId: ".concat(i.userId,", ")).call(s,e.name),error_code:FX.AUTOPLAY_FAILED}))}))}})),i.engineId=e;var o=t.renderDom;i._monitor=KD(e),i.logger=new lN("Player",0,e);var a=t.userId,s=t.isScreen?sh.RENDER_MODE_FIT:sh.RENDER_MODE_HIDDEN;i.renderMode=void 0!==t.renderMode?t.renderMode:s,i._rotate=Number(t.rotation||0);var c="string"==typeof o?document.getElementById(o):o;if(!c)throw new kC(mC.CANT_FIND_DOM,"can't find dom");return i._videoContainer=document.createElement("div"),i._videoContainer.style.width="100%",i._videoContainer.style.height="100%",i._videoContainer.style.position="relative",i._videoContainer.style.overflow="hidden",i._containerDom=c,i.userId=a,i.isLocal=!!t.isLocal,i.isScreen=!!t.isScreen,i._initVideo(),!i.isLocal||15!==(null==cU?void 0:cU[0])&&15!==oU||(i._safari15VideoTimer=window.setTimeout((function(){try{i._videoContainer.style.display="block",setTimeout((function(){i._videoContainer.style.display="flex"}),500)}catch(Y$){}}),1e3)),i}return Fh(n,[{key:"_initVideo",value:function(){var e,t,r=this;this._videoDom||(this._videoDom=Nq("video",{style:{width:"100%",height:"100%"},attributes:Vq}),this._videoDom.id=Bg(t="".concat(this.userId,"_")).call(t,iL()),this.setRenderMode(this.renderMode),this.mirror(this.mirrorType===hh.MIRROR_TYPE_RENDER));this._containerDom.appendChild(this._videoContainer),SI(e=[90,270]).call(e,this._rotate)>-1?(this._rotateDom=this._createRotationDiv(),this._rotateDom.appendChild(this._videoDom),this._videoContainer.appendChild(this._rotateDom)):(180===this._rotate&&(this._videoContainer.style.transform="rotate(180deg)"),this._videoContainer.appendChild(this._videoDom)),this._initListeners(),this._onLocalTrackMute=function(){r._needResume=!0},this._onInterruptionEnd=function(){r.logger.warn("resume player after iOS interruption"),r._internalPlay()},xH.on(wH.ON_IOS_LOCAL_TRACK_MUTE,this._onLocalTrackMute),xH.on(wH.ON_IOS_LOCAL_TRACK_UNMUTE,this._onInterruptionEnd),xH.on(wH.ON_IOS_INTERRUPTION_END,this._onInterruptionEnd)}},{key:"_createRotationDiv",value:function(){var e=this,t=document.createElement("div");return t.style.transform="rotate(".concat(this._rotate,"deg)"),180!==this._rotate&&(t.style.position="absolute",this.refreshRenderSize("init"),window.ResizeObserver&&(this._resizeObserver=new ResizeObserver((function(){e.refreshRenderSize("the container size has changed.")})),this._resizeObserver.observe(this._containerDom))),t}},{key:"refreshRenderSize",value:function(e){if(this._rotateDom){var t,r;this.logger.print("refreshRenderSize","Because ".concat(e));var n=Number(window.getComputedStyle(this._containerDom).width.replace("px","")),i=Number(window.getComputedStyle(this._containerDom).height.replace("px","")),o=null===(t=this._videoDom)||void 0===t?void 0:t.videoWidth,a=null===(r=this._videoDom)||void 0===r?void 0:r.videoHeight;if(n&&i&&a&&o){var s,c;if(this.renderMode===sh.RENDER_MODE_FILL)s=i,c=n;else{var u=this.renderMode===sh.RENDER_MODE_HIDDEN?Math.max(n/a,i/o):Math.min(n/a,i/o);s=o*u,c=a*u}this._rotateDom.style.width="".concat(s,"px"),this._rotateDom.style.height="".concat(c,"px"),this._rotateDom.style.left="".concat((n-s)/2,"px"),this._rotateDom.style.top="".concat((i-c)/2,"px")}}}},{key:"_initListeners",value:function(){var e=this;this._videoDom&&Lq.forEach((function(t){var r;null===(r=e._videoDom)||void 0===r||r.addEventListener(t,e.emitVideoEvent)}))}},{key:"_removeListeners",value:function(){var e=this;this._videoDom&&Lq.forEach((function(t){var r;null===(r=e._videoDom)||void 0===r||r.removeEventListener(t,e.emitVideoEvent)}))}},{key:"setRenderMode",value:function(e){this.renderMode=e,this._videoDom&&(this.renderMode===sh.RENDER_MODE_FIT?this._videoDom.style.objectFit="contain":this.renderMode===sh.RENDER_MODE_FILL?this._videoDom.style.objectFit="fill":this._videoDom.style.objectFit="cover")}},{key:"playVideo",value:(t=Ng(Mg().mark((function e(t,r){var n,i,o,a,s=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this._videoDom,this._stream=r,this.logger.info("playVideo","play video track: ".concat(this.userId)),!(o&&o.srcObject instanceof MediaStream&&o.srcObject.getTrackById(null===(n=t.preprocessingTrack)||void 0===n?void 0:n.id))){e.next=6;break}try{JD(this.engineId,"playVideo","play video repeatedly",0,this.userId)}catch(Y$){}return e.abrupt("return");case 6:o||(this._initVideo(),o=this._videoDom),this.logger.info("playVideo","play video by dom: ".concat(null===(i=o)||void 0===i?void 0:i.id)),a=new MediaStream,t.videoPlayer=this,a.addTrack(t.preprocessingTrack),o.srcObject=a,o&&!this._containerDom.contains(this._videoContainer)&&this._containerDom.appendChild(this._videoContainer),o&&!this._videoContainer.contains(o)&&this._videoContainer.appendChild(o),setTimeout((function(){return s._internalPlay()})),r&&RU.VIDEO_STALL&&r.startVideoStallObserve(this),this.played=!0;case 17:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"updateSrcObject",value:function(e){var t=e.preprocessingTrack;if(t&&this._videoDom){var r=new MediaStream;r.addTrack(t),this._videoDom.srcObject=r}}},{key:"removeTrack",value:function(){var e,t=null===(e=this._videoDom)||void 0===e?void 0:e.srcObject;if(t){var r=t.getVideoTracks();null!=r&&r.length&&r.forEach((function(e){t.removeTrack(e)}))}}},{key:"manuallyPlay",value:function(){if(this.logger.info("Invoke VideoPlayer.manuallyPlay",this.userId,this.isScreen),this._emitPlayFailed=!1,this._hasManuallyPaused=!1,!this._videoDom)throw new kC(mC.INVALID_PARAMS,"Player not found");return 0!==this._videoDom.readyState||JL?this._videoDom.play():HI.resolve()}},{key:"manuallyPause",value:function(){if(this.logger.print("Invoke VideoPlayer.manuallyPause",this.userId,this.isScreen),this.played){if(this._hasManuallyPaused=!0,!this._videoDom)throw new kC(mC.INVALID_PARAMS,"Player not found");return this._videoDom.pause()}}},{key:"mirror",value:function(e){var t;this.logger.info("mirror",Bg(t="".concat(this.userId," set mirror: ")).call(t,e)),this.mirrorType=e?hh.MIRROR_TYPE_RENDER:hh.MIRROR_TYPE_NONE,this._videoDom&&(this._videoDom.style.transform=e?"rotateY(180deg)":"")}},{key:"stop",value:function(){var e,t,r,n=this,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=this._containerDom;(this.logger.info("stop","stop video track: ".concat(this.userId)),null===(e=this._stream)||void 0===e||e.stopVideoStallObserve(),this._videoDom)&&(i||(this._videoDom.srcObject=null),null!=o&&o.contains(this._videoContainer)&&o.removeChild(this._videoContainer),null===(t=this._videoContainer)||void 0===t||t.childNodes.forEach((function(e){e!==n._videoDom&&e!==n._rotateDom||n._videoContainer.removeChild(e)})),null!==(r=this._rotateDom)&&void 0!==r&&r.contains(this._videoDom)&&this._rotateDom.removeChild(this._videoDom));this._hasManuallyPaused=!1,this.played=!1}},{key:"destroy",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger.info("destroy","video player: ".concat(this.userId)),this.stop(t),null===(e=this._resizeObserver)||void 0===e||e.disconnect(),LA(NA(n.prototype),"removeAllListeners",this).call(this),this._removeListeners(),xH.off(wH.ON_IOS_LOCAL_TRACK_MUTE,this._onLocalTrackMute),xH.off(wH.ON_IOS_LOCAL_TRACK_UNMUTE,this._onInterruptionEnd),xH.off(wH.ON_IOS_INTERRUPTION_END,this._onInterruptionEnd),this._videoDom&&delete this._videoDom,this._safari15VideoTimer&&(window.clearInterval(this._safari15VideoTimer),this._safari15VideoTimer=void 0)}},{key:"domElement",get:function(){return this._videoDom}}]),n}(rV.EventEmitter),Bq=function(e){VA(i,e);var t,r,n=tw(i);function i(e,t){var r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{divId:void 0,muted:!1,isScreen:!1},a=o.divId,s=o.muted,c=o.isScreen;if(Bh(this,i),Jl(sA(r=n.call(this)),"_containerDom",void 0),Jl(sA(r),"_audioDom",void 0),Jl(sA(r),"_fakeAudioDom",void 0),Jl(sA(r),"userId",void 0),Jl(sA(r),"muted",!1),Jl(sA(r),"_emitPlayFailed",!1),Jl(sA(r),"played",!1),Jl(sA(r),"isScreen",void 0),Jl(sA(r),"_wechatTimer",void 0),Jl(sA(r),"_edgeTimer",void 0),Jl(sA(r),"_monitor",void 0),Jl(sA(r),"logger",void 0),Jl(sA(r),"_pasued",!0),Jl(sA(r),"emitAudioEvent",(function(e){var t,n,i,o,a={type:"audio",rawEvent:e,readyState:(null===(t=r._audioDom)||void 0===t?void 0:t.readyState)||0,userId:r.userId,eventName:e.type,currentTime:(null===(n=r._audioDom)||void 0===n?void 0:n.currentTime)||0};("playing"===e.type&&r.logger.info("AudioPlayerPlaying","[userId-".concat(r.userId,"] audio element playing")),"pause"===e.type)&&(r.logger.info("AudioPlayerPause","[userId-".concat(r.userId,"] audio element pause")),!r._pasued&&null!==(i=r._audioDom)&&void 0!==i&&null!==(o=i.srcObject)&&void 0!==o&&o.active&&r._internalPlay());$L&&JL&&("canplay"===e.type?(clearTimeout(r._wechatTimer),r._wechatTimer=window.setTimeout((function(){r._autoPlayError("wechat")}),500)):"playing"===e.type&&clearTimeout(r._wechatTimer)),QL&&WL&&"error"===e.type&&(clearTimeout(r._edgeTimer),r._edgeTimer=window.setTimeout((function(){var e;0===(null===(e=r._audioDom)||void 0===e?void 0:e.currentTime)&&r._autoPlayError("edge")}),500)),r.emit("playback_event",a)})),Jl(sA(r),"_internalPlay",(function(){var e,t;if(JD(r.engineId,"audio _internalPlay",{paused:null===(e=r._audioDom)||void 0===e?void 0:e.paused,userId:r.userId,screen:r.isScreen}),null!==(t=r._audioDom)&&void 0!==t&&t.paused)try{var n,i=r._audioDom.play(),o=DH.getAudioContextInstance();if("suspended"===o.state){var a=o.resume(),s=setTimeout((function(){var e;"suspended"===o.state&&(r._autoPlayError("AudioContext cannot resume"),null===(e=r._monitor)||void 0===e||e.report("rtc_error",{message:"audio autoplay failed, userId: ".concat(r.userId,": Cannot resume the AudioContext - timeout"),error_code:-1e3}));clearTimeout(s)}));a.catch((function(e){var t,n,i;r._autoPlayError("AudioContext cannot resume"),null===(t=r._monitor)||void 0===t||t.report("rtc_error",{message:Bg(n=Bg(i="audio autoplay failed, userId: ".concat(r.userId,": Cannot resume the AudioContext - rejected by: [")).call(i,null==e?void 0:e.name,"]")).call(n,null==e?void 0:e.message),error_code:-1e3})})).finally((function(){clearTimeout(s)}))}null!==(n=i)&&void 0!==n&&n.then&&($L&&QL&&(i=i.then((function(){return new HI((function(e){setTimeout(Ng(Mg().mark((function t(){var n;return Mg().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return null===(n=r._audioDom)||void 0===n||n.pause(),r._audioDom.volume=1,t.next=4,r._audioDom.play();case 4:e();case 5:case"end":return t.stop()}}),t)}))),500)}))}))),i.then((function(){JD(r.engineId,"_internalPlay successfully",{userId:r.userId,screen:r.isScreen}),r._pasued=!1})).catch((function(e){var t,n,i;r._autoPlayError(e),null===(t=r._monitor)||void 0===t||t.report("rtc_error",{message:Bg(n=Bg(i="audio autoplay failed, userId: ".concat(r.userId,": ")).call(i,e.message," ")).call(n,e.name),error_code:FX.AUTOPLAY_FAILED})})))}catch(l){var c,u,d;r._autoPlayError(l),null===(c=r._monitor)||void 0===c||c.report("rtc_error",{message:Bg(u=Bg(d="audio autoplay failed, userId: ".concat(r.userId,": ")).call(d,l.message," ")).call(u,l.name),error_code:FX.AUTOPLAY_FAILED})}})),r.engineId=e,a){var u=document.getElementById(a);if(!u)throw new kC(mC.CANT_FIND_DOM,"can't find dom");r._containerDom=u}else r._containerDom=document.body;return r.userId=t,r.muted=s,r.isScreen=c,r._monitor=KD(e),r.logger=new lN("Player",0,e),r._initAudio(),r}return Fh(i,[{key:"_initAudio",value:function(){var e;this._audioDom||(this._audioDom=Nq("audio",{style:{display:"none"},attributes:Uq}),this._audioDom.volume=this.muted?0:1,this._audioDom.muted=this.muted,this._audioDom.id=Bg(e="".concat(this.userId,"_")).call(e,iL()),this._containerDom.appendChild(this._audioDom));this._initListeners()}},{key:"_initListeners",value:function(){var e=this;this._audioDom&&Lq.forEach((function(t){var r;null===(r=e._audioDom)||void 0===r||r.addEventListener(t,e.emitAudioEvent)}))}},{key:"_removeListeners",value:function(){var e=this;this._audioDom&&(Lq.forEach((function(t){var r;null===(r=e._audioDom)||void 0===r||r.removeEventListener(t,e.emitAudioEvent)})),this._audioDom.removeEventListener("canplay",this._internalPlay),this._audioDom.removeEventListener("loadeddata",this._internalPlay))}},{key:"playAudio",value:(r=Ng(Mg().mark((function e(t){var r,n,i,o,a,s=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("playAudio","play audio track: ".concat(this.userId)),!((o=this._audioDom)&&o.srcObject instanceof MediaStream&&o.srcObject.getTrackById(null===(r=t.preprocessingTrack)||void 0===r?void 0:r.id))){e.next=4;break}return e.abrupt("return");case 4:o||(this._initAudio(),o=this._audioDom),a=new MediaStream,t instanceof EG?(this._fakeAudioDom=new Audio,this._fakeAudioDom.muted=!0,this._fakeAudioDom.srcObject=new MediaStream([t.originTrack]),a.addTrack(t.preprocessingTrack)):a.addTrack(t.preprocessingTrack),$L&&QL&&(this._audioDom.volume=0),o.srcObject=a,null===(n=o)||void 0===n||n.addEventListener("canplay",this._internalPlay),null===(i=o)||void 0===i||i.addEventListener("loadeddata",this._internalPlay),setTimeout((function(){return s._internalPlay()})),this.played=!0;case 13:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_autoPlayError",value:function(e){var t,r;this._emitPlayFailed||(this._emitPlayFailed=!0,this.emit("playback_event",{type:"audio",rawEvent:e,readyState:(null===(t=this._audioDom)||void 0===t?void 0:t.readyState)||0,userId:this.userId,eventName:"autoplay-error",currentTime:(null===(r=this._audioDom)||void 0===r?void 0:r.currentTime)||0}))}},{key:"pause",value:function(){if(!this._audioDom)throw new kC(mC.INVALID_PARAMS,"Player not found");this._pasued=!0,this._audioDom.pause()}},{key:"manuallyPause",value:function(){return this.pause()}},{key:"manuallyPlay",value:function(){var e,t=this;if(this.logger.info("Invoke AudioPlayer.manuallyPlay"),this._emitPlayFailed=!1,!this._audioDom)throw new kC(mC.INVALID_PARAMS,"Player not found");if(!this.played)return HI.resolve();this._audioDom.volume=1,this._audioDom.muted=!1,null===(e=this._fakeAudioDom)||void 0===e||e.play();var r=[],n=this._audioDom.play();null!=n&&n.then&&r.push(n);var i=DH.getAudioContextInstance();if("suspended"===i.state){var o=i.resume();null!=o&&o.then&&r.push(o)}(r.length>0?HI.all(r):HI.resolve(n)).then((function(){t._pasued=!1}))}},{key:"setPlaybackDevice",value:(t=Ng(Mg().mark((function e(t){var r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("setPlaybackDevice","setPlaybackDevice: ".concat(t)),e.next=3,RH.enumerateAudioPlaybackDevices();case 3:if(r=e.sent,n=Jg(r).call(r,(function(e){return e.deviceId})),qy(n).call(n,t)&&this._audioDom&&this._audioDom.setSinkId){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this._audioDom.setSinkId(t);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"stop",value:function(){var e=this._containerDom;this.logger.info("stopAudio","stop audio track: ".concat(this.userId)),this._audioDom&&(this._audioDom.srcObject=null,null!=e&&e.contains(this._audioDom)&&e.removeChild(this._audioDom)),this._fakeAudioDom&&(this._fakeAudioDom.srcObject=null,this._fakeAudioDom=void 0),this.played=!1}},{key:"domElement",get:function(){return this._audioDom}},{key:"destroy",value:function(){this.logger.info("destroy","audio player: ".concat(this.userId)),this.stop(),LA(NA(i.prototype),"removeAllListeners",this).call(this),this._removeListeners(),this._audioDom&&(this._audioDom.srcObject=null,delete this._audioDom),this._edgeTimer&&clearTimeout(this._edgeTimer)}}]),i}(rV.EventEmitter);function jq(e,t,r,n){var i=function(){var e=Ng(Mg().mark((function e(t,i){var o,a;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=null==n?void 0:n.get(i),Array.isArray(o)&&(o=null===(a=o)||void 0===a?void 0:sI(a).call(a,(function(e){return e.isScreen===r}))),!t){e.next=9;break}if(!t.played){e.next=8;break}return e.next=6,t.manuallyPlay();case 6:e.next=9;break;case 8:o&&(t instanceof Fq&&o.videoTrack&&t.playVideo(o.videoTrack,o),t instanceof Bq&&o.audioTrack&&t.playAudio(o.audioTrack));case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();if(t)return i(e.get(t),t);var o=[];return e.forEach((function(e,t){return o.push(i(e,t))})),HI.all(o)}var Hq=a,Gq=pt("iterator"),zq=!Hq((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2&b=3"),n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),r.delete("a",2),r.delete("b",void 0),!e.toJSON||!r.has("a",1)||r.has("a",2)||!r.has("a",void 0)||r.has("b")||!t.size&&true||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[Gq]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://ÑÐµÑÑ").host||"#%D0%B1"!==new URL("http://a#Ð±").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),Kq=Cr,Wq=o,Xq=M,qq=m,Yq=x,Jq=zq,Qq=fi,Zq=mi,$q=ak,eY=ji,tY=du,rY=no,nY=Ev,iY=w,oY=$e,aY=Qt,sY=gn,cY=nr,uY=te,dY=bn,lY=Xn,hY=B,pY=wp,vY=bp,fY=Dv,_Y=fw,mY=pt("iterator"),gY="URLSearchParams",yY=gY+"Iterator",SY=rY.set,bY=rY.getterFor(gY),kY=rY.getterFor(yY),EY=Object.getOwnPropertyDescriptor,TY=function(e){if(!Yq)return Wq[e];var t=EY(Wq,e);return t&&t.value},IY=TY("fetch"),RY=TY("Request"),AY=TY("Headers"),wY=RY&&RY.prototype,CY=AY&&AY.prototype,xY=Wq.RegExp,OY=Wq.TypeError,PY=Wq.decodeURIComponent,MY=Wq.encodeURIComponent,DY=qq("".charAt),NY=qq([].join),LY=qq([].push),UY=qq("".replace),VY=qq([].shift),FY=qq([].splice),BY=qq("".split),jY=qq("".slice),HY=/\+/g,GY=Array(4),zY=function(e){return GY[e-1]||(GY[e-1]=xY("((?:%[\\da-f]{2}){"+e+"})","gi"))},KY=function(e){try{return PY(e)}catch(Y$){return e}},WY=function(e){var t=UY(e,HY," "),r=4;try{return PY(t)}catch(Y$){for(;r;)t=UY(t,zY(r--),KY);return t}},XY=/[!'()~]|%20/g,qY={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},YY=function(e){return qY[e]},JY=function(e){return UY(MY(e),XY,YY)},QY=tY((function(e,t){SY(this,{type:yY,iterator:pY(bY(e).entries),kind:t})}),"Iterator",(function(){var e=kY(this),t=e.kind,r=e.iterator.next(),n=r.value;return r.done||(r.value="keys"===t?n.key:"values"===t?n.value:[n.key,n.value]),r}),!0),ZY=function(e){this.entries=[],this.url=null,void 0!==e&&(uY(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===DY(e,0)?jY(e,1):e:dY(e)))};ZY.prototype={type:gY,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,n,i,o,a,s,c=vY(e);if(c)for(r=(t=pY(e,c)).next;!(n=Xq(r,t)).done;){if(o=(i=pY(cY(n.value))).next,(a=Xq(o,i)).done||(s=Xq(o,i)).done||!Xq(o,i).done)throw OY("Expected sequence with length 2");LY(this.entries,{key:dY(a.value),value:dY(s.value)})}else for(var u in e)oY(e,u)&&LY(this.entries,{key:u,value:dY(e[u])})},parseQuery:function(e){if(e)for(var t,r,n=BY(e,"&"),i=0;i<n.length;)(t=n[i++]).length&&(r=BY(t,"="),LY(this.entries,{key:WY(VY(r)),value:WY(NY(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],n=0;n<t.length;)e=t[n++],LY(r,JY(e.key)+"="+JY(e.value));return NY(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var $Y=function(){nY(this,eJ);var e=SY(this,new ZY(arguments.length>0?arguments[0]:void 0));Yq||(this.size=e.entries.length)},eJ=$Y.prototype;if($q(eJ,{append:function(e,t){var r=bY(this);fY(arguments.length,2),LY(r.entries,{key:dY(e),value:dY(t)}),Yq||this.length++,r.updateURL()},delete:function(e){for(var t=bY(this),r=fY(arguments.length,1),n=t.entries,i=dY(e),o=r<2?void 0:arguments[1],a=void 0===o?o:dY(o),s=0;s<n.length;){var c=n[s];if(c.key!==i||void 0!==a&&c.value!==a)s++;else if(FY(n,s,1),void 0!==a)break}Yq||(this.size=n.length),t.updateURL()},get:function(e){var t=bY(this).entries;fY(arguments.length,1);for(var r=dY(e),n=0;n<t.length;n++)if(t[n].key===r)return t[n].value;return null},getAll:function(e){var t=bY(this).entries;fY(arguments.length,1);for(var r=dY(e),n=[],i=0;i<t.length;i++)t[i].key===r&&LY(n,t[i].value);return n},has:function(e){for(var t=bY(this).entries,r=fY(arguments.length,1),n=dY(e),i=r<2?void 0:arguments[1],o=void 0===i?i:dY(i),a=0;a<t.length;){var s=t[a++];if(s.key===n&&(void 0===o||s.value===o))return!0}return!1},set:function(e,t){var r=bY(this);fY(arguments.length,1);for(var n,i=r.entries,o=!1,a=dY(e),s=dY(t),c=0;c<i.length;c++)(n=i[c]).key===a&&(o?FY(i,c--,1):(o=!0,n.value=s));o||LY(i,{key:a,value:s}),Yq||(this.size=i.length),r.updateURL()},sort:function(){var e=bY(this);_Y(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,r=bY(this).entries,n=aY(e,arguments.length>1?arguments[1]:void 0),i=0;i<r.length;)n((t=r[i++]).value,t.key,this)},keys:function(){return new QY(this,"keys")},values:function(){return new QY(this,"values")},entries:function(){return new QY(this,"entries")}},{enumerable:!0}),Qq(eJ,mY,eJ.entries,{name:"entries"}),Qq(eJ,"toString",(function(){return bY(this).serialize()}),{enumerable:!0}),Yq&&Zq(eJ,"size",{get:function(){return bY(this).entries.length},configurable:!0,enumerable:!0}),eY($Y,gY),Kq({global:!0,constructor:!0,forced:!Jq},{URLSearchParams:$Y}),!Jq&&iY(AY)){var tJ=qq(CY.has),rJ=qq(CY.set),nJ=function(e){if(uY(e)){var t,r=e.body;if(sY(r)===gY)return t=e.headers?new AY(e.headers):new AY,tJ(t,"content-type")||rJ(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),lY(e,{body:hY(0,dY(r)),headers:hY(0,t)})}return e};if(iY(IY)&&Kq({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return IY(e,arguments.length>1?nJ(arguments[1]):{})}}),iY(RY)){var iJ=function(e){return nY(this,wY),new RY(e,arguments.length>1?nJ(arguments[1]):{})};wY.constructor=iJ,iJ.prototype=wY,Kq({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:iJ})}}var oJ,aJ={URLSearchParams:$Y,getState:bY},sJ=m,cJ=2147483647,uJ=/[^\0-\u007E]/,dJ=/[.\u3002\uFF0E\uFF61]/g,lJ="Overflow: input needs wider integers to process",hJ=RangeError,pJ=sJ(dJ.exec),vJ=Math.floor,fJ=String.fromCharCode,_J=sJ("".charCodeAt),mJ=sJ([].join),gJ=sJ([].push),yJ=sJ("".replace),SJ=sJ("".split),bJ=sJ("".toLowerCase),kJ=function(e){return e+22+75*(e<26)},EJ=function(e,t,r){var n=0;for(e=r?vJ(e/700):e>>1,e+=vJ(e/t);e>455;)e=vJ(e/35),n+=36;return vJ(n+36*e/(e+38))},TJ=function(e){var t=[];e=function(e){for(var t=[],r=0,n=e.length;r<n;){var i=_J(e,r++);if(i>=55296&&i<=56319&&r<n){var o=_J(e,r++);56320==(64512&o)?gJ(t,((1023&i)<<10)+(1023&o)+65536):(gJ(t,i),r--)}else gJ(t,i)}return t}(e);var r,n,i=e.length,o=128,a=0,s=72;for(r=0;r<e.length;r++)(n=e[r])<128&&gJ(t,fJ(n));var c=t.length,u=c;for(c&&gJ(t,"-");u<i;){var d=cJ;for(r=0;r<e.length;r++)(n=e[r])>=o&&n<d&&(d=n);var l=u+1;if(d-o>vJ((cJ-a)/l))throw hJ(lJ);for(a+=(d-o)*l,o=d,r=0;r<e.length;r++){if((n=e[r])<o&&++a>cJ)throw hJ(lJ);if(n===o){for(var h=a,p=36;;){var v=p<=s?1:p>=s+26?26:p-s;if(h<v)break;var f=h-v,_=36-v;gJ(t,fJ(kJ(v+f%_))),h=vJ(f/_),p+=36}gJ(t,fJ(kJ(h))),s=EJ(a,l,u===c),a=0,u++}}a++,o++}return mJ(t,"")},IJ=Cr,RJ=x,AJ=zq,wJ=o,CJ=Qt,xJ=m,OJ=fi,PJ=mi,MJ=Ev,DJ=$e,NJ=ET,LJ=hy,UJ=si,VJ=Ul.codeAt,FJ=function(e){var t,r,n=[],i=SJ(yJ(bJ(e),dJ,"."),".");for(t=0;t<i.length;t++)r=i[t],gJ(n,pJ(uJ,r)?"xn--"+TJ(r):r);return mJ(n,".")},BJ=bn,jJ=ji,HJ=Dv,GJ=aJ,zJ=no,KJ=zJ.set,WJ=zJ.getterFor("URL"),XJ=GJ.URLSearchParams,qJ=GJ.getState,YJ=wJ.URL,JJ=wJ.TypeError,QJ=wJ.parseInt,ZJ=Math.floor,$J=Math.pow,eQ=xJ("".charAt),tQ=xJ(/./.exec),rQ=xJ([].join),nQ=xJ(1..toString),iQ=xJ([].pop),oQ=xJ([].push),aQ=xJ("".replace),sQ=xJ([].shift),cQ=xJ("".split),uQ=xJ("".slice),dQ=xJ("".toLowerCase),lQ=xJ([].unshift),hQ="Invalid scheme",pQ="Invalid host",vQ="Invalid port",fQ=/[a-z]/i,_Q=/[\d+-.a-z]/i,mQ=/\d/,gQ=/^0x/i,yQ=/^[0-7]+$/,SQ=/^\d+$/,bQ=/^[\da-f]+$/i,kQ=/[\0\t\n\r #%/:<>?@[\\\]^|]/,EQ=/[\0\t\n\r #/:<>?@[\\\]^|]/,TQ=/^[\u0000-\u0020]+/,IQ=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,RQ=/[\t\n\r]/g,AQ=function(e){var t,r,n,i;if("number"==typeof e){for(t=[],r=0;r<4;r++)lQ(t,e%256),e=ZJ(e/256);return rQ(t,".")}if("object"==typeof e){for(t="",n=function(e){for(var t=null,r=1,n=null,i=0,o=0;o<8;o++)0!==e[o]?(i>r&&(t=n,r=i),n=null,i=0):(null===n&&(n=o),++i);return i>r&&(t=n,r=i),t}(e),r=0;r<8;r++)i&&0===e[r]||(i&&(i=!1),n===r?(t+=r?":":"::",i=!0):(t+=nQ(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},wQ={},CQ=NJ({},wQ,{" ":1,'"':1,"<":1,">":1,"`":1}),xQ=NJ({},CQ,{"#":1,"?":1,"{":1,"}":1}),OQ=NJ({},xQ,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),PQ=function(e,t){var r=VJ(e,0);return r>32&&r<127&&!DJ(t,e)?e:encodeURIComponent(e)},MQ={ftp:21,file:null,http:80,https:443,ws:80,wss:443},DQ=function(e,t){var r;return 2===e.length&&tQ(fQ,eQ(e,0))&&(":"===(r=eQ(e,1))||!t&&"|"===r)},NQ=function(e){var t;return e.length>1&&DQ(uQ(e,0,2))&&(2===e.length||"/"===(t=eQ(e,2))||"\\"===t||"?"===t||"#"===t)},LQ=function(e){return"."===e||"%2e"===dQ(e)},UQ={},VQ={},FQ={},BQ={},jQ={},HQ={},GQ={},zQ={},KQ={},WQ={},XQ={},qQ={},YQ={},JQ={},QQ={},ZQ={},$Q={},eZ={},tZ={},rZ={},nZ={},iZ=function(e,t,r){var n,i,o,a=BJ(e);if(t){if(i=this.parse(a))throw JJ(i);this.searchParams=null}else{if(void 0!==r&&(n=new iZ(r,!0)),i=this.parse(a,null,n))throw JJ(i);(o=qJ(new XJ)).bindURL(this),this.searchParams=o}};iZ.prototype={type:"URL",parse:function(e,t,r){var n,i,o,a,s,c=this,u=t||UQ,d=0,l="",h=!1,p=!1,v=!1;for(e=BJ(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=aQ(e,TQ,""),e=aQ(e,IQ,"$1")),e=aQ(e,RQ,""),n=LJ(e);d<=n.length;){switch(i=n[d],u){case UQ:if(!i||!tQ(fQ,i)){if(t)return hQ;u=FQ;continue}l+=dQ(i),u=VQ;break;case VQ:if(i&&(tQ(_Q,i)||"+"===i||"-"===i||"."===i))l+=dQ(i);else{if(":"!==i){if(t)return hQ;l="",u=FQ,d=0;continue}if(t&&(c.isSpecial()!==DJ(MQ,l)||"file"===l&&(c.includesCredentials()||null!==c.port)||"file"===c.scheme&&!c.host))return;if(c.scheme=l,t)return void(c.isSpecial()&&MQ[c.scheme]===c.port&&(c.port=null));l="","file"===c.scheme?u=JQ:c.isSpecial()&&r&&r.scheme===c.scheme?u=BQ:c.isSpecial()?u=zQ:"/"===n[d+1]?(u=jQ,d++):(c.cannotBeABaseURL=!0,oQ(c.path,""),u=tZ)}break;case FQ:if(!r||r.cannotBeABaseURL&&"#"!==i)return hQ;if(r.cannotBeABaseURL&&"#"===i){c.scheme=r.scheme,c.path=UJ(r.path),c.query=r.query,c.fragment="",c.cannotBeABaseURL=!0,u=nZ;break}u="file"===r.scheme?JQ:HQ;continue;case BQ:if("/"!==i||"/"!==n[d+1]){u=HQ;continue}u=KQ,d++;break;case jQ:if("/"===i){u=WQ;break}u=eZ;continue;case HQ:if(c.scheme=r.scheme,i===oJ)c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=UJ(r.path),c.query=r.query;else if("/"===i||"\\"===i&&c.isSpecial())u=GQ;else if("?"===i)c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=UJ(r.path),c.query="",u=rZ;else{if("#"!==i){c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=UJ(r.path),c.path.length--,u=eZ;continue}c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=UJ(r.path),c.query=r.query,c.fragment="",u=nZ}break;case GQ:if(!c.isSpecial()||"/"!==i&&"\\"!==i){if("/"!==i){c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,u=eZ;continue}u=WQ}else u=KQ;break;case zQ:if(u=KQ,"/"!==i||"/"!==eQ(l,d+1))continue;d++;break;case KQ:if("/"!==i&&"\\"!==i){u=WQ;continue}break;case WQ:if("@"===i){h&&(l="%40"+l),h=!0,o=LJ(l);for(var f=0;f<o.length;f++){var _=o[f];if(":"!==_||v){var m=PQ(_,OQ);v?c.password+=m:c.username+=m}else v=!0}l=""}else if(i===oJ||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()){if(h&&""===l)return"Invalid authority";d-=LJ(l).length+1,l="",u=XQ}else l+=i;break;case XQ:case qQ:if(t&&"file"===c.scheme){u=ZQ;continue}if(":"!==i||p){if(i===oJ||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()){if(c.isSpecial()&&""===l)return pQ;if(t&&""===l&&(c.includesCredentials()||null!==c.port))return;if(a=c.parseHost(l))return a;if(l="",u=$Q,t)return;continue}"["===i?p=!0:"]"===i&&(p=!1),l+=i}else{if(""===l)return pQ;if(a=c.parseHost(l))return a;if(l="",u=YQ,t===qQ)return}break;case YQ:if(!tQ(mQ,i)){if(i===oJ||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()||t){if(""!==l){var g=QJ(l,10);if(g>65535)return vQ;c.port=c.isSpecial()&&g===MQ[c.scheme]?null:g,l=""}if(t)return;u=$Q;continue}return vQ}l+=i;break;case JQ:if(c.scheme="file","/"===i||"\\"===i)u=QQ;else{if(!r||"file"!==r.scheme){u=eZ;continue}switch(i){case oJ:c.host=r.host,c.path=UJ(r.path),c.query=r.query;break;case"?":c.host=r.host,c.path=UJ(r.path),c.query="",u=rZ;break;case"#":c.host=r.host,c.path=UJ(r.path),c.query=r.query,c.fragment="",u=nZ;break;default:NQ(rQ(UJ(n,d),""))||(c.host=r.host,c.path=UJ(r.path),c.shortenPath()),u=eZ;continue}}break;case QQ:if("/"===i||"\\"===i){u=ZQ;break}r&&"file"===r.scheme&&!NQ(rQ(UJ(n,d),""))&&(DQ(r.path[0],!0)?oQ(c.path,r.path[0]):c.host=r.host),u=eZ;continue;case ZQ:if(i===oJ||"/"===i||"\\"===i||"?"===i||"#"===i){if(!t&&DQ(l))u=eZ;else if(""===l){if(c.host="",t)return;u=$Q}else{if(a=c.parseHost(l))return a;if("localhost"===c.host&&(c.host=""),t)return;l="",u=$Q}continue}l+=i;break;case $Q:if(c.isSpecial()){if(u=eZ,"/"!==i&&"\\"!==i)continue}else if(t||"?"!==i)if(t||"#"!==i){if(i!==oJ&&(u=eZ,"/"!==i))continue}else c.fragment="",u=nZ;else c.query="",u=rZ;break;case eZ:if(i===oJ||"/"===i||"\\"===i&&c.isSpecial()||!t&&("?"===i||"#"===i)){if(".."===(s=dQ(s=l))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(c.shortenPath(),"/"===i||"\\"===i&&c.isSpecial()||oQ(c.path,"")):LQ(l)?"/"===i||"\\"===i&&c.isSpecial()||oQ(c.path,""):("file"===c.scheme&&!c.path.length&&DQ(l)&&(c.host&&(c.host=""),l=eQ(l,0)+":"),oQ(c.path,l)),l="","file"===c.scheme&&(i===oJ||"?"===i||"#"===i))for(;c.path.length>1&&""===c.path[0];)sQ(c.path);"?"===i?(c.query="",u=rZ):"#"===i&&(c.fragment="",u=nZ)}else l+=PQ(i,xQ);break;case tZ:"?"===i?(c.query="",u=rZ):"#"===i?(c.fragment="",u=nZ):i!==oJ&&(c.path[0]+=PQ(i,wQ));break;case rZ:t||"#"!==i?i!==oJ&&("'"===i&&c.isSpecial()?c.query+="%27":c.query+="#"===i?"%23":PQ(i,wQ)):(c.fragment="",u=nZ);break;case nZ:i!==oJ&&(c.fragment+=PQ(i,CQ))}d++}},parseHost:function(e){var t,r,n;if("["===eQ(e,0)){if("]"!==eQ(e,e.length-1))return pQ;if(t=function(e){var t,r,n,i,o,a,s,c=[0,0,0,0,0,0,0,0],u=0,d=null,l=0,h=function(){return eQ(e,l)};if(":"===h()){if(":"!==eQ(e,1))return;l+=2,d=++u}for(;h();){if(8===u)return;if(":"!==h()){for(t=r=0;r<4&&tQ(bQ,h());)t=16*t+QJ(h(),16),l++,r++;if("."===h()){if(0===r)return;if(l-=r,u>6)return;for(n=0;h();){if(i=null,n>0){if(!("."===h()&&n<4))return;l++}if(!tQ(mQ,h()))return;for(;tQ(mQ,h());){if(o=QJ(h(),10),null===i)i=o;else{if(0===i)return;i=10*i+o}if(i>255)return;l++}c[u]=256*c[u]+i,2!=++n&&4!==n||u++}if(4!==n)return;break}if(":"===h()){if(l++,!h())return}else if(h())return;c[u++]=t}else{if(null!==d)return;l++,d=++u}}if(null!==d)for(a=u-d,u=7;0!==u&&a>0;)s=c[u],c[u--]=c[d+a-1],c[d+--a]=s;else if(8!==u)return;return c}(uQ(e,1,-1)),!t)return pQ;this.host=t}else if(this.isSpecial()){if(e=FJ(e),tQ(kQ,e))return pQ;if(t=function(e){var t,r,n,i,o,a,s,c=cQ(e,".");if(c.length&&""===c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(r=[],n=0;n<t;n++){if(""===(i=c[n]))return e;if(o=10,i.length>1&&"0"===eQ(i,0)&&(o=tQ(gQ,i)?16:8,i=uQ(i,8===o?1:2)),""===i)a=0;else{if(!tQ(10===o?SQ:8===o?yQ:bQ,i))return e;a=QJ(i,o)}oQ(r,a)}for(n=0;n<t;n++)if(a=r[n],n===t-1){if(a>=$J(256,5-t))return null}else if(a>255)return null;for(s=iQ(r),n=0;n<r.length;n++)s+=r[n]*$J(256,3-n);return s}(e),null===t)return pQ;this.host=t}else{if(tQ(EQ,e))return pQ;for(t="",r=LJ(e),n=0;n<r.length;n++)t+=PQ(r[n],wQ);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return DJ(MQ,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"===this.scheme&&1===t&&DQ(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,n=e.password,i=e.host,o=e.port,a=e.path,s=e.query,c=e.fragment,u=t+":";return null!==i?(u+="//",e.includesCredentials()&&(u+=r+(n?":"+n:"")+"@"),u+=AQ(i),null!==o&&(u+=":"+o)):"file"===t&&(u+="//"),u+=e.cannotBeABaseURL?a[0]:a.length?"/"+rQ(a,"/"):"",null!==s&&(u+="?"+s),null!==c&&(u+="#"+c),u},setHref:function(e){var t=this.parse(e);if(t)throw JJ(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"===e)try{return new oZ(e.path[0]).origin}catch(Y$){return"null"}return"file"!==e&&this.isSpecial()?e+"://"+AQ(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(BJ(e)+":",UQ)},getUsername:function(){return this.username},setUsername:function(e){var t=LJ(BJ(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=PQ(t[r],OQ)}},getPassword:function(){return this.password},setPassword:function(e){var t=LJ(BJ(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=PQ(t[r],OQ)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?AQ(e):AQ(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,XQ)},getHostname:function(){var e=this.host;return null===e?"":AQ(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,qQ)},getPort:function(){var e=this.port;return null===e?"":BJ(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""===(e=BJ(e))?this.port=null:this.parse(e,YQ))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+rQ(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,$Q))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""===(e=BJ(e))?this.query=null:("?"===eQ(e,0)&&(e=uQ(e,1)),this.query="",this.parse(e,rZ)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!==(e=BJ(e))?("#"===eQ(e,0)&&(e=uQ(e,1)),this.fragment="",this.parse(e,nZ)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var oZ=function(e){var t=MJ(this,aZ),r=HJ(arguments.length,1)>1?arguments[1]:void 0,n=KJ(t,new iZ(e,!1,r));RJ||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},aZ=oZ.prototype,sZ=function(e,t){return{get:function(){return WJ(this)[e]()},set:t&&function(e){return WJ(this)[t](e)},configurable:!0,enumerable:!0}};if(RJ&&(PJ(aZ,"href",sZ("serialize","setHref")),PJ(aZ,"origin",sZ("getOrigin")),PJ(aZ,"protocol",sZ("getProtocol","setProtocol")),PJ(aZ,"username",sZ("getUsername","setUsername")),PJ(aZ,"password",sZ("getPassword","setPassword")),PJ(aZ,"host",sZ("getHost","setHost")),PJ(aZ,"hostname",sZ("getHostname","setHostname")),PJ(aZ,"port",sZ("getPort","setPort")),PJ(aZ,"pathname",sZ("getPathname","setPathname")),PJ(aZ,"search",sZ("getSearch","setSearch")),PJ(aZ,"searchParams",sZ("getSearchParams")),PJ(aZ,"hash",sZ("getHash","setHash"))),OJ(aZ,"toJSON",(function(){return WJ(this).serialize()}),{enumerable:!0}),OJ(aZ,"toString",(function(){return WJ(this).serialize()}),{enumerable:!0}),YJ){var cZ=YJ.createObjectURL,uZ=YJ.revokeObjectURL;cZ&&OJ(oZ,"createObjectURL",CJ(cZ,YJ)),uZ&&OJ(oZ,"revokeObjectURL",CJ(uZ,YJ))}jJ(oZ,"URL"),IJ({global:!0,constructor:!0,forced:!AJ,sham:!RJ},{URL:oZ});var dZ=Cr,lZ=a,hZ=Dv,pZ=bn,vZ=zq,fZ=se("URL");dZ({target:"URL",stat:!0,forced:!(vZ&&lZ((function(){fZ.canParse()})))},{canParse:function(e){var t=hZ(arguments.length,1),r=pZ(e),n=t<2||void 0===arguments[1]?void 0:pZ(arguments[1]);try{return!!new fZ(r,n)}catch(Y$){return!1}}});var _Z=r(re.URL),mZ=function(){var e=Ng(Mg().mark((function e(t,r){var n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Audio(_Z.createObjectURL(new Blob([t],r))),e.prev=1,n.muted=!0,e.next=5,n.play();case 5:return n.pause(),e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,r){return e.apply(this,arguments)}}(),gZ=dT,yZ=GI,SZ=function(e,t,r,n){for(var i,o=n>1?void 0:n?yZ(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&gZ(t,r,o),o},bZ=function(){function e(t,r){Bh(this,e),Jl(this,"_sharedAudioContext",new AudioContext),Jl(this,"_audioDestination",this._sharedAudioContext.createMediaStreamDestination()),Jl(this,"_localGainNode",this._sharedAudioContext.createGain()),Jl(this,"_bufferGainNode",this._sharedAudioContext.createGain()),Jl(this,"_audioBufferSource",void 0),Jl(this,"_localSource",void 0),Jl(this,"_context",void 0),Jl(this,"_failedAudioList",[]),Jl(this,"_startingIds",new uT),Jl(this,"_revokeURLs",new dj),Jl(this,"mixingMap",new uT),Jl(this,"resourcesCache",new uT),Jl(this,"volumeConfig",new uT),Jl(this,"cachedBuffer",[]),Jl(this,"id","AudioMixingManager"),this.engineId=r,this._context=t,this._localGainNode.gain.value=1}var t,r,n;return Fh(e,[{key:"mixMediaStream",value:function(e){this._localSource&&this._localSource.disconnect(this._localGainNode),this._localSource=this._sharedAudioContext.createMediaStreamSource(e),this._localSource.connect(this._localGainNode).connect(this._audioDestination)}},{key:"startAudioMixing",value:(n=Ng(Mg().mark((function e(t,r,n){var i,o,a,s,c,u,d,l,h,p,v,f,_,m=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this._startingIds.get(t)){e.next=3;break}return console.warn("AudioMixing task id: ".concat(t," is starting")),e.abrupt("return");case 3:if(this._startingIds.set(t,t),i=n.playCount,UU(o=n.type,"mixingType",sX(Dh)),a=this._context.getLocalAudioTrack()){e.next=9;break}return e.abrupt("return");case 9:if((s=a.preprocessingTrack)&&this.mixMediaStream(new MediaStream([s])),a.once("needReplaceTrack",(function(){m.mixMediaStream(new MediaStream([a.preprocessingTrack]))})),null!=(c=this.mixingMap.get(t))&&c.audioNode){c.audioNode.pause(),this._context.emitMessage({mixId:t,state:Nh.AUDIO_MIXING_STATE_STOPPED,error:gC.AUDIO_MIXING_ERROR_OK});try{c.gainNode.disconnect(this._audioDestination),c.audioSource.disconnect(c.gainNode)}catch(g){}}if(!(d=this.resourcesCache.get(t))||d.filePath!==r){e.next=19;break}u=d.getAudioNode(),e.next=32;break;case 19:return e.next=21,fetch(r,{mode:"cors",credentials:"include"}).then((function(e){if(e.ok)return e.arrayBuffer();throw m._context.emitMessage({mixId:t,state:Nh.AUDIO_MIXING_STATE_FAILED,error:gC.AUDIO_MIXING_ERROR_START_FAILED}),new kC(mC.LOAD_RESOURCES_FAILED,e.statusText)}));case 21:return l=e.sent,BT(r).call(r,"mp3")?h={type:"audio/mpeg"}:BT(r).call(r,"aac")&&(h={type:"audio/aac"}),e.next=25,mZ(l,h);case 25:if(e.sent){e.next=29;break}throw this._context.emitMessage({mixId:t,state:Nh.AUDIO_MIXING_STATE_FAILED,error:gC.AUDIO_MIXING_ERROR_START_FAILED}),new kC(mC.LOAD_RESOURCES_FAILED,"invalid audio resource");case 29:(u=new Audio).crossOrigin="anonymous",u.src=_Z.createObjectURL(new Blob([l],h));case 32:return i<=0?u.loop=!0:i>0&&(p=i,u.onended=function(){--p>0?u.play():(m.mixingMap.delete(t),m._context.emitMessage({mixId:t,state:Nh.AUDIO_MIXING_STATE_FINISHED,error:gC.AUDIO_MIXING_ERROR_OK}))}),e.prev=33,e.next=36,u.play();case 36:e.next=43;break;case 38:e.prev=38,e.t0=e.catch(33),console.error(e.t0),this._failedAudioList.push(u),this._context.onAutoPlayFailed({userId:this.id,kind:"audio",streamIndex:ch.STREAM_INDEX_MAIN,mediaType:uh.AUDIO});case 43:if(this._startingIds.delete(t),v=this._sharedAudioContext.createMediaElementSource(u),f=this._sharedAudioContext.createGain(),_=this.volumeConfig.get(t),f.gain.value=_?_/100:1,v.connect(f).connect(this._audioDestination),this.mixingMap.set(t,{audioSource:v,audioNode:u,gainNode:f,type:"file"}),o===Dh.PUBLISH)try{f.disconnect(this._sharedAudioContext.destination)}catch(g){}else f.connect(this._sharedAudioContext.destination);this._context.updateLocalAudioTrack(this._audioDestination.stream.getAudioTracks()[0],n.type),this._context.emitMessage({mixId:t,state:Nh.AUDIO_MIXING_STATE_PLAYING,error:gC.AUDIO_MIXING_ERROR_OK});case 53:case"end":return e.stop()}}),e,this,[[33,38]])}))),function(e,t,r){return n.apply(this,arguments)})},{key:"stopAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&"file"===t.type&&(this.mixingMap.delete(e),t.audioNode.pause(),t.audioSource.disconnect(t.gainNode),t.gainNode.disconnect(this._audioDestination),this._context.emitMessage({mixId:e,state:Nh.AUDIO_MIXING_STATE_STOPPED,error:gC.AUDIO_MIXING_ERROR_OK}))}},{key:"pauseAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&(this._context.emitMessage({mixId:e,state:Nh.AUDIO_MIXING_STATE_PAUSED,error:gC.AUDIO_MIXING_ERROR_OK}),t.audioNode.pause())}},{key:"resumeAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&(this._context.emitMessage({mixId:e,state:Nh.AUDIO_MIXING_STATE_PLAYING,error:gC.AUDIO_MIXING_ERROR_OK}),t.audioNode.play())}},{key:"preloadAudioMixing",value:(r=Ng(Mg().mark((function e(t,r){var n,i,o=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stopAudioMixing(t),e.next=3,fetch(r,{mode:"cors",credentials:"include"}).then((function(e){if(e.ok)return e.arrayBuffer();throw new kC(mC.LOAD_RESOURCES_FAILED,e.statusText)})).catch((function(e){if(o._context.emitMessage({mixId:t,state:Nh.AUDIO_MIXING_STATE_FAILED,error:gC.AUDIO_MIXING_ERROR_PRELOAD_FAILED}),e instanceof kC)throw e;throw new kC(mC.LOAD_RESOURCES_FAILED,"Load resources failed",e)}));case 3:return n=e.sent,BT(r).call(r,"mp3")?i={type:"audio/mpeg"}:BT(r).call(r,"aac")&&(i={type:"audio/aac"}),e.next=7,mZ(n,i);case 7:if(e.sent){e.next=11;break}throw this._context.emitMessage({mixId:t,state:Nh.AUDIO_MIXING_STATE_FAILED,error:gC.AUDIO_MIXING_ERROR_PRELOAD_FAILED}),new kC(mC.LOAD_RESOURCES_FAILED,"Load resources failed");case 11:return this._context.emitMessage({mixId:t,state:Nh.AUDIO_MIXING_STATE_PRELOADED,error:gC.AUDIO_MIXING_ERROR_OK}),this.resourcesCache.set(t,{getAudioNode:function(){var e=_Z.createObjectURL(new Blob([n],i));return o._revokeURLs.add(e),new Audio(e)},filePath:r,duration:0}),e.next=15,new HI((function(e){var r=_Z.createObjectURL(new Blob([n],i)),a=new Audio(r);a.addEventListener("durationchange",(function(){var n=o.resourcesCache.get(t);n&&(n.duration=a.duration,o.resourcesCache.set(t,n)),_Z.revokeObjectURL(r),e(null)}))}));case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"unloadAudioMixing",value:function(e){this.resourcesCache.has(e)&&this.resourcesCache.delete(e)}},{key:"getAudioMixingVolume",value:function(e){var t=this.mixingMap.get(e);return t?100*t.gainNode.gain.value:0}},{key:"setAudioMixingVolume",value:function(e,t){t<0?t=0:t>400&&(t=400),this.volumeConfig.set(e,t);var r=this.mixingMap.get(e);r&&(r.gainNode.gain.value=Number(t)/100)}},{key:"getAudioMixingDuration",value:function(e){var t=this.mixingMap.get(e),r=this.resourcesCache.get(e);return t||r?t?1e3*t.audioNode.duration:r?1e3*r.duration:0:0}},{key:"getAudioMixingCurrentPosition",value:function(e){var t=this.mixingMap.get(e);return t?1e3*t.audioNode.currentTime:0}},{key:"setAudioMixingPosition",value:function(e,t){var r=this.mixingMap.get(e);r&&(r.audioNode.currentTime=t/1e3,r.audioNode.play())}},{key:"enableAudioMixingBuffer",value:function(e){UU(e,"type",sX(Dh));var t=this._context.getLocalAudioTrack();if(t){var r=t.preprocessingTrack;if(r&&this.mixMediaStream(new MediaStream([r])),e===Dh.PUBLISH)try{this._bufferGainNode.disconnect(this._sharedAudioContext.destination)}catch(n){}else this._bufferGainNode.connect(this._sharedAudioContext.destination);this._context.updateLocalAudioTrack(this._audioDestination.stream.getAudioTracks()[0],e),this._bufferGainNode.connect(this._audioDestination),this._context.emitMessage({mixId:-1,state:Nh.AUDIO_MIXING_STATE_PCM_ENABLED,error:gC.AUDIO_MIXING_ERROR_OK})}}},{key:"disableAudioMixingBuffer",value:function(){if(this.cachedBuffer=[],this._audioBufferSource){try{this._audioBufferSource.onended=null,this._audioBufferSource.disconnect(this._bufferGainNode),this._bufferGainNode.disconnect(this._audioDestination),this._bufferGainNode.disconnect(this._sharedAudioContext.destination)}catch(e){}finally{this._audioBufferSource=void 0}this._context.updateLocalAudioTrack(),this._context.emitMessage({mixId:-1,state:Nh.AUDIO_MIXING_STATE_PCM_DISABLED,error:gC.AUDIO_MIXING_ERROR_OK})}}},{key:"pushAudioMixingBuffer",value:function(e){var t=this;if(!(this._audioBufferSource&&(this.cachedBuffer.push(e),this.cachedBuffer.length>0))){this._audioBufferSource=this._sharedAudioContext.createBufferSource(),this._audioBufferSource.buffer=e,this._audioBufferSource.connect(this._bufferGainNode);try{this._audioBufferSource.start()}catch(r){this._failedAudioList.push(this._audioBufferSource)}this._audioBufferSource.onended=function(){var e;if(null===(e=t._audioBufferSource)||void 0===e||e.disconnect(t._bufferGainNode),t._audioBufferSource=void 0,t.cachedBuffer.length){var r=t.cachedBuffer.shift();r&&t.pushAudioMixingBuffer(r)}}}}},{key:"stopAll",value:function(){var e=this;if(this._localSource)try{this._localSource.disconnect(this._localGainNode),delete this._localSource}catch(t){}this.mixingMap.forEach((function(t,r){e.stopAudioMixing(r)}))}},{key:"mixTrack",get:function(){return this._audioDestination.stream.getAudioTracks()[0]}},{key:"sharedAudioContext",get:function(){return this._sharedAudioContext}},{key:"resumeLocalPlay",value:(t=Ng(Mg().mark((function e(){var t,r,n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=gy(this._failedAudioList),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=24;break}if(i=n.value,e.prev=6,!(i instanceof HTMLAudioElement)){e.next=13;break}return i.muted=!1,e.next=11,i.play();case 11:e.next=14;break;case 13:i.start();case 14:e.next=22;break;case 16:return e.prev=16,e.t0=e.catch(6),t.push(i),console.error(e.t0),this._context.onAutoPlayFailed({userId:this.id,kind:"audio",streamIndex:ch.STREAM_INDEX_MAIN,mediaType:uh.AUDIO}),e.abrupt("break",24);case 22:e.next=4;break;case 24:e.next=29;break;case 26:e.prev=26,e.t1=e.catch(2),r.e(e.t1);case 29:return e.prev=29,r.f(),e.finish(29);case 32:this._failedAudioList=t;case 33:case"end":return e.stop()}}),e,this,[[2,26,29,32],[6,16]])}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e=this._sharedAudioContext;"closed"!==e.state&&"function"==typeof e.close&&e.close(),this.cachedBuffer=[],this.mixingMap.clear(),this.resourcesCache.clear(),this.volumeConfig.clear(),this._startingIds=new uT,this._revokeURLs.forEach((function(e){_Z.revokeObjectURL(e)}))}}]),e}();SZ([XD("id","filePath","options")],bZ.prototype,"startAudioMixing",1),SZ([XD("id")],bZ.prototype,"stopAudioMixing",1),SZ([XD("id")],bZ.prototype,"pauseAudioMixing",1),SZ([XD("id")],bZ.prototype,"resumeAudioMixing",1),SZ([XD("id")],bZ.prototype,"preloadAudioMixing",1),SZ([XD("id")],bZ.prototype,"unloadAudioMixing",1),SZ([XD("id")],bZ.prototype,"getAudioMixingVolume",1),SZ([XD("id","volume")],bZ.prototype,"setAudioMixingVolume",1),SZ([XD("id")],bZ.prototype,"getAudioMixingDuration",1),SZ([XD("id")],bZ.prototype,"getAudioMixingCurrentPosition",1),SZ([XD("id","position")],bZ.prototype,"setAudioMixingPosition",1),SZ([XD("type")],bZ.prototype,"enableAudioMixingBuffer",1),SZ([XD()],bZ.prototype,"disableAudioMixingBuffer",1),SZ([XD("buffer")],bZ.prototype,"pushAudioMixingBuffer",1);var kZ=function(e){return e.NORMAL_USER="normalUser",e.SILENT_USER="silentUser",e}(kZ||{}),EZ=function(e){VA(c,e);var t,r,n,i,o,a,s=tw(c);function c(e){var t;return Bh(this,c),Jl(sA(t=s.call(this)),"_dataChannelSignal",void 0),Jl(sA(t),"_handler",void 0),Jl(sA(t),"_dataChannelSignalState",cq.DISCONNECTED),Jl(sA(t),"_loginSessionId",null),Jl(sA(t),"_userId",null),Jl(sA(t),"_token",null),Jl(sA(t),"_loginResolveCallback",void 0),Jl(sA(t),"_loginRejectCallback",void 0),Jl(sA(t),"_wait_login_token",!1),Jl(sA(t),"_serverParamsCache",void 0),Jl(sA(t),"id",void 0),Jl(sA(t),"_connectionManager",void 0),Jl(sA(t),"isReconnecting",!1),Jl(sA(t),"logger",void 0),t._ctx=e,t.id=e.id,t.logger=new lN("RTMClient",1,e.id),t._connectionManager=new nq(e),t._addConnectHandler(),t}return Fh(c,[{key:"login",value:function(e,t){var r=this;return new HI((function(n,i){var o;if(r.logger.info("login","invoke login, token: %o, userId: %o",e,t),r._loginSessionId)throw new kC(mC.ALREADY_LOGIN,"Already logined");if(r._loginResolveCallback)throw new kC(mC.LOGIN_FAILED,"Is logging in, please try again later.");r._userId=t,r._token=e,null===(o=KD(r.id))||void 0===o||o.set({rtm_user_id:t}),r._loginResolveCallback=n,r._loginRejectCallback=i,r._dataChannelSignal?r._login():r.connect().then((function(){r._login()}))}))}},{key:"logout",value:(a=Ng(Mg().mark((function e(){var t;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new kC(mC.NOT_LOGIN,"login first");case 2:return e.next=4,null===(t=this._dataChannelSignal)||void 0===t?void 0:t.sendSignaling("logout",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId},{functionType:tq.C2RTM}).catch((function(){}));case 4:this._clearState();case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"updateLoginToken",value:(o=Ng(Mg().mark((function e(t){var r=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._token=t,e.abrupt("return",new HI((function(e,t){r._wait_login_token?(r._loginResolveCallback=e,r._loginRejectCallback=t,r._login()):e()})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getPeerOnlineStatus",value:(i=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new kC(mC.NOT_LOGIN,"login first");case 2:return this._checkDataChannelSignal(),e.next=5,this._dataChannelSignal.sendSignaling("getPeerOnlineStatus",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId,peerUserId:t},{functionType:tq.C2RTM});case 5:return r=e.sent,e.abrupt("return",null==r?void 0:r.status);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"sendUserMessageOutsideRoom",value:(n=Ng(Mg().mark((function e(t,r){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new kC(mC.NOT_LOGIN,"login first");case 2:return this._checkDataChannelSignal(),e.abrupt("return",this._dataChannelSignal.sendP2PMessage({from:this._userId,app:this._ctx.appId,to:t,room:"",msg:r}));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"setServerParams",value:(r=Ng(Mg().mark((function e(t,r){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,LU(t,"signature"),LU(r,"url"),this._loginSessionId&&this._userId){e.next=5;break}throw new kC(mC.NOT_LOGIN,"login first");case 5:return this._checkDataChannelSignal(),e.next=8,this._dataChannelSignal.sendSignaling("setServerParams",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId,signature:t,url:r},{functionType:tq.C2RTM}).catch((function(e){throw new kC(mC.UNEXPECTED_ERROR,e.msg)}));case 8:this._serverParamsCache={signature:t,url:r},this.emit("onServerParamsSetResult"),e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(0),this.emit("onServerParamsSetResult",e.t0),e.t0;case 16:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e,t){return r.apply(this,arguments)})},{key:"sendServerMessage",value:(t=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new kC(mC.NOT_LOGIN,"login first");case 2:return this._checkDataChannelSignal(),e.abrupt("return",this._dataChannelSignal.sendP2PMessage({from:this._userId,app:this._ctx.appId,to:"",room:"",type:JX.BUSINESS_SERVER,msg:t}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e;this.logger.info("destroy","invoke."),LA(NA(c.prototype),"removeAllListeners",this).call(this),this._loginResolveCallback&&this._loginRejectCallback&&(this._loginRejectCallback(new kC(mC.LOGIN_FAILED,"logout")),delete this._loginResolveCallback,delete this._loginRejectCallback),null===(e=this._dataChannelSignal)||void 0===e||e.destroy(),delete this._dataChannelSignal,this._clearState(),this._connectionManager.destroy(),delete this._serverParamsCache}},{key:"_login",value:function(){var e=this;if(this._userId){var t=iL();this._checkDataChannelSignal(),this._dataChannelSignal.sendSignaling("login",{Token:cL.token2auth(this._ctx.appId,null,this._userId,this._token),timestamp:Date.now(),loginSessionId:t,params:{deviceType:"web",userAgent:window.navigator.userAgent,sdkVersion:RU.VERSION,deviceId:yU.getDeviceId(),appId:this._ctx.appId,userId:this._userId},accessParams:zg({requireICEUfragV2:!0})},{functionType:tq.C2RTM}).then((function(){"function"==typeof e._loginResolveCallback&&e._loginResolveCallback(),e._loginSessionId=t,ND.setRtsSessionId(e.id,t),e._wait_login_token=!1,e._serverParamsCache&&e.setServerParams(e._serverParamsCache.signature,e._serverParamsCache.url)})).catch((function(t){var r,n,i=t||{},o=i.code,a=i.message;e._wait_login_token=!1,o>=700&&o<800?708===o?(r=mC.INVALID_PARAMS,n="Invalid userId"):(r=mC.INVALID_TOKEN,n="Invalid token",e._wait_login_token=!0,e._loginRejectCallback||e.emit("onRTMTokenError")):(r=mC.LOGIN_FAILED,n="login failed"),"function"==typeof e._loginRejectCallback&&e._loginRejectCallback(new kC(r,a||n))})).finally((function(){delete e._loginResolveCallback,delete e._loginRejectCallback}))}}},{key:"connect",value:function(){var e=this;return new HI((function(t,r){e._connectionManager.once("connected",(function(){return t()})),e._connectionManager.once("disconnected",r),e._connectionManager.connect()}))}},{key:"_checkDataChannelSignal",value:function(){if(!this._dataChannelSignal||this._dataChannelSignalState!==cq.CONNECTED)throw new kC(mC.NOT_CONNECTED_YET,"datachannel not connect")}},{key:"_addConnectHandler",value:function(){var e=this;this._connectionManager.on("connected",(function(t){var r,n;e._dataChannelSignalState=cq.CONNECTED,e.logger.info("connectStateChange","connected"),null===(r=e._handler)||void 0===r||r.destroy(),null===(n=e._dataChannelSignal)||void 0===n||n.destroy(),e._handler=kX(e._ctx,t.pc),e._dataChannelSignal=t.signaling,e._addSignalEventHandler(),e.isReconnecting&&e._login()})),this._connectionManager.on("disconnected",(function(t){e._dataChannelSignalState=cq.DISCONNECTED,e.logger.warn("connectStateChange","disconnected. %o",t),e.isReconnecting&&(e.emit("onUserDisconnection"),e._clearState())})),this._connectionManager.on("connecting",(function(){var t;e.isReconnecting=!1,null===(t=e._handler)||void 0===t||t.destroy(),delete e._handler,e._dataChannelSignalState=cq.CONNECTING,e.logger.info("connectStateChange","connecting")})),this._connectionManager.on("reconnecting",(function(){var t;e.isReconnecting=!0,null===(t=e._handler)||void 0===t||t.destroy(),delete e._handler,e._dataChannelSignalState=cq.CONNECTING,e.logger.warn("connectStateChange","reconnecting")}))}},{key:"_addSignalEventHandler",value:function(){var e,t,r,n=this;null===(e=this._dataChannelSignal)||void 0===e||e.on(IX.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM,(function(e){n.emit("onUserMessageReceivedOutsideRoom",{userId:e.from,message:e.msg})})),null===(t=this._dataChannelSignal)||void 0===t||t.on(IX.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM,(function(e){n.emit("onUserBinaryMessageReceivedOutsideRoom",{userId:e.from,message:e.msg})})),null===(r=this._dataChannelSignal)||void 0===r||r.on(IX.USER_DISCONNECTION,(function(){n.emit("onUserDisconnection"),n._clearState()}))}},{key:"_clearState",value:function(){this._userId=null,this._token=null,this._loginSessionId=null,ND.setRtsSessionId(this.id,"")}}]),c}(rV.EventEmitter),TZ=function(){function e(t){Bh(this,e),Jl(this,"_roomId",void 0),Jl(this,"_constraints",{}),Jl(this,"_profile",void 0),Jl(this,"_customMaxBitrate",0),this._appId=t}return Fh(e,[{key:"setRoomId",value:function(e){this._roomId=e}},{key:"setAudioProfile",value:function(e){this._profile=e,this._customMaxBitrate=0}},{key:"customMaxBitrate",get:function(){return this._customMaxBitrate}},{key:"setCustomMaxBitrate",value:function(e){var t=yU.getEngineWebConfig(this._appId,this._roomId||"").audio_encode;this._customMaxBitrate=null!=t&&t.bitrate?0:1e3*e}},{key:"getOpusConfigStr",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=yU.getEngineWebConfig(this._appId,this._roomId||"").audio_encode,n=this.getConstraints(),i=n.sampleRate,o=n.channelCount,a="number"==typeof i?i:null==i?void 0:i.exact,s="number"==typeof o?o:null==o?void 0:o.exact,c={};t.split(";").forEach((function(e){var t=yy(e.split("="),2),r=t[0],n=t[1];r&&n&&(c[r]=n)}));var u=(null==r?void 0:r.bitrate)||this._customMaxBitrate||this._getConfigByAudioProfile().bitrate;u&&(c.maxaveragebitrate=u);var d=(null==r?void 0:r.enc_sample_rate)||a;d&&(c["sprop-maxcapturerate"]=d);var l=(null==r?void 0:r.playback_rate)||a;return l&&(c.maxplaybackrate=l),(s&&s>1||null!=r&&r.stereo)&&(c["sprop-stereo"]=1,c.stereo=1),null!=r&&r.dtx&&(c.usedtx=1),Jg(e=LS(c)).call(e,(function(e){var t;return Bg(t="".concat(e,"=")).call(t,c[e])})).join(";")}},{key:"updateConstraints",value:function(e){this._constraints=Zl(Zl({},this._constraints),e)}},{key:"getConstraints",value:function(){var e=Zl({},this._constraints),t=yU.getEngineWebConfig(this._appId,this._roomId||"").audio_capture;AL(null==t?void 0:t.sample_rate)||(e.sampleRate=t.sample_rate),AL(null==t?void 0:t.channel)||(e.channelCount=t.channel),AL(null==t?void 0:t.agc)||(e.autoGainControl=t.agc),AL(null==t?void 0:t.ans)||(e.noiseSuppression=t.ans),AL(null==t?void 0:t.aec)||(e.echoCancellation=t.aec);var r=this._getConfigByAudioProfile(),n=r.sampleRate,i=r.channel;return AL(e.sampleRate)&&!AL(n)&&(e.sampleRate=n),AL(e.channelCount)&&!AL(i)&&(e.channelCount=i),e}},{key:"_getConfigByAudioProfile",value:function(){var e={};switch(this._profile){case Th.fluent:e.sampleRate=16e3,e.bitrate=24e3;break;case Th.standard:e.sampleRate=48e3,e.bitrate=48e3;break;case Th.hd:e.sampleRate=48e3,e.bitrate=128e3,e.channel=2;break;case Th.standardStereo:e.sampleRate=48e3,e.bitrate=8e4,e.channel=2;break;case Th.hdMono:e.sampleRate=48e3,e.bitrate=128e3}return e}}]),e}(),IZ=function(e){VA(o,e);var t,r,n,i=tw(o);function o(e,t,r){var n,a=r.businessId;return Bh(this,o),Jl(sA(n=i.call(this)),"_mediaServerClient",void 0),Jl(sA(n),"_appId",void 0),Jl(sA(n),"remoteStreams",void 0),Jl(sA(n),"_businessId",void 0),Jl(sA(n),"_ctx",void 0),n.id=e,n._appId=t,n.remoteStreams=new uT,n._businessId=a,n._ctx={id:n.id,appId:n._appId,avSync:!0,audioProfileManager:new TZ(n._appId),useCloudProxy:!1,userPriority:new uT,joinRoomConfig:new bU(n.id),enableFallbackHandler:I$(t),enableStandardHandler:R$(t),pcKillSwitch:Zl(Zl({ctor_sdpsemantics_add:!0,ctor_encodedinsetablestream_add:!0,sld_rtcpfb_rrtr_add:!0,sld_ext_sdesmid_remove:!0,sld_fmtp_sps_add:!0,sld_fmtp_bitrate_add:!0,sld_fmtp_opus_add:!0},wU("PC_KILLSWITCH")),T$(n._appId))},n}return Fh(o,[{key:"connect",value:(n=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._mediaServerClient=new dq(this._ctx),this._mediaServerClient.publicStream=!0,this._businessId&&(this._mediaServerClient.businessId=this._businessId),this._bindEvents(),e.next=6,this._mediaServerClient.connect();case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"startPlayPublicStream",value:(r=Ng(Mg().mark((function e(t){var r,n=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.remoteStreams.get(t)){e.next=2;break}throw new kC(mC.REPEAT_PLAY,"repeat play public media stream");case 2:return(r=new zG(this._ctx,t,t,!1,!0,{audiostream:!0,localaudio:!0,videostream:!0,localvideo:!0,extaudio:!1,extvideo:!1,videoDescriptions:[]})).on("onSEIMessage",(function(e){if(e instanceof Uint8Array)for(var t=RL(e),i=0;i<t.seiCount;i++)n.emit(MX.ON_SEI_MESSAGED_RECEIVED,{sei:t.seis[i],publicStreamId:r.streamId})})),e.next=6,this._mediaServerClient.subscribePublicStream(r);case 6:return this.remoteStreams.set(t,r),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"stopPlayPublicStream",value:function(e){var t=this.remoteStreams.get(e);if(t)return this.remoteStreams.delete(e),this._mediaServerClient.unsubscribePublicStream(t)}},{key:"destroy",value:function(){var e;this.remoteStreams.forEach((function(e){e.clean()})),this.remoteStreams=new uT,null===(e=this._mediaServerClient)||void 0===e||e.destroy(),this.removeAllListeners()}},{key:"_handleReconnected",value:(t=Ng(Mg().mark((function e(){var t,r,n,i=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=gy(this.remoteStreams);try{for(n=function(){var e=yy(r.value,2),t=e[0],n=e[1];n.clean(),n.statsReport.unsubscribe(),i.remoteStreams.delete(t),i.startPlayPublicStream(t).then((function(){var e=i.remoteStreams.get(t);i.safeEmit(MX.RESUBSCRIBE,{stream:e})}))},t.s();!(r=t.n()).done;)n()}catch(J$){t.e(J$)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_bindEvents",value:function(){var e,t,r=this;null===(e=this._mediaServerClient)||void 0===e||e.on("connectSuccess",(function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).reconnect&&r._handleReconnected()})),null===(t=this._mediaServerClient)||void 0===t||t.on("onRemoteStreamStats",(function(e){r.emit("onRemoteStreamStats",e)}))}}]),o}(oV),RZ=new lN("AudioDeviceManager",1),AZ=function(e){VA(c,e);var t,r,n,i,o,a,s=tw(c);function c(e,t){var r;return Bh(this,c),Jl(sA(r=s.call(this)),"_audioLevelFetcher",void 0),Jl(sA(r),"_playbackDeviceTestTimer",void 0),Jl(sA(r),"_audioElement",void 0),Jl(sA(r),"_audioTrack",void 0),Jl(sA(r),"_mediaRecorder",void 0),Jl(sA(r),"_recoderTimer",void 0),Jl(sA(r),"_isAudioPlaybackDeviceTesting",!1),Jl(sA(r),"_isAudioDeviceRecordTesting",!1),Jl(sA(r),"_audioCaptureAndRecoderResolve",void 0),Jl(sA(r),"_onAutoplayFailed",void 0),Jl(sA(r),"_audioPlaybackDeviceId",void 0),r._ctx=e,r._extensionManager=t,r}return Fh(c,[{key:"audioTrack",get:function(){return this._audioTrack}},{key:"startAudioPlaybackDeviceTest",value:(a=Ng(Mg().mark((function e(t,r){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isAudioPlaybackDeviceTesting&&!this._isAudioDeviceRecordTesting){e.next=2;break}throw new kC(mC.REPEAT_DEVICE_TEST,"device test cannot be called repeatedly at the same time.");case 2:return this._isAudioPlaybackDeviceTesting=!0,RZ.info("startAudioPlaybackDeviceTest()","Invoke"),e.prev=4,e.next=7,this._playAudioFile(t,{loop:!0});case 7:e.next=14;break;case 9:throw e.prev=9,e.t0=e.catch(4),RZ.error("startAudioPlaybackDeviceTest()","error",e.t0),this.stopAudioPlaybackDeviceTest(),e.t0;case 14:this._startEmitAudioPlaybackDeviceTestVolume(r);case 15:case"end":return e.stop()}}),e,this,[[4,9]])}))),function(e,t){return a.apply(this,arguments)})},{key:"stopAudioPlaybackDeviceTest",value:function(){this._isAudioPlaybackDeviceTesting&&(RZ.info("stopAudioPlaybackDeviceTest()","Invoke"),this._isAudioPlaybackDeviceTesting=!1,this._stopEmitAudioPlaybackDeviceTestVolume(),this._destroyAudioElement())}},{key:"startAudioDeviceRecordTest",value:(o=Ng(Mg().mark((function e(t,r,n){var i,o=this,a=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=a.length>3&&void 0!==a[3]?a[3]:3e4,window.MediaRecorder){e.next=3;break}throw new kC(mC.NOT_SUPPORTED,"Your browser does not support MediaRecorder.");case 3:if(!this._isAudioDeviceRecordTesting&&!this._isAudioPlaybackDeviceTesting){e.next=5;break}throw new kC(mC.REPEAT_DEVICE_TEST,"device test cannot be called repeatedly at the same time.");case 5:return this._isAudioDeviceRecordTesting=!0,RZ.info("startAudioDeviceRecordTest()","Invoke"),this._recoderTimer=window.setTimeout((function(){RZ.info("startAudioDeviceRecordTest()","".concat(i,'ms automatic call method "stopAudioDeviceRecordAndPlayTest"')),o._stopAudioCaptureAndRecoder()}),i),e.prev=8,this._onAutoplayFailed=r,e.next=12,this._startAudioCaptureAndRecoder(t,null!=n?n:100);case 12:e.next=19;break;case 14:throw e.prev=14,e.t0=e.catch(8),this._isAudioDeviceRecordTesting=!1,delete this._onAutoplayFailed,e.t0;case 19:delete this._audioCaptureAndRecoderResolve;case 20:case"end":return e.stop()}}),e,this,[[8,14]])}))),function(e,t,r){return o.apply(this,arguments)})},{key:"stopAudioDeviceRecordAndPlayTest",value:function(){RZ.info("stopAudioDeviceRecordAndPlayTest()","Invoke"),void 0!==this._recoderTimer&&(clearTimeout(this._recoderTimer),delete this._recoderTimer),this._stopAudioCaptureAndRecoder()}},{key:"stopAudioDevicePlayTest",value:function(){this._isAudioDeviceRecordTesting&&(RZ.info("stopAudioDevicePlayTest()","Invoke"),this._isAudioDeviceRecordTesting=!1,this._mediaRecorder&&(this._mediaRecorder.ondataavailable=null),this.stopAudioDeviceRecordAndPlayTest(),this._stopEmitAudioPlaybackDeviceTestVolume(),this._destroyAudioElement()),delete this._onAutoplayFailed}},{key:"getRecordTrack",value:function(){return this._audioTrack}},{key:"setSinkId",value:(i=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(RZ.info("setSinkId()","Invoke"),void 0!==HTMLAudioElement.prototype.setSinkId){e.next=3;break}throw new kC(mC.NOT_SUPPORTED,"setSinkId not supported by current browser");case 3:return e.next=5,RH.getDeviceById(t);case 5:if(r=e.sent){e.next=8;break}throw new kC(mC.INVALID_DEVICE_ID,"audio playback device id ".concat(t," is invalid"));case 8:return this._audioPlaybackDeviceId=t,this._setAudioCtxSinkId(),e.abrupt("return",r);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getSinkId",value:function(){return this._audioPlaybackDeviceId}},{key:"destroy",value:function(){RZ.info("destroy()","Invoke"),LA(NA(c.prototype),"removeAllListeners",this).call(this),this.stopAudioPlaybackDeviceTest(),this.stopAudioDevicePlayTest()}},{key:"_playAudioFile",value:(n=Ng(Mg().mark((function e(t,r){var n,i=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return RZ.info("_playAudioFile()",Bg(n="Invoke url=".concat(t,"; loop=")).call(n,r.loop)),e.abrupt("return",new HI((function(e,n){var o=Nq("audio",{attributes:{src:t,crossOrigin:"anonymous"}});i._audioElement=o,o.loop=r.loop,i._audioLevelFetcher=new MH(o),o.onplaying=function(){o.onplaying=null,RZ.info("_playAudioFile()","onplaying"),e()},o.onerror=function(){var e=Ng(Mg().mark((function e(t){var r,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:RZ.error("_playAudioFile()","onerror",t),i=t.message||(null==o||null===(r=o.error)||void 0===r?void 0:r.message),n(new kC(mC.LOAD_RESOURCES_FAILED,"Failed to play recorded audio".concat(i?", reason: ".concat(i):".")));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i._setAudioCtxSinkId().then((function(){var e,t;return null===(e=o.play())||void 0===e||null===(t=e.catch)||void 0===t?void 0:t.call(e,(function(e){var t;RZ.warn("_playAudioFile()","autoplay error",e);var r=Bg(t="Failed to play recorded audio, ".concat(e.name,": ")).call(t,e.message);"NotAllowedError"===e.name&&i._onAutoplayFailed?i._onAutoplayFailed((function(){var e;return HI.all([null===(e=i._audioLevelFetcher)||void 0===e?void 0:e.resume(),o.play()])})):n(new kC(mC.LOAD_RESOURCES_FAILED,r))}))}))})));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"_destroyAudioElement",value:function(){this._audioElement&&(RZ.info("_destroyAudioElement()","Invoke"),this._audioElement.onplaying=null,this._audioElement.onerror=null,this._audioElement.src="",delete this._audioElement,"function"==typeof this._audioCaptureAndRecoderResolve&&this._audioCaptureAndRecoderResolve())}},{key:"_startEmitAudioPlaybackDeviceTestVolume",value:function(e){var t=this;e=Math.max(e,100),this._audioElement&&(RZ.info("_startEmitAudioPlaybackDeviceTestVolume()","start timer(".concat(e,"ms)")),this._playbackDeviceTestTimer=self.setInterval((function(){t._audioLevelFetcher&&t.emit("onAudioPlaybackDeviceTestVolume",t._audioLevelFetcher.getAudioLevel())}),e))}},{key:"_stopEmitAudioPlaybackDeviceTestVolume",value:function(){var e;void 0!==this._playbackDeviceTestTimer&&(RZ.info("_stopEmitAudioPlaybackDeviceTestVolume()","stop timer"),self.clearInterval(this._playbackDeviceTestTimer),delete this._playbackDeviceTestTimer),null===(e=this._audioLevelFetcher)||void 0===e||e.destroy(),delete this._audioLevelFetcher}},{key:"_startAudioCaptureAndRecoder",value:(r=Ng(Mg().mark((function e(t,r){var n,i=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,sG(this._ctx.audioProfileManager.getConstraints(),this._extensionManager);case 2:return this._audioTrack=e.sent,this._audioTrack.setVolume(r+.01),n=new MediaStream([this._audioTrack.preprocessingTrack]),RZ.info("startAudioDeviceRecordTest()","create microphone track success!"),e.abrupt("return",new HI((function(e,r){var o,a;"function"==typeof MediaRecorder.isTypeSupported&&(o=sI(a=["audio/webm","audio/mp4"]).call(a,(function(e){return MediaRecorder.isTypeSupported(e)})),RZ.info("startAudioDeviceRecordTest()","use mimeType: ".concat(o))),i._mediaRecorder=new MediaRecorder(n,o?{mimeType:o}:void 0);var s=i._mediaRecorder.mimeType;i._mediaRecorder.ondataavailable=function(){var n=Ng(Mg().mark((function n(o){var a,c;return Mg().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!i._isAudioDeviceRecordTesting){n.next=16;break}return RZ.info("startAudioDeviceRecordTest()","get recorded file(mimeType: ".concat(s,").")),c=new Blob([o.data],{type:s}),n.prev=3,n.next=6,i._playAudioFile(_Z.createObjectURL(c),{loop:!1});case 6:n.next=11;break;case 8:return n.prev=8,n.t0=n.catch(3),n.abrupt("return",r(n.t0));case 11:i._startEmitAudioPlaybackDeviceTestVolume(t),null===(a=i._audioElement)||void 0===a||a.addEventListener("ended",(function(){i.stopAudioDevicePlayTest(),e()})),i._audioCaptureAndRecoderResolve=e,n.next=17;break;case 16:e();case 17:case"end":return n.stop()}}),n,null,[[3,8]])})));return function(e){return n.apply(this,arguments)}}(),i._mediaRecorder.onerror=function(e){r(new kC(mC.AUDIO_DEVICE_TEST_FAILED,e.message||"mediaRecorder error"))},i._audioCaptureAndRecoderResolve=e,i._mediaRecorder.start()})));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"_stopAudioCaptureAndRecoder",value:function(){var e;this._mediaRecorder&&("recording"===this._mediaRecorder.state&&this._mediaRecorder.stop(),delete this._mediaRecorder),null===(e=this._audioTrack)||void 0===e||e.close(),delete this._audioTrack}},{key:"_setAudioCtxSinkId",value:(t=Ng(Mg().mark((function e(){var t,r,n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._audioPlaybackDeviceId){"default"===t&&(t="");try{null===(r=DH.getAudioContextInstance())||void 0===r||null===(n=r.setSinkId)||void 0===n||n.call(r,t),RZ.info("setSinkId","ctx.sinkId=".concat(t))}catch(o){RZ.error("setSinkId",Bg(i="failed, ".concat(o.name," - ")).call(i,o.message))}}case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),c}(rV.EventEmitter),wZ=new lN("VideoSnapshot",1),CZ=function(e){var t=null==e?void 0:e.domElement;if(t&&!t.paused&&4===t.readyState)return t},xZ=function(){var e=Ng(Mg().mark((function e(t,r,n){var i,o,a,s,c,u,d,l;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=document.createElement("canvas"),o=i.getContext("2d")){e.next=4;break}throw new Error("canvas.getContext error");case 4:if(a=function(e,t,n){return t=t||e.width,n=n||e.height,i.width=t,i.height=n,r?o.setTransform(-1,0,0,1,t,0):o.setTransform(1,0,0,1,0,0),o.drawImage(e,0,0,t,n),o.getImageData(0,0,t,n)},s=Date.now(),!(c=CZ(n))){e.next=16;break}return wZ.info("takeSnapshot","VideoPlayer already set."),e.next=11,a(c,c.videoWidth,c.videoHeight);case 11:return u=e.sent,wZ.info("takeSnapshot","success, cost ".concat(Date.now()-s,"ms")),e.abrupt("return",u);case 16:if(!window.ImageCapture){e.next=29;break}if("live"!==(d=new window.ImageCapture(t)).track.readyState||!d.track.enabled||d.track.muted){e.next=29;break}return wZ.info("takeSnapshot","use ImageCapture"),e.t0=a,e.next=23,d.grabFrame();case 23:return e.t1=e.sent,e.next=26,(0,e.t0)(e.t1);case 26:return l=e.sent,wZ.info("takeSnapshot","success, cost ".concat(Date.now()-s,"ms")),e.abrupt("return",l);case 29:return wZ.info("takeSnapshot","use temp video"),e.abrupt("return",new HI((function(e,r){var n=new MediaStream([t]),i=document.createElement("video");i.setAttribute("playsinline",""),i.muted=!0,document.body.appendChild(i),i.onplaying=function(){var r=a(i,i.videoWidth,i.videoHeight);wZ.info("takeSnapshot","success, cost ".concat(Date.now()-s,"ms")),e(r),n.removeTrack(t),i.srcObject=null,i.load()},i.onerror=r,i.srcObject=n,i.play()})));case 31:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),OZ=function(){return{url:"",video:{codec:Ah.H264,width:640,height:360,fps:15,gop:2,kBitRate:PZ(640,360,15)},audio:{codec:"AAC",kBitRate:64,sampleRate:48e3,channels:2,AACProfile:Rh.LC},layout:{regions:[],appData:"",backgroundColor:"#000000"}}};function PZ(e,t,r){return e*t<=288e3?r<=15?800:1200:e*t<=864e3?r<=15?1200:1800:e*t<=1152e3?r<=15?1600:2400:e*t<=2592e3?r<=15?2500:3750:r<=15?3300:5e3}function MZ(e){if("string"!=typeof e||!/^rtmps?:\/\//.test(e))throw new kC(mC.INVALID_PARAMS,"Invalid rtmp address")}function DZ(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(null==e||!e.length)throw new kC(mC.INVALID_PARAMS,"regions should not be empty.");var t,r=gy(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if("string"!=typeof n.userId)throw new kC(mC.INVALID_PARAMS,"region.userId(".concat(n.userId,") should be a string."));if("boolean"!=typeof n.isScreenStream)throw new kC(mC.INVALID_PARAMS,"region.isScreenStream(".concat(n.isScreenStream,") should be a boolean."))}}catch(J$){r.e(J$)}finally{r.f()}}function NZ(e,t){var r,n,i,o=function(e,r){var n=aS(e).call(e,(function(e,t){return null==e?void 0:e[t]}),t),i=aS(e).call(e,(function(e,t){return null==e?void 0:e[t]}),OZ());return n&&r(n)?n:i},a=function(e){return e%2==0?e:e+1},s=a(o(["video","width"],(function(e){return e>=2&&e<=1920}))),c=a(o(["video","height"],(function(e){return e>=2&&e<=1920}))),u=o(["video","fps"],(function(e){return e>=1&&e<=60})),d=(null===(r=t.video)||void 0===r?void 0:r.kBitRate)||0,l=o(["audio","sampleRate"],(function(e){var t;return!!sI(t=[32e3,44100,48e3]).call(t,(function(t){return t===e||t/1e3===e}))}));return{type:"transcode",action:e,transcodeMeta:{transcode:{url:t.url},control:{protocol:"2.0"},audio:{codec:o(["audio","codec"],(function(e){return"AAC"===e})),bitRate:1e3*o(["audio","kBitRate"],(function(e){return e>=32&&e<=192})),sampleRate:l<100?1e3*l:l,channels:o(["audio","channels"],(function(e){var t;return qy(t=[1,2]).call(t,e)})),profile:o(["audio","AACProfile"],(function(e){var t;return qy(t=[Rh.LC,Rh.HEv1,Rh.HEv2]).call(t,e)}))},video:{codec:o(["video","codec"],(function(e){var t;return qy(t=["H264","H265"]).call(t,e)})),fps:u,gop:o(["video","gop"],(function(e){return e>=1&&e<=5}))*u,bitRate:1e3*(d>=16&&d<=1e4?d:PZ(s,c,u)),width:s,height:c},layout:{canvas:{bgnd:o(["layout","backgroundColor"],(function(e){return/^#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})$/.test(e)}))},regions:(null===(n=t.layout)||void 0===n||null===(i=n.regions)||void 0===i?void 0:Jg(i).call(i,(function(e){var t,r;return{alpha:!e.alpha||Number(e.alpha)>1||Number(e.alpha)<=0?1:Number(e.alpha),uid:e.userId,zorder:!e.zorder||Number(e.zorder)<0||Number(e.zorder)>100?0:Number(e.zorder),x:!e.x||Number(e.x)>=1||Number(e.x)<0?0:Number(e.x),y:!e.y||Number(e.y)>=1||Number(e.y)<0?0:Number(e.y),w:!e.w||Number(e.w)>1||Number(e.w)<=0?1:Number(e.w),h:!e.h||Number(e.h)>1||Number(e.h)<=0?1:Number(e.h),renderMode:e.renderMode&&qy(t=[1,2,3]).call(t,e.renderMode)?e.renderMode:1,contentControl:e.contentControl&&qy(r=[0,1,2]).call(r,e.contentControl)?e.contentControl:0,screen:!!e.isScreenStream}})))||[],app_data:o(["layout","appData"],(function(e){return"string"==typeof e}))}}}}var LZ,UZ={getDefaultValue:OZ,checkStartParams:function(e){var t;MZ(e.url),DZ(null===(t=e.layout)||void 0===t?void 0:t.regions)},checckUpdateParams:function(e){var t;e.url&&MZ(e.url),DZ(null===(t=e.layout)||void 0===t?void 0:t.regions)},getStartParams:function(e){return NZ("started",e)},getUpdateParams:function(e){return NZ("layoutChanged",e)}},VZ=Wp,FZ=ti;Cr({target:"Object",stat:!0},{fromEntries:function(e){var t={};return VZ(e,(function(e,r){FZ(t,e,r)}),{AS_ENTRIES:!0}),t}});var BZ,jZ=r(re.Object.fromEntries),HZ=["ele","fakeEle"],GZ=["orgTrack","mediaTrack","preprocessingTrack"],zZ=["orgTrack","mediaTrack","preprocessingTrack"],KZ=["currentTime","duration","ended","error","muted","networkState","paused","readyState","seekable","sinkId","src","volume"],WZ=["currentTime","sampleRate","state","baseLatency","outputLatency","sinkId"],XZ=["contentHint","enabled","id","kind","label","muted","readyState"],qZ=["currentDirection","direction","mid","stopped"];function YZ(e){return JZ.apply(this,arguments)}function JZ(){return(JZ=Ng(Mg().mark((function e(t){var r,n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Date.now(),n=[],!(t&&t._room&&t._room._mediaServerClient&&t._room._mediaServerClient._handler&&t._room._mediaServerClient._handler._peerConnection)){e.next=6;break}return e.next=5,t._room._mediaServerClient._handler._peerConnection.getStats();case 5:n=e.sent;case 6:return i=[],n.forEach((function(e){i.push(e)})),e.abrupt("return",{timestamp:r,stats:i});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function QZ(e){var t={};if(e instanceof MediaStream){t.id=e.id,t.active=e.active;var r=e.getTracks();t.tracks=Jg(r).call(r,(function(e){return jZ(Jg(XZ).call(XZ,(function(t){return[t,e[t]]})))}))}return t}function ZZ(e){return $Z.apply(this,arguments)}function $Z(){return($Z=Ng(Mg().mark((function e(t){var r,n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.now(),n=[],t._videoPlayer&&n.push({userId:"__local__",mediaType:"video",isScreen:!1,isPublic:!1,ele:t._videoPlayer._videoDom}),t._screenPlayer&&n.push({userId:"__local__",mediaType:"video",isScreen:!0,isPublic:!1,ele:t._screenPlayer._videoDom}),t._remoteVideoPlayer.forEach((function(e,t){n.push({userId:t,mediaType:"video",isScreen:!1,isPublic:!1,ele:e?e._videoDom:void 0})})),t._remoteScreenPlayer.forEach((function(e,t){n.push({userId:t,mediaType:"video",isScreen:!0,isPublic:!1,ele:e?e._videoDom:void 0})})),t._remoteAudioPlayer.forEach((function(e,t){n.push({userId:t,mediaType:"audio",isScreen:!1,isPublic:!1,ele:e?e._audioDom:void 0,fakeEle:e?e._fakeAudioDom:void 0})})),t._remoteScreenAudioPlayer&&t._remoteScreenAudioPlayer.forEach((function(e,t){n.push({userId:t,mediaType:"audio",isScreen:!0,isPublic:!1,ele:e?e._audioDom:void 0,fakeEle:e?e._fakeAudioDom:void 0})})),t._publicStreamVideoPlayer&&t._publicStreamVideoPlayer.forEach((function(e,t){n.push({userId:t,mediaType:"video",isScreen:!1,isPublic:!0,ele:e?e._videoDom:void 0})})),t._publicStreamAudioPlayer&&t._publicStreamAudioPlayer.forEach((function(e,t){n.push({userId:t,mediaType:"audio",isScreen:!1,isPublic:!0,ele:e?e._audioDom:void 0,fakeEle:e?e._fakeAudioDom:void 0})})),i=Jg(n).call(n,(function(e){var t=e.ele,r=e.fakeEle,n=SD(e,HZ),i=Zl({ele:Zl({srcObject:t?QZ(t.srcObject):void 0},jZ(Jg(KZ).call(KZ,(function(e){return[e,t[e]]}))))},n);return r&&(i.fakeEle=Zl({srcObject:QZ(r.srcObject)},jZ(Jg(KZ).call(KZ,(function(e){return[e,r[e]]}))))),i})),e.abrupt("return",{timestamp:r,elementStats:i});case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function e$(e){var t,r=[],n=[];e&&e._room&&e._room._remoteStreams&&(n=uw(t=e._room._remoteStreams).call(t));var i,o=gy(n);try{for(o.s();!(i=o.n()).done;){i.value.forEach((function(e){e.audioTrack&&r.push(e.audioTrack)}))}}catch(J$){o.e(J$)}finally{o.f()}e._localAudioTrack&&r.push(e._localAudioTrack),e._localScreenAudioTrack&&r.push(e._localScreenAudioTrack);for(var a=0,s=r;a<s.length;a++){var c,u,d=s[a];if(d._audioLevelFetcher&&d._audioLevelFetcher._ctx)return d._audioLevelFetcher._ctx;if(d._ac)return d._ac;if(d._audioFetchMap)if(WC(uw(c=d._audioFetchMap).call(c)).length)return WC(uw(u=d._audioFetchMap).call(u))[0]._ctx;if(d._ap&&d._ap._ac)return d._ap._ac}return null}function t$(e){return r$.apply(this,arguments)}function r$(){return(r$=Ng(Mg().mark((function e(t){var r,n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Date.now(),n=e$(t),i={},n){e.next=5;break}return e.abrupt("return",{timestamp:r,acState:void 0});case 5:return WZ.forEach((function(e){i[e]=n[e]})),e.abrupt("return",{timestamp:r,acState:i});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function n$(e){var t=[];e._localAudioTrack&&t.push({userId:"__local__",mediaType:"audio",isScreen:!1,isPublic:!1,isVirtual:!1,orgTrack:e._localAudioTrack._originTrack,mediaTrack:e._localAudioTrack._mediaTrack,preprocessingTrack:e._localAudioTrack._preProcessingTrack}),e._localScreenAudioTrack&&t.push({userId:"__local__",mediaType:"audio",isScreen:!0,isPublic:!1,isVirtual:!1,orgTrack:e._localScreenAudioTrack._originTrack,mediaTrack:e._localScreenAudioTrack._mediaTrack,preprocessingTrack:e._localScreenAudioTrack._preProcessingTrack}),e._localVideoTrack&&t.push({userId:"__local__",mediaType:"video",isScreen:!1,isPublic:!1,isVirtual:!1,orgTrack:e._localVideoTrack._originTrack,mediaTrack:e._localVideoTrack._mediaTrack,preprocessingTrack:e._localVideoTrack._preProcessingTrack}),e._localScreenVideoTrack&&t.push({userId:"__local__",mediaType:"video",isScreen:!0,isPublic:!1,isVirtual:!1,orgTrack:e._localScreenVideoTrack._originTrack,mediaTrack:e._localScreenVideoTrack._mediaTrack,preprocessingTrack:e._localScreenVideoTrack._preProcessingTrack}),e._room&&e._room._remoteStreams&&e._room._remoteStreams.forEach((function(e,r){e.forEach((function(e){e.audioTrack&&t.push({userId:r,mediaType:"audio",isScreen:e.isScreen,isPublic:!1,isVirtual:!1,orgTrack:e.audioTrack._originTrack,mediaTrack:e.audioTrack._mediaTrack}),e.videoTrack&&t.push({userId:r,mediaType:"video",isScreen:e.isScreen,isPublic:!1,isVirtual:!1,orgTrack:e.videoTrack._originTrack,mediaTrack:e.videoTrack._mediaTrack})}))}));var r=e._publicStreamManager;return r||(r=e._outsideRoom),r&&r.remoteStreams.forEach((function(e,r){e.audioTrack&&t.push({userId:r,mediaType:"audio",isScreen:e.isScreen,isPublic:!0,isVirtual:!1,orgTrack:e.audioTrack._originTrack,mediaTrack:e.audioTrack._mediaTrack}),e.videoTrack&&t.push({userId:r,mediaType:"video",isScreen:e.isScreen,isPublic:!0,isVirtual:!1,orgTrack:e.videoTrack._originTrack,mediaTrack:e.videoTrack._mediaTrack})})),e&&e._room&&e._room._virtualStreams&&e._room._virtualStreams.forEach((function(e,r){e.audioTrack&&t.push({userId:"virtualStream-".concat(r),mediaType:"audio",isScreen:!1,isPublic:!1,isVirtual:!0,orgTrack:e.audioTrack._originTrack,mediaTrack:e.audioTrack._mediaTrack}),e.videoTrack&&t.push({userId:"virtualStream-".concat(r),mediaType:"video",isScreen:!1,isPublic:!1,isVirtual:!0,orgTrack:e.videoTrack._originTrack,mediaTrack:e.videoTrack._mediaTrack})})),t}function i$(e,t){return o$.apply(this,arguments)}function o$(){return(o$=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,v;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=2048,i=50,o=128,a=256,s=2,t){e.next=7;break}return e.abrupt("return",void 0);case 7:return(c=new MediaStream).addTrack(t),u=r.createMediaStreamSource(c),d=r.createAnalyser(),u.connect(d),"suspended"===r.state&&(console.warn(r.state),r.resume()),l=new Uint8Array(n),d.getByteTimeDomainData(l),e.next=17,new HI((function(e){setTimeout(e,i)}));case 17:return d.getByteTimeDomainData(l),e.next=20,new HI((function(e){setTimeout(e,i)}));case 20:return h=0,l.forEach((function(e){return h=Math.max(h,Math.abs(e-o))})),v=(p=h/o*a)>s?p:0,u.disconnect(),d.disconnect(),e.abrupt("return",v);case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function a$(e){return s$.apply(this,arguments)}function s$(){return s$=Ng(Mg().mark((function e(t){var r,n,i,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1e3,n=Date.now(),BZ||(BZ=new AudioContext),"suspended"!==BZ.state){e.next=6;break}return e.next=6,new HI((function(e){var r=setTimeout((function(){console.warn("[RTC_AMBULANCE] AudioContext resume failed, try to find one in RTCEngine"),(BZ=e$(t))&&console.warn("[RTC_AMBULANCE] find AudioContext in RTCEngine success"),e()}),1e3);BZ.resume().then((function(){clearTimeout(r),e()}),(function(){clearTimeout(r),BZ=null,e()}))}));case 6:if(BZ){e.next=9;break}return console.error("[RTC_AMBULANCE] get volume is not supported"),e.abrupt("return");case 9:return i=n$(t),o=[],e.next=13,HI.all(Jg(r=Iy(i).call(i,(function(e){return"audio"===e.mediaType}))).call(r,function(){var e=Ng(Mg().mark((function e(t){var r,n,i,a,s;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.orgTrack,n=t.mediaTrack,i=t.preprocessingTrack,a=SD(t,GZ),s=Zl({},a),e.next=4,HI.all([i$(r,BZ).then((function(e){s.orgTrackVolume=e})),i$(n,BZ).then((function(e){s.mediaTrackVolume=e})),i$(i,BZ).then((function(e){s.preprocessingTrackVolume=e}))]);case 4:o.push(s);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 13:return e.abrupt("return",{timestamp:n,trackVolumes:o});case 14:case"end":return e.stop()}}),e)}))),s$.apply(this,arguments)}function c$(e){return u$.apply(this,arguments)}function u$(){return(u$=Ng(Mg().mark((function e(t){var r,n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.now(),n=n$(t),i=Jg(n).call(n,(function(e){var t=e.orgTrack,r=e.mediaTrack,n=e.preprocessingTrack,i=SD(e,zZ);return Zl({orgTrack:t?jZ(Jg(XZ).call(XZ,(function(e){return[e,t[e]]}))):void 0,mediaTrack:r?jZ(Jg(XZ).call(XZ,(function(e){return[e,r[e]]}))):void 0,preprocessingTrack:n?jZ(Jg(XZ).call(XZ,(function(e){return[e,n[e]]}))):void 0},i)})),e.abrupt("return",{timestamp:r,trackStates:i});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d$(e){if(e){var t={track:e.track?e.track.id:void 0,transport:{state:e.transport?e.transport.state:void 0}};return e.transport&&e.transport.iceTransport&&(t.iceTransport={state:e.transport.iceTransport.state,role:e.transport.iceTransport.role,gatheringState:e.transport.iceTransport.gatheringState,component:e.transport.iceTransport.component}),t}}function l$(e){return h$.apply(this,arguments)}function h$(){return(h$=Ng(Mg().mark((function e(t){var r,n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.now(),n=[],t._room&&t._room._mediaServerClient&&t._room._mediaServerClient._handler&&t._room._mediaServerClient._handler._peerConnection&&(n=t._room._mediaServerClient._handler._peerConnection.getTransceivers()),i=[],n.forEach((function(e){var t=Zl({sender:d$(e.sender),receiver:d$(e.receiver)},jZ(Jg(qZ).call(qZ,(function(t){return[t,e[t]]}))));i.push(t)})),e.abrupt("return",{timestamp:r,tranceiverStates:i});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p$(e){return v$.apply(this,arguments)}function v$(){return(v$=Ng(Mg().mark((function e(t){var r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={stats:[],mediaElementStates:[],audioContextStates:[],volumes:[],trackStates:[],tranceiverStates:[]},n=[],e.next=4,new HI((function(e){var i,o=0;i=setTimeout((function a(){n.push(YZ(t).then((function(e){r.stats.push(e)})),ZZ(t).then((function(e){r.mediaElementStates.push(e)})),t$(t).then((function(e){r.audioContextStates.push(e)})),a$(t).then((function(e){r.volumes.push(e)})),c$(t).then((function(e){r.trackStates.push(e)})),l$(t).then((function(e){r.tranceiverStates.push(e)}))),++o>=10?HI.all(n).then((function(){e()})):(clearTimeout(i),i=setTimeout(a,500))}),500)}));case 4:return console.log("RTC_AMBULANCE",r),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var f$=dT,_$=GI,m$=function(e,t,r,n){for(var i,o=n>1?void 0:n?_$(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&f$(t,r,o),o},g$=function(e){VA(Re,e);var t,r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I,R,A,w,C,x,O,P,M,D,N,L,U,V,F,B,j,H,G,z,K,W,X,q,Y,J,Q,Z,$,ee,te,re,ne,ie,oe,ae,se,ce,ue,de,le,he,pe,ve,fe,_e,me,ge,ye,Se,be,ke,Ee,Te,Ie=tw(Re);function Re(e,t,r){var n;return Bh(this,Re),Jl(sA(n=Ie.call(this)),"monitor",void 0),Jl(sA(n),"logger",void 0),Jl(sA(n),"_room",void 0),Jl(sA(n),"_publicStreamManager",void 0),Jl(sA(n),"_appId",void 0),Jl(sA(n),"_businessId",void 0),Jl(sA(n),"_visibility",!0),Jl(sA(n),"_localVideoTrack",void 0),Jl(sA(n),"_localAudioTrack",void 0),Jl(sA(n),"_localImgVideoTrack",void 0),Jl(sA(n),"_localImgScreenTrack",void 0),Jl(sA(n),"_localScreenVideoTrack",void 0),Jl(sA(n),"_localScreenAudioTrack",void 0),Jl(sA(n),"_tempMixingAudioTrack",void 0),Jl(sA(n),"_localAudioVolume",100),Jl(sA(n),"_localScreenAudioVolume",100),Jl(sA(n),"_remoteAudioVolume",new uT),Jl(sA(n),"_remoteScreenAudioVolume",new uT),Jl(sA(n),"_publicAudioVolume",new uT),Jl(sA(n),"_videoPlayer",void 0),Jl(sA(n),"_screenPlayer",void 0),Jl(sA(n),"_remoteVideoPlayer",new uT),Jl(sA(n),"_remoteScreenPlayer",new uT),Jl(sA(n),"_remoteAudioPlayer",new uT),Jl(sA(n),"_remoteScreenAudioPlayer",new uT),Jl(sA(n),"_publicStreamAudioPlayer",new uT),Jl(sA(n),"_publicStreamVideoPlayer",new uT),Jl(sA(n),"_publicStreamIds",new uT),Jl(sA(n),"_roomConfig",void 0),Jl(sA(n),"_videoStreamConstraints",Zl({},PU)),Jl(sA(n),"_audioStreamConstraints",{}),Jl(sA(n),"_enableSimulcast",!1),Jl(sA(n),"_videoStreamEncodeConfig",[Zl({},PU)]),Jl(sA(n),"_screenStreamEncodeConfig",[Zl({},MU)]),Jl(sA(n),"_dummyMainImage",void 0),Jl(sA(n),"_dummyScreenImage",void 0),Jl(sA(n),"_trackSourceType",void 0),Jl(sA(n),"_liveTranscodeConfig",void 0),Jl(sA(n),"_startCloudProxyTimestamp",void 0),Jl(sA(n),"_localVideoDeviceId",void 0),Jl(sA(n),"_pauseAllSubscribeState",{audio:void 0,video:void 0,resumeStreamIds:{}}),Jl(sA(n),"_audioVolumeIndicationTimer",void 0),Jl(sA(n),"_dummyMainTimer",void 0),Jl(sA(n),"_dummyScreenTimer",void 0),Jl(sA(n),"_audioPropertiesReportTimer",null),Jl(sA(n),"_mirrorType",hh.MIRROR_TYPE_RENDER),Jl(sA(n),"_audioMixingManager",void 0),Jl(sA(n),"_pubLock",void 0),Jl(sA(n),"_subLocks",void 0),Jl(sA(n),"_audioCaptureLock",void 0),Jl(sA(n),"_videoCaptureLock",void 0),Jl(sA(n),"_screenCaptureLock",void 0),Jl(sA(n),"_subScreenLocks",void 0),Jl(sA(n),"_rtmClient",void 0),Jl(sA(n),"_messageStatisticsObserver",void 0),Jl(sA(n),"_tempRoomInfo",void 0),Jl(sA(n),"_originIceConfigRequestUrls",void 0),Jl(sA(n),"_originConfigServerUrls",void 0),Jl(sA(n),"_originLogServerUrl",void 0),Jl(sA(n),"_extensionManager",void 0),Jl(sA(n),"_audioDeviceManager",void 0),Jl(sA(n),"_remoteVideoConfig",new uT),Jl(sA(n),"_config",void 0),Jl(sA(n),"_needClosePreTrack",!1),Jl(sA(n),"_ctx",void 0),Jl(sA(n),"_updateMixAudioTrack",function(){var e=Ng(Mg().mark((function e(t){var r,i,o=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o.length>1&&void 0!==o[1]?o[1]:Dh.PLAYOUT_AND_PUBLISH,n.logger.info("_updateMixAudioTrack()"),n._localAudioTrack){e.next=5;break}return t&&(n._tempMixingAudioTrack={track:t,type:i}),e.abrupt("return");case 5:if(t?(n._localAudioTrack.mixType=i,n._localAudioTrack.mixedAudioTrack=t):(delete n._localAudioTrack.mixType,delete n._localAudioTrack.mixedAudioTrack),null===(r=n._room)||void 0===r||!r.hasPublished){e.next=9;break}return e.next=9,n._updatePublish();case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Jl(sA(n),"_onAudioMixingMessage",(function(e){n.safeEmit(Uh.onAudioMixingStateChanged,e)})),Jl(sA(n),"_onAudioMixingAutoplayFailed",(function(e){n.safeEmit(Uh.onAutoplayFailed,e)})),n.id=t,n._appId=e,n.monitor=KD(t),n._ctx={id:t,appId:e,avSync:!0,streamRTT:{},useCloudProxy:!1,audioProfileManager:new TZ(e),userPriority:new uT,expectedIDC:null==r?void 0:r.expectedIDC,joinRoomConfig:new bU(t),enableFallbackHandler:I$(e),enableStandardHandler:R$(e),pcKillSwitch:Zl(Zl({ctor_sdpsemantics_add:!0,ctor_encodedinsetablestream_add:!0,sld_rtcpfb_rrtr_add:!0,sld_ext_sdesmid_remove:!0,sld_fmtp_sps_add:!0,sld_fmtp_bitrate_add:!0,sld_fmtp_opus_add:!0},wU("PC_KILLSWITCH")),T$(n._appId))},n._pubLock=new PX("pubLock"),n._subLocks=new uT,n._subScreenLocks=new uT,n._audioCaptureLock=new PX("audioCap"),n._videoCaptureLock=new PX("videoCap"),n._screenCaptureLock=new PX("screenCap"),n._addDeviceEventHandler(),n._extensionManager=new LH(t),n._audioDeviceManager=new AZ(n._ctx,n._extensionManager),n._audioMixingManager=new bZ({getLocalAudioTrack:function(){return n._localAudioTrack},updateLocalAudioTrack:n._updateMixAudioTrack,emitMessage:n._onAudioMixingMessage,onAutoPlayFailed:n._onAudioMixingAutoplayFailed},t),window.__rtc_engine__=sA(n),window["__rtc_engine__".concat(Math.floor(100*Math.random()+1))]=sA(n),n._trackSourceType={video:$l.VIDEO_SOURCE_TYPE_INTERNAL,screenVideo:$l.VIDEO_SOURCE_TYPE_INTERNAL,audio:eh.AUDIO_SOURCE_TYPE_INTERNAL,screenAudio:eh.AUDIO_SOURCE_TYPE_INTERNAL},n._config=r,n._rtmClient=new EZ(n._ctx),n._handleRTMClient(n._rtmClient),n._handleAudioDeviceManager(),n._messageStatisticsObserver=new LD(t),n.logger=new lN("Engine",0,t),ND.createRTSMsgReportor(n.id),n._getServerConfig(),n.monitor.reportLongString("NativeDetector",zg(US)),n}return Fh(Re,[{key:"appId",get:function(){return this._appId},set:function(e){this._appId=e}},{key:"updateToken",value:(Te=Ng(Mg().mark((function e(t){var r,n,i,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updateToken()","token: %s",t),LU(t,"token"),!this.waitForNewToken||!this._tempRoomInfo){e.next=8;break}return r=this._tempRoomInfo,n=r.config,i=r.userInfo,o=r.roomId,delete this._tempRoomInfo,e.next=7,this.joinRoom(t,o,i,n);case 7:return e.abrupt("return",e.sent);case 8:if(this._room){e.next=10;break}throw new kC(mC.UPDATE_TOKEN_BEFORE_JOIN,"update token before join room");case 10:return e.next=12,this._room.updateToken(t);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return Te.apply(this,arguments)})},{key:"setVideoCaptureDevice",value:(Ee=Ng(Mg().mark((function e(t){var r,n,i,o,a,s=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("setVideoCaptureDevice()","deviceId: %s",t),LU(t,"deviceId"),this._localVideoDeviceId=t,this._localVideoTrack){e.next=5;break}return e.abrupt("return");case 5:if(!JL||!$L){e.next=9;break}if(this._localVideoTrack.originTrack.getSettings().deviceId!==t){e.next=9;break}return e.abrupt("return");case 9:return n=MK({},this._videoStreamConstraints),"user"===t||"environment"===t||"left"===t||"right"===t?(delete n.deviceId,n.facingMode=t):!XL||ZL?n.deviceId={exact:t}:delete n.deviceId,$L&&jL&&lU>=85&&lU<=91&&(null===(i=this._videoPlayer)||void 0===i||i.removeTrack()),this._needClosePreTrack=this._needClosePreTrack||wj,this._needClosePreTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close(),delete this._localVideoTrack),this.logger.info("setVideoCaptureDevice()","start createCameraVideoTrack..."),e.next=17,oG(n,this._extensionManager).catch((function(e){if(s._localVideoTrack&&!s._localVideoTrack.dummy)return s.logger.warn("setVideoCaptureDevice()","createCameraVideoTrack failed, stop pre VideoTrack."),s._removeLocalTrackEvents(s._localVideoTrack),s._localVideoTrack.close(),delete s._localVideoTrack,oG(n,s._extensionManager).then((function(e){return s._needClosePreTrack=!0,e})).catch(Ng(Mg().mark((function t(){var r;return Mg().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s.logger.error("setVideoCaptureDevice()","createCameraVideoTrack failed, rollback."),t.next=3,oG(s._videoStreamConstraints,s._extensionManager);case 3:throw r=t.sent,s._switchTrack(r),e;case 6:case"end":return t.stop()}}),t)}))));throw e}));case 17:return o=e.sent,this.logger.success("setVideoCaptureDevice()","createCameraVideoTrack success."),this._videoStreamConstraints=n,this._localVideoTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close()),null!==(r=this._videoStreamEncodeConfig[0])&&void 0!==r&&r.contentHint&&o.setContentHint(null===(a=this._videoStreamEncodeConfig[0])||void 0===a?void 0:a.contentHint),e.next=24,this._switchTrack(o);case 24:case"end":return e.stop()}}),e,this)}))),function(e){return Ee.apply(this,arguments)})},{key:"setAudioCaptureDevice",value:(ke=Ng(Mg().mark((function e(t){var r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("setAudioCaptureDevice()","deviceId: %s",t),LU(t,"deviceId"),this._ctx.audioProfileManager.updateConstraints({deviceId:{exact:t}}),this._localAudioTrack){e.next=5;break}return e.abrupt("return");case 5:return this._localAudioTrack.close(),this._removeLocalTrackEvents(this._localAudioTrack),e.next=9,sG(this._ctx.audioProfileManager.getConstraints(),this._extensionManager);case 9:if(n=e.sent,this._initLocalTrackEvents(n),this._localAudioTrack=n,this._localAudioTrack.setVolume(this._localAudioVolume),this._room){e.next=15;break}return e.abrupt("return");case 15:if(null===(r=this._room.localStream)||void 0===r||!r.pubAudio){e.next=18;break}return e.next=18,this._updatePublish();case 18:case"end":return e.stop()}}),e,this)}))),function(e){return ke.apply(this,arguments)})},{key:"_addDeviceEventHandler",value:function(){RH.on(Uh.onVideoDeviceStateChanged,this._onVideoDeviceStateChange.bind(this)),RH.on(Uh.onAudioDeviceStateChanged,this._onAudioDeviceStateChange.bind(this))}},{key:"_addHandlerEventHandler",value:function(){var e,t,r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I,R,A,w,C,x,O,P,M,D,N,L,U,V=this;null===(e=this._room)||void 0===e||e.on(IX.ON_ADD_STREAM,this._onAddStream.bind(this)),null===(t=this._room)||void 0===t||t.on(IX.ON_REMOVE_STREAM,this._onRemoveStream.bind(this)),null===(r=this._room)||void 0===r||r.on(IX.USER_CONNECTION,this._onUserConnection.bind(this)),null===(n=this._room)||void 0===n||n.on(MX.ON_USER_LEAVE,this._onUserLeave.bind(this)),null===(i=this._room)||void 0===i||i.on(MX.ON_ROOM_ERROR,this._onRoomError.bind(this)),null===(o=this._room)||void 0===o||o.on(MX.ON_NETWORK_QUALITY,this._onNetworkQuality.bind(this)),null===(a=this._room)||void 0===a||a.on(IX.ON_CUSTOM_MESSAGE,this._onCustomMessage.bind(this)),null===(s=this._room)||void 0===s||s.on(IX.USER_MESSAGE_RECEIVED,this._onUserMessageReceived.bind(this)),null===(c=this._room)||void 0===c||c.on(IX.USER_BINARY_MESSAGE_RECEIVED,this._onUserBinaryMessageReceived.bind(this)),null===(u=this._room)||void 0===u||u.on(IX.ON_USER_TOKEN_WILL_EXPIRE,this._onUserTokenWillExpire.bind(this)),null===(d=this._room)||void 0===d||d.on(IX.POST_PROCESSING_MESSAGE,(function(e){"2.0"===e.protocol?V._onStreamMixingEvent({error:e.error,event:e.eventType,message:e.message}):"publicStreamCallback"===e.type?V._onPushPublicStreamResult(e):"transcodeStatusCallback"===e.type&&V._onLiveTranscodingResult(e)})),null===(l=this._room)||void 0===l||l.on(AX.ON_CONNECTION_STATE_CHANGE,this._onConnectionStateChange.bind(this)),null===(h=this._room)||void 0===h||h.on(AX.ON_VENDOR_CONNECTION_STATE_CHANGE,(function(e){return V.safeEmit(Uh.onVendorConnectionStateChanged,e)})),null===(p=this._room)||void 0===p||p.on(MX.RESUBSCRIBE,this._onResubscribe.bind(this)),null===(v=this._room)||void 0===v||v.on(MX.SUBSCRIBE_PUSH_TRACK,this._onSubscribePushTrack.bind(this)),null===(f=this._room)||void 0===f||f.on(MX.REMOVE_PUSH_TRACK,this._onRemovePushTrack.bind(this)),null===(_=this._room)||void 0===_||_.on(MX.ON_PUBLISH_RESULT,(function(e){var t,r=!(e.retry||null===(t=V._room)||void 0===t||!t._roomConfig.isAutoPublish);r&&V.safeEmit(Uh.onAutoPublishResult,e),V.safeEmit(Uh.onPublishResult,{isScreen:e.isScreen,isAutoPublish:r,errorCode:e.errorCode})})),null===(m=this._room)||void 0===m||m.on(MX.ON_SUBSCRIBE_RESULT,(function(e){V.safeEmit(Uh.onSubscribeResult,{userId:e.userId,isScreen:e.isScreen,isAutoSubscribe:!1,errorCode:e.errorCode})})),null===(g=this._room)||void 0===g||g.on(MX.ON_REMOTE_STREAM_STATS,(function(e){V.safeEmit(Uh.onRemoteStreamStats,e)})),null===(y=this._room)||void 0===y||y.on(MX.ON_LOCAL_STREAM_STATS,(function(e){V.safeEmit(Uh.onLocalStreamStats,e)})),null===(S=this._room)||void 0===S||S.on(MX.ON_SUBTITLE_STATE_CHANGED,(function(e){V.safeEmit(Uh.onSubtitleStateChanged,e)})),null===(b=this._room)||void 0===b||b.on(MX.ON_SUBTITLE_MESSAGE_RECEIVED,(function(e){V.safeEmit(Uh.onSubtitleMessageReceived,e)})),null===(k=this._room)||void 0===k||k.on(MX.ON_USER_PUBLISH_STATE_CHANGE,this._onUserPublishStateChange.bind(this)),null===(E=this._room)||void 0===E||E.on(MX.ON_USER_START_AUDIO_CAPTURE,(function(e,t){var r=e.userId;V._updateAudioPlayerState(t),V.safeEmit(Uh.onUserStartAudioCapture,{userId:r})})),null===(T=this._room)||void 0===T||T.on(MX.ON_USER_STOP_AUDIO_CAPTURE,(function(e){var t=e.userId;V.safeEmit(Uh.onUserStopAudioCapture,{userId:t})})),null===(I=this._room)||void 0===I||I.on(MX.ON_USER_START_VIDEO_CAPTURE,(function(e){var t=e.userId;V.safeEmit(Uh.onUserStartVideoCapture,{userId:t})})),null===(R=this._room)||void 0===R||R.on(MX.ON_USER_STOP_VIDEO_CAPTURE,(function(e){var t=e.userId;V.safeEmit(Uh.onUserStopVideoCapture,{userId:t})})),null===(A=this._room)||void 0===A||A.on(MX.ON_SEI_MESSAGED_RECEIVED,(function(e){V.safeEmit(Uh.onSEIMessageReceived,e)})),null===(w=this._room)||void 0===w||w.on(MX.ON_REMOTE_VIDEO_SIZE_CHANGED,(function(e,t){V.safeEmit(Uh.onRemoteVideoSizeChanged,e,t)})),null===(C=this._room)||void 0===C||C.on(MX.ON_SIMULCAST_SUBSCRIBE_FALLBACK,(function(e){return V.safeEmit(Uh.onSimulcastSubscribeFallback,e)})),null===(x=this._room)||void 0===x||x.on(MX.RECONNECT_FAILED,(function(){V.safeEmit(Uh.onError,{errorCode:mC.RECONNECT_FAILED})})),null===(O=this._room)||void 0===O||O.on(MX.ON_VIDEO_STREAM_BANNED,(function(e){V.safeEmit(Uh.onVideoStreamBanned,{uid:e.uid,banned:e.banned})})),null===(P=this._room)||void 0===P||P.on(MX.ON_AUDIO_STREAM_BANNED,(function(e){V.safeEmit(Uh.onAudioStreamBanned,{uid:e.uid,banned:e.banned})})),null===(M=this._room)||void 0===M||M.on(MX.ON_FORWARD_STREAM_ERROR,(function(e){V.safeEmit(Uh.onForwardStreamError,e)})),null===(D=this._room)||void 0===D||D.on(MX.ON_REJOIN_WITH_TCP,(function(){V.safeEmit(Uh.onRejoinWithTcp)})),null===(N=this._room)||void 0===N||N.on(MX.ON_ICE_CONNECT_WITH_TCP,(function(){V.safeEmit(Uh.onIceConnectWithTcp)})),null===(L=this._room)||void 0===L||L.on(MX.PUB_RETRY,(function(e){V.safeEmit(Uh.onPublishRetry,e)})),null===(U=this._room)||void 0===U||U.on(MX.SUB_RETRY,(function(e){V.safeEmit(Uh.onSubscribeRetry,e)}))}},{key:"safeEmit",value:function(e){for(var t,r,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return function(e){var t,r=wU("FORCE_ENABLED_REPORT_CALLBACKS");return!(null==r||!qy(r).call(r,e))||!qy(t=[Uh.onRemoteStreamStats,Uh.onLocalStreamStats,Uh.onAudioVolumeIndication,Uh.onLocalAudioPropertiesReport,Uh.onRemoteAudioPropertiesReport]).call(t,e)}(e)&&YD(this.id,e,i),(t=LA(NA(Re.prototype),"safeEmit",this)).call.apply(t,Bg(r=[this,e]).call(r,i))}},{key:"_removeHandlerEventHandler",value:function(){var e;null===(e=this._room)||void 0===e||e.removeAllListeners()}},{key:"connect",value:(be=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._room){e.next=2;break}return e.abrupt("return");case 2:return this._room=new Dq({isAutoPublish:!0,isAutoSubscribeAudio:!0,isAutoSubscribeVideo:!0,roomProfileType:Eh.communication},this._ctx),this._addHandlerEventHandler(),e.next=6,this._room.connect(this._appId);case 6:case"end":return e.stop()}}),e,this)}))),function(){return be.apply(this,arguments)})},{key:"joinRoom",value:(Se=Ng(Mg().mark((function e(t,r,n,i){var o,a,s,c,u,d;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("joinRoom()","token: %o roomId: %o, userInfo: %o, roomConfig: %o",t,r,n,i),HU(t)||LU(t,"token"),GU(r),WU(n),XU(i=MK({isAutoPublish:!0,isAutoSubscribeAudio:!0,isAutoSubscribeVideo:!0,roomProfileType:Eh.communication},i)),(null===(o=this._room)||void 0===o?void 0:o.connectionState)!==cq.CONNECTED){e.next=8;break}throw new kC(mC.REPEAT_JOIN,"Already joined");case 8:return null===(a=this.monitor)||void 0===a||a.report("rtc_sdk_api_call",{sdk_api_name:"host",message:location.host,error_code:0}),this._room||(this._room=new Dq(i,this._ctx),this._addHandlerEventHandler()),this._room.roomConfig=i,s=this._liveTranscodeConfig&&UZ.getStartParams(this._liveTranscodeConfig),c=Zl(Zl({},n),{},{businessId:this._businessId,role:this._visibility?kZ.NORMAL_USER:kZ.SILENT_USER}),e.prev=13,this._ctx.useCloudProxy&&(this._startCloudProxyTimestamp=Date.now()),Tq(c),e.next=18,this._room.join(this._appId,r,t,c,s);case 18:return u=e.sent,this._roomConfig=i,this._ctx.audioProfileManager.setRoomId(r),this._tempRoomInfo&&delete this._tempRoomInfo,i.isAutoPublish&&(this._visibility?this._updatePublish({invokeByJoinRoom:!0,mediaType:uh.AUDIO_AND_VIDEO}):(this.safeEmit(Uh.onAutoPublishResult,{isScreen:!1,state:oh.PUBLISH_FAIL}),this.safeEmit(Uh.onPublishResult,{isScreen:!1,isAutoPublish:!0,errorCode:mC.NO_PUBLISH_PERMISSION}))),ND.setRoomId(this.id,r),ND.setUserId(this.id,n.userId),e.abrupt("return",u);case 28:throw e.prev=28,e.t0=e.catch(13),e.t0.code===mC.INVALID_TOKEN&&(this._tempRoomInfo={config:i,roomId:r,userInfo:c}),null===(d=this._room)||void 0===d||d.destroy(),delete this._room,e.t0;case 34:case"end":return e.stop()}}),e,this,[[13,28]])}))),function(e,t,r,n){return Se.apply(this,arguments)})},{key:"leaveRoom",value:(ye=Ng(Mg().mark((function e(){var t,r,n,i=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]&&i[0],this.logger.info("leaveRoom()"),!t){e.next=7;break}return e.next=5,null===(r=this._room)||void 0===r?void 0:r.leave(t);case 5:e.next=8;break;case 7:null===(n=this._room)||void 0===n||n.leave(t).catch();case 8:this._removeHandlerEventHandler(),this._subLocks=new uT,this._subScreenLocks=new uT,this._ctx.audioProfileManager.setRoomId(),this._liveTranscodeConfig&&this.stopLiveTranscoding(),this._room=void 0,this._remoteAudioPlayer.forEach((function(e){return e.destroy()})),this._remoteAudioPlayer=new uT,this._remoteScreenAudioPlayer.forEach((function(e){return e.destroy()})),this._remoteScreenAudioPlayer=new uT,this._remoteScreenPlayer.forEach((function(e){return e.destroy()})),this._remoteScreenPlayer=new uT,this._remoteVideoPlayer.forEach((function(e){return e.destroy()})),this._remoteVideoPlayer=new uT,this._roomConfig=void 0,this._publicStreamIds=new uT,ND.setRoomId(this.id,""),ND.setUserId(this.id,"");case 26:case"end":return e.stop()}}),e,this)}))),function(){return ye.apply(this,arguments)})},{key:"_destroyLocalTrack",value:function(){this._localAudioTrack&&(this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.close(),this._localAudioTrack=void 0),this._localVideoTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close(),this._localVideoTrack=void 0),this._localScreenAudioTrack&&(this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.close(),this._localScreenAudioTrack=void 0),this._localScreenVideoTrack&&(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.close(),this._localScreenVideoTrack=void 0),this._localImgVideoTrack&&(this._localImgVideoTrack.stop(),this._localImgVideoTrack=void 0),this._localImgScreenTrack&&(this._localImgScreenTrack.stop(),this._localImgScreenTrack=void 0)}},{key:"destroy",value:function(){var e,t,r;this.logger.info("destroy()"),this.removeAllListeners(),this._removeHandlerEventHandler(),null===(e=this._room)||void 0===e||e.destroy(),this._room=void 0,null===(t=this._videoPlayer)||void 0===t||t.destroy(),this._subLocks=new uT,this._subScreenLocks=new uT,this._audioCaptureLock=new PX("audioCap"),this._videoCaptureLock=new PX("videoCap"),this._screenCaptureLock=new PX("screenCap"),this._videoPlayer=void 0,this._screenPlayer=void 0,this._videoStreamConstraints={},this._videoStreamEncodeConfig=[PU],this._screenStreamEncodeConfig=[MU],this._pauseAllSubscribeState={audio:void 0,video:void 0,resumeStreamIds:{}},this._messageStatisticsObserver.destroy(),this.monitor.destroy(),ND.destroyRTSMsgReportor(this.id),clearInterval(this._audioVolumeIndicationTimer),clearInterval(this._dummyMainTimer),clearInterval(this._dummyScreenTimer),this._audioVolumeIndicationTimer=void 0,this._stopAudioPropertiesReport(),this._destroyLocalTrack(),xH.on("".concat(this.id,"capture-end"),this._destroyLocalTrack.bind(this)),this._remoteAudioPlayer.forEach((function(e){return e.destroy()})),this._remoteAudioPlayer=new uT,this._remoteScreenAudioPlayer.forEach((function(e){return e.destroy()})),this._remoteScreenAudioPlayer=new uT,this._remoteScreenPlayer.forEach((function(e){return e.destroy()})),this._remoteScreenPlayer=new uT,this._remoteVideoPlayer.forEach((function(e){return e.destroy()})),this._remoteVideoPlayer=new uT,this._publicStreamAudioPlayer.forEach((function(e){return e.destroy()})),this._publicStreamAudioPlayer=new uT,this._publicStreamVideoPlayer.forEach((function(e){return e.destroy()})),this._publicStreamVideoPlayer=new uT,this._roomConfig=void 0,this._audioMixingManager.destroy(),this._rtmClient.destroy(),null===(r=this._publicStreamManager)||void 0===r||r.destroy(),this._publicStreamIds=new uT,this._audioDeviceManager.destroy(),this._remoteVideoConfig=new uT,this._ctx.userPriority.clear(),this._extensionManager.destroy(),this._ctx.avSync=!0,this._localAudioVolume=100,this._localScreenAudioVolume=100,this._remoteAudioVolume.clear(),this._remoteScreenAudioVolume.clear(),this._publicAudioVolume.clear()}},{key:"publishStream",value:(ge=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("publishStream()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),!TL(t)||this._localVideoTrack||!this._localImgVideoTrack){e.next=7;break}return e.next=6,tG(this._localImgVideoTrack,this._extensionManager);case 6:this._localVideoTrack=e.sent;case 7:return e.next=9,this._updatePublish({mediaType:t});case 9:case"end":return e.stop()}}),e,this)}))),function(e){return ge.apply(this,arguments)})},{key:"unpublishStream",value:(me=Ng(Mg().mark((function e(t,r){var n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("unpublishStream()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),!r){e.next=5;break}return e.abrupt("return",null===(n=this._room)||void 0===n?void 0:n.unpublish());case 5:return e.next=7,this._updatePublish({mediaType:t,pubState:NX.UNPUB});case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return me.apply(this,arguments)})},{key:"publishScreen",value:(_e=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("publishScreen()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),e.prev=3,!TL(t)||this._localScreenVideoTrack||!this._localImgScreenTrack){e.next=8;break}return e.next=7,nG(this._localImgScreenTrack,this._extensionManager);case 7:this._localScreenVideoTrack=e.sent;case 8:return e.next=10,this._updateScreenPublish({mediaType:t,pubState:NX.PUB});case 10:e.next=19;break;case 12:if(e.prev=12,e.t0=e.catch(3),!(e.t0 instanceof kC)){e.next=18;break}throw e.t0;case 18:throw new kC(mC.UNEXPECTED_ERROR,"unexpected error",e.t0);case 19:case"end":return e.stop()}}),e,this,[[3,12]])}))),function(e){return _e.apply(this,arguments)})},{key:"unpublishScreen",value:(fe=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("unpublishScreen()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),e.next=5,this._updateScreenPublish({mediaType:t,pubState:NX.UNPUB});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return fe.apply(this,arguments)})},{key:"subscribeStream",value:(ve=Ng(Mg().mark((function e(t,r){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("subscribeStream()","userId: %o, mediaType: %o",t,r),e.abrupt("return",this._subscribe(!1,t,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return ve.apply(this,arguments)})},{key:"_subscribe",value:(pe=Ng(Mg().mark((function e(t,r,n){var i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n!==uh.AUDIO||null===(i=this._room)||void 0===i||!i.multiChatMode){e.next=3;break}return this.logger.warn("subscribeStream()","due to multiChatMode return"),e.abrupt("return");case 3:if(s=this._room.remoteStreams.get(r),c=null==s?void 0:sI(s).call(s,(function(e){return e.isScreen===t}))){e.next=7;break}throw new kC(mC.STREAM_NOT_EXIST,"stream not exist");case 7:return u=this._pauseAllSubscribeState.audio,d=this._pauseAllSubscribeState.video,this._pauseAllSubscribeState.audio&&(n-=n&uh.AUDIO),this._pauseAllSubscribeState.video&&(n-=n&uh.VIDEO),this.logger.warn("subscribeStream()","due to pauseAll mediaType: %o",n),l=c.hasSubscribed,h=this._remoteVideoConfig.get(r)||(null===(o=this._roomConfig)||void 0===o?void 0:o.remoteVideoConfig),c.originalMediaType=n,e.next=17,this._room.subscribe(c,n,h);case 17:EL(n)&&this._updateAudioPlayerState(c),TL(n)&&this._updateVideoPlayerState(c),p=0,v=0,u!==this._pauseAllSubscribeState.audio&&(this._pauseAllSubscribeState.audio?p|=uh.AUDIO:v|=uh.AUDIO),d!==this._pauseAllSubscribeState.video&&(this._pauseAllSubscribeState.video?p|=uh.VIDEO:v|=uh.VIDEO),p&&this.pauseAllSubscribedStream(p),v&&this.resumeAllSubscribedStream(v),this._pauseAllSubscribeState.resumeStreamIds[c.streamId]=c.streamId,(c.audioTrack||c.videoTrack)&&(m=!(t||!(null!==(f=this._roomConfig)&&void 0!==f&&f.isAutoSubscribeAudio||null!==(_=this._roomConfig)&&void 0!==_&&_.isAutoSubscribeVideo)),g={userId:r,isScreen:!1,state:ih.SUBSCRIBE_SUCC},m&&this.safeEmit(Uh.onAutoSubscribeResult,g),this.safeEmit(Uh.onSubscribeResult,{userId:r,isScreen:t,isAutoSubscribe:m})),null!==(a=this._room)&&void 0!==a&&a.multiChatMode||l||!EL(n)||!c.hasAudio||null===(y=c.observer)||void 0===y||y.setSubscribeAudio(!0),!l&&TL(n)&&c.hasVideo&&(null===(S=c.observer)||void 0===S||S.setSubscribeVideo(!0));case 29:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return pe.apply(this,arguments)})},{key:"unsubscribeStream",value:(he=Ng(Mg().mark((function e(t,r){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("unsubscribeStream()","userId: %o, mediaType: %o",t,r),e.abrupt("return",this._unsubscribe(!1,t,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return he.apply(this,arguments)})},{key:"subscribeScreen",value:(le=Ng(Mg().mark((function e(t,r){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("subscribeScreen() userId: %o, mediaType: %o",t,r),e.abrupt("return",this._subscribe(!0,t,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return le.apply(this,arguments)})},{key:"unsubscribeScreen",value:(de=Ng(Mg().mark((function e(t,r){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("unsubscribeScreen() userId: %o, mediaType: %o",t,r),e.abrupt("return",this._unsubscribe(!0,t,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return de.apply(this,arguments)})},{key:"_unsubscribe",value:function(e,t,r,n){var i,o=this;if(r!==uh.AUDIO||null===(i=this._room)||void 0===i||!i.multiChatMode){var a,s=this._room.remoteStreams.get(t),c=null==s?void 0:sI(s).call(s,(function(t){return t.isScreen===e}));if(!c)throw new kC(mC.STREAM_NOT_EXIST,"stream not exist");if($L&&lU&&lU>=85&&lU<=91&&r!==uh.AUDIO)null===(a=e?this._remoteScreenPlayer.get(t):this._remoteVideoPlayer.get(t))||void 0===a||a.stop();return this._room.unsubscribe(c,r).then((function(){n||delete o._pauseAllSubscribeState.resumeStreamIds[c.streamId]}))}this.logger.warn("subscribeStream()","due to multiChatMode return")}},{key:"setRemoteVideoConfig",value:(ue=Ng(Mg().mark((function e(t,r){var n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("setRemoteVideoConfig() userId: %o, remoteVideoConfig: %o",t,r),zU(t),JU(r),this._remoteVideoConfig.set(t,r),e.abrupt("return",null===(n=this._room)||void 0===n?void 0:n.updateSubVideoConfig(t,r).then((function(){})));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return ue.apply(this,arguments)})},{key:"startVideoCapture",value:(ce=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c,u,d,l,h,p,v=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("startVideoCapture()","deviceId: %s",t),HU(t)||LU(t,"deviceId"),t=t||this._localVideoDeviceId,this._localVideoDeviceId=t,this._trackSourceType.video!==$l.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=6;break}throw new kC(mC.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");case 6:if(!this._localVideoTrack||this._localVideoTrack.dummy){e.next=8;break}throw new kC(mC.REPEAT_CAPTURE,"Has already capture");case 8:return s=this._videoStreamConstraints,t&&("user"===t||"environment"===t||"left"===t||"right"===t?(s.facingMode=t,delete s.deviceId):!XL||ZL?s.deviceId={exact:t}:delete s.deviceId,this._videoStreamConstraints=s),c={},e.next=13,oG(s,this._extensionManager);case 13:if(u=e.sent,null!==(r=this._videoStreamEncodeConfig[0])&&void 0!==r&&r.contentHint&&u.setContentHint(null===(d=this._videoStreamEncodeConfig[0])||void 0===d?void 0:d.contentHint),this._initLocalTrackEvents(u),this._localVideoTrack=u,null===(n=this._videoPlayer)||void 0===n||n.playVideo(u),(l=u.originTrack)&&(c=l.getSettings(),h={width:c.width,height:c.height},this._localVideoTrack.resolution=h,this.autoResetVideoEncoderConfig(c),setTimeout((function(){return v.safeEmit(Uh.onLocalVideoSizeChanged,{streamIndex:ch.STREAM_INDEX_MAIN,info:h})}))),xH.emit("".concat(this.id,"capture-end")),this._room){e.next=23;break}return e.abrupt("return",c);case 23:return p=this._room._roomConfig.isAutoPublish,(null!==(i=this._room.localStream)&&void 0!==i&&i.pubVideo||p)&&this._visibility&&this._updatePublish(),null===(o=this._room.localStream)||void 0===o||null===(a=o.observer)||void 0===a||a.setEnableVideo(!0),e.abrupt("return",c);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return ce.apply(this,arguments)})},{key:"stopVideoCapture",value:(se=Ng(Mg().mark((function e(){var t,r,n,i,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("stopVideoCapture()"),this._trackSourceType.video!==$l.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=3;break}throw new kC(mC.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");case 3:if(null===(t=this._videoPlayer)||void 0===t||t.stop(),this._localVideoTrack&&(this._localVideoTrack.dummy||((o=this._extensionManager.getPluginByName(NH.PRE_PROCESSING,"RTCBeautyExtension"))&&o.emit("stop"),this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close(),this._localImgVideoTrack?(this._localVideoTrack.setTrack(this._localImgVideoTrack,this._extensionManager),this._localVideoTrack.dummy=!0):this._localVideoTrack=void 0)),this._room){e.next=7;break}return e.abrupt("return");case 7:if(null===(r=this._room.localStream)||void 0===r||!r.pubVideo){e.next=10;break}return e.next=10,this._updatePublish();case 10:null===(n=this._room.localStream)||void 0===n||null===(i=n.observer)||void 0===i||i.setEnableVideo(!1);case 11:case"end":return e.stop()}}),e,this)}))),function(){return se.apply(this,arguments)})},{key:"startAudioCapture",value:(ae=Ng(Mg().mark((function e(t){var r,n,i,o,a,s;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("startAudioCapture()","deviceId: $o",t),HU(t)||LU(t,"deviceId"),t&&this._ctx.audioProfileManager.updateConstraints({deviceId:{exact:t}}),this._trackSourceType.audio!==eh.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=5;break}throw new kC(mC.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");case 5:if(!this._localAudioTrack){e.next=7;break}throw new kC(mC.REPEAT_CAPTURE,"Has already capture");case 7:return o={},e.next=10,sG(this._ctx.audioProfileManager.getConstraints(),this._extensionManager);case 10:if((a=e.sent).originTrack&&(o=a.originTrack.getSettings()),this._initLocalTrackEvents(a),this._localAudioTrack=a,this._localAudioTrack.setVolume(this._localAudioVolume),this._tempMixingAudioTrack&&(this._localAudioTrack.mixType=this._tempMixingAudioTrack.type,this._localAudioTrack.mixedAudioTrack=this._tempMixingAudioTrack.track,delete this._tempMixingAudioTrack),xH.emit("".concat(this.id,"capture-end")),this._room){e.next=19;break}return e.abrupt("return",o);case 19:return s=this._room._roomConfig.isAutoPublish,(null!==(r=this._room.localStream)&&void 0!==r&&r.pubAudio||s)&&this._visibility&&this._updatePublish(),null===(n=this._room.localStream)||void 0===n||null===(i=n.observer)||void 0===i||i.setEnableAudio(!0),e.abrupt("return",o);case 23:case"end":return e.stop()}}),e,this)}))),function(e){return ae.apply(this,arguments)})},{key:"stopAudioCapture",value:(oe=Ng(Mg().mark((function e(){var t,r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("stopAudioCapture()"),this._trackSourceType.audio!==eh.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=3;break}throw new kC(mC.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");case 3:if(this._localAudioTrack&&(this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.close()),this._localAudioTrack=void 0,this._audioMixingManager.stopAll(),this._room){e.next=8;break}return e.abrupt("return");case 8:if(null===(t=this._room.localStream)||void 0===t||!t.pubAudio){e.next=11;break}return e.next=11,this._updatePublish();case 11:null===(r=this._room.localStream)||void 0===r||null===(n=r.observer)||void 0===n||n.setEnableAudio(!1);case 12:case"end":return e.stop()}}),e,this)}))),function(){return oe.apply(this,arguments)})},{key:"checkAudioAndVideoDeviceId",value:function(e,t){var r;return this.logger.print("startAudioAndVideoCapture","optionsOrAudioDeviceId: $o",e,"videoDeviceId: $o",t),HU(t)||LU(t,"videoDeviceId"),HU(e)||("string"==typeof e?(LU(e,"audioDeviceId"),r=e):(r=null==e?void 0:e.audioDeviceId,t=null==e?void 0:e.videoDeviceId,LU(r,"audioDeviceId"),LU(t,"videoDeviceId"))),t=t||this._localVideoDeviceId,this._localVideoDeviceId=t,{audioDeviceId:r,videoDeviceId:t}}},{key:"startAudioAndVideoCapture",value:(ie=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("startAudioAndVideoCapture","optionsOrAudioDeviceId: $o",t,"videoDeviceId: $o",r),l=this.checkAudioAndVideoDeviceId(t,r),h=l.audioDeviceId,p=l.videoDeviceId,r=p,h&&this._ctx.audioProfileManager.updateConstraints({deviceId:{exact:h}}),this._trackSourceType.video!==$l.VIDEO_SOURCE_TYPE_EXTERNAL&&this._trackSourceType.audio!==eh.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=6;break}throw new kC(mC.STREAM_TYPE_NOT_MATCH,this._trackSourceType.video===$l.VIDEO_SOURCE_TYPE_EXTERNAL?"setVideoSourceType as internal first":"setAudioSourceType as internal first");case 6:if(!this._localVideoTrack||this._localVideoTrack.dummy){e.next=8;break}throw new kC(mC.REPEAT_CAPTURE,"video has already capture");case 8:if(!this._localAudioTrack){e.next=10;break}throw new kC(mC.REPEAT_CAPTURE,"audio has already capture");case 10:return v=this._videoStreamConstraints,r&&("user"===r||"environment"===r||"left"===r||"right"===r?(v.facingMode=r,delete v.deviceId):!XL||ZL?v.deviceId={exact:r}:delete v.deviceId,this._videoStreamConstraints=v),f={},_={},e.next=16,uG(this._ctx.audioProfileManager.getConstraints(),v,this._extensionManager);case 16:if(m=e.sent,g=m.audioTrack,y=m.videoTrack,null!==(n=this._videoStreamEncodeConfig[0])&&void 0!==n&&n.contentHint&&y.setContentHint(null===(S=this._videoStreamEncodeConfig[0])||void 0===S?void 0:S.contentHint),this._initLocalTrackEvents(y),this._localVideoTrack=y,null===(i=this._videoPlayer)||void 0===i||i.playVideo(y),this._initLocalTrackEvents(g),this._localAudioTrack=g,this._localAudioTrack.setVolume(this._localAudioVolume),this._tempMixingAudioTrack&&(this._localAudioTrack.mixType=this._tempMixingAudioTrack.type,this._localAudioTrack.mixedAudioTrack=this._tempMixingAudioTrack.track,delete this._tempMixingAudioTrack),b=y.originTrack,f=b.getSettings(),k={width:f.width||0,height:f.height||0},this._localVideoTrack.resolution=k,this.autoResetVideoEncoderConfig(f),setTimeout((function(){return T.safeEmit(Uh.onLocalVideoSizeChanged,{streamIndex:ch.STREAM_INDEX_MAIN,info:k})})),b=g.originTrack,_=b.getSettings(),xH.emit("".concat(this.id,"capture-end")),this._room){e.next=38;break}return e.abrupt("return",{audioTrackSettings:_,videoTrackSettings:f});case 38:return E=this._room._roomConfig.isAutoPublish,(null!==(o=this._room.localStream)&&void 0!==o&&o.pubVideo||null!==(a=this._room.localStream)&&void 0!==a&&a.pubAudio||E)&&this._visibility&&this._updatePublish(),null===(s=this._room.localStream)||void 0===s||null===(c=s.observer)||void 0===c||c.setEnableVideo(!0),null===(u=this._room.localStream)||void 0===u||null===(d=u.observer)||void 0===d||d.setEnableAudio(!0),e.abrupt("return",{audioTrackSettings:_,videoTrackSettings:f});case 43:case"end":return e.stop()}}),e,this)}))),function(e,t){return ie.apply(this,arguments)})},{key:"startVideoAndAudioCapture",value:(ne=Ng(Mg().mark((function e(t,r){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.startAudioAndVideoCapture(r,t));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return ne.apply(this,arguments)})},{key:"getAudioMixingManager",value:function(){return this.logger.info("getAudioMixingManager()","invoke"),this._audioMixingManager}},{key:"startScreenCapture",value:(re=Ng(Mg().mark((function e(){var t,r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m=this,g=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=g.length>0&&void 0!==g[0]?g[0]:{},this.logger.info("startScreenCapture()","config: %o",c),u=c.enableAudio,d=void 0!==u&&u,this._trackSourceType.screenVideo!==$l.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=5;break}throw new kC(mC.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");case 5:if(this._trackSourceType.screenAudio!==eh.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=7;break}throw new kC(mC.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");case 7:return e.next=9,lG(d,this._extensionManager,this._screenStreamEncodeConfig[0]);case 9:if(l=e.sent,h=yy(l,2),p=h[0],null==(v=h[1])||v.setVolume(this._localScreenAudioVolume),this._localScreenVideoTrack&&!this._localScreenVideoTrack.dummy&&(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.close()),null===(t=this._localScreenAudioTrack)||void 0===t||t.close(),delete this._localScreenAudioTrack,this._localScreenVideoTrack=p,null!==(r=this._screenStreamEncodeConfig[0])&&void 0!==r&&r.contentHint&&p.setContentHint(null===(f=this._screenStreamEncodeConfig[0])||void 0===f?void 0:f.contentHint),(_=p.originTrack)&&setTimeout((function(){var e=_.getSettings(),t={width:e.width,height:e.height};p.resolution=t,m.safeEmit(Uh.onLocalVideoSizeChanged,{streamIndex:ch.STREAM_INDEX_SCREEN,info:{width:e.width,height:e.height}})}),500),v&&(this._localScreenAudioTrack=v,this._initLocalTrackEvents(v)),null===(n=this._screenPlayer)||void 0===n||n.playVideo(this._localScreenVideoTrack),this._initLocalTrackEvents(this._localScreenVideoTrack,!0),!(null!==(i=this._room)&&void 0!==i&&null!==(o=i.localScreenStream)&&void 0!==o&&o.pubAudio||null!==(a=this._room)&&void 0!==a&&null!==(s=a.localScreenStream)&&void 0!==s&&s.pubVideo)){e.next=27;break}return e.next=27,this._updateScreenPublish();case 27:case"end":return e.stop()}}),e,this)}))),function(){return re.apply(this,arguments)})},{key:"stopScreenCapture",value:(te=Ng(Mg().mark((function e(){var t,r,n,i,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("stopScreenCapture()"),null===(t=this._screenPlayer)||void 0===t||t.stop(),this._localScreenVideoTrack&&(this._localScreenVideoTrack.dummy||(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.close(),this._localImgScreenTrack&&(this._localScreenVideoTrack.setTrack(this._localImgScreenTrack,this._extensionManager),this._localScreenVideoTrack.dummy=!0))),this._localScreenAudioTrack&&(this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.close()),this._localScreenAudioTrack=void 0,!(null!==(r=this._room)&&void 0!==r&&null!==(n=r.localScreenStream)&&void 0!==n&&n.pubAudio||null!==(i=this._room)&&void 0!==i&&null!==(o=i.localScreenStream)&&void 0!==o&&o.pubVideo)){e.next=8;break}return e.next=8,this._updateScreenPublish();case 8:case"end":return e.stop()}}),e,this)}))),function(){return te.apply(this,arguments)})},{key:"setLocalVideoPlayer",value:function(e,t){if(this.logger.info("setLocalVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",e,t),UU(e,"streamIndex",[ch.STREAM_INDEX_MAIN,ch.STREAM_INDEX_SCREEN]),null!=t&&t.renderDom){var r,n,i=Zl(Zl({userId:this._getUserId()},t),{},{isLocal:!0});if(delete i.rotation,qU(i),e===ch.STREAM_INDEX_MAIN&&!this._videoPlayer)return this._videoPlayer=new Fq(this.id,i),this._initPlayerEvents(this._videoPlayer,!1,e),this._videoPlayer.mirror(!!this._mirrorType),this._localVideoTrack&&!this._localVideoTrack.dummy&&(null===(r=this._config)||void 0===r?void 0:r.autoPlayPolicy)!==Ih.PLAY_MANUALLY&&this._videoPlayer.playVideo(this._localVideoTrack),this._videoPlayer.domElement;if(e===ch.STREAM_INDEX_SCREEN&&!this._screenPlayer)return this._screenPlayer=new Fq(this.id,Zl(Zl({},i),{},{isScreen:!0,isLocal:!0})),this._initPlayerEvents(this._screenPlayer,!1,e),this._localScreenVideoTrack&&!this._localScreenVideoTrack.dummy&&(null===(n=this._config)||void 0===n?void 0:n.autoPlayPolicy)!==Ih.PLAY_MANUALLY&&this._screenPlayer.playVideo(this._localScreenVideoTrack),this._screenPlayer.domElement;if(void 0!==t.renderMode){var o=e===ch.STREAM_INDEX_MAIN?this._videoPlayer:this._screenPlayer;null==o||o.setRenderMode(t.renderMode)}}else{var a,s;e===ch.STREAM_INDEX_MAIN?(null===(a=this._videoPlayer)||void 0===a||a.destroy(!0),delete this._videoPlayer):(null===(s=this._screenPlayer)||void 0===s||s.destroy(),delete this._screenPlayer)}}},{key:"startLiveTranscoding",value:(ee=Ng(Mg().mark((function e(t){var r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("startLiveTranscoding()","transcode: %o",t),UZ.checkStartParams(t),this._liveTranscodeConfig=t,!((n=null===(r=this._room)||void 0===r?void 0:r.roomInfo)&&n.roomId.length+n.userInfo.userId.length>126)){e.next=6;break}throw new kC(mC.INVALID_PARAMS,"The roomId+userId must be within 126 bytes");case 6:if(e.prev=6,this.safeEmit(Uh.onStreamMixingEvent,{event:DX.START,error:0,message:""}),!this._room||this._room.connectionState!==cq.CONNECTED){e.next=11;break}return e.next=11,this._room.liveControlMessage(UZ.getStartParams(this._liveTranscodeConfig));case 11:e.next=20;break;case 13:if(e.prev=13,e.t0=e.catch(6),!(e.t0 instanceof kC)){e.next=19;break}throw e.t0;case 19:throw new kC(mC.UNEXPECTED_ERROR,"unexpected error",e.t0);case 20:case"end":return e.stop()}}),e,this,[[6,13]])}))),function(e){return ee.apply(this,arguments)})},{key:"updateLiveTranscoding",value:($=Ng(Mg().mark((function e(t){var r,n,i,o;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updateLiveTranscoding()","transcode: %o",t),this._liveTranscodeConfig){e.next=3;break}return e.abrupt("return");case 3:return delete(i=MK({},t)).audio,null===(r=i.video)||void 0===r||delete r.codec,null===(n=i.video)||void 0===n||delete n.gop,UZ.checckUpdateParams(i),this._liveTranscodeConfig=MK(this._liveTranscodeConfig,i),e.prev=9,this.safeEmit(Uh.onStreamMixingEvent,{event:DX.UPDATE,error:0,message:""}),e.next=13,null===(o=this._room)||void 0===o?void 0:o.liveControlMessage(UZ.getUpdateParams(this._liveTranscodeConfig));case 13:e.next=22;break;case 15:if(e.prev=15,e.t0=e.catch(9),!(e.t0 instanceof kC)){e.next=21;break}throw e.t0;case 21:throw new kC(mC.UNEXPECTED_ERROR,"unexpected error",e.t0);case 22:case"end":return e.stop()}}),e,this,[[9,15]])}))),function(e){return $.apply(this,arguments)})},{key:"stopLiveTranscoding",value:(Z=Ng(Mg().mark((function e(){var t;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("stopLiveTranscoding()"),this._liveTranscodeConfig){e.next=3;break}return e.abrupt("return");case 3:return delete this._liveTranscodeConfig,e.prev=4,this.safeEmit(Uh.onStreamMixingEvent,{event:DX.STOP,error:0,message:""}),e.next=8,null===(t=this._room)||void 0===t?void 0:t.liveControlMessage({action:"stopped",type:"transcode"});case 8:e.next=17;break;case 10:if(e.prev=10,e.t0=e.catch(4),!(e.t0 instanceof kC)){e.next=16;break}throw e.t0;case 16:throw new kC(mC.UNEXPECTED_ERROR,"unexpected error",e.t0);case 17:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(){return Z.apply(this,arguments)})},{key:"startSubtitle",value:(Q=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("startSubtitle()","config: %o",t),this._assertNotInRoom(),e.next=4,null===(r=this._room)||void 0===r?void 0:r.startSubtitle(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return Q.apply(this,arguments)})},{key:"stopSubtitle",value:function(){var e;this.logger.info("stopSubtitle()","invoke"),null===(e=this._room)||void 0===e||e.stopSubtitle()}},{key:"setBusinessId",value:function(e){return this.logger.info("setBusinessId()","businessId: %s",e),!function(e){return"string"!=typeof e}(e)&&!this._room&&(this.monitor.set({rtc_business_id:e}),this._businessId=e,!0)}},{key:"setUserVisibility",value:(J=Ng(Mg().mark((function e(t){var r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("setUserVisibility()","enable: %o",t),t=!!t,this._visibility!==t){e.next=4;break}return e.abrupt("return");case 4:if(this._room){e.next=7;break}return this._visibility=t,e.abrupt("return");case 7:return this._assertNotInRoom(),this._room.localStream&&(null===(n=this._room.localStream.observer)||void 0===n||n.setPublisher(t)),t||(this._room.unpublish(),this._room.unpublishScreen()),e.next=12,this._room.updateUserAttributes({role:t?kZ.NORMAL_USER:kZ.SILENT_USER});case 12:this._visibility=t,t&&null!==(r=this._roomConfig)&&void 0!==r&&r.isAutoPublish&&this._updatePublish({mediaType:uh.AUDIO_AND_VIDEO});case 14:case"end":return e.stop()}}),e,this)}))),function(e){return J.apply(this,arguments)})},{key:"_initPlayerEvents",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:ch.STREAM_INDEX_MAIN)===ch.STREAM_INDEX_SCREEN;e.on("playback_event",(function(i){switch(i.eventName){case"timeupdate":return;case"loadeddata":if("audio"===i.type){var o,a,s=e.userId.replace("_screen",""),c=null===(o=t._room)||void 0===o||null===(a=o.remoteStreams.get(s))||void 0===a?void 0:sI(a).call(a,(function(e){return e.isScreen===n})),u=function(){r?t.safeEmit(Uh.onFirstPublicStreamAudioFrameDecoded,{publicStreamId:s}):(t.safeEmit(Uh.onAudioFirstFrameDecoded,{userId:s,isScreen:n}),t.safeEmit(Uh.onRemoteAudioFirstFrame,{userId:s,isScreen:n})),t.monitor.report("first_remote_audio_render",{stream_id:"",stream_user_id:s||""},{isScreen:n})};c&&c.observer&&!c.observer.audioFirstFrameReceived?c.observer.once("recvAudioFirstFrame",u):u()}else{var d,l,h={userId:e.userId,height:(null===(d=e.domElement)||void 0===d?void 0:d.videoHeight)||0,width:(null===(l=e.domElement)||void 0===l?void 0:l.videoWidth)||0,isScreen:n};r?(h.publicStreamId=h.userId,delete h.userId,delete h.isScreen,t.safeEmit(Uh.onFirstPublicStreamVideoFrameRendered,h),t.safeEmit(Uh.onFirstPublicStreamVideoFrameDecoded,h)):e.isLocal||(t.safeEmit(Uh.onVideoFirstFrameRendered,h),t.safeEmit(Uh.onVideoFirstFrameDecoded,h),t.safeEmit(Uh.onRemoteVideoFirstFrame,h)),t.monitor.report("first_remote_video_render",{stream_id:"",stream_user_id:i.userId||""},{isScreen:n})}break;case"autoplay-error":return r&&(i.publicStreamId=i.userId),JD(t.id,"autoplay-error",e instanceof Fq?"video":"audio",0,i.userId||""),void t.safeEmit(Uh.onAutoplayFailed,{userId:i.userId,kind:e instanceof Fq?"video":"audio",mediaType:e instanceof Fq?uh.VIDEO:uh.AUDIO,streamIndex:e.isScreen?ch.STREAM_INDEX_SCREEN:ch.STREAM_INDEX_MAIN})}t.safeEmit(Uh.onPlayerEvent,i)}))}},{key:"_initLocalTrackEvents",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];["track-ended","track-mute","track-unmute"].forEach((function(r){e.on(r,function(){var e=Ng(Mg().mark((function e(n){var i,o,a;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.monitor.report("rtc_error",{message:Bg(i="track-".concat(r," mediaType: ")).call(i,n.originTrack.kind),error_code:FX.TRACK_ERROR,capture_session_id:n.captureSessionId,media_type:r,reason:r}),o=!1,n!==t._localScreenAudioTrack&&n!==t._localScreenVideoTrack||(o=!0),a=n.originTrack.kind,t.safeEmit({"track-ended":Uh.onTrackEnded,"track-mute":Uh.onTrackMute,"track-unmute":Uh.onTrackUnmute}[r],{kind:a,isScreen:o}),!ZL&&!qL){e.next=13;break}if("track-mute"!==r){e.next=12;break}if(xH.emit(wH.ON_IOS_LOCAL_TRACK_MUTE,a),"audio"!==a){e.next=12;break}return e.next=11,t.stopAudioCapture();case 11:t.startAudioCapture();case 12:"track-unmute"===r&&xH.emit(wH.ON_IOS_LOCAL_TRACK_UNMUTE,a);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),e.on("resolution-change",(function(e){t._extensionManager.getPluginsByType(NH.PRE_PROCESSING).forEach((function(t){var n;null==t||null===(n=t.applyConstraints)||void 0===n||n.call(t,r?ch.STREAM_INDEX_SCREEN:ch.STREAM_INDEX_MAIN,e)})),t.safeEmit(Uh.onLocalVideoSizeChanged,{streamIndex:r?ch.STREAM_INDEX_SCREEN:ch.STREAM_INDEX_MAIN,info:e})}))}},{key:"_removeLocalTrackEvents",value:function(e){e.removeAllListeners("track-ended"),e.removeAllListeners("track-mute"),e.removeAllListeners("track-unmute"),e.removeAllListeners("resolution-change")}},{key:"setRemoteVideoPlayer",value:function(e,t){this.logger.info("setRemoteVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",e,t),UU(e,"streamIndex",[ch.STREAM_INDEX_MAIN,ch.STREAM_INDEX_SCREEN]),qU(t);var r,n,i,o=t.userId;if(e===ch.STREAM_INDEX_MAIN){var a,s,c;if(null===(a=this._remoteVideoPlayer.get(o))||void 0===a||a.destroy(),!t.renderDom)return;var u=new Fq(this.id,t);this._initPlayerEvents(u,!1,e),this._remoteVideoPlayer.set(o,u);var d=null===(s=this._room)||void 0===s||null===(c=s.remoteStreams.get(o))||void 0===c?void 0:sI(c).call(c,(function(e){return!e.isScreen}));return d&&this._updateVideoPlayerState(d),u.domElement}if(null===(r=this._remoteScreenPlayer.get(o))||void 0===r||r.destroy(),t.renderDom){var l=new Fq(this.id,Zl(Zl({},t),{},{isScreen:!0}));this._remoteScreenPlayer.set(o,l),this._initPlayerEvents(l,!1,e);var h=null===(n=this._room)||void 0===n||null===(i=n.remoteStreams.get(o))||void 0===i?void 0:sI(i).call(i,(function(e){return e.isScreen}));return h&&this._updateVideoPlayerState(h),l.domElement}}},{key:"setLocalVideoMirrorType",value:function(e){this.logger.info("setLocalVideoMirrorType()","mirrorType: %o",e),UU(e,"mirrorType",[hh.MIRROR_TYPE_NONE,hh.MIRROR_TYPE_RENDER]),this._mirrorType=e,this._videoPlayer&&this._videoPlayer.mirror(!!e)}},{key:"setAudioPlaybackDevice",value:(Y=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("setAudioPlaybackDevice()","deviceId: %s",t),LU(t,"deviceId"),e.next=4,this._audioDeviceManager.setSinkId(t);case 4:r=e.sent,this._remoteAudioPlayer.forEach((function(e){e.setPlaybackDevice(t)})),this._remoteScreenAudioPlayer.forEach((function(e){e.setPlaybackDevice(t)})),this.safeEmit(Uh.onAudioPlaybackDeviceChanged,r),this.monitor.report("rtc_audio_device",{audio_event:"playout_device_switch",message:zg(r),error_code:0});case 9:case"end":return e.stop()}}),e,this)}))),function(e){return Y.apply(this,arguments)})},{key:"play",value:(q=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c,u,d,l,h,p,v,f,_,m=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=m.length>1&&void 0!==m[1]?m[1]:uh.AUDIO_AND_VIDEO,o=m.length>2?m[2]:void 0,this.logger.info("play()","userId: %s, mediaType: %s, streamIndex: %s",t,i,o),a=!t||t===this._getUserId()||"local_user"===t,s=void 0===o||o===ch.STREAM_INDEX_MAIN,c=void 0===o||o===ch.STREAM_INDEX_SCREEN,u=i!==uh.VIDEO,d=i!==uh.AUDIO,l=[],a&&d&&(s&&this._localVideoTrack&&(null===(h=this._videoPlayer)||void 0===h||h.mirror(!!this._mirrorType),l.push(null===(p=this._videoPlayer)||void 0===p?void 0:p.manuallyPlay())),c&&this._localScreenVideoTrack&&l.push(null===(v=this._screenPlayer)||void 0===v?void 0:v.manuallyPlay())),t===this._audioMixingManager.id&&l.push(this._audioMixingManager.resumeLocalPlay()),f=null===(r=this._room)||void 0===r?void 0:r.remoteStreams,d&&s&&l.push(jq(this._remoteVideoPlayer,t,!1,f)),d&&c&&l.push(jq(this._remoteScreenPlayer,t,!0,f)),u&&s&&l.push(jq(this._remoteAudioPlayer,t,!1,f)),d&&c&&l.push(jq(this._remoteScreenAudioPlayer,t,!0,f)),_=null===(n=this._publicStreamManager)||void 0===n?void 0:n.remoteStreams,u&&l.push(jq(this._publicStreamVideoPlayer,t,!1,_)),d&&l.push(jq(this._publicStreamAudioPlayer,t,!1,_)),e.abrupt("return",HI.all(l).then((function(){})));case 20:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"pauseAllSubscribedStream",value:(X=Ng(Mg().mark((function e(t){var r,n,i,o,a,s=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("pauseAllSubscribedStream()","mediaType: %o",t),this._checkMediaType(t),EL(t)&&(s._pauseAllSubscribeState.audio=!0),TL(t)&&(s._pauseAllSubscribeState.video=!0),this._room){e.next=6;break}return e.abrupt("return",HI.resolve());case 6:n=[],i=gy(uw(r=this._room.remoteStreams).call(r));try{for(i.s();!(o=i.n()).done;)a=o.value,Array.isArray(a)&&a.forEach((function(e){if(e.hasSubscribed){s._pauseAllSubscribeState.resumeStreamIds[e.streamId]=e.streamId;var r=s._unsubscribe(e.isScreen,e.userId,t,!0);r&&n.push(r)}}))}catch(J$){i.e(J$)}finally{i.f()}return e.abrupt("return",HI.all(n).then((function(){})));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return X.apply(this,arguments)})},{key:"resumeAllSubscribedStream",value:(W=Ng(Mg().mark((function e(t){var r,n,i,o,a,s=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("resumeAllSubscribedStream()","mediaType: %o",t),this._checkMediaType(t),EL(t)&&(s._pauseAllSubscribeState.audio=!1),TL(t)&&(s._pauseAllSubscribeState.video=!1),this._room){e.next=6;break}return e.abrupt("return",HI.resolve());case 6:n=[],i=gy(uw(r=this._room.remoteStreams).call(r));try{for(i.s();!(o=i.n()).done;)a=o.value,Array.isArray(a)&&a.forEach((function(e){if(s._pauseAllSubscribeState.resumeStreamIds[e.streamId]){delete s._pauseAllSubscribeState.resumeStreamIds[e.streamId];var r=s._subscribe(e.isScreen,e.userId,t);r&&n.push(r)}}))}catch(J$){i.e(J$)}finally{i.f()}return e.abrupt("return",HI.all(n).then((function(){var e;null===(e=s._room)||void 0===e||e.remoteStreams.forEach((function(e){Array.isArray(e)&&e.forEach((function(e){s._updateAudioPlayerState(e),s._updateVideoPlayerState(e)}))}))})));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return W.apply(this,arguments)})},{key:"sendUserMessage",value:(K=Ng(Mg().mark((function e(t,r){var n,i,o,a=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zU(t),YU(r),this._assertNotInRoom(),o=Date.now(),e.abrupt("return",null===(n=this._room)||void 0===n||null===(i=n.sendUserMessage(t,r))||void 0===i?void 0:i.then((function(e){return a._messageStatisticsObserver.countP2PMessage(!0,t,!1,o,e),e.id})).catch((function(e){throw a._messageStatisticsObserver.countP2PMessage(!1,t,!1,o,e),e})));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return K.apply(this,arguments)})},{key:"sendUserBinaryMessage",value:(z=Ng(Mg().mark((function e(t,r){var n,i,o,a=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zU(t),BU(r,"message"),YU(r),this._assertNotInRoom(),o=Date.now(),e.abrupt("return",null===(n=this._room)||void 0===n||null===(i=n.sendUserMessage(t,r))||void 0===i?void 0:i.then((function(e){return a._messageStatisticsObserver.countP2PMessage(!0,t,!0,o,e),e.id})).catch((function(e){throw a._messageStatisticsObserver.countP2PMessage(!1,t,!0,o,e),e})));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return z.apply(this,arguments)})},{key:"sendRoomMessage",value:(G=Ng(Mg().mark((function e(t){var r,n,i,o=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return YU(t),this._assertNotInRoom(),i=Date.now(),e.abrupt("return",null===(r=this._room)||void 0===r||null===(n=r.sendRoomMessage(t))||void 0===n?void 0:n.then((function(e){var t,r;return o._messageStatisticsObserver.countRoomMessage(!0,null===(t=o._room)||void 0===t||null===(r=t.roomInfo)||void 0===r?void 0:r.roomId,!1,i),e})).catch((function(e){var t,r;throw o._messageStatisticsObserver.countRoomMessage(!1,null===(t=o._room)||void 0===t||null===(r=t.roomInfo)||void 0===r?void 0:r.roomId,!1,i),e})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"sendRoomBinaryMessage",value:(H=Ng(Mg().mark((function e(t){var r,n,i,o=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return YU(t),this._assertNotInRoom(),i=Date.now(),e.abrupt("return",null===(r=this._room)||void 0===r||null===(n=r.sendRoomMessage(t,!0))||void 0===n?void 0:n.then((function(e){var t,r;return o._messageStatisticsObserver.countRoomMessage(!0,null===(t=o._room)||void 0===t||null===(r=t.roomInfo)||void 0===r?void 0:r.roomId,!0,i),e})).catch((function(e){var t,r;throw o._messageStatisticsObserver.countRoomMessage(!1,null===(t=o._room)||void 0===t||null===(r=t.roomInfo)||void 0===r?void 0:r.roomId,!0,i),e})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return H.apply(this,arguments)})},{key:"setAudioCaptureConfig",value:(j=Ng(Mg().mark((function e(){var t,r=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=r.length>0&&void 0!==r[0]?r[0]:{},this.logger.info("setAudioCaptureConfig()","config: %o",t),delete t.deviceId,jU(t),this._shouldUpdateAudioConf("setAudioCaptureConfig")&&this._ctx.audioProfileManager.updateConstraints(t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return j.apply(this,arguments)})},{key:"setVideoCaptureConfig",value:(B=Ng(Mg().mark((function e(){var t,r=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},this.logger.info("setVideoCaptureConfig()","config: %o",t),e.abrupt("return",this._setVideoCaptureConfig(t));case 3:case"end":return e.stop()}}),e,this)}))),function(){return B.apply(this,arguments)})},{key:"_setVideoCaptureConfig",value:(F=Ng(Mg().mark((function e(){var t,r,n,i=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(delete(r=i.length>0&&void 0!==i[0]?i[0]:{}).deviceId,jU(r),n=Zl(Zl({},r),{},{deviceId:this._videoStreamConstraints.deviceId}),!this._localVideoTrack){e.next=7;break}return e.next=7,this._localVideoTrack.updateVideoCaptureConfig(n);case 7:return this._videoStreamConstraints=n,e.abrupt("return",(null===(t=this._localVideoTrack)||void 0===t?void 0:t.originTrack.getSettings())||{});case 9:case"end":return e.stop()}}),e,this)}))),function(){return F.apply(this,arguments)})},{key:"enableSimulcastMode",value:function(e){var t;return this.logger.info("enableSimulcastMode()","enabled: %o",e),this._enableSimulcast=e,14!==cU[0]&&(null!==(t=this._room)&&void 0!==t&&t.hasPublished&&CL("You must call this API before publishing the video streams"),!0)}},{key:"setVideoEncoderConfig",value:(V=Ng(Mg().mark((function e(t){var r,n,i,o,a;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this.logger.info("setVideoEncoderConfig()"," descriptions: %o",t),Array.isArray(t)||(t=[t]),ZU(t=Iy(t).call(t,(function(e){return!!e}))),t.length>3&&(CL("setVideoEncoderConfig: You can set parameters for up to 3 streams"),t=cI(t).call(t,0,3)),n=1;n<t.length;n++)i=xL(t[0].width)/xL(t[n].width)||1,Math.floor(i)!==i&&CL("setVideoEncoderConfig: The resolution setting needs to be an integer multiple");return Ww(t).call(t,(function(e,t){return t.maxKbps-e.maxKbps})),this._localVideoTrack&&null!==(o=t[0])&&void 0!==o&&o.contentHint&&this._localVideoTrack.setContentHint(null===(a=t[0])||void 0===a?void 0:a.contentHint),e.next=10,this._setVideoCaptureConfig(Zl({},t[0]));case 10:this._videoStreamEncodeConfig=t,this._updateDummyCaptureImage(ch.STREAM_INDEX_MAIN),null!==(r=this._room)&&void 0!==r&&r.hasPublished&&this._updatePublish();case 13:case"end":return e.stop()}}),e,this)}))),function(e){return V.apply(this,arguments)})},{key:"setVideoEncoderAutoConfigList",value:function(e){if(Array.isArray(e))return Ww(e).call(e,(function(e,t){return e.maxKbps-t.maxKbps})),OU(e)}},{key:"autoResetVideoEncoderConfig",value:function(e){var t,r=xU;if(r.length){this._videoStreamEncodeConfig.length||(this._videoStreamEncodeConfig=[PU]);var n=this._videoStreamEncodeConfig[0],i=e.width||xL(n.width),o=e.height||xL(n.height),a=i*o;if(!(xL(n.width)*xL(n.height)<=a)){var s,c,u=r[0];r.forEach((function(e){var t=xL(e.width)*xL(e.height);s||(a<t?s=e:u=e)})),c=s&&xL(s.width)*xL(s.height)-a<a-xL(u.width)*xL(u.height)?IT({},s):IT({},u),this._videoStreamEncodeConfig=Iy(t=this._videoStreamEncodeConfig).call(t,(function(e){return!(c&&xL(e.width)*xL(e.height)>=a)||(c.maxKbps=Math.min(e.maxKbps,c.maxKbps),!1)})),this._videoStreamEncodeConfig.unshift({width:i,height:o,frameRate:e.frameRate?Math.round(e.frameRate):this._videoStreamEncodeConfig[0].frameRate,maxKbps:c.maxKbps}),this.logger.print("autoResetVideoEncoderConfig() result",zg(this._videoStreamEncodeConfig)),JD(this.id,"autoResetVideoEncoderConfig",zg(this._videoStreamEncodeConfig))}}}},{key:"setScreenEncoderConfig",value:(U=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("setScreenEncoderConfig()","description: %o",t),this._screenStreamEncodeConfig=[t],!this._localScreenVideoTrack){e.next=7;break}if("16.1"===sU){e.next=6;break}return e.next=6,this._localScreenVideoTrack.updateVideoCaptureConfig(t);case 6:t.contentHint&&this._localScreenVideoTrack.setContentHint(t.contentHint);case 7:this._updateDummyCaptureImage(ch.STREAM_INDEX_SCREEN),null!==(r=this._room)&&void 0!==r&&r.hasScreenPublished&&this._updateScreenPublish();case 9:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{key:"sendSEIMessage",value:function(e,t,r){if(this.logger.info("sendSEIMessage()","streamIdex: %o, message: %o, repeatCount: %o",e,t,r),!Ej())throw new kC(mC.NOT_SUPPORTED,"Browser does not support sending SEI");UU(e,"streamIndex",[ch.STREAM_INDEX_MAIN,ch.STREAM_INDEX_SCREEN]),NU(r,"repeatCount",0,30);var n="string"==typeof t?new Uint8Array(cL.str2ab(t)):t;if(t.length){var i;if(e===ch.STREAM_INDEX_MAIN){var o,a;if(null===(o=this._room)||void 0===o||null===(a=o.localStream)||void 0===a||!a.hasPublished)return;i=this._room.localStream}else{var s,c;if(null===(s=this._room)||void 0===s||null===(c=s.localScreenStream)||void 0===c||!c.hasPublished)return;i=this._room.localScreenStream}if(n.byteLength>4096)this.logger.warn("sei size must not bigger than 4KB");else{var u=iL();i.seiList.push({content:n,uuid:u,repeatCount:r}),setTimeout((function(){var e;if(i){var t,r=tC(e=i.seiList).call(e,(function(e){return e.uuid===u}));if(r>=0)jI(t=i.seiList).call(t,r,1)}}),2e3)}}else this.logger.warn("sei message must not be empty")}},{key:"setAudioVolumeIndicationInterval",value:function(e){var t=this;this.logger.info("setAudioVolumeIndicationInterval()","interval %o: ",e),("number"!=typeof e||e<200)&&(e=200);var r=[];this._audioVolumeIndicationTimer&&clearInterval(this._audioVolumeIndicationTimer),this._audioVolumeIndicationTimer=setInterval((function(){var e,n;r=[],null===(e=t._room)||void 0===e||e.remoteStreams.forEach((function(e,t){var n;if(0!==e.length){var i=sI(e).call(e,(function(e){return!e.isScreen})),o=null==i||null===(n=i.audioTrack)||void 0===n?void 0:n.getAudioLevel();r.push({userId:t,volume:o||0})}}));var i=null===(n=t._localAudioTrack)||void 0===n?void 0:n.getAudioLevel();r.push({userId:t._getUserId(),volume:i||0}),t.safeEmit(Uh.onAudioVolumeIndication,{speakers:r})}),e)}},{key:"_sendActiveSpeaker",value:function(e,t){if(this._room&&this._room.remoteUsers.size>=1){var r,n=e[0],i=aS(t).call(t,(function(e,t){return e&&e.audioPropertiesInfo.nonlinearVolume>t.audioPropertiesInfo.nonlinearVolume?e:t}),void 0);if((r=n?i?n.audioPropertiesInfo.nonlinearVolume>i.audioPropertiesInfo.nonlinearVolume?n:i:n:i)&&r.audioPropertiesInfo.nonlinearVolume>-35){var o,a;if(r.streamKey)o=this._room.remoteUsers.get(r.streamKey.userId);else o=null===(a=this._room._roomInfo)||void 0===a?void 0:a.userInfo;o&&this.safeEmit(Uh.onActiveSpeaker,{userId:o.userId,extraInfo:o.extraInfo})}}}},{key:"enableAudioPropertiesReport",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger.info("enableAudioPropertiesReport()","config %o: ",t);var r=t.enableInBackground,n=void 0===r||r,i=t.localMainReportMode,o=void 0===i?ph.NORMAL:i,a=t.audioReportMode,s=void 0===a?vh.MICROPHONE:a,c=t.interval,u=void 0===c?100:c;this._stopAudioPropertiesReport(),u<=0||(u=Math.max(100,u),this._audioPropertiesReportTimer=self.setInterval((function(){if(n||"hidden"!==document.visibilityState){var t=[],r=e._audioDeviceManager.getRecordTrack()||e._localAudioTrack;if(r){var i,a,c=null===(i=e._room)||void 0===i||null===(a=i.localStream)||void 0===a?void 0:a.audioHasPublish,u=!!e._audioDeviceManager.getRecordTrack(),d=r.getAudioLevel(s),l=kL(d),h={streamIndex:ch.STREAM_INDEX_MAIN,audioPropertiesInfo:{linearVolume:d,nonlinearVolume:l}};if(c||u)t.push(h);else switch(o){case ph.DISCONNECT:break;case ph.RESET:h.audioPropertiesInfo.linearVolume=0,h.audioPropertiesInfo.nonlinearVolume=-127,t.push(h);break;case ph.NORMAL:t.push(h);break;default:throw new kC(mC.INVALID_PARAMS,"invalid localMainReportMode: ".concat(o," in config"))}}if(e._localScreenAudioTrack){var p=e._localScreenAudioTrack.getAudioLevel();t.push({streamIndex:ch.STREAM_INDEX_SCREEN,audioPropertiesInfo:{linearVolume:p,nonlinearVolume:kL(p)}})}if(e.safeEmit(Uh.onLocalAudioPropertiesReport,t),e._room){var v=[];if(e._room.multiChatMode)e._room.getActiveSpeakerInMultiChatMode().forEach((function(t){var r,n,i,o=255*t.audioLevel;v.push({streamKey:{userId:t.userId,streamIndex:ch.STREAM_INDEX_MAIN,roomId:null!==(r=null===(n=e._room)||void 0===n||null===(i=n._roomInfo)||void 0===i?void 0:i.roomId)&&void 0!==r?r:""},audioPropertiesInfo:{linearVolume:o,nonlinearVolume:kL(o)}})}));else e._room.remoteStreams.forEach((function(t,r){t.forEach((function(t){if(t.audioTrack){var n,i,o,a=t.audioTrack.getAudioLevel();v.push({streamKey:{userId:r,streamIndex:t.isScreen?ch.STREAM_INDEX_SCREEN:ch.STREAM_INDEX_MAIN,roomId:null!==(n=null===(i=e._room)||void 0===i||null===(o=i.roomInfo)||void 0===o?void 0:o.roomId)&&void 0!==n?n:""},audioPropertiesInfo:{linearVolume:a,nonlinearVolume:kL(a)}})}}))}));e.safeEmit(Uh.onRemoteAudioPropertiesReport,v),e._sendActiveSpeaker(t,Iy(v).call(v,(function(e){return e.streamKey.streamIndex!==ch.STREAM_INDEX_SCREEN})))}}}),u))}},{key:"setVideoSourceType",value:(L=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T,I,R,A;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("setVideoSourceType()","index: %o, videoSourceType: %o",t,r),UU(t,"streamIndex",[ch.STREAM_INDEX_MAIN,ch.STREAM_INDEX_SCREEN]),UU(r,"VideoSourceType",[$l.VIDEO_SOURCE_TYPE_EXTERNAL,$l.VIDEO_SOURCE_TYPE_INTERNAL]),n=t===ch.STREAM_INDEX_MAIN?"video":"screenVideo",this._trackSourceType[n]===r){e.next=26;break}if(this._trackSourceType[n]=r,this.logger.print("setVideoSourceType",Bg(i="set ".concat(n," source type to ")).call(i,r)),!this._localVideoTrack||t!==ch.STREAM_INDEX_MAIN){e.next=17;break}if(u=!1,r===$l.VIDEO_SOURCE_TYPE_EXTERNAL&&(u=!0,(d=this._extensionManager.getPluginByName(NH.PRE_PROCESSING,"RTCBeautyExtension"))&&d.emit("stop"),this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close()),null===(o=this._videoPlayer)||void 0===o||o.stop(),this._localVideoTrack=void 0,l=null===(a=this._room)||void 0===a?void 0:a._roomConfig.isAutoPublish,u?null===(h=this._room)||void 0===h||null===(p=h.localStream)||void 0===p||null===(v=p.observer)||void 0===v||v.setEnableVideo(!1):null===(f=this._room)||void 0===f||null===(_=f.localStream)||void 0===_||null===(m=_.observer)||void 0===m||m.setPushVideo(!1),!(null!==(s=this._room)&&void 0!==s&&null!==(c=s.localStream)&&void 0!==c&&c.pubVideo||l)){e.next=17;break}return e.next=17,this._updatePublish();case 17:if(!this._localScreenVideoTrack||t!==ch.STREAM_INDEX_SCREEN){e.next=26;break}if(b=!1,r===$l.VIDEO_SOURCE_TYPE_EXTERNAL&&(b=!0,this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.close()),null===(g=this._screenPlayer)||void 0===g||g.stop(),this._localScreenVideoTrack=void 0,b?null===(k=this._room)||void 0===k||null===(E=k.localScreenStream)||void 0===E||null===(T=E.observer)||void 0===T||T.setEnableVideo(!1):null===(I=this._room)||void 0===I||null===(R=I.localScreenStream)||void 0===R||null===(A=R.observer)||void 0===A||A.setPushVideo(!1),null===(y=this._room)||void 0===y||null===(S=y.localScreenStream)||void 0===S||!S.pubVideo){e.next=26;break}return e.next=26,this._updateScreenPublish();case 26:case"end":return e.stop()}}),e,this)}))),function(e,t){return L.apply(this,arguments)})},{key:"setExternalVideoTrack",value:(N=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,v,f;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("setExternalVideoTrack()","index: %o, track: %o",t,r),UU(t,"streamIndex",[ch.STREAM_INDEX_MAIN,ch.STREAM_INDEX_SCREEN]),VU(r),t!==ch.STREAM_INDEX_MAIN){e.next=16;break}if(this._trackSourceType.video===$l.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=6;break}throw new kC(mC.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as external first");case 6:return e.next=8,vG(r,this._extensionManager);case 8:if(this._localVideoTrack=e.sent,!r.contentHint&&null!==(n=this._videoStreamEncodeConfig[0])&&void 0!==n&&n.contentHint&&this._localVideoTrack.setContentHint(null===(c=this._videoStreamEncodeConfig[0])||void 0===c?void 0:c.contentHint),this._initLocalTrackEvents(this._localVideoTrack),null===(i=this._videoPlayer)||void 0===i||i.playVideo(this._localVideoTrack),u=null===(o=this._room)||void 0===o?void 0:o._roomConfig.isAutoPublish,!(null!==(a=this._room)&&void 0!==a&&null!==(s=a.localStream)&&void 0!==s&&s.pubVideo||u)){e.next=16;break}return e.next=16,this._updatePublish();case 16:if(t!==ch.STREAM_INDEX_SCREEN){e.next=28;break}if(this._trackSourceType.screenVideo===$l.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=19;break}throw new kC(mC.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as external first");case 19:return e.next=21,gG(r,this._extensionManager);case 21:if(this._localScreenVideoTrack=e.sent,this._initLocalTrackEvents(this._localScreenVideoTrack,!0),null===(d=this._screenPlayer)||void 0===d||d.playVideo(this._localScreenVideoTrack),null===(l=this._room)||void 0===l||null===(h=l.localScreenStream)||void 0===h||null===(p=h.observer)||void 0===p||p.setPushVideo(!0),null===(v=this._room)||void 0===v||null===(f=v.localScreenStream)||void 0===f||!f.pubVideo){e.next=28;break}return e.next=28,this._updateScreenPublish();case 28:case"end":return e.stop()}}),e,this)}))),function(e,t){return N.apply(this,arguments)})},{key:"setAudioSourceType",value:(D=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,v,f,_,m,g,y,S,b,k,E,T;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("setAudioSourceType()","index: %o, audioSourceType: %o",t,r),UU(t,"streamIndex",[ch.STREAM_INDEX_MAIN,ch.STREAM_INDEX_SCREEN]),UU(r,"audioSourceType",[eh.AUDIO_SOURCE_TYPE_EXTERNAL,eh.AUDIO_SOURCE_TYPE_INTERNAL]),n=t===ch.STREAM_INDEX_MAIN?"audio":"screenAudio",this._trackSourceType[n]===r){e.next=24;break}if(this._trackSourceType[n]=r,this.logger.print("setVideoSourceType",Bg(i="set ".concat(n," source type to ")).call(i,r)),!this._localAudioTrack||t!==ch.STREAM_INDEX_MAIN){e.next=16;break}if(c=!1,this._trackSourceType.audio===eh.AUDIO_SOURCE_TYPE_EXTERNAL&&(c=!0,this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.close()),this._localAudioTrack=void 0,u=null===(o=this._room)||void 0===o?void 0:o._roomConfig.isAutoPublish,c?null===(d=this._room)||void 0===d||null===(l=d.localStream)||void 0===l||null===(h=l.observer)||void 0===h||h.setEnableAudio(!1):null===(p=this._room)||void 0===p||null===(v=p.localStream)||void 0===v||null===(f=v.observer)||void 0===f||f.setPushAudio(!1),!(null!==(a=this._room)&&void 0!==a&&null!==(s=a.localStream)&&void 0!==s&&s.pubAudio||u)){e.next=16;break}return e.next=16,this._updatePublish();case 16:if(!this._localScreenAudioTrack||t!==ch.STREAM_INDEX_SCREEN){e.next=24;break}if(g=!1,this._trackSourceType.audio===eh.AUDIO_SOURCE_TYPE_EXTERNAL&&(g=!0,this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.close()),this._localScreenAudioTrack=void 0,g?null===(y=this._room)||void 0===y||null===(S=y.localScreenStream)||void 0===S||null===(b=S.observer)||void 0===b||b.setEnableAudio(!1):null===(k=this._room)||void 0===k||null===(E=k.localScreenStream)||void 0===E||null===(T=E.observer)||void 0===T||T.setPushAudio(!1),null===(_=this._room)||void 0===_||null===(m=_.localScreenStream)||void 0===m||!m.pubAudio){e.next=24;break}return e.next=24,this._updateScreenPublish();case 24:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"setExternalAudioTrack",value:(M=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,v;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("setExternalAudioTrack()","index: %o, track: %o",t,r),UU(t,"streamIndex",[ch.STREAM_INDEX_MAIN,ch.STREAM_INDEX_SCREEN]),VU(r),t!==ch.STREAM_INDEX_MAIN){e.next=16;break}if(this._trackSourceType.audio===eh.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=6;break}throw new kC(mC.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as external first");case 6:return e.next=8,_G(r,this._extensionManager);case 8:if(this._localAudioTrack=e.sent,this._localAudioTrack.setVolume(this._localAudioVolume),this._initLocalTrackEvents(this._localAudioTrack),u=null===(n=this._room)||void 0===n?void 0:n._roomConfig.isAutoPublish,null===(i=this._room)||void 0===i||null===(o=i.localStream)||void 0===o||null===(a=o.observer)||void 0===a||a.setPushAudio(!0),!(null!==(s=this._room)&&void 0!==s&&null!==(c=s.localStream)&&void 0!==c&&c.pubAudio||u)){e.next=16;break}return e.next=16,this._updatePublish();case 16:if(t!==ch.STREAM_INDEX_SCREEN){e.next=28;break}if(this._trackSourceType.screenAudio===eh.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=19;break}throw new kC(mC.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as external first");case 19:return e.next=21,SG(r,this._extensionManager);case 21:if(this._localScreenAudioTrack=e.sent,this._localScreenAudioTrack.setVolume(this._localScreenAudioVolume),this._initLocalTrackEvents(this._localScreenAudioTrack),null===(d=this._room)||void 0===d||null===(l=d.localScreenStream)||void 0===l||null===(h=l.observer)||void 0===h||h.setPushAudio(!0),null===(p=this._room)||void 0===p||null===(v=p.localScreenStream)||void 0===v||!v.pubAudio){e.next=28;break}return e.next=28,this._updateScreenPublish();case 28:case"end":return e.stop()}}),e,this)}))),function(e,t){return M.apply(this,arguments)})},{key:"login",value:(P=Ng(Mg().mark((function e(t,r){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("login()","token: %o, userInfo: %o",t,r),HU(t)||LU(t,"token"),zU(r),e.abrupt("return",this._rtmClient.login(t,r));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return P.apply(this,arguments)})},{key:"logout",value:(O=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("logout()"),e.abrupt("return",this._rtmClient.logout());case 2:case"end":return e.stop()}}),e,this)}))),function(){return O.apply(this,arguments)})},{key:"updateLoginToken",value:(x=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("updateLoginToken()","token: %o",t),HU(t)||LU(t,"token"),e.abrupt("return",this._rtmClient.updateLoginToken(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"getPeerOnlineStatus",value:(C=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("getPeerOnlineStatus()","userId: %o",t),zU(t),e.abrupt("return",this._rtmClient.getPeerOnlineStatus(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"sendUserMessageOutsideRoom",value:(w=Ng(Mg().mark((function e(t,r){var n,i=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zU(t),YU(r),n=Date.now(),e.abrupt("return",this._rtmClient.sendUserMessageOutsideRoom(t,r).then((function(e){return i._messageStatisticsObserver.countUserMessageOutsideRoom(!0,t,!1,n,e),e.id})).catch((function(e){throw i._messageStatisticsObserver.countUserMessageOutsideRoom(!1,t,!1,n,e),e})));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return w.apply(this,arguments)})},{key:"sendUserBinaryMessageOutsideRoom",value:(A=Ng(Mg().mark((function e(t,r){var n,i=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return zU(t),BU(r,"message"),YU(r),n=Date.now(),e.abrupt("return",this._rtmClient.sendUserMessageOutsideRoom(t,r).then((function(e){return i._messageStatisticsObserver.countUserMessageOutsideRoom(!0,t,!0,n,e),e.id})).catch((function(e){throw i._messageStatisticsObserver.countUserMessageOutsideRoom(!1,t,!0,n,e),e})));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return A.apply(this,arguments)})},{key:"setServerParams",value:(R=Ng(Mg().mark((function e(t,r){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("setServerParams()","signature: %o, url: %0",t,r),e.abrupt("return",this._rtmClient.setServerParams(t,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return R.apply(this,arguments)})},{key:"sendServerMessage",value:(I=Ng(Mg().mark((function e(t){var r,n=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return LU(t,"message"),YU(t),r=Date.now(),e.abrupt("return",this._rtmClient.sendServerMessage(t).then((function(e){n._messageStatisticsObserver.countServerMessage(!0,!1,r,e)})).catch((function(e){throw n._messageStatisticsObserver.countServerMessage(!1,!1,r,e),e})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"sendServerBinaryMessage",value:(T=Ng(Mg().mark((function e(t){var r,n=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return BU(t,"message"),YU(t),r=Date.now(),e.abrupt("return",this._rtmClient.sendServerMessage(t).then((function(e){n._messageStatisticsObserver.countServerMessage(!0,!0,r,e)})).catch((function(e){throw n._messageStatisticsObserver.countServerMessage(!1,!0,r,e),e})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"startCloudProxy",value:function(e){if(this._room)throw new kC(mC.START_CLOUD_PROXY_AFTER_JOIN,"[startCloudProxy] should be invoke before join room ");this.logger.info("startCloudProxy()",e),LU(e.logProxy,"logProxy"),LU(e.accessProxy,"accessProxy"),LU(e.configProxy,"configProxy"),this._originIceConfigRequestUrls=wU("ICE_CONFIG_REQUEST_URLS"),this._originLogServerUrl=wU("LOG_SERVER_URL"),this._originConfigServerUrls=wU("CONFIG_REQUEST_DOMAINS"),AU("ICE_CONFIG_REQUEST_URLS",e.accessProxy),AU("LOG_SERVER_URL",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/^https?:\/\/.+/.test(e)||(e="https://".concat(e)),"".concat(e,"/video/v1/webrtc_log/")}(e.logProxy)),AU("CONFIG_REQUEST_DOMAINS",[e.configProxy]),yU.clearAccessNode(this._appId),yU.clearAccessUrls(),this._ctx.useCloudProxy=!0}},{key:"stopCloudProxy",value:function(){var e,t,r;if(this._room)throw new kC(mC.STOP_CLOUD_PROXY_BEFORE_LEAVE,"[stopCloudProxy] should be invoke after leave room ");this.logger.info("stopCloudProxy()");var n=null===(e=this._originIceConfigRequestUrls)||void 0===e?void 0:Jg(e).call(e,(function(e){return e.replace("https://","").replace("/dispatch/v1/AccessInfo?Action=GetAccessInfo","")}));AU("ICE_CONFIG_REQUEST_URLS",null!=n?n:[]),AU("LOG_SERVER_URL",null!==(t=this._originLogServerUrl)&&void 0!==t?t:""),AU("CONFIG_REQUEST_DOMAINS",null!==(r=this._originConfigServerUrls)&&void 0!==r?r:[]),yU.clearAccessNode(this._appId),yU.clearAccessUrls(),this._ctx.useCloudProxy=!1,this._startCloudProxyTimestamp=void 0}},{key:"startPushPublicStream",value:(E=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c,u,d,l=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("startPushPublicStream()","publicStreamId: %o, publicStreamParam: %o",t,r),KU(t),this._assertNotInRoom(),!this._publicStreamIds.get(t)){e.next=5;break}throw new kC(mC.REPEAT_PUSH,"repeat push public media stream");case 5:return(s=null===(n=this._room)||void 0===n||null===(i=n._roomInfo)||void 0===i?void 0:i.roomId)&&(null===(c=r.layout)||void 0===c||null===(u=c.regions)||void 0===u||Jg(u).call(u,(function(e){e.roomId=s}))),d=CU(t,"started",r),e.abrupt("return",null===(o=this._room)||void 0===o||null===(a=o.publicStreamControlMessage(d))||void 0===a?void 0:a.then((function(){l._publicStreamIds.set(t,t)})));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return E.apply(this,arguments)})},{key:"updatePublicStreamParam",value:(k=Ng(Mg().mark((function e(t,r){var n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.print("startPushPublicStream()","publicStreamId: %o, publicStreamParam: %o",t,r),KU(t),this._assertNotInRoom(),i=CU(t,"layoutChanged",r),e.abrupt("return",null===(n=this._room)||void 0===n?void 0:n.publicStreamControlMessage(i));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return k.apply(this,arguments)})},{key:"stopPushPublicStream",value:(b=Ng(Mg().mark((function e(t){var r,n=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.print("startPushPublicStream()","publicStreamId: %o",t),KU(t),this._assertNotInRoom(),e.abrupt("return",null===(r=this._room)||void 0===r?void 0:r.publicStreamControlMessage({type:"publicstream",action:"stopped",publicStreamID:t}).then((function(){n._publicStreamIds.delete(t)})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"startPlayPublicStream",value:(S=Ng(Mg().mark((function e(t){var r,n,i,o,a=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(KU(t),this._publicStreamManager){e.next=8;break}return this._publicStreamManager=new IZ(this.id,this._appId,{businessId:this._businessId}),this._publicStreamManager.on(MX.RESUBSCRIBE,(function(e){var t=e.stream;if(t){var r,n=a._publicStreamAudioPlayer.get(t.streamId);n&&t.audioTrack&&(n.stop(),n.playAudio(null===(r=e.stream)||void 0===r?void 0:r.audioTrack));var i,o=a._publicStreamVideoPlayer.get(t.streamId);o&&t.videoTrack&&o.playVideo(null===(i=e.stream)||void 0===i?void 0:i.videoTrack)}})),this._publicStreamManager.on("onRemoteStreamStats",(function(e){e.publicStreamId=e.userId,delete e.userId,delete e.isScreen,a.safeEmit(Uh.onPublicStreamStats,e)})),this._publicStreamManager.on(MX.ON_SEI_MESSAGED_RECEIVED,(function(e){a.safeEmit(Uh.onPublicStreamSEIMessageReceived,e)})),e.next=8,this._publicStreamManager.connect();case 8:return e.next=10,this._publicStreamManager.startPlayPublicStream(t);case 10:r=e.sent,(n=this._publicStreamVideoPlayer.get(t))&&r.videoTrack&&n.playVideo(r.videoTrack,r),!(i=this._publicStreamAudioPlayer.get(t))&&r.audioTrack&&(i=new Bq(this.id,t,{muted:(null===(o=this._config)||void 0===o?void 0:o.autoPlayPolicy)===Ih.VIDEO_ONLY,isScreen:!1}),r.audioTrack.setPlayer(i),this._initPlayerEvents(i,!0),i.playAudio(r.audioTrack),this._publicStreamAudioPlayer.set(t,i));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"stopPlayPublicStream",value:(y=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._publicStreamManager){e.next=2;break}return e.abrupt("return");case 2:this._publicStreamManager.stopPlayPublicStream(t),(r=this._publicStreamAudioPlayer.get(t))&&(r.destroy(),this._publicStreamAudioPlayer.delete(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"setAudioProfile",value:(g=Ng(Mg().mark((function e(t){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.info("setAudioProfile()","profile: %o",t),this._shouldUpdateAudioConf("setAudioProfile")&&this._ctx.audioProfileManager.setAudioProfile(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"setAudioEncodeMaxBitrate",value:(m=Ng(Mg().mark((function e(t){var r,n,i,o,a,s;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("setAudioEncodeMaxBitrate()",t),NU(t,"maxBitrate",6,256),this._ctx.audioProfileManager.setCustomMaxBitrate(t),!this._ctx.audioProfileManager.customMaxBitrate){e.next=10;break}if(!FL||!(null!==(r=this._room)&&void 0!==r&&null!==(n=r.localStream)&&void 0!==n&&n.pubAudio||null!==(i=this._room)&&void 0!==i&&null!==(o=i.localScreenStream)&&void 0!==o&&o.pubAudio)){e.next=6;break}throw new kC(mC.NOT_SUPPORTED,"Your browser does not support set audio encode maxBitrate dynamically.");case 6:return e.next=8,null===(a=this._room)||void 0===a?void 0:a.setAudioEncodeMaxBitrate(ch.STREAM_INDEX_MAIN,t);case 8:return e.next=10,null===(s=this._room)||void 0===s?void 0:s.setAudioEncodeMaxBitrate(ch.STREAM_INDEX_SCREEN,t);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"setPublicStreamVideoPlayer",value:function(e,t){var r,n,i;this.logger.print("setPublicStreamVideoPlayer()","publicStreamId: %o, videoPlayerOption: %o",e,t);var o=this._publicStreamVideoPlayer.get(e);if(null===(r=o)||void 0===r||r.destroy(),t.renderDom){o=new Fq(this.id,Zl(Zl({},t),{},{userId:e})),this._initPlayerEvents(o,!0),this._publicStreamVideoPlayer.set(e,o);var a=null===(n=this._publicStreamManager)||void 0===n?void 0:n.remoteStreams.get(e);null!=a&&a.videoTrack&&(null===(i=this._config)||void 0===i?void 0:i.autoPlayPolicy)!==Ih.PLAY_MANUALLY&&o.playVideo(a.videoTrack,a)}else this._publicStreamVideoPlayer.delete(e)}},{key:"setDummyCaptureImagePath",value:(_=Ng(Mg().mark((function e(t,r){var n=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new HI((function(e,i){LU(r,"filePath");var o=new Image;o.crossOrigin="anonymous",o.src=r,o.onload=function(){t===ch.STREAM_INDEX_MAIN?n._dummyMainImage=o:n._dummyScreenImage=o;try{n._updateDummyCaptureImage(t),e()}catch(r){i(new kC(mC.UNEXPECTED_ERROR,r.message))}},o.onerror=function(){i(new kC(mC.UNEXPECTED_ERROR,"Load image error"))}})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return _.apply(this,arguments)})},{key:"_updateDummyCaptureImage",value:function(e){var t,r;if(e===ch.STREAM_INDEX_MAIN?(t=this._dummyMainImage,r=this._videoStreamEncodeConfig[0]):(t=this._dummyScreenImage,r=this._screenStreamEncodeConfig[0]),t){var n,i,o=document.createElement("canvas"),a=o.getContext("2d"),s=xL(r.width),c=xL(r.height);if(!a)throw new kC(mC.UNEXPECTED_ERROR,"Not support canvas");!s||!c||t.width<=s&&t.height<=c?(n=t.width,i=t.height):(n=Math.min(s,t.width*c/t.height),i=Math.min(c,t.height*s/t.width)),o.width=n,o.height=i,a.drawImage(t,0,0,t.width,t.height,0,0,n,i);var u=window.setInterval((function(){t&&a.drawImage(t,0,0,t.width,t.height,0,0,n,i)}),200);e===ch.STREAM_INDEX_MAIN?(clearInterval(this._dummyMainTimer),this._dummyMainTimer=u):(clearInterval(this._dummyScreenTimer),this._dummyScreenTimer=u);var d,l,h=o.captureStream(5).getVideoTracks()[0];if(e===ch.STREAM_INDEX_MAIN)this._localImgVideoTrack=h,null!==(d=this._localVideoTrack)&&void 0!==d&&d.dummy&&this._localVideoTrack.setTrack(this._localImgVideoTrack,this._extensionManager);else this._localImgScreenTrack=h,null!==(l=this._localScreenVideoTrack)&&void 0!==l&&l.dummy&&this._localScreenVideoTrack.setTrack(this._localImgScreenTrack,this._extensionManager)}}},{key:"_addListenExtensionEvent",value:function(e){var t=this;e.on("re-capture-audio",(function(){t._localAudioTrack&&t.stopAudioCapture().then((function(){t.startAudioCapture()}))})),e.on("re-capture-video",(function(){t._localVideoTrack&&!t._localVideoTrack.dummy&&t.stopVideoCapture().then((function(){t.startVideoCapture()}))})),e.on("reset-video-effect",function(){var e=Ng(Mg().mark((function e(r,n){var i,o,a;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t._localVideoTrack||t._localVideoTrack.dummy){e.next=17;break}return t._localVideoTrack&&t._removeLocalTrackEvents(t._localVideoTrack),e.prev=2,e.next=5,t._localVideoTrack.generatePreProcessingTrack(t._extensionManager);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),n(e.t0);case 10:if(t._initLocalTrackEvents(t._localVideoTrack),null!==(i=t._videoPlayer)&&void 0!==i&&i.played&&(t._videoPlayer.stop(),t._videoPlayer.playVideo(t._localVideoTrack),t._videoPlayer.mirror(!!t._mirrorType)),t.safeEmit(Uh.onLocalStreamTrackChangedByExtension,{streamIndex:ch.STREAM_INDEX_MAIN,type:"video"}),r(),null===(o=t._room)||void 0===o||null===(a=o.localStream)||void 0===a||!a.pubVideo){e.next=17;break}return e.next=17,t._updatePublish();case 17:r();case 18:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t,r){return e.apply(this,arguments)}}())}},{key:"registerExtension",value:(f=Ng(Mg().mark((function e(t){var r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.monitor=this.monitor,e.prev=1,e.next=4,t.isSupported();case 4:if(e.sent){e.next=7;break}throw new Error("This extension is not supported.");case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(1),new Error("This extension is not supported.");case 12:return e.next=14,t.init({videoCaptureConfig:this._videoStreamConstraints});case 14:this._extensionManager.register(t),this._addListenExtensionEvent(t),null===(r=this._localAudioTrack)||void 0===r||r.generatePreProcessingTrack(this._extensionManager),null===(n=this._localVideoTrack)||void 0===n||n.generatePreProcessingTrack(this._extensionManager);case 18:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return f.apply(this,arguments)})},{key:"defaultTranscoding",value:function(){return JSON.parse(zg(UZ.getDefaultValue()))}},{key:"_updatePublish",value:(v=Ng(Mg().mark((function e(){var t,r,n,i=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},this.logger.info("_updatePublish()","config: %o",t),r={mediaType:void 0,invokeByJoinRoom:!1,pubState:NX.PUB},t=Zl(Zl({},r),t),this._visibility){e.next=6;break}throw new kC(mC.NO_PUBLISH_PERMISSION,"no publish permission");case 6:return e.next=8,this._pubLock.lock();case 8:if(n=e.sent,this._room&&this._room.connectionState===cq.CONNECTED){e.next=12;break}return n(),e.abrupt("return");case 12:return e.prev=12,e.next=15,this._room.publish(this._videoStreamEncodeConfig,this._enableSimulcast,this._localVideoTrack,this._localAudioTrack,t.mediaType,t.pubState,t.invokeByJoinRoom);case 15:e.next=24;break;case 17:if(e.prev=17,e.t0=e.catch(12),!(e.t0 instanceof kC)){e.next=23;break}throw e.t0;case 23:throw new kC(mC.UNEXPECTED_ERROR,"unexpected error",e.t0);case 24:return e.prev=24,n(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[12,17,24,27]])}))),function(){return v.apply(this,arguments)})},{key:"startAudioPlaybackDeviceTest",value:(p=Ng(Mg().mark((function e(t,r){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.print("startAudioPlaybackDeviceTest()","filePath: %o, indicationInterval: %o",t,r),LU(t,"filePath"),NU(r,"indicationInterval"),e.next=5,this._audioDeviceManager.startAudioPlaybackDeviceTest(t,r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"stopAudioPlaybackDeviceTest",value:function(){this.logger.info("stopAudioPlaybackDeviceTest()"),this._audioDeviceManager.stopAudioPlaybackDeviceTest()}},{key:"startAudioDeviceRecordTest",value:(h=Ng(Mg().mark((function e(t,r){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.print("startAudioDeviceRecordTest()","indicationInterval: %o",t),NU(t,"indicationInterval"),e.next=4,this._audioDeviceManager.startAudioDeviceRecordTest(t,r,this._localAudioVolume);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"stopAudioDeviceRecordAndPlayTest",value:function(){this.logger.info("stopAudioDeviceRecordAndPlayTest()"),this._audioDeviceManager.stopAudioDeviceRecordAndPlayTest()}},{key:"stopAudioDevicePlayTest",value:function(){this.logger.info("stopAudioDevicePlayTest()"),this._audioDeviceManager.stopAudioDevicePlayTest()}},{key:"setRemoteUserPriority",value:function(e,t){var r;this.logger.print("setRemoteUserPriority()","userId: %o, priority: %o",e,t);try{zU(e),UU(t,"priority",[Sh.HIGH,Sh.MEDIUM,Sh.LOW])}catch(n){return console.warn(n),!1}return this._ctx.userPriority.set(e,t),null===(r=this._room)||void 0===r||r.updateRemoteUserPriority(e),!0}},{key:"takeLocalSnapshot",value:(l=Ng(Mg().mark((function e(t){var r,n;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("takeLocalSnapshot()","streamIndex: %o",t),UU(t,"streamIndex",[ch.STREAM_INDEX_MAIN,ch.STREAM_INDEX_SCREEN]),r=t===ch.STREAM_INDEX_MAIN?this.localVideoTrack:this.localScreenVideoTrack){e.next=5;break}throw new kC(mC.INVOKED_BEFORE_CAPTURE,"capture first");case 5:return n=t===ch.STREAM_INDEX_MAIN?this._videoPlayer:this._screenPlayer,e.abrupt("return",xZ(r.preprocessingTrack,(null==n?void 0:n.mirrorType)===hh.MIRROR_TYPE_RENDER,n));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"takeRemoteSnapshot",value:(d=Ng(Mg().mark((function e(t,r){var n,i,o,a,s,c;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("takeRemoteSnapshot()","id: %o, streamIndex: %o",t,r),LU(t,"id"),UU(r,"streamIndex",[ch.STREAM_INDEX_MAIN,ch.STREAM_INDEX_SCREEN]),c=(null===(n=this._room)||void 0===n||null===(i=n.remoteStreams.get(t))||void 0===i||null===(o=sI(i).call(i,(function(e){return e.isScreen===(r===ch.STREAM_INDEX_SCREEN)})))||void 0===o?void 0:o.videoTrack)||(null===(a=this._publicStreamManager)||void 0===a||null===(s=a.remoteStreams.get(t))||void 0===s?void 0:s.videoTrack)){e.next=6;break}throw new kC(mC.STREAM_NOT_EXIST,"stream not exist");case 6:return e.abrupt("return",xZ(c.preprocessingTrack,!1,r===ch.STREAM_INDEX_MAIN?this._remoteVideoPlayer.get(t):this._remoteScreenPlayer.get(t)));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"setSubscribeFallbackOption",value:function(e){this.logger.info("setSubscribeFallbackOption()","option: %o",e);try{UU(e,"option",[yh.DISABLE,yh.VIDEO_STREAM_LOW,yh.AUDIO_ONLY])}catch(t){return console.warn(t),!1}return!this._room&&(this._ctx.subscribeFallbackOption=e,!0)}},{key:"getLocalStreamTrack",value:function(e,t){var r,n,i=this;if(e===ch.STREAM_INDEX_MAIN?(r="video"===t?this.localVideoTrack:this.localAudioTrack,n=function(){var e;return null===(e=i._room)||void 0===e?void 0:e.localStream}):(r="video"===t?this.localScreenVideoTrack:this.localScreenAudioTrack,n=function(){var e;return null===(e=i._room)||void 0===e?void 0:e.localScreenStream}),r){var o=r instanceof kG&&r.mixedAudioTrack?r.mixedAudioTrack:r.preprocessingTrack;if(o){var a=n();return this._reportMsTrackEvent(o,(null==a?void 0:a.stream.id)||"local"),o}}}},{key:"getRemoteStreamTrack",value:function(e,t,r){var n,i,o=(null===(n=this._room)||void 0===n?void 0:n.remoteStreams.get(e))||[];if(o&&o.length){var a,s,c,u,d;if(t===ch.STREAM_INDEX_MAIN)a=sI(o).call(o,(function(e){return!e.isScreen})),i="video"===r?null===(s=a)||void 0===s?void 0:s.videoTrack:null===(c=a)||void 0===c?void 0:c.audioTrack;else a=sI(o).call(o,(function(e){return e.isScreen})),i="video"===r?null===(u=a)||void 0===u?void 0:u.videoTrack:null===(d=a)||void 0===d?void 0:d.audioTrack;if(i){var l=i.preprocessingTrack;if(l&&a){var h=a.streamId;return this._reportMsTrackEvent(l,h),l}}}}},{key:"getPublicStreamTrack",value:function(e,t){if(this._publicStreamManager&&this._publicStreamManager.remoteStreams){var r=this._publicStreamManager.remoteStreams.get(e);if(r){var n="video"===t?r.videoTrack:r.audioTrack;if(n){var i=n.preprocessingTrack;if(i){var o=r.streamId;return this._reportMsTrackEvent(i,o),i}}}}}},{key:"setRemoteStreamRenderSync",value:function(e){return!this._room&&(this._ctx.avSync=!!e,!0)}},{key:"setJoinRoomParams",value:function(e){e&&(this._ctx.joinRoomParams=e)}},{key:"setCaptureVolume",value:function(e,t){var r,n,i,o,a,s=this;(UU(e,"streamIndex",[ch.STREAM_INDEX_MAIN,ch.STREAM_INDEX_SCREEN]),t=$U(t,"volume",0,400),e===ch.STREAM_INDEX_SCREEN)?(null===(r=this._localScreenAudioTrack)||void 0===r||r.once("needReplaceTrack",(function(){var e;null===(e=s._room)||void 0===e||e.updatePubScreenTrack()})),null===(n=this._localScreenAudioTrack)||void 0===n||n.setVolume(t),this._localScreenAudioVolume=t):(null===(i=this._localAudioTrack)||void 0===i||i.once("needReplaceTrack",(function(){var e;null===(e=s._room)||void 0===e||e.updatePubTrack()})),null===(o=this._localAudioTrack)||void 0===o||o.setVolume(t),null===(a=this._audioDeviceManager.audioTrack)||void 0===a||a.setVolume(t),this._localAudioVolume=t)}},{key:"setPlaybackVolume",value:function(e,t,r){var n,i,o,a;if(zU(e),UU(t,"streamIndex",[ch.STREAM_INDEX_MAIN,ch.STREAM_INDEX_SCREEN]),r=$U(r,"volume",0,400),null!==(n=this._room)&&void 0!==n&&n.multiChatMode)CL("setPlaybackVolume is not supported in Conference mode");else{var s=t===ch.STREAM_INDEX_SCREEN;s?this._remoteScreenAudioVolume.set(e,r):this._remoteAudioVolume.set(e,r);var c=null===(i=this._room)||void 0===i||null===(o=i.remoteStreams.get(e))||void 0===o?void 0:sI(o).call(o,(function(e){return e.isScreen===s}));null==c||null===(a=c.audioTrack)||void 0===a||a.setVolume(r)}}},{key:"setPublicStreamVolume",value:function(e,t){var r,n,i;LU(e,"publicStreamId"),t=$U(t,"volume",0,400),this._publicAudioVolume.set(e,t),null===(r=this._publicStreamManager)||void 0===r||null===(n=r.remoteStreams.get(e))||void 0===n||null===(i=n.audioTrack)||void 0===i||i.setVolume(t)}},{key:"startForwardStreamToRooms",value:(u=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.forEach((function(e){GU(e.roomId)})),this._assertNotInRoom(),e.next=4,this._room.startForwardStream2Rooms(t);case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"updateForwardStreamToRooms",value:(c=Ng(Mg().mark((function e(t){var r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.forEach((function(e){GU(e.roomId)})),this._assertNotInRoom(),e.next=4,this._room.updateForwardStream2Rooms(t);case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"stopForwardStreamToRooms",value:(s=Ng(Mg().mark((function e(){var t;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertNotInRoom(),e.next=3,this._room.stopForwardStream2Rooms();case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"pauseForwardStreamToAllRooms",value:(a=Ng(Mg().mark((function e(){var t;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertNotInRoom(),e.next=3,this._room.pauseForwardStream2AllRooms();case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"resumeForwardStreamToAllRooms",value:(o=Ng(Mg().mark((function e(){var t;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertNotInRoom(),e.next=3,this._room.resumeForwardStream2AllRooms();case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"ambulance",value:(i=Ng(Mg().mark((function e(){var t,r;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p$(this);case 2:return t=e.sent,r=zg(t),this.monitor.reportLongString("ambulance",r),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_reportMsTrackEvent",value:function(e,t){var r=this;if(!e.hookStop){e.hookStop=!0;var n=e.stop;e.stop=function(){JD(r.id,"stop",t,0,t),n.call(e)}}}},{key:"_updateScreenPublish",value:(n=Ng(Mg().mark((function e(){var t,r,n,i=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},this.logger.info("_updateScreenPublish()"),r={mediaType:void 0,pubState:NX.PUB},t=Zl(Zl({},r),t),this._visibility){e.next=6;break}throw new kC(mC.NO_PUBLISH_PERMISSION,"no publish permission");case 6:return e.next=8,this._pubLock.lock();case 8:if(n=e.sent,this._room&&this._room.connectionState===cq.CONNECTED){e.next=12;break}return n(),e.abrupt("return");case 12:return e.prev=12,e.next=15,this._room.publishScreen(this._screenStreamEncodeConfig,this._localScreenVideoTrack,this._localScreenAudioTrack,t.mediaType,t.pubState);case 15:e.next=24;break;case 17:if(e.prev=17,e.t0=e.catch(12),!(e.t0 instanceof kC)){e.next=23;break}throw e.t0;case 23:throw new kC(mC.UNEXPECTED_ERROR,"unexpected error",e.t0);case 24:return e.prev=24,n(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[12,17,24,27]])}))),function(){return n.apply(this,arguments)})},{key:"_updateAudioPlayerState",value:function(e){this.logger.info("_updateAudioPlayerState()");var t,r=e.userId,n=e.isScreen,i=n?this._remoteScreenAudioPlayer:this._remoteAudioPlayer,o=i.get(r);if(e.audioTrack&&e.attributes.audiostream&&e.subAudio){var a,s,c;if(!o){var u;o=new Bq(this.id,r,{muted:(null===(u=this._config)||void 0===u?void 0:u.autoPlayPolicy)===Ih.VIDEO_ONLY,isScreen:n}),this._initPlayerEvents(o,!1,n?ch.STREAM_INDEX_SCREEN:ch.STREAM_INDEX_MAIN),i.set(r,o);var d=this._audioDeviceManager.getSinkId();d&&o.setPlaybackDevice(d)}(null===(a=this._config)||void 0===a?void 0:a.autoPlayPolicy)!==Ih.PLAY_MANUALLY&&o.playAudio(e.audioTrack),e.audioTrack.setPlayer(o);var l=n?null!==(s=this._remoteScreenAudioVolume.get(r))&&void 0!==s?s:100:null!==(c=this._remoteAudioVolume.get(r))&&void 0!==c?c:100;e.audioTrack.setVolume(l),BL&&qL&&(t=this._remoteAudioPlayer,LZ&&clearTimeout(LZ),LZ=setTimeout((function(){var e,r=gy(t);try{for(r.s();!(e=r.n()).done;){var n=yy(e.value,2),i=n[0],o=n[1];null!=i&&_C(i).call(i,"mux")&&o.pause()}}catch(J$){r.e(J$)}finally{r.f()}var a,s=gy(t);try{for(s.s();!(a=s.n()).done;){var c=yy(a.value,2),u=c[0],d=c[1];null!=u&&_C(u).call(u,"mux")&&d.manuallyPlay()}}catch(J$){s.e(J$)}finally{s.f()}}),2e3))}else{var h;null===(h=o)||void 0===h||h.stop()}}},{key:"_updateVideoPlayerState",value:function(e){var t;this.logger.info("_updateVideoPlayerState()");var r,n,i=e.userId;if(r=e.isScreen?this._remoteScreenPlayer.get(i):this._remoteVideoPlayer.get(i),e.videoTrack)r&&(null===(n=this._config)||void 0===n?void 0:n.autoPlayPolicy)!==Ih.PLAY_MANUALLY&&r.playVideo(e.videoTrack,e);else if(null!==(t=r)&&void 0!==t&&t.played){var o;null===(o=r)||void 0===o||o.stop()}}},{key:"_onAddStream",value:(r=Ng(Mg().mark((function e(t){var r,n,i,o,a,s,c;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.stream,n=r.attributes,i=n.localaudio,o=n.audiostream,a=n.localvideo,s=n.videostream,c=TG.NONE,o&&(c|=uh.AUDIO),s&&(c|=uh.VIDEO),!c){e.next=11;break}return e.next=8,new HI((function(e){return setTimeout(e)}));case 8:r.isScreen?this.safeEmit(Uh.onUserPublishScreen,{userId:r.userId,mediaType:c}):(this.safeEmit(Uh.onUserPublishStream,{userId:r.userId,mediaType:c,videoStreamDescriptions:r.attributes.videoDescriptions}),this._handleAutoSubscribe(r,!0)),this.safeEmit("onAddStream",{userId:r.userId,mediaType:c,isScreen:!!r.isScreen}),r.isScreen||(i&&this.safeEmit(Uh.onUserStartAudioCapture,{userId:r.userId}),a&&this.safeEmit(Uh.onUserStartVideoCapture,{userId:r.userId}));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_handleAutoSubscribe",value:function(e,t){var r,n,i=TG.NONE;if(null!==(r=this._roomConfig)&&void 0!==r&&r.isAutoSubscribeAudio&&(i|=uh.AUDIO),null!==(n=this._roomConfig)&&void 0!==n&&n.isAutoSubscribeVideo&&(i|=uh.VIDEO),i){var o,a;if(t&&EL(i))null===(o=e.observer)||void 0===o||o.setAutoSubscribeAudio(!0);if(t&&TL(i))null===(a=e.observer)||void 0===a||a.setAutoSubscribeVideo(!0);this._subscribe(!1,e.userId,i)}}},{key:"_onRemoveStream",value:function(e){var t,r=this,n=e.stream,i=null!==(t=y$[e.reason])&&void 0!==t?t:dh.STREAM_REMOVE_REASON_OTHER,o=n.isScreen?Uh.onUserUnpublishScreen:Uh.onUserUnpublishStream,a=TG.NONE;n.attributes.audiostream&&(a|=uh.AUDIO),n.attributes.videostream&&(a|=uh.VIDEO),a!==TG.NONE&&(this.safeEmit(o,{userId:n.userId,mediaType:a,reason:i}),this.safeEmit("onRemoveStream",{userId:n.userId,isScreen:n.isScreen})),"function"==typeof e.callback&&e.callback(),this._getRemotePlayer(n.userId,n.isScreen).forEach((function(e){n.isScreen?(r._remoteScreenPlayer.delete(n.userId),r._remoteScreenAudioPlayer.delete(n.userId)):(r._remoteAudioPlayer.delete(n.userId),r._remoteVideoPlayer.delete(n.userId)),null==e||e.destroy()}))}},{key:"_onUserConnection",value:function(e){var t=this;setTimeout((function(){return t.safeEmit(Uh.onUserJoined,e)}))}},{key:"_onUserLeave",value:function(e){var t=this,r=e.userInfo;this._getRemotePlayer(r.userId,!0).forEach((function(e){t._remoteScreenAudioPlayer.delete(r.userId),t._remoteScreenPlayer.delete(r.userId),null==e||e.destroy()})),this._getRemotePlayer(r.userId,!1).forEach((function(e){t._remoteAudioPlayer.delete(r.userId),t._remoteVideoPlayer.delete(r.userId),null==e||e.destroy()})),this.safeEmit(Uh.onUserLeave,e)}},{key:"_onRoomError",value:function(e){var t;this.safeEmit(Uh.onError,e),null===(t=this._room)||void 0===t||t.destroy(),this._room=void 0}},{key:"_onNetworkQuality",value:function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];this.safeEmit.apply(this,Bg(e=[Uh.onNetworkQuality]).call(e,r))}},{key:"_onConnectionStateChange",value:function(e){if(void 0!==this._startCloudProxyTimestamp&&this._ctx.useCloudProxy&&e.state===lh.CONNECTION_STATE_CONNECTED&&this.safeEmit(Uh.onCloudProxyConnected,{interval:Date.now()-this._startCloudProxyTimestamp}),this.safeEmit(Uh.onConnectionStateChanged,e),e.state===lh.CONNECTION_STATE_RECONNECTING){var t,r=gy(this._remoteAudioPlayer);try{for(r.s();!(t=r.n()).done;){var n=yy(t.value,2),i=n[0],o=n[1];_C(i).call(i,"mux")&&o.stop()}}catch(J$){r.e(J$)}finally{r.f()}}}},{key:"_getRemotePlayer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:uh.AUDIO_AND_VIDEO,n=(t?this._remoteScreenAudioPlayer:this._remoteAudioPlayer).get(e),i=(t?this._remoteScreenPlayer:this._remoteVideoPlayer).get(e),o=[];return r&uh.AUDIO&&o.push(n),r&uh.VIDEO&&o.push(i),o}},{key:"_stopAudioPropertiesReport",value:function(){null!==this._audioPropertiesReportTimer&&(clearInterval(this._audioPropertiesReportTimer),this._audioPropertiesReportTimer=null)}},{key:"_onResubscribe",value:function(e){e.stream&&(this._getRemotePlayer(e.stream.userId,e.stream.isScreen).forEach((function(e){return null==e?void 0:e.stop()})),this._updateAudioPlayerState(e.stream),this._updateVideoPlayerState(e.stream))}},{key:"_onSubscribePushTrack",value:function(e){e.stream&&this._updateAudioPlayerState(e.stream)}},{key:"_onRemovePushTrack",value:function(e){var t=this;if(e.stream){this._updateAudioPlayerState(e.stream);var r=e.stream;this._getRemotePlayer(r.userId,r.isScreen,e.mediaType).forEach((function(n){e.mediaType&uh.AUDIO&&(r.isScreen?t._remoteScreenAudioPlayer.delete(r.userId):t._remoteAudioPlayer.delete(r.userId)),r.isScreen?e.mediaType&uh.VIDEO&&t._remoteScreenPlayer.delete(r.userId):e.mediaType&uh.VIDEO&&t._remoteVideoPlayer.delete(r.userId),null==n||n.destroy()}))}}},{key:"_onVideoDeviceStateChange",value:function(e){this.safeEmit(Uh.onVideoDeviceStateChanged,e)}},{key:"_onAudioDeviceStateChange",value:function(e){this.safeEmit(Uh.onAudioDeviceStateChanged,e)}},{key:"_onUserPublishStateChange",value:function(e){var t=this,r=e.userId,n=e.isScreen,i=e.mediaType,o=e.pubState,a=e.remoteStream,s={userId:r,mediaType:i};i&uh.AUDIO&&setTimeout((function(){t._updateAudioPlayerState(a)})),n?o===NX.PUB?this.safeEmit(Uh.onUserPublishScreen,s):this.safeEmit(Uh.onUserUnpublishScreen,Zl(Zl({},s),{},{reason:dh.STREAM_REMOVE_REASON_UNPUBLISH})):o===NX.PUB?(s.videoStreamDescriptions=a.attributes.videoDescriptions,this.safeEmit(Uh.onUserPublishStream,s),this._handleAutoSubscribe(a,!0)):this.safeEmit(Uh.onUserUnpublishStream,Zl(Zl({},s),{},{reason:dh.STREAM_REMOVE_REASON_UNPUBLISH}))}},{key:"_onCustomMessage",value:function(e){var t=e.message;e.binary?this.safeEmit(Uh.onRoomBinaryMessageReceived,{userId:e.clientId,message:t}):this.safeEmit(Uh.onRoomMessageReceived,{userId:e.clientId,message:t})}},{key:"_onUserMessageReceived",value:function(e){this._messageStatisticsObserver.recvP2PMessage(e.userId),this.safeEmit(Uh.onUserMessageReceived,e)}},{key:"_onUserBinaryMessageReceived",value:function(e){this._messageStatisticsObserver.recvP2PMessage(e.userId),this.safeEmit(Uh.onUserBinaryMessageReceived,e)}},{key:"_onLiveTranscodingResult",value:function(e){this.safeEmit(Uh.onLiveTranscodingResult,e)}},{key:"_onStreamMixingEvent",value:function(e){this.safeEmit(Uh.onStreamMixingEvent,e)}},{key:"_onUserTokenWillExpire",value:function(){this.safeEmit(Uh.onTokenWillExpire)}},{key:"_onPushPublicStreamResult",value:function(e){this.safeEmit(Uh.onPushPublicStreamResult,e)}},{key:"_handleRTMClient",value:function(e){var t=this;e.on("onUserMessageReceivedOutsideRoom",(function(e){t._messageStatisticsObserver.recvP2POutRoomMessage(e.userId),t.safeEmit(Uh.onUserMessageReceivedOutsideRoom,e)})),e.on("onUserBinaryMessageReceivedOutsideRoom",(function(e){t._messageStatisticsObserver.recvP2POutRoomMessage(e.userId),t.safeEmit(Uh.onUserBinaryMessageReceivedOutsideRoom,e)})),e.on("onUserDisconnection",(function(){t.safeEmit(Uh.onError,{errorCode:mC.RTM_DUPLICATE_LOGIN})})),e.on("onRTMTokenError",(function(){t.safeEmit(Uh.onError,{errorCode:mC.RTM_TOKEN_ERROR})})),e.on("onServerParamsSetResult",(function(e){t.safeEmit(Uh.onServerParamsSetResult,null==e?void 0:e.code)}))}},{key:"waitForNewToken",get:function(){return!!this._tempRoomInfo}},{key:"getSubLock",value:function(e,t){var r,n=e?this._subScreenLocks:this._subLocks,i=n.get(t);i||(i=new PX(Bg(r="sub_".concat(e?1:0,"_")).call(r,t)),n.set(t,i));return i}},{key:"localAudioTrack",get:function(){return this._localAudioTrack}},{key:"localVideoTrack",get:function(){return this._localVideoTrack}},{key:"localScreenAudioTrack",get:function(){return this._localScreenAudioTrack}},{key:"localScreenVideoTrack",get:function(){return this._localScreenVideoTrack}},{key:"remoteStreams",get:function(){var e,t=[];return null!==(e=this._room)&&void 0!==e&&e.remoteStreams&&this._room.remoteStreams.forEach((function(e){Array.isArray(e)&&e.forEach((function(e){t.push({userId:e.userId,isScreen:e.isScreen,hasVideo:e.hasVideo,hasAudio:e.hasAudio,videoStreamDescriptions:e.attributes.videoDescriptions})}))})),t}},{key:"iceState",get:function(){var e,t,r;return null===(e=this._room)||void 0===e||null===(t=e._mediaServerClient.handler)||void 0===t||null===(r=t._peerConnection)||void 0===r?void 0:r.iceConnectionState}},{key:"remoteUsers",get:function(){var e,t=[];return null!==(e=this._room)&&void 0!==e&&e.remoteUsers&&this._room.remoteUsers.forEach((function(e){t.push({userId:e.userId})})),t}},{key:"multiChatMode",get:function(){var e;return!(null===(e=this._room)||void 0===e||!e._mediaServerClient.roomAttributes.multiChatMode)}},{key:"checkMediaType",get:function(){return this._checkMediaType}},{key:"assertNotInRoom",get:function(){return this._assertNotInRoom}},{key:"_handleAudioDeviceManager",value:function(){var e=this;this._audioDeviceManager.on("onAudioPlaybackDeviceTestVolume",(function(t){e.safeEmit(Uh.onAudioPlaybackDeviceTestVolume,t)}))}},{key:"_assertNotInRoom",value:function(){if(!this._room||this._room.connectionState!==cq.CONNECTED)throw new kC(mC.NOT_CONNECTED_YET,"server not connected")}},{key:"_checkMediaType",value:function(e){UU(e,"mediaType",[uh.AUDIO,uh.VIDEO,uh.AUDIO_AND_VIDEO])}},{key:"_getUserId",value:function(){var e,t;return(null===(e=this._room)||void 0===e||null===(t=e.roomInfo)||void 0===t?void 0:t.userInfo.userId)||"local_user"}},{key:"_switchTrack",value:(t=Ng(Mg().mark((function e(t){var r,n,i;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._initLocalTrackEvents(t),this._localVideoTrack=t,null!==(r=this._videoPlayer)&&void 0!==r&&r.played&&(this._videoPlayer.stop(),this._videoPlayer.playVideo(t),this._videoPlayer.mirror(!!this._mirrorType)),null===(n=this._room)||void 0===n||null===(i=n.localStream)||void 0===i||!i.pubVideo){e.next=6;break}return e.next=6,this._updatePublish();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_shouldUpdateAudioConf",value:function(e){var t,r,n,i=(null===(t=this._room)||void 0===t?void 0:t.hasPublished)||(null===(r=this._room)||void 0===r||null===(n=r.localStream)||void 0===n?void 0:n.pubAudio)||this._localAudioTrack&&this._localAudioTrack.sourceType===UH.INTERNAL;if(i){var o="engine.".concat(e," should be called before publishing or capturing.");console.warn("[RTC WebSDK]: ".concat(o)),JD(this.id,e,o)}return!i}},{key:"_getServerConfig",value:function(){var e=this,t=yU.getServerConfig(this.appId);t.rts_report&&ND.setConfig(t.rts_report),this._ctx.joinRoomConfig.setServerConfig(t.web_join_room),this._getServerConfigExecutor(t),pN({engineId:this.id,appId:this.appId,sdkVersion:wU("VERSION"),requestDomains:wU("CONFIG_REQUEST_DOMAINS"),keys:["rts_report","web_join_room","web_rtc_config"],deviceId:wU("DEVICE_ID")}).then((function(t){yU.setServerConfig(e.appId,t),e.safeEmit("__onGetServerConfigFinishHook")}))}},{key:"_getServerConfigExecutor",value:function(e){var t,r,n,i;Nx.setParameter("UPLOAD_CONSOLE_ON",!(null==e||null===(t=e.web_rtc_config)||void 0===t||!t.upload_console_on)),Nx.setParameter("UPLOAD_CONSOLE_LENGTH_CUT",null==e||null===(r=e.web_rtc_config)||void 0===r?void 0:r.upload_console_length_cut),Nx.setParameter("UPLOAD_REPORT_LIMIT",null==e||null===(n=e.web_rtc_config)||void 0===n?void 0:n.upload_report_limit),Nx.setParameter("ENABLE_REPORT_IDB_BUFFER",!(null==e||null===(i=e.web_rtc_config)||void 0===i||!i.enable_report_idb_buffer))}}]),Re}(oV);m$([XD()],g$.prototype,"updateToken",1),m$([XD(),k$("video")],g$.prototype,"setVideoCaptureDevice",1),m$([XD(),k$("audio")],g$.prototype,"setAudioCaptureDevice",1),m$([function(e,t,r){if("function"==typeof r.value){var n=r.value;r.value=function(){for(var e,t=KD(this.id),r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return null==t||t.set({room_id:i[1],user_id:null===(e=i[2])||void 0===e?void 0:e.userId}),n.apply(this,i)}}},XD()],g$.prototype,"connect",1),m$([XD()],g$.prototype,"joinRoom",1),m$([XD()],g$.prototype,"leaveRoom",1),m$([XD()],g$.prototype,"destroy",1),m$([XD()],g$.prototype,"publishStream",1),m$([XD()],g$.prototype,"unpublishStream",1),m$([XD()],g$.prototype,"publishScreen",1),m$([XD()],g$.prototype,"unpublishScreen",1),m$([XD()],g$.prototype,"subscribeStream",1),m$([S$],g$.prototype,"_subscribe",1),m$([XD()],g$.prototype,"unsubscribeStream",1),m$([XD()],g$.prototype,"subscribeScreen",1),m$([XD()],g$.prototype,"unsubscribeScreen",1),m$([S$],g$.prototype,"_unsubscribe",1),m$([XD(),b$],g$.prototype,"setRemoteVideoConfig",1),m$([XD(),k$("video")],g$.prototype,"startVideoCapture",1),m$([XD(),k$("video")],g$.prototype,"stopVideoCapture",1),m$([XD(),k$("audio")],g$.prototype,"startAudioCapture",1),m$([XD(),k$("audio")],g$.prototype,"stopAudioCapture",1),m$([XD(),k$("all")],g$.prototype,"startAudioAndVideoCapture",1),m$([XD()],g$.prototype,"startVideoAndAudioCapture",1),m$([XD()],g$.prototype,"getAudioMixingManager",1),m$([XD(),E$],g$.prototype,"startScreenCapture",1),m$([XD(),E$],g$.prototype,"stopScreenCapture",1),m$([XD()],g$.prototype,"setLocalVideoPlayer",1),m$([XD()],g$.prototype,"startLiveTranscoding",1),m$([XD()],g$.prototype,"updateLiveTranscoding",1),m$([XD()],g$.prototype,"stopLiveTranscoding",1),m$([XD()],g$.prototype,"startSubtitle",1),m$([XD()],g$.prototype,"stopSubtitle",1),m$([XD()],g$.prototype,"setBusinessId",1),m$([XD()],g$.prototype,"setUserVisibility",1),m$([XD()],g$.prototype,"setRemoteVideoPlayer",1),m$([XD()],g$.prototype,"setLocalVideoMirrorType",1),m$([XD()],g$.prototype,"setAudioPlaybackDevice",1),m$([XD()],g$.prototype,"play",1),m$([XD()],g$.prototype,"pauseAllSubscribedStream",1),m$([XD()],g$.prototype,"resumeAllSubscribedStream",1),m$([XD()],g$.prototype,"sendUserMessage",1),m$([XD()],g$.prototype,"sendUserBinaryMessage",1),m$([XD()],g$.prototype,"sendRoomMessage",1),m$([XD()],g$.prototype,"sendRoomBinaryMessage",1),m$([XD()],g$.prototype,"setAudioCaptureConfig",1),m$([wL("4.51"),XD()],g$.prototype,"setVideoCaptureConfig",1),m$([XD()],g$.prototype,"enableSimulcastMode",1),m$([XD()],g$.prototype,"setVideoEncoderConfig",1),m$([XD()],g$.prototype,"setScreenEncoderConfig",1),m$([XD()],g$.prototype,"sendSEIMessage",1),m$([wL("4.42"),XD()],g$.prototype,"setAudioVolumeIndicationInterval",1),m$([XD()],g$.prototype,"enableAudioPropertiesReport",1),m$([XD()],g$.prototype,"setVideoSourceType",1),m$([XD()],g$.prototype,"setExternalVideoTrack",1),m$([XD()],g$.prototype,"setAudioSourceType",1),m$([XD()],g$.prototype,"setExternalAudioTrack",1),m$([XD()],g$.prototype,"login",1),m$([XD()],g$.prototype,"logout",1),m$([XD()],g$.prototype,"updateLoginToken",1),m$([XD()],g$.prototype,"getPeerOnlineStatus",1),m$([XD()],g$.prototype,"sendUserMessageOutsideRoom",1),m$([XD()],g$.prototype,"sendUserBinaryMessageOutsideRoom",1),m$([XD()],g$.prototype,"setServerParams",1),m$([XD()],g$.prototype,"sendServerMessage",1),m$([XD()],g$.prototype,"sendServerBinaryMessage",1),m$([XD()],g$.prototype,"startCloudProxy",1),m$([XD()],g$.prototype,"stopCloudProxy",1),m$([XD()],g$.prototype,"startPushPublicStream",1),m$([XD()],g$.prototype,"updatePublicStreamParam",1),m$([XD()],g$.prototype,"stopPushPublicStream",1),m$([XD("streamId")],g$.prototype,"startPlayPublicStream",1),m$([XD("streamId")],g$.prototype,"stopPlayPublicStream",1),m$([XD()],g$.prototype,"setAudioProfile",1),m$([XD()],g$.prototype,"setAudioEncodeMaxBitrate",1),m$([XD()],g$.prototype,"setPublicStreamVideoPlayer",1),m$([XD()],g$.prototype,"setDummyCaptureImagePath",1),m$([XD()],g$.prototype,"registerExtension",1),m$([XD()],g$.prototype,"startAudioPlaybackDeviceTest",1),m$([XD()],g$.prototype,"stopAudioPlaybackDeviceTest",1),m$([XD()],g$.prototype,"startAudioDeviceRecordTest",1),m$([XD()],g$.prototype,"stopAudioDeviceRecordAndPlayTest",1),m$([XD()],g$.prototype,"stopAudioDevicePlayTest",1),m$([XD(),b$],g$.prototype,"setRemoteUserPriority",1),m$([XD()],g$.prototype,"takeLocalSnapshot",1),m$([XD()],g$.prototype,"takeRemoteSnapshot",1),m$([XD()],g$.prototype,"setSubscribeFallbackOption",1),m$([XD()],g$.prototype,"getLocalStreamTrack",1),m$([XD()],g$.prototype,"getRemoteStreamTrack",1),m$([XD()],g$.prototype,"getPublicStreamTrack",1),m$([XD()],g$.prototype,"setRemoteStreamRenderSync",1),m$([XD()],g$.prototype,"setJoinRoomParams",1),m$([XD()],g$.prototype,"startForwardStreamToRooms",1),m$([XD()],g$.prototype,"updateForwardStreamToRooms",1),m$([XD()],g$.prototype,"stopForwardStreamToRooms",1),m$([XD()],g$.prototype,"pauseForwardStreamToAllRooms",1),m$([XD()],g$.prototype,"resumeForwardStreamToAllRooms",1);var y$={"client unpublished":dh.STREAM_REMOVE_REASON_UNPUBLISH,"publish failed":dh.STREAM_REMOVE_REASON_PUBLISH_FAILED,"stream removed":dh.STREAM_REMOVE_REASON_KEEP_LIVE_FAILED,"client disconnected":dh.STREAM_REMOVE_REASON_CLIENT_DISCONNECTED,"client republish":dh.STREAM_REMOVE_REASON_REPUBLISH};function S$(e,t,r){var n=r.value;return r.value=Ng(Mg().mark((function e(){var t,r,i,o,a,s,c,u=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=u.length,r=new Array(t),i=0;i<t;i++)r[i]=u[i];return o=r[0],a=r[1],s=r[2],this.checkMediaType(s),this.assertNotInRoom(),e.next=6,this.getSubLock(o,a).lock();case 6:return c=e.sent,e.prev=7,e.next=10,n.apply(this,r);case 10:return e.abrupt("return",e.sent);case 11:return e.prev=11,c(),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[7,,11,14]])}))),r}function b$(e,t,r){var n=r.value;return r.value=Ng(Mg().mark((function e(){var t,r,i,o,a,s=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=s.length,r=new Array(t),i=0;i<t;i++)r[i]=s[i];return o=r[0],e.next=4,this.getSubLock(!1,o).lock();case 4:return a=e.sent,e.prev=5,e.next=8,n.apply(this,r);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,a(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[5,,9,12]])}))),r}function k$(e){return function(t,r,n){var i=n.value;return n.value=Ng(Mg().mark((function t(){var r,n,o,a,s,c=arguments;return Mg().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=[],"video"!==e&&r.push(this._audioCaptureLock.lock()),"audio"!==e&&r.push(this._videoCaptureLock.lock()),t.next=5,HI.all(r);case 5:for(n=t.sent,t.prev=6,o=c.length,a=new Array(o),s=0;s<o;s++)a[s]=c[s];return t.next=10,i.apply(this,a);case 10:return t.abrupt("return",t.sent);case 11:return t.prev=11,n.forEach((function(e){return e()})),t.finish(11);case 14:case"end":return t.stop()}}),t,this,[[6,,11,14]])}))),n}}function E$(e,t,r){var n=r.value;return r.value=Ng(Mg().mark((function e(){var t,r,i,o,a=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._screenCaptureLock.lock();case 2:for(t=e.sent,e.prev=3,r=a.length,i=new Array(r),o=0;o<r;o++)i[o]=a[o];return e.next=7,n.apply(this,i);case 7:return e.abrupt("return",e.sent);case 8:return e.prev=8,t(),e.finish(8);case 11:case"end":return e.stop()}}),e,this,[[3,,8,11]])}))),r}function T$(e){var t=yU.getServerConfig(e).web_rtc_config;return null!=t&&t.web_pc_killswitch?null==t?void 0:t.web_pc_killswitch:{}}function I$(e){var t=yU.getServerConfig(e).web_rtc_config;return"boolean"==typeof(null==t?void 0:t.fallback)?!1!==t.fallback&&(!!Array.isArray(null==t?void 0:t.fallback_ua_reg)&&t.fallback_ua_reg.every((function(e){return"string"==typeof e&&new RegExp(e).test(navigator.userAgent)}))):!!wU("ENABLE_FALLBACK_HANDLER")}function R$(e){var t=yU.getServerConfig(e).web_rtc_config;return"boolean"==typeof(null==t?void 0:t.standard)?!1!==t.standard&&(!!Array.isArray(null==t?void 0:t.standard_ua_reg)&&t.standard_ua_reg.every((function(e){return"string"==typeof e&&new RegExp(e).test(navigator.userAgent)}))):!!wU("ENABLE_STANDARD_HANDLER")}var A$,w$=dT,C$=GI,x$=function(e,t,r,n){for(var i,o=n>1?void 0:n?C$(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&w$(t,r,o),o},O$=function(e){VA(i,e);var t,r,n=tw(i);function i(e,t,r){var o;return Bh(this,i),Jl(sA(o=n.call(this,e,t,r)),"singleStreamRenderMode",!1),o.id=t,o.logger=new lN("BLWEngine",0,t),OU([{width:192,height:108,frameRate:15,maxKbps:100},{width:320,height:180,frameRate:15,maxKbps:140},{width:640,height:360,frameRate:15,maxKbps:400},{width:1280,height:720,frameRate:15,maxKbps:1e3},{width:1920,height:1080,frameRate:15,maxKbps:2e3}]),o._handleEngineEvents(),o}return Fh(i,[{key:"subscribeStream",value:(r=Ng(Mg().mark((function e(t,r){var n=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.print("subscribeStream()","userId: %o, mediaType: %o",t,r),this.singleStreamRenderMode&&TL(r)&&LA(NA(i.prototype),"subscribeScreen",this).call(this,t,uh.VIDEO).catch((function(e){n.logger.error("singleStreamRenderMode subscribeScreen()",e)})),e.abrupt("return",LA(NA(i.prototype),"subscribeStream",this).call(this,t,r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"unsubscribeStream",value:(t=Ng(Mg().mark((function e(t,r){var n=this;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.print("unsubscribeStream()","userId: %o, mediaType: %o",t,r),this.singleStreamRenderMode&&TL(r)&&LA(NA(i.prototype),"unsubscribeScreen",this).call(this,t,uh.VIDEO).catch((function(e){n.logger.error("singleStreamRenderMode unsubscribeScreen()",e)})),e.abrupt("return",LA(NA(i.prototype),"unsubscribeStream",this).call(this,t,r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"setRemoteScreenVideoStreamIndex",value:function(e){var t;return this.logger.print("setRemoteScreenVideoStreamIndex()","streamIndex: %o",e),(null===(t=this._room)||void 0===t?void 0:t.connectionState)!==cq.CONNECTED&&(this.singleStreamRenderMode=e===ch.STREAM_INDEX_MAIN,!0)}},{key:"setRemoteVideoPlayer",value:function(e,t){if(this.logger.print("setRemoteVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",e,t),!this.singleStreamRenderMode||e!==ch.STREAM_INDEX_SCREEN)return LA(NA(i.prototype),"setRemoteVideoPlayer",this).call(this,e,t)}},{key:"destroy",value:function(){this.singleStreamRenderMode=!1,LA(NA(i.prototype),"destroy",this).call(this)}},{key:"_updateVideoPlayerState",value:function(e){var t,r;if(!this.singleStreamRenderMode)return LA(NA(i.prototype),"_updateVideoPlayerState",this).call(this,e);var n,o=e.userId,a=null===(t=this._room)||void 0===t?void 0:t.remoteStreams.get(o);Array.isArray(a)&&a.forEach((function(e){e.isScreen&&(n=e)}));var s=this._remoteVideoPlayer.get(o);if(s){if(!e.isScreen&&null!==(r=n)&&void 0!==r&&r.videoTrack)return this.logger.print("_updateVideoPlayerState","prevent play main stream"),void s.playVideo(n.videoTrack,n);var c;if(e.videoTrack)(null===(c=this._config)||void 0===c?void 0:c.autoPlayPolicy)!==Ih.PLAY_MANUALLY&&s.playVideo(e.videoTrack,e);else s.played&&s.stop()}}},{key:"_handleEngineEvents",value:function(){var e=this;this.on(Uh.onUserPublishScreen,(function(t){if(e.singleStreamRenderMode&&TL(t.mediaType)){var r,n,i=null===(r=e._room)||void 0===r?void 0:r.remoteStreams.get(t.userId),o=null==i?void 0:sI(i).call(i,(function(e){return!e.isScreen})),a=null==i?void 0:sI(i).call(i,(function(e){return e.isScreen}));null!=a&&a.hasSubscribed?(e.logger.info("onUserPublishScreen","singleStreamRenderMode screen hasSubscribed"),e._updateVideoPlayerState(a)):(null!==(n=e._roomConfig)&&void 0!==n&&n.isAutoSubscribeVideo||null!=o&&o.hasSubscribed&&TL(o.subMediaType))&&(e.logger.info("onUserPublishScreen","singleStreamRenderMode subscribeScreen"),e.subscribeScreen(t.userId,uh.VIDEO))}})),this.on(Uh.onUserUnpublishScreen,(function(t){if(e.singleStreamRenderMode&&TL(t.mediaType)){var r,n=e._remoteVideoPlayer.get(t.userId),i=null===(r=e._room)||void 0===r?void 0:r.remoteStreams.get(t.userId),o=null==i?void 0:sI(i).call(i,(function(e){return!e.isScreen}));if(null==o||!o.videoTrack||!n)return;n.playVideo(o.videoTrack)}}))}}]),i}(g$);x$([XD()],O$.prototype,"subscribeStream",1),x$([XD()],O$.prototype,"unsubscribeStream",1),x$([XD()],O$.prototype,"setRemoteScreenVideoStreamIndex",1),x$([XD()],O$.prototype,"setRemoteVideoPlayer",1),x$([XD()],O$.prototype,"destroy",1);var P$=new lN("VERTC",0);Ix.storeKey=Bg(A$="".concat(Date.now(),"-")).call(A$,yU.getDeviceId()),UD({rtc_sdk_version:RU.VERSION,device_id:yU.getDeviceId(),log_cache_key:Ix.storeKey}),VD(RU.LOG_SERVER_URL);var M$=1,D$=function(e,t){P$.info("createEngine","Invoke VERTC.createEngine"),LU(e,"appId");var r=(M$++).toString();return WD(r,{rtc_app_id:e,auto_play_policy:null==t?void 0:t.autoPlayPolicy}),new g$(e,r,t)},N$=function(e,t){P$.print("createBLWEngine","Invoke VERTC.createBLWEngine"),LU(e,"appId");var r=(M$++).toString();return WD(r,{rtc_app_id:e,auto_play_policy:null==t?void 0:t.autoPlayPolicy}),new O$(e,r,t)},L$=function(e){if(P$.info("destroyEngine","Invoke VERTC.destroyEngine"),!(e instanceof g$))throw new kC(mC.INVALID_ENGINE,"Invalid engine object");var t;e.destroy(),(t=e.monitor).report("sdk_init_engine",{start:Date.now(),type:"end"}),zD.delete(t.id)},U$=function(){var e=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",RH.enumerateDevices());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),V$=function(){var e=Ng(Mg().mark((function e(){var t,r,n,i,o,a,s=arguments;return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(t=s.length>0&&void 0!==s[0]?s[0]:{video:!0,audio:!0}).video,n=t.audio,i={video:!1,audio:!1},!r){e.next=14;break}return e.prev=4,e.next=7,RH.getPermissions({video:!0,force:!0});case 7:o=e.sent,i.video=o.video,o.video||(i.videoExceptionError=o.reason),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(4);case 14:if(!n){e.next=25;break}return e.prev=15,e.next=18,RH.getPermissions({audio:!0,force:!0});case 18:a=e.sent,i.audio=a.audio,a.audio||(i.audioExceptionError=a.reason),e.next=25;break;case 23:e.prev=23,e.t1=e.catch(15);case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}}),e,null,[[4,12],[15,23]])})));return function(){return e.apply(this,arguments)}}(),F$=function(){var e=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",RH.enumerateAudioCaptureDevices());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B$=function(){var e=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",RH.enumerateVideoCaptureDevices());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j$=function(){var e=Ng(Mg().mark((function e(){return Mg().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",RH.enumerateAudioPlaybackDevices());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),H$=function(){return RU.VERSION},G$=function(){return lj()},z$=function(){return pj()},K$=function(e){var t=e.logLevel,r=e.LogfileSize;t&&(Ix.logLevel=t),r&&(Ix.LogfileSize=r)},W$=function(e){Ix.download(e)};function X$(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return zg(Jg(t).call(t,(function(e){return e instanceof g$?"[ENGINE]":e})))}function q$(e,t){return function(){BD(t,0,X$.apply(void 0,arguments));var r=e.apply(void 0,arguments);return"function"==typeof(null==r?void 0:r.then)?r.then((function(e){return jD(t,0,X$(e)),e})).catch((function(e){throw jD(t,e.code,e.message),e})):(jD(t,0,X$(r)),r)}}return Zl(Zl(Zl(Zl({},new(Fh((function e(){Bh(this,e),Jl(this,"getSdkVersion",q$(H$,"getSdkVersion")),Jl(this,"createEngine",q$(D$,"createEngine")),Jl(this,"createBLWEngine",q$(N$,"createBLWEngine")),Jl(this,"destroyEngine",q$(L$,"destroyEngine")),Jl(this,"enumerateDevices",q$(U$,"enumerateDevices")),Jl(this,"enableDevices",q$(V$,"enableDevices")),Jl(this,"enumerateAudioCaptureDevices",q$(F$,"enumerateAudioCaptureDevices")),Jl(this,"enumerateVideoCaptureDevices",q$(B$,"enumerateVideoCaptureDevices")),Jl(this,"enumerateAudioPlaybackDevices",q$(j$,"enumerateAudioPlaybackDevices")),Jl(this,"getParameter",wU),Jl(this,"setParameter",AU),Jl(this,"isSupported",q$(G$,"isSupported")),Jl(this,"getSupportedCodecs",q$(z$,"getSupportedCodecs")),Jl(this,"events",Uh),Jl(this,"ErrorCode",mC),Jl(this,"platform","VolcEngine"),Jl(this,"commitInfo","HEAD<408e957*>"),Jl(this,"downloadLog",q$(W$,"downloadLog")),Jl(this,"setLogConfig",q$(K$,"setLogConfig"))})))),Ph),Lh),{},{events:Uh})}));
//# sourceMappingURL=index.min.js.map
